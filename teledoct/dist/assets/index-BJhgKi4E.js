function Sw(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in r)){const s=Object.getOwnPropertyDescriptor(n,i);s&&Object.defineProperty(r,i,s.get?s:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var Cd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fh(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function ww(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var Fy={exports:{}},jh={},jy={exports:{}},Pr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Pu=Symbol.for("react.element"),Ew=Symbol.for("react.portal"),Rw=Symbol.for("react.fragment"),Tw=Symbol.for("react.strict_mode"),xw=Symbol.for("react.profiler"),kw=Symbol.for("react.provider"),Cw=Symbol.for("react.context"),Pw=Symbol.for("react.forward_ref"),Lw=Symbol.for("react.suspense"),Dw=Symbol.for("react.memo"),Iw=Symbol.for("react.lazy"),n0=Symbol.iterator;function Aw(r){return r===null||typeof r!="object"?null:(r=n0&&r[n0]||r["@@iterator"],typeof r=="function"?r:null)}var By={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Uy=Object.assign,$y={};function _l(r,e,t){this.props=r,this.context=e,this.refs=$y,this.updater=t||By}_l.prototype.isReactComponent={};_l.prototype.setState=function(r,e){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,e,"setState")};_l.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function Vy(){}Vy.prototype=_l.prototype;function km(r,e,t){this.props=r,this.context=e,this.refs=$y,this.updater=t||By}var Cm=km.prototype=new Vy;Cm.constructor=km;Uy(Cm,_l.prototype);Cm.isPureReactComponent=!0;var i0=Array.isArray,Gy=Object.prototype.hasOwnProperty,Pm={current:null},Hy={key:!0,ref:!0,__self:!0,__source:!0};function Wy(r,e,t){var n,i={},s=null,a=null;if(e!=null)for(n in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(s=""+e.key),e)Gy.call(e,n)&&!Hy.hasOwnProperty(n)&&(i[n]=e[n]);var c=arguments.length-2;if(c===1)i.children=t;else if(1<c){for(var o=Array(c),l=0;l<c;l++)o[l]=arguments[l+2];i.children=o}if(r&&r.defaultProps)for(n in c=r.defaultProps,c)i[n]===void 0&&(i[n]=c[n]);return{$$typeof:Pu,type:r,key:s,ref:a,props:i,_owner:Pm.current}}function Ow(r,e){return{$$typeof:Pu,type:r.type,key:e,ref:r.ref,props:r.props,_owner:r._owner}}function Lm(r){return typeof r=="object"&&r!==null&&r.$$typeof===Pu}function Mw(r){var e={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(t){return e[t]})}var s0=/\/+/g;function hp(r,e){return typeof r=="object"&&r!==null&&r.key!=null?Mw(""+r.key):e.toString(36)}function Pd(r,e,t,n,i){var s=typeof r;(s==="undefined"||s==="boolean")&&(r=null);var a=!1;if(r===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(r.$$typeof){case Pu:case Ew:a=!0}}if(a)return a=r,i=i(a),r=n===""?"."+hp(a,0):n,i0(i)?(t="",r!=null&&(t=r.replace(s0,"$&/")+"/"),Pd(i,e,t,"",function(l){return l})):i!=null&&(Lm(i)&&(i=Ow(i,t+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(s0,"$&/")+"/")+r)),e.push(i)),1;if(a=0,n=n===""?".":n+":",i0(r))for(var c=0;c<r.length;c++){s=r[c];var o=n+hp(s,c);a+=Pd(s,e,t,o,i)}else if(o=Aw(r),typeof o=="function")for(r=o.call(r),c=0;!(s=r.next()).done;)s=s.value,o=n+hp(s,c++),a+=Pd(s,e,t,o,i);else if(s==="object")throw e=String(r),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function td(r,e,t){if(r==null)return r;var n=[],i=0;return Pd(r,n,"","",function(s){return e.call(t,s,i++)}),n}function Nw(r){if(r._status===-1){var e=r._result;e=e(),e.then(function(t){(r._status===0||r._status===-1)&&(r._status=1,r._result=t)},function(t){(r._status===0||r._status===-1)&&(r._status=2,r._result=t)}),r._status===-1&&(r._status=0,r._result=e)}if(r._status===1)return r._result.default;throw r._result}var zi={current:null},Ld={transition:null},Fw={ReactCurrentDispatcher:zi,ReactCurrentBatchConfig:Ld,ReactCurrentOwner:Pm};function zy(){throw Error("act(...) is not supported in production builds of React.")}Pr.Children={map:td,forEach:function(r,e,t){td(r,function(){e.apply(this,arguments)},t)},count:function(r){var e=0;return td(r,function(){e++}),e},toArray:function(r){return td(r,function(e){return e})||[]},only:function(r){if(!Lm(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};Pr.Component=_l;Pr.Fragment=Rw;Pr.Profiler=xw;Pr.PureComponent=km;Pr.StrictMode=Tw;Pr.Suspense=Lw;Pr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Fw;Pr.act=zy;Pr.cloneElement=function(r,e,t){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var n=Uy({},r.props),i=r.key,s=r.ref,a=r._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,a=Pm.current),e.key!==void 0&&(i=""+e.key),r.type&&r.type.defaultProps)var c=r.type.defaultProps;for(o in e)Gy.call(e,o)&&!Hy.hasOwnProperty(o)&&(n[o]=e[o]===void 0&&c!==void 0?c[o]:e[o])}var o=arguments.length-2;if(o===1)n.children=t;else if(1<o){c=Array(o);for(var l=0;l<o;l++)c[l]=arguments[l+2];n.children=c}return{$$typeof:Pu,type:r.type,key:i,ref:s,props:n,_owner:a}};Pr.createContext=function(r){return r={$$typeof:Cw,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:kw,_context:r},r.Consumer=r};Pr.createElement=Wy;Pr.createFactory=function(r){var e=Wy.bind(null,r);return e.type=r,e};Pr.createRef=function(){return{current:null}};Pr.forwardRef=function(r){return{$$typeof:Pw,render:r}};Pr.isValidElement=Lm;Pr.lazy=function(r){return{$$typeof:Iw,_payload:{_status:-1,_result:r},_init:Nw}};Pr.memo=function(r,e){return{$$typeof:Dw,type:r,compare:e===void 0?null:e}};Pr.startTransition=function(r){var e=Ld.transition;Ld.transition={};try{r()}finally{Ld.transition=e}};Pr.unstable_act=zy;Pr.useCallback=function(r,e){return zi.current.useCallback(r,e)};Pr.useContext=function(r){return zi.current.useContext(r)};Pr.useDebugValue=function(){};Pr.useDeferredValue=function(r){return zi.current.useDeferredValue(r)};Pr.useEffect=function(r,e){return zi.current.useEffect(r,e)};Pr.useId=function(){return zi.current.useId()};Pr.useImperativeHandle=function(r,e,t){return zi.current.useImperativeHandle(r,e,t)};Pr.useInsertionEffect=function(r,e){return zi.current.useInsertionEffect(r,e)};Pr.useLayoutEffect=function(r,e){return zi.current.useLayoutEffect(r,e)};Pr.useMemo=function(r,e){return zi.current.useMemo(r,e)};Pr.useReducer=function(r,e,t){return zi.current.useReducer(r,e,t)};Pr.useRef=function(r){return zi.current.useRef(r)};Pr.useState=function(r){return zi.current.useState(r)};Pr.useSyncExternalStore=function(r,e,t){return zi.current.useSyncExternalStore(r,e,t)};Pr.useTransition=function(){return zi.current.useTransition()};Pr.version="18.3.1";jy.exports=Pr;var Ie=jy.exports;const gs=Fh(Ie),jw=Sw({__proto__:null,default:gs},[Ie]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bw=Ie,Uw=Symbol.for("react.element"),$w=Symbol.for("react.fragment"),Vw=Object.prototype.hasOwnProperty,Gw=Bw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Hw={key:!0,ref:!0,__self:!0,__source:!0};function Ky(r,e,t){var n,i={},s=null,a=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(a=e.ref);for(n in e)Vw.call(e,n)&&!Hw.hasOwnProperty(n)&&(i[n]=e[n]);if(r&&r.defaultProps)for(n in e=r.defaultProps,e)i[n]===void 0&&(i[n]=e[n]);return{$$typeof:Uw,type:r,key:s,ref:a,props:i,_owner:Gw.current}}jh.Fragment=$w;jh.jsx=Ky;jh.jsxs=Ky;Fy.exports=jh;var ce=Fy.exports,uf={},qy={exports:{}},_s={},Yy={exports:{}},Qy={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function e(M,U){var j=M.length;M.push(U);e:for(;0<j;){var Q=j-1>>>1,Y=M[Q];if(0<i(Y,U))M[Q]=U,M[j]=Y,j=Q;else break e}}function t(M){return M.length===0?null:M[0]}function n(M){if(M.length===0)return null;var U=M[0],j=M.pop();if(j!==U){M[0]=j;e:for(var Q=0,Y=M.length,he=Y>>>1;Q<he;){var re=2*(Q+1)-1,pe=M[re],fe=re+1,ue=M[fe];if(0>i(pe,j))fe<Y&&0>i(ue,pe)?(M[Q]=ue,M[fe]=j,Q=fe):(M[Q]=pe,M[re]=j,Q=re);else if(fe<Y&&0>i(ue,j))M[Q]=ue,M[fe]=j,Q=fe;else break e}}return U}function i(M,U){var j=M.sortIndex-U.sortIndex;return j!==0?j:M.id-U.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;r.unstable_now=function(){return s.now()}}else{var a=Date,c=a.now();r.unstable_now=function(){return a.now()-c}}var o=[],l=[],u=1,h=null,f=3,g=!1,p=!1,d=!1,m=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,S=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function R(M){for(var U=t(l);U!==null;){if(U.callback===null)n(l);else if(U.startTime<=M)n(l),U.sortIndex=U.expirationTime,e(o,U);else break;U=t(l)}}function k(M){if(d=!1,R(M),!p)if(t(o)!==null)p=!0,I(C);else{var U=t(l);U!==null&&N(k,U.startTime-M)}}function C(M,U){p=!1,d&&(d=!1,E(D),D=-1),g=!0;var j=f;try{for(R(U),h=t(o);h!==null&&(!(h.expirationTime>U)||M&&!v());){var Q=h.callback;if(typeof Q=="function"){h.callback=null,f=h.priorityLevel;var Y=Q(h.expirationTime<=U);U=r.unstable_now(),typeof Y=="function"?h.callback=Y:h===t(o)&&n(o),R(U)}else n(o);h=t(o)}if(h!==null)var he=!0;else{var re=t(l);re!==null&&N(k,re.startTime-U),he=!1}return he}finally{h=null,f=j,g=!1}}var x=!1,P=null,D=-1,b=5,w=-1;function v(){return!(r.unstable_now()-w<b)}function _(){if(P!==null){var M=r.unstable_now();w=M;var U=!0;try{U=P(!0,M)}finally{U?y():(x=!1,P=null)}}else x=!1}var y;if(typeof S=="function")y=function(){S(_)};else if(typeof MessageChannel<"u"){var T=new MessageChannel,L=T.port2;T.port1.onmessage=_,y=function(){L.postMessage(null)}}else y=function(){m(_,0)};function I(M){P=M,x||(x=!0,y())}function N(M,U){D=m(function(){M(r.unstable_now())},U)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(M){M.callback=null},r.unstable_continueExecution=function(){p||g||(p=!0,I(C))},r.unstable_forceFrameRate=function(M){0>M||125<M?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):b=0<M?Math.floor(1e3/M):5},r.unstable_getCurrentPriorityLevel=function(){return f},r.unstable_getFirstCallbackNode=function(){return t(o)},r.unstable_next=function(M){switch(f){case 1:case 2:case 3:var U=3;break;default:U=f}var j=f;f=U;try{return M()}finally{f=j}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(M,U){switch(M){case 1:case 2:case 3:case 4:case 5:break;default:M=3}var j=f;f=M;try{return U()}finally{f=j}},r.unstable_scheduleCallback=function(M,U,j){var Q=r.unstable_now();switch(typeof j=="object"&&j!==null?(j=j.delay,j=typeof j=="number"&&0<j?Q+j:Q):j=Q,M){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=j+Y,M={id:u++,callback:U,priorityLevel:M,startTime:j,expirationTime:Y,sortIndex:-1},j>Q?(M.sortIndex=j,e(l,M),t(o)===null&&M===t(l)&&(d?(E(D),D=-1):d=!0,N(k,j-Q))):(M.sortIndex=Y,e(o,M),p||g||(p=!0,I(C))),M},r.unstable_shouldYield=v,r.unstable_wrapCallback=function(M){var U=f;return function(){var j=f;f=U;try{return M.apply(this,arguments)}finally{f=j}}}})(Qy);Yy.exports=Qy;var Ww=Yy.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zw=Ie,ys=Ww;function ot(r){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+r,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+r+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Xy=new Set,au={};function oc(r,e){al(r,e),al(r+"Capture",e)}function al(r,e){for(au[r]=e,r=0;r<e.length;r++)Xy.add(e[r])}var Ma=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),df=Object.prototype.hasOwnProperty,Kw=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,a0={},o0={};function qw(r){return df.call(o0,r)?!0:df.call(a0,r)?!1:Kw.test(r)?o0[r]=!0:(a0[r]=!0,!1)}function Yw(r,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function Qw(r,e,t,n){if(e===null||typeof e>"u"||Yw(r,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ki(r,e,t,n,i,s,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=r,this.type=e,this.sanitizeURL=s,this.removeEmptyString=a}var Ci={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){Ci[r]=new Ki(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var e=r[0];Ci[e]=new Ki(e,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){Ci[r]=new Ki(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){Ci[r]=new Ki(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){Ci[r]=new Ki(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){Ci[r]=new Ki(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){Ci[r]=new Ki(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){Ci[r]=new Ki(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){Ci[r]=new Ki(r,5,!1,r.toLowerCase(),null,!1,!1)});var Dm=/[\-:]([a-z])/g;function Im(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var e=r.replace(Dm,Im);Ci[e]=new Ki(e,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var e=r.replace(Dm,Im);Ci[e]=new Ki(e,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var e=r.replace(Dm,Im);Ci[e]=new Ki(e,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){Ci[r]=new Ki(r,1,!1,r.toLowerCase(),null,!1,!1)});Ci.xlinkHref=new Ki("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){Ci[r]=new Ki(r,1,!1,r.toLowerCase(),null,!0,!0)});function Am(r,e,t,n){var i=Ci.hasOwnProperty(e)?Ci[e]:null;(i!==null?i.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Qw(e,t,i,n)&&(t=null),n||i===null?qw(e)&&(t===null?r.removeAttribute(e):r.setAttribute(e,""+t)):i.mustUseProperty?r[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,n=i.attributeNamespace,t===null?r.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,n?r.setAttributeNS(n,e,t):r.setAttribute(e,t))))}var Ba=zw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,rd=Symbol.for("react.element"),jc=Symbol.for("react.portal"),Bc=Symbol.for("react.fragment"),Om=Symbol.for("react.strict_mode"),hf=Symbol.for("react.profiler"),Jy=Symbol.for("react.provider"),Zy=Symbol.for("react.context"),Mm=Symbol.for("react.forward_ref"),pf=Symbol.for("react.suspense"),ff=Symbol.for("react.suspense_list"),Nm=Symbol.for("react.memo"),no=Symbol.for("react.lazy"),e_=Symbol.for("react.offscreen"),c0=Symbol.iterator;function Ol(r){return r===null||typeof r!="object"?null:(r=c0&&r[c0]||r["@@iterator"],typeof r=="function"?r:null)}var xn=Object.assign,pp;function Wl(r){if(pp===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);pp=e&&e[1]||""}return`
`+pp+r}var fp=!1;function mp(r,e){if(!r||fp)return"";fp=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var n=l}Reflect.construct(r,[],e)}else{try{e.call()}catch(l){n=l}r.call(e.prototype)}else{try{throw Error()}catch(l){n=l}r()}}catch(l){if(l&&n&&typeof l.stack=="string"){for(var i=l.stack.split(`
`),s=n.stack.split(`
`),a=i.length-1,c=s.length-1;1<=a&&0<=c&&i[a]!==s[c];)c--;for(;1<=a&&0<=c;a--,c--)if(i[a]!==s[c]){if(a!==1||c!==1)do if(a--,c--,0>c||i[a]!==s[c]){var o=`
`+i[a].replace(" at new "," at ");return r.displayName&&o.includes("<anonymous>")&&(o=o.replace("<anonymous>",r.displayName)),o}while(1<=a&&0<=c);break}}}finally{fp=!1,Error.prepareStackTrace=t}return(r=r?r.displayName||r.name:"")?Wl(r):""}function Xw(r){switch(r.tag){case 5:return Wl(r.type);case 16:return Wl("Lazy");case 13:return Wl("Suspense");case 19:return Wl("SuspenseList");case 0:case 2:case 15:return r=mp(r.type,!1),r;case 11:return r=mp(r.type.render,!1),r;case 1:return r=mp(r.type,!0),r;default:return""}}function mf(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Bc:return"Fragment";case jc:return"Portal";case hf:return"Profiler";case Om:return"StrictMode";case pf:return"Suspense";case ff:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case Zy:return(r.displayName||"Context")+".Consumer";case Jy:return(r._context.displayName||"Context")+".Provider";case Mm:var e=r.render;return r=r.displayName,r||(r=e.displayName||e.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case Nm:return e=r.displayName||null,e!==null?e:mf(r.type)||"Memo";case no:e=r._payload,r=r._init;try{return mf(r(e))}catch{}}return null}function Jw(r){var e=r.type;switch(r.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=e.render,r=r.displayName||r.name||"",e.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return mf(e);case 8:return e===Om?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function wo(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function t_(r){var e=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Zw(r){var e=t_(r)?"checked":"value",t=Object.getOwnPropertyDescriptor(r.constructor.prototype,e),n=""+r[e];if(!r.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(r,e,{configurable:!0,get:function(){return i.call(this)},set:function(a){n=""+a,s.call(this,a)}}),Object.defineProperty(r,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(a){n=""+a},stopTracking:function(){r._valueTracker=null,delete r[e]}}}}function nd(r){r._valueTracker||(r._valueTracker=Zw(r))}function r_(r){if(!r)return!1;var e=r._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return r&&(n=t_(r)?r.checked?"true":"false":r.value),r=n,r!==t?(e.setValue(r),!0):!1}function Xd(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function gf(r,e){var t=e.checked;return xn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??r._wrapperState.initialChecked})}function l0(r,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=wo(e.value!=null?e.value:t),r._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function n_(r,e){e=e.checked,e!=null&&Am(r,"checked",e,!1)}function vf(r,e){n_(r,e);var t=wo(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&r.value===""||r.value!=t)&&(r.value=""+t):r.value!==""+t&&(r.value=""+t);else if(n==="submit"||n==="reset"){r.removeAttribute("value");return}e.hasOwnProperty("value")?yf(r,e.type,t):e.hasOwnProperty("defaultValue")&&yf(r,e.type,wo(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(r.defaultChecked=!!e.defaultChecked)}function u0(r,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+r._wrapperState.initialValue,t||e===r.value||(r.value=e),r.defaultValue=e}t=r.name,t!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,t!==""&&(r.name=t)}function yf(r,e,t){(e!=="number"||Xd(r.ownerDocument)!==r)&&(t==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+t&&(r.defaultValue=""+t))}var zl=Array.isArray;function Xc(r,e,t,n){if(r=r.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<r.length;t++)i=e.hasOwnProperty("$"+r[t].value),r[t].selected!==i&&(r[t].selected=i),i&&n&&(r[t].defaultSelected=!0)}else{for(t=""+wo(t),e=null,i=0;i<r.length;i++){if(r[i].value===t){r[i].selected=!0,n&&(r[i].defaultSelected=!0);return}e!==null||r[i].disabled||(e=r[i])}e!==null&&(e.selected=!0)}}function _f(r,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ot(91));return xn({},e,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function d0(r,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(ot(92));if(zl(t)){if(1<t.length)throw Error(ot(93));t=t[0]}e=t}e==null&&(e=""),t=e}r._wrapperState={initialValue:wo(t)}}function i_(r,e){var t=wo(e.value),n=wo(e.defaultValue);t!=null&&(t=""+t,t!==r.value&&(r.value=t),e.defaultValue==null&&r.defaultValue!==t&&(r.defaultValue=t)),n!=null&&(r.defaultValue=""+n)}function h0(r){var e=r.textContent;e===r._wrapperState.initialValue&&e!==""&&e!==null&&(r.value=e)}function s_(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function bf(r,e){return r==null||r==="http://www.w3.org/1999/xhtml"?s_(e):r==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var id,a_=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction(function(){return r(e,t,n,i)})}:r}(function(r,e){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=e;else{for(id=id||document.createElement("div"),id.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=id.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;e.firstChild;)r.appendChild(e.firstChild)}});function ou(r,e){if(e){var t=r.firstChild;if(t&&t===r.lastChild&&t.nodeType===3){t.nodeValue=e;return}}r.textContent=e}var Ql={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},eE=["Webkit","ms","Moz","O"];Object.keys(Ql).forEach(function(r){eE.forEach(function(e){e=e+r.charAt(0).toUpperCase()+r.substring(1),Ql[e]=Ql[r]})});function o_(r,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Ql.hasOwnProperty(r)&&Ql[r]?(""+e).trim():e+"px"}function c_(r,e){r=r.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,i=o_(t,e[t],n);t==="float"&&(t="cssFloat"),n?r.setProperty(t,i):r[t]=i}}var tE=xn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Sf(r,e){if(e){if(tE[r]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ot(137,r));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ot(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ot(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ot(62))}}function wf(r,e){if(r.indexOf("-")===-1)return typeof e.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ef=null;function Fm(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Rf=null,Jc=null,Zc=null;function p0(r){if(r=Iu(r)){if(typeof Rf!="function")throw Error(ot(280));var e=r.stateNode;e&&(e=Gh(e),Rf(r.stateNode,r.type,e))}}function l_(r){Jc?Zc?Zc.push(r):Zc=[r]:Jc=r}function u_(){if(Jc){var r=Jc,e=Zc;if(Zc=Jc=null,p0(r),e)for(r=0;r<e.length;r++)p0(e[r])}}function d_(r,e){return r(e)}function h_(){}var gp=!1;function p_(r,e,t){if(gp)return r(e,t);gp=!0;try{return d_(r,e,t)}finally{gp=!1,(Jc!==null||Zc!==null)&&(h_(),u_())}}function cu(r,e){var t=r.stateNode;if(t===null)return null;var n=Gh(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(r=r.type,n=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!n;break e;default:r=!1}if(r)return null;if(t&&typeof t!="function")throw Error(ot(231,e,typeof t));return t}var Tf=!1;if(Ma)try{var Ml={};Object.defineProperty(Ml,"passive",{get:function(){Tf=!0}}),window.addEventListener("test",Ml,Ml),window.removeEventListener("test",Ml,Ml)}catch{Tf=!1}function rE(r,e,t,n,i,s,a,c,o){var l=Array.prototype.slice.call(arguments,3);try{e.apply(t,l)}catch(u){this.onError(u)}}var Xl=!1,Jd=null,Zd=!1,xf=null,nE={onError:function(r){Xl=!0,Jd=r}};function iE(r,e,t,n,i,s,a,c,o){Xl=!1,Jd=null,rE.apply(nE,arguments)}function sE(r,e,t,n,i,s,a,c,o){if(iE.apply(this,arguments),Xl){if(Xl){var l=Jd;Xl=!1,Jd=null}else throw Error(ot(198));Zd||(Zd=!0,xf=l)}}function cc(r){var e=r,t=r;if(r.alternate)for(;e.return;)e=e.return;else{r=e;do e=r,e.flags&4098&&(t=e.return),r=e.return;while(r)}return e.tag===3?t:null}function f_(r){if(r.tag===13){var e=r.memoizedState;if(e===null&&(r=r.alternate,r!==null&&(e=r.memoizedState)),e!==null)return e.dehydrated}return null}function f0(r){if(cc(r)!==r)throw Error(ot(188))}function aE(r){var e=r.alternate;if(!e){if(e=cc(r),e===null)throw Error(ot(188));return e!==r?null:r}for(var t=r,n=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(n=i.return,n!==null){t=n;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return f0(i),r;if(s===n)return f0(i),e;s=s.sibling}throw Error(ot(188))}if(t.return!==n.return)t=i,n=s;else{for(var a=!1,c=i.child;c;){if(c===t){a=!0,t=i,n=s;break}if(c===n){a=!0,n=i,t=s;break}c=c.sibling}if(!a){for(c=s.child;c;){if(c===t){a=!0,t=s,n=i;break}if(c===n){a=!0,n=s,t=i;break}c=c.sibling}if(!a)throw Error(ot(189))}}if(t.alternate!==n)throw Error(ot(190))}if(t.tag!==3)throw Error(ot(188));return t.stateNode.current===t?r:e}function m_(r){return r=aE(r),r!==null?g_(r):null}function g_(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var e=g_(r);if(e!==null)return e;r=r.sibling}return null}var v_=ys.unstable_scheduleCallback,m0=ys.unstable_cancelCallback,oE=ys.unstable_shouldYield,cE=ys.unstable_requestPaint,Un=ys.unstable_now,lE=ys.unstable_getCurrentPriorityLevel,jm=ys.unstable_ImmediatePriority,y_=ys.unstable_UserBlockingPriority,eh=ys.unstable_NormalPriority,uE=ys.unstable_LowPriority,__=ys.unstable_IdlePriority,Bh=null,ua=null;function dE(r){if(ua&&typeof ua.onCommitFiberRoot=="function")try{ua.onCommitFiberRoot(Bh,r,void 0,(r.current.flags&128)===128)}catch{}}var Ks=Math.clz32?Math.clz32:fE,hE=Math.log,pE=Math.LN2;function fE(r){return r>>>=0,r===0?32:31-(hE(r)/pE|0)|0}var sd=64,ad=4194304;function Kl(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function th(r,e){var t=r.pendingLanes;if(t===0)return 0;var n=0,i=r.suspendedLanes,s=r.pingedLanes,a=t&268435455;if(a!==0){var c=a&~i;c!==0?n=Kl(c):(s&=a,s!==0&&(n=Kl(s)))}else a=t&~i,a!==0?n=Kl(a):s!==0&&(n=Kl(s));if(n===0)return 0;if(e!==0&&e!==n&&!(e&i)&&(i=n&-n,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(n&4&&(n|=t&16),e=r.entangledLanes,e!==0)for(r=r.entanglements,e&=n;0<e;)t=31-Ks(e),i=1<<t,n|=r[t],e&=~i;return n}function mE(r,e){switch(r){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function gE(r,e){for(var t=r.suspendedLanes,n=r.pingedLanes,i=r.expirationTimes,s=r.pendingLanes;0<s;){var a=31-Ks(s),c=1<<a,o=i[a];o===-1?(!(c&t)||c&n)&&(i[a]=mE(c,e)):o<=e&&(r.expiredLanes|=c),s&=~c}}function kf(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function b_(){var r=sd;return sd<<=1,!(sd&4194240)&&(sd=64),r}function vp(r){for(var e=[],t=0;31>t;t++)e.push(r);return e}function Lu(r,e,t){r.pendingLanes|=e,e!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,e=31-Ks(e),r[e]=t}function vE(r,e){var t=r.pendingLanes&~e;r.pendingLanes=e,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=e,r.mutableReadLanes&=e,r.entangledLanes&=e,e=r.entanglements;var n=r.eventTimes;for(r=r.expirationTimes;0<t;){var i=31-Ks(t),s=1<<i;e[i]=0,n[i]=-1,r[i]=-1,t&=~s}}function Bm(r,e){var t=r.entangledLanes|=e;for(r=r.entanglements;t;){var n=31-Ks(t),i=1<<n;i&e|r[n]&e&&(r[n]|=e),t&=~i}}var Hr=0;function S_(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var w_,Um,E_,R_,T_,Cf=!1,od=[],po=null,fo=null,mo=null,lu=new Map,uu=new Map,ao=[],yE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function g0(r,e){switch(r){case"focusin":case"focusout":po=null;break;case"dragenter":case"dragleave":fo=null;break;case"mouseover":case"mouseout":mo=null;break;case"pointerover":case"pointerout":lu.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":uu.delete(e.pointerId)}}function Nl(r,e,t,n,i,s){return r===null||r.nativeEvent!==s?(r={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:s,targetContainers:[i]},e!==null&&(e=Iu(e),e!==null&&Um(e)),r):(r.eventSystemFlags|=n,e=r.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),r)}function _E(r,e,t,n,i){switch(e){case"focusin":return po=Nl(po,r,e,t,n,i),!0;case"dragenter":return fo=Nl(fo,r,e,t,n,i),!0;case"mouseover":return mo=Nl(mo,r,e,t,n,i),!0;case"pointerover":var s=i.pointerId;return lu.set(s,Nl(lu.get(s)||null,r,e,t,n,i)),!0;case"gotpointercapture":return s=i.pointerId,uu.set(s,Nl(uu.get(s)||null,r,e,t,n,i)),!0}return!1}function x_(r){var e=qo(r.target);if(e!==null){var t=cc(e);if(t!==null){if(e=t.tag,e===13){if(e=f_(t),e!==null){r.blockedOn=e,T_(r.priority,function(){E_(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){r.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Dd(r){if(r.blockedOn!==null)return!1;for(var e=r.targetContainers;0<e.length;){var t=Pf(r.domEventName,r.eventSystemFlags,e[0],r.nativeEvent);if(t===null){t=r.nativeEvent;var n=new t.constructor(t.type,t);Ef=n,t.target.dispatchEvent(n),Ef=null}else return e=Iu(t),e!==null&&Um(e),r.blockedOn=t,!1;e.shift()}return!0}function v0(r,e,t){Dd(r)&&t.delete(e)}function bE(){Cf=!1,po!==null&&Dd(po)&&(po=null),fo!==null&&Dd(fo)&&(fo=null),mo!==null&&Dd(mo)&&(mo=null),lu.forEach(v0),uu.forEach(v0)}function Fl(r,e){r.blockedOn===e&&(r.blockedOn=null,Cf||(Cf=!0,ys.unstable_scheduleCallback(ys.unstable_NormalPriority,bE)))}function du(r){function e(i){return Fl(i,r)}if(0<od.length){Fl(od[0],r);for(var t=1;t<od.length;t++){var n=od[t];n.blockedOn===r&&(n.blockedOn=null)}}for(po!==null&&Fl(po,r),fo!==null&&Fl(fo,r),mo!==null&&Fl(mo,r),lu.forEach(e),uu.forEach(e),t=0;t<ao.length;t++)n=ao[t],n.blockedOn===r&&(n.blockedOn=null);for(;0<ao.length&&(t=ao[0],t.blockedOn===null);)x_(t),t.blockedOn===null&&ao.shift()}var el=Ba.ReactCurrentBatchConfig,rh=!0;function SE(r,e,t,n){var i=Hr,s=el.transition;el.transition=null;try{Hr=1,$m(r,e,t,n)}finally{Hr=i,el.transition=s}}function wE(r,e,t,n){var i=Hr,s=el.transition;el.transition=null;try{Hr=4,$m(r,e,t,n)}finally{Hr=i,el.transition=s}}function $m(r,e,t,n){if(rh){var i=Pf(r,e,t,n);if(i===null)kp(r,e,n,nh,t),g0(r,n);else if(_E(i,r,e,t,n))n.stopPropagation();else if(g0(r,n),e&4&&-1<yE.indexOf(r)){for(;i!==null;){var s=Iu(i);if(s!==null&&w_(s),s=Pf(r,e,t,n),s===null&&kp(r,e,n,nh,t),s===i)break;i=s}i!==null&&n.stopPropagation()}else kp(r,e,n,null,t)}}var nh=null;function Pf(r,e,t,n){if(nh=null,r=Fm(n),r=qo(r),r!==null)if(e=cc(r),e===null)r=null;else if(t=e.tag,t===13){if(r=f_(e),r!==null)return r;r=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;r=null}else e!==r&&(r=null);return nh=r,null}function k_(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(lE()){case jm:return 1;case y_:return 4;case eh:case uE:return 16;case __:return 536870912;default:return 16}default:return 16}}var co=null,Vm=null,Id=null;function C_(){if(Id)return Id;var r,e=Vm,t=e.length,n,i="value"in co?co.value:co.textContent,s=i.length;for(r=0;r<t&&e[r]===i[r];r++);var a=t-r;for(n=1;n<=a&&e[t-n]===i[s-n];n++);return Id=i.slice(r,1<n?1-n:void 0)}function Ad(r){var e=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&e===13&&(r=13)):r=e,r===10&&(r=13),32<=r||r===13?r:0}function cd(){return!0}function y0(){return!1}function bs(r){function e(t,n,i,s,a){this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var c in r)r.hasOwnProperty(c)&&(t=r[c],this[c]=t?t(s):s[c]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?cd:y0,this.isPropagationStopped=y0,this}return xn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=cd)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=cd)},persist:function(){},isPersistent:cd}),e}var bl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Gm=bs(bl),Du=xn({},bl,{view:0,detail:0}),EE=bs(Du),yp,_p,jl,Uh=xn({},Du,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hm,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==jl&&(jl&&r.type==="mousemove"?(yp=r.screenX-jl.screenX,_p=r.screenY-jl.screenY):_p=yp=0,jl=r),yp)},movementY:function(r){return"movementY"in r?r.movementY:_p}}),_0=bs(Uh),RE=xn({},Uh,{dataTransfer:0}),TE=bs(RE),xE=xn({},Du,{relatedTarget:0}),bp=bs(xE),kE=xn({},bl,{animationName:0,elapsedTime:0,pseudoElement:0}),CE=bs(kE),PE=xn({},bl,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),LE=bs(PE),DE=xn({},bl,{data:0}),b0=bs(DE),IE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},AE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},OE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ME(r){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(r):(r=OE[r])?!!e[r]:!1}function Hm(){return ME}var NE=xn({},Du,{key:function(r){if(r.key){var e=IE[r.key]||r.key;if(e!=="Unidentified")return e}return r.type==="keypress"?(r=Ad(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?AE[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hm,charCode:function(r){return r.type==="keypress"?Ad(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Ad(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),FE=bs(NE),jE=xn({},Uh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),S0=bs(jE),BE=xn({},Du,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hm}),UE=bs(BE),$E=xn({},bl,{propertyName:0,elapsedTime:0,pseudoElement:0}),VE=bs($E),GE=xn({},Uh,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),HE=bs(GE),WE=[9,13,27,32],Wm=Ma&&"CompositionEvent"in window,Jl=null;Ma&&"documentMode"in document&&(Jl=document.documentMode);var zE=Ma&&"TextEvent"in window&&!Jl,P_=Ma&&(!Wm||Jl&&8<Jl&&11>=Jl),w0=" ",E0=!1;function L_(r,e){switch(r){case"keyup":return WE.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function D_(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Uc=!1;function KE(r,e){switch(r){case"compositionend":return D_(e);case"keypress":return e.which!==32?null:(E0=!0,w0);case"textInput":return r=e.data,r===w0&&E0?null:r;default:return null}}function qE(r,e){if(Uc)return r==="compositionend"||!Wm&&L_(r,e)?(r=C_(),Id=Vm=co=null,Uc=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return P_&&e.locale!=="ko"?null:e.data;default:return null}}var YE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function R0(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e==="input"?!!YE[r.type]:e==="textarea"}function I_(r,e,t,n){l_(n),e=ih(e,"onChange"),0<e.length&&(t=new Gm("onChange","change",null,t,n),r.push({event:t,listeners:e}))}var Zl=null,hu=null;function QE(r){G_(r,0)}function $h(r){var e=Gc(r);if(r_(e))return r}function XE(r,e){if(r==="change")return e}var A_=!1;if(Ma){var Sp;if(Ma){var wp="oninput"in document;if(!wp){var T0=document.createElement("div");T0.setAttribute("oninput","return;"),wp=typeof T0.oninput=="function"}Sp=wp}else Sp=!1;A_=Sp&&(!document.documentMode||9<document.documentMode)}function x0(){Zl&&(Zl.detachEvent("onpropertychange",O_),hu=Zl=null)}function O_(r){if(r.propertyName==="value"&&$h(hu)){var e=[];I_(e,hu,r,Fm(r)),p_(QE,e)}}function JE(r,e,t){r==="focusin"?(x0(),Zl=e,hu=t,Zl.attachEvent("onpropertychange",O_)):r==="focusout"&&x0()}function ZE(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return $h(hu)}function eR(r,e){if(r==="click")return $h(e)}function tR(r,e){if(r==="input"||r==="change")return $h(e)}function rR(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var Ys=typeof Object.is=="function"?Object.is:rR;function pu(r,e){if(Ys(r,e))return!0;if(typeof r!="object"||r===null||typeof e!="object"||e===null)return!1;var t=Object.keys(r),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var i=t[n];if(!df.call(e,i)||!Ys(r[i],e[i]))return!1}return!0}function k0(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function C0(r,e){var t=k0(r);r=0;for(var n;t;){if(t.nodeType===3){if(n=r+t.textContent.length,r<=e&&n>=e)return{node:t,offset:e-r};r=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=k0(t)}}function M_(r,e){return r&&e?r===e?!0:r&&r.nodeType===3?!1:e&&e.nodeType===3?M_(r,e.parentNode):"contains"in r?r.contains(e):r.compareDocumentPosition?!!(r.compareDocumentPosition(e)&16):!1:!1}function N_(){for(var r=window,e=Xd();e instanceof r.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)r=e.contentWindow;else break;e=Xd(r.document)}return e}function zm(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e&&(e==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||e==="textarea"||r.contentEditable==="true")}function nR(r){var e=N_(),t=r.focusedElem,n=r.selectionRange;if(e!==t&&t&&t.ownerDocument&&M_(t.ownerDocument.documentElement,t)){if(n!==null&&zm(t)){if(e=n.start,r=n.end,r===void 0&&(r=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(r,t.value.length);else if(r=(e=t.ownerDocument||document)&&e.defaultView||window,r.getSelection){r=r.getSelection();var i=t.textContent.length,s=Math.min(n.start,i);n=n.end===void 0?s:Math.min(n.end,i),!r.extend&&s>n&&(i=n,n=s,s=i),i=C0(t,s);var a=C0(t,n);i&&a&&(r.rangeCount!==1||r.anchorNode!==i.node||r.anchorOffset!==i.offset||r.focusNode!==a.node||r.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),r.removeAllRanges(),s>n?(r.addRange(e),r.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),r.addRange(e)))}}for(e=[],r=t;r=r.parentNode;)r.nodeType===1&&e.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)r=e[t],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var iR=Ma&&"documentMode"in document&&11>=document.documentMode,$c=null,Lf=null,eu=null,Df=!1;function P0(r,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Df||$c==null||$c!==Xd(n)||(n=$c,"selectionStart"in n&&zm(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),eu&&pu(eu,n)||(eu=n,n=ih(Lf,"onSelect"),0<n.length&&(e=new Gm("onSelect","select",null,e,t),r.push({event:e,listeners:n}),e.target=$c)))}function ld(r,e){var t={};return t[r.toLowerCase()]=e.toLowerCase(),t["Webkit"+r]="webkit"+e,t["Moz"+r]="moz"+e,t}var Vc={animationend:ld("Animation","AnimationEnd"),animationiteration:ld("Animation","AnimationIteration"),animationstart:ld("Animation","AnimationStart"),transitionend:ld("Transition","TransitionEnd")},Ep={},F_={};Ma&&(F_=document.createElement("div").style,"AnimationEvent"in window||(delete Vc.animationend.animation,delete Vc.animationiteration.animation,delete Vc.animationstart.animation),"TransitionEvent"in window||delete Vc.transitionend.transition);function Vh(r){if(Ep[r])return Ep[r];if(!Vc[r])return r;var e=Vc[r],t;for(t in e)if(e.hasOwnProperty(t)&&t in F_)return Ep[r]=e[t];return r}var j_=Vh("animationend"),B_=Vh("animationiteration"),U_=Vh("animationstart"),$_=Vh("transitionend"),V_=new Map,L0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ro(r,e){V_.set(r,e),oc(e,[r])}for(var Rp=0;Rp<L0.length;Rp++){var Tp=L0[Rp],sR=Tp.toLowerCase(),aR=Tp[0].toUpperCase()+Tp.slice(1);Ro(sR,"on"+aR)}Ro(j_,"onAnimationEnd");Ro(B_,"onAnimationIteration");Ro(U_,"onAnimationStart");Ro("dblclick","onDoubleClick");Ro("focusin","onFocus");Ro("focusout","onBlur");Ro($_,"onTransitionEnd");al("onMouseEnter",["mouseout","mouseover"]);al("onMouseLeave",["mouseout","mouseover"]);al("onPointerEnter",["pointerout","pointerover"]);al("onPointerLeave",["pointerout","pointerover"]);oc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));oc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));oc("onBeforeInput",["compositionend","keypress","textInput","paste"]);oc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));oc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));oc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ql="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),oR=new Set("cancel close invalid load scroll toggle".split(" ").concat(ql));function D0(r,e,t){var n=r.type||"unknown-event";r.currentTarget=t,sE(n,e,void 0,r),r.currentTarget=null}function G_(r,e){e=(e&4)!==0;for(var t=0;t<r.length;t++){var n=r[t],i=n.event;n=n.listeners;e:{var s=void 0;if(e)for(var a=n.length-1;0<=a;a--){var c=n[a],o=c.instance,l=c.currentTarget;if(c=c.listener,o!==s&&i.isPropagationStopped())break e;D0(i,c,l),s=o}else for(a=0;a<n.length;a++){if(c=n[a],o=c.instance,l=c.currentTarget,c=c.listener,o!==s&&i.isPropagationStopped())break e;D0(i,c,l),s=o}}}if(Zd)throw r=xf,Zd=!1,xf=null,r}function un(r,e){var t=e[Nf];t===void 0&&(t=e[Nf]=new Set);var n=r+"__bubble";t.has(n)||(H_(e,r,2,!1),t.add(n))}function xp(r,e,t){var n=0;e&&(n|=4),H_(t,r,n,e)}var ud="_reactListening"+Math.random().toString(36).slice(2);function fu(r){if(!r[ud]){r[ud]=!0,Xy.forEach(function(t){t!=="selectionchange"&&(oR.has(t)||xp(t,!1,r),xp(t,!0,r))});var e=r.nodeType===9?r:r.ownerDocument;e===null||e[ud]||(e[ud]=!0,xp("selectionchange",!1,e))}}function H_(r,e,t,n){switch(k_(e)){case 1:var i=SE;break;case 4:i=wE;break;default:i=$m}t=i.bind(null,e,t,r),i=void 0,!Tf||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),n?i!==void 0?r.addEventListener(e,t,{capture:!0,passive:i}):r.addEventListener(e,t,!0):i!==void 0?r.addEventListener(e,t,{passive:i}):r.addEventListener(e,t,!1)}function kp(r,e,t,n,i){var s=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var a=n.tag;if(a===3||a===4){var c=n.stateNode.containerInfo;if(c===i||c.nodeType===8&&c.parentNode===i)break;if(a===4)for(a=n.return;a!==null;){var o=a.tag;if((o===3||o===4)&&(o=a.stateNode.containerInfo,o===i||o.nodeType===8&&o.parentNode===i))return;a=a.return}for(;c!==null;){if(a=qo(c),a===null)return;if(o=a.tag,o===5||o===6){n=s=a;continue e}c=c.parentNode}}n=n.return}p_(function(){var l=s,u=Fm(t),h=[];e:{var f=V_.get(r);if(f!==void 0){var g=Gm,p=r;switch(r){case"keypress":if(Ad(t)===0)break e;case"keydown":case"keyup":g=FE;break;case"focusin":p="focus",g=bp;break;case"focusout":p="blur",g=bp;break;case"beforeblur":case"afterblur":g=bp;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":g=_0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":g=TE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":g=UE;break;case j_:case B_:case U_:g=CE;break;case $_:g=VE;break;case"scroll":g=EE;break;case"wheel":g=HE;break;case"copy":case"cut":case"paste":g=LE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":g=S0}var d=(e&4)!==0,m=!d&&r==="scroll",E=d?f!==null?f+"Capture":null:f;d=[];for(var S=l,R;S!==null;){R=S;var k=R.stateNode;if(R.tag===5&&k!==null&&(R=k,E!==null&&(k=cu(S,E),k!=null&&d.push(mu(S,k,R)))),m)break;S=S.return}0<d.length&&(f=new g(f,p,null,t,u),h.push({event:f,listeners:d}))}}if(!(e&7)){e:{if(f=r==="mouseover"||r==="pointerover",g=r==="mouseout"||r==="pointerout",f&&t!==Ef&&(p=t.relatedTarget||t.fromElement)&&(qo(p)||p[Na]))break e;if((g||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,g?(p=t.relatedTarget||t.toElement,g=l,p=p?qo(p):null,p!==null&&(m=cc(p),p!==m||p.tag!==5&&p.tag!==6)&&(p=null)):(g=null,p=l),g!==p)){if(d=_0,k="onMouseLeave",E="onMouseEnter",S="mouse",(r==="pointerout"||r==="pointerover")&&(d=S0,k="onPointerLeave",E="onPointerEnter",S="pointer"),m=g==null?f:Gc(g),R=p==null?f:Gc(p),f=new d(k,S+"leave",g,t,u),f.target=m,f.relatedTarget=R,k=null,qo(u)===l&&(d=new d(E,S+"enter",p,t,u),d.target=R,d.relatedTarget=m,k=d),m=k,g&&p)t:{for(d=g,E=p,S=0,R=d;R;R=kc(R))S++;for(R=0,k=E;k;k=kc(k))R++;for(;0<S-R;)d=kc(d),S--;for(;0<R-S;)E=kc(E),R--;for(;S--;){if(d===E||E!==null&&d===E.alternate)break t;d=kc(d),E=kc(E)}d=null}else d=null;g!==null&&I0(h,f,g,d,!1),p!==null&&m!==null&&I0(h,m,p,d,!0)}}e:{if(f=l?Gc(l):window,g=f.nodeName&&f.nodeName.toLowerCase(),g==="select"||g==="input"&&f.type==="file")var C=XE;else if(R0(f))if(A_)C=tR;else{C=ZE;var x=JE}else(g=f.nodeName)&&g.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(C=eR);if(C&&(C=C(r,l))){I_(h,C,t,u);break e}x&&x(r,f,l),r==="focusout"&&(x=f._wrapperState)&&x.controlled&&f.type==="number"&&yf(f,"number",f.value)}switch(x=l?Gc(l):window,r){case"focusin":(R0(x)||x.contentEditable==="true")&&($c=x,Lf=l,eu=null);break;case"focusout":eu=Lf=$c=null;break;case"mousedown":Df=!0;break;case"contextmenu":case"mouseup":case"dragend":Df=!1,P0(h,t,u);break;case"selectionchange":if(iR)break;case"keydown":case"keyup":P0(h,t,u)}var P;if(Wm)e:{switch(r){case"compositionstart":var D="onCompositionStart";break e;case"compositionend":D="onCompositionEnd";break e;case"compositionupdate":D="onCompositionUpdate";break e}D=void 0}else Uc?L_(r,t)&&(D="onCompositionEnd"):r==="keydown"&&t.keyCode===229&&(D="onCompositionStart");D&&(P_&&t.locale!=="ko"&&(Uc||D!=="onCompositionStart"?D==="onCompositionEnd"&&Uc&&(P=C_()):(co=u,Vm="value"in co?co.value:co.textContent,Uc=!0)),x=ih(l,D),0<x.length&&(D=new b0(D,r,null,t,u),h.push({event:D,listeners:x}),P?D.data=P:(P=D_(t),P!==null&&(D.data=P)))),(P=zE?KE(r,t):qE(r,t))&&(l=ih(l,"onBeforeInput"),0<l.length&&(u=new b0("onBeforeInput","beforeinput",null,t,u),h.push({event:u,listeners:l}),u.data=P))}G_(h,e)})}function mu(r,e,t){return{instance:r,listener:e,currentTarget:t}}function ih(r,e){for(var t=e+"Capture",n=[];r!==null;){var i=r,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=cu(r,t),s!=null&&n.unshift(mu(r,s,i)),s=cu(r,e),s!=null&&n.push(mu(r,s,i))),r=r.return}return n}function kc(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function I0(r,e,t,n,i){for(var s=e._reactName,a=[];t!==null&&t!==n;){var c=t,o=c.alternate,l=c.stateNode;if(o!==null&&o===n)break;c.tag===5&&l!==null&&(c=l,i?(o=cu(t,s),o!=null&&a.unshift(mu(t,o,c))):i||(o=cu(t,s),o!=null&&a.push(mu(t,o,c)))),t=t.return}a.length!==0&&r.push({event:e,listeners:a})}var cR=/\r\n?/g,lR=/\u0000|\uFFFD/g;function A0(r){return(typeof r=="string"?r:""+r).replace(cR,`
`).replace(lR,"")}function dd(r,e,t){if(e=A0(e),A0(r)!==e&&t)throw Error(ot(425))}function sh(){}var If=null,Af=null;function Of(r,e){return r==="textarea"||r==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Mf=typeof setTimeout=="function"?setTimeout:void 0,uR=typeof clearTimeout=="function"?clearTimeout:void 0,O0=typeof Promise=="function"?Promise:void 0,dR=typeof queueMicrotask=="function"?queueMicrotask:typeof O0<"u"?function(r){return O0.resolve(null).then(r).catch(hR)}:Mf;function hR(r){setTimeout(function(){throw r})}function Cp(r,e){var t=e,n=0;do{var i=t.nextSibling;if(r.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(n===0){r.removeChild(i),du(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=i}while(t);du(e)}function go(r){for(;r!=null;r=r.nextSibling){var e=r.nodeType;if(e===1||e===3)break;if(e===8){if(e=r.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return r}function M0(r){r=r.previousSibling;for(var e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return r;e--}else t==="/$"&&e++}r=r.previousSibling}return null}var Sl=Math.random().toString(36).slice(2),oa="__reactFiber$"+Sl,gu="__reactProps$"+Sl,Na="__reactContainer$"+Sl,Nf="__reactEvents$"+Sl,pR="__reactListeners$"+Sl,fR="__reactHandles$"+Sl;function qo(r){var e=r[oa];if(e)return e;for(var t=r.parentNode;t;){if(e=t[Na]||t[oa]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(r=M0(r);r!==null;){if(t=r[oa])return t;r=M0(r)}return e}r=t,t=r.parentNode}return null}function Iu(r){return r=r[oa]||r[Na],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Gc(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(ot(33))}function Gh(r){return r[gu]||null}var Ff=[],Hc=-1;function To(r){return{current:r}}function dn(r){0>Hc||(r.current=Ff[Hc],Ff[Hc]=null,Hc--)}function sn(r,e){Hc++,Ff[Hc]=r.current,r.current=e}var Eo={},ji=To(Eo),rs=To(!1),tc=Eo;function ol(r,e){var t=r.type.contextTypes;if(!t)return Eo;var n=r.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=e,r.__reactInternalMemoizedMaskedChildContext=i),i}function ns(r){return r=r.childContextTypes,r!=null}function ah(){dn(rs),dn(ji)}function N0(r,e,t){if(ji.current!==Eo)throw Error(ot(168));sn(ji,e),sn(rs,t)}function W_(r,e,t){var n=r.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var i in n)if(!(i in e))throw Error(ot(108,Jw(r)||"Unknown",i));return xn({},t,n)}function oh(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Eo,tc=ji.current,sn(ji,r),sn(rs,rs.current),!0}function F0(r,e,t){var n=r.stateNode;if(!n)throw Error(ot(169));t?(r=W_(r,e,tc),n.__reactInternalMemoizedMergedChildContext=r,dn(rs),dn(ji),sn(ji,r)):dn(rs),sn(rs,t)}var Da=null,Hh=!1,Pp=!1;function z_(r){Da===null?Da=[r]:Da.push(r)}function mR(r){Hh=!0,z_(r)}function xo(){if(!Pp&&Da!==null){Pp=!0;var r=0,e=Hr;try{var t=Da;for(Hr=1;r<t.length;r++){var n=t[r];do n=n(!0);while(n!==null)}Da=null,Hh=!1}catch(i){throw Da!==null&&(Da=Da.slice(r+1)),v_(jm,xo),i}finally{Hr=e,Pp=!1}}return null}var Wc=[],zc=0,ch=null,lh=0,xs=[],ks=0,rc=null,Ia=1,Aa="";function Wo(r,e){Wc[zc++]=lh,Wc[zc++]=ch,ch=r,lh=e}function K_(r,e,t){xs[ks++]=Ia,xs[ks++]=Aa,xs[ks++]=rc,rc=r;var n=Ia;r=Aa;var i=32-Ks(n)-1;n&=~(1<<i),t+=1;var s=32-Ks(e)+i;if(30<s){var a=i-i%5;s=(n&(1<<a)-1).toString(32),n>>=a,i-=a,Ia=1<<32-Ks(e)+i|t<<i|n,Aa=s+r}else Ia=1<<s|t<<i|n,Aa=r}function Km(r){r.return!==null&&(Wo(r,1),K_(r,1,0))}function qm(r){for(;r===ch;)ch=Wc[--zc],Wc[zc]=null,lh=Wc[--zc],Wc[zc]=null;for(;r===rc;)rc=xs[--ks],xs[ks]=null,Aa=xs[--ks],xs[ks]=null,Ia=xs[--ks],xs[ks]=null}var vs=null,ms=null,gn=!1,Ws=null;function q_(r,e){var t=Cs(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=r,e=r.deletions,e===null?(r.deletions=[t],r.flags|=16):e.push(t)}function j0(r,e){switch(r.tag){case 5:var t=r.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(r.stateNode=e,vs=r,ms=go(e.firstChild),!0):!1;case 6:return e=r.pendingProps===""||e.nodeType!==3?null:e,e!==null?(r.stateNode=e,vs=r,ms=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=rc!==null?{id:Ia,overflow:Aa}:null,r.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Cs(18,null,null,0),t.stateNode=e,t.return=r,r.child=t,vs=r,ms=null,!0):!1;default:return!1}}function jf(r){return(r.mode&1)!==0&&(r.flags&128)===0}function Bf(r){if(gn){var e=ms;if(e){var t=e;if(!j0(r,e)){if(jf(r))throw Error(ot(418));e=go(t.nextSibling);var n=vs;e&&j0(r,e)?q_(n,t):(r.flags=r.flags&-4097|2,gn=!1,vs=r)}}else{if(jf(r))throw Error(ot(418));r.flags=r.flags&-4097|2,gn=!1,vs=r}}}function B0(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;vs=r}function hd(r){if(r!==vs)return!1;if(!gn)return B0(r),gn=!0,!1;var e;if((e=r.tag!==3)&&!(e=r.tag!==5)&&(e=r.type,e=e!=="head"&&e!=="body"&&!Of(r.type,r.memoizedProps)),e&&(e=ms)){if(jf(r))throw Y_(),Error(ot(418));for(;e;)q_(r,e),e=go(e.nextSibling)}if(B0(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(ot(317));e:{for(r=r.nextSibling,e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="/$"){if(e===0){ms=go(r.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}r=r.nextSibling}ms=null}}else ms=vs?go(r.stateNode.nextSibling):null;return!0}function Y_(){for(var r=ms;r;)r=go(r.nextSibling)}function cl(){ms=vs=null,gn=!1}function Ym(r){Ws===null?Ws=[r]:Ws.push(r)}var gR=Ba.ReactCurrentBatchConfig;function Bl(r,e,t){if(r=t.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(ot(309));var n=t.stateNode}if(!n)throw Error(ot(147,r));var i=n,s=""+r;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(a){var c=i.refs;a===null?delete c[s]:c[s]=a},e._stringRef=s,e)}if(typeof r!="string")throw Error(ot(284));if(!t._owner)throw Error(ot(290,r))}return r}function pd(r,e){throw r=Object.prototype.toString.call(e),Error(ot(31,r==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":r))}function U0(r){var e=r._init;return e(r._payload)}function Q_(r){function e(E,S){if(r){var R=E.deletions;R===null?(E.deletions=[S],E.flags|=16):R.push(S)}}function t(E,S){if(!r)return null;for(;S!==null;)e(E,S),S=S.sibling;return null}function n(E,S){for(E=new Map;S!==null;)S.key!==null?E.set(S.key,S):E.set(S.index,S),S=S.sibling;return E}function i(E,S){return E=bo(E,S),E.index=0,E.sibling=null,E}function s(E,S,R){return E.index=R,r?(R=E.alternate,R!==null?(R=R.index,R<S?(E.flags|=2,S):R):(E.flags|=2,S)):(E.flags|=1048576,S)}function a(E){return r&&E.alternate===null&&(E.flags|=2),E}function c(E,S,R,k){return S===null||S.tag!==6?(S=Np(R,E.mode,k),S.return=E,S):(S=i(S,R),S.return=E,S)}function o(E,S,R,k){var C=R.type;return C===Bc?u(E,S,R.props.children,k,R.key):S!==null&&(S.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===no&&U0(C)===S.type)?(k=i(S,R.props),k.ref=Bl(E,S,R),k.return=E,k):(k=Ud(R.type,R.key,R.props,null,E.mode,k),k.ref=Bl(E,S,R),k.return=E,k)}function l(E,S,R,k){return S===null||S.tag!==4||S.stateNode.containerInfo!==R.containerInfo||S.stateNode.implementation!==R.implementation?(S=Fp(R,E.mode,k),S.return=E,S):(S=i(S,R.children||[]),S.return=E,S)}function u(E,S,R,k,C){return S===null||S.tag!==7?(S=Zo(R,E.mode,k,C),S.return=E,S):(S=i(S,R),S.return=E,S)}function h(E,S,R){if(typeof S=="string"&&S!==""||typeof S=="number")return S=Np(""+S,E.mode,R),S.return=E,S;if(typeof S=="object"&&S!==null){switch(S.$$typeof){case rd:return R=Ud(S.type,S.key,S.props,null,E.mode,R),R.ref=Bl(E,null,S),R.return=E,R;case jc:return S=Fp(S,E.mode,R),S.return=E,S;case no:var k=S._init;return h(E,k(S._payload),R)}if(zl(S)||Ol(S))return S=Zo(S,E.mode,R,null),S.return=E,S;pd(E,S)}return null}function f(E,S,R,k){var C=S!==null?S.key:null;if(typeof R=="string"&&R!==""||typeof R=="number")return C!==null?null:c(E,S,""+R,k);if(typeof R=="object"&&R!==null){switch(R.$$typeof){case rd:return R.key===C?o(E,S,R,k):null;case jc:return R.key===C?l(E,S,R,k):null;case no:return C=R._init,f(E,S,C(R._payload),k)}if(zl(R)||Ol(R))return C!==null?null:u(E,S,R,k,null);pd(E,R)}return null}function g(E,S,R,k,C){if(typeof k=="string"&&k!==""||typeof k=="number")return E=E.get(R)||null,c(S,E,""+k,C);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case rd:return E=E.get(k.key===null?R:k.key)||null,o(S,E,k,C);case jc:return E=E.get(k.key===null?R:k.key)||null,l(S,E,k,C);case no:var x=k._init;return g(E,S,R,x(k._payload),C)}if(zl(k)||Ol(k))return E=E.get(R)||null,u(S,E,k,C,null);pd(S,k)}return null}function p(E,S,R,k){for(var C=null,x=null,P=S,D=S=0,b=null;P!==null&&D<R.length;D++){P.index>D?(b=P,P=null):b=P.sibling;var w=f(E,P,R[D],k);if(w===null){P===null&&(P=b);break}r&&P&&w.alternate===null&&e(E,P),S=s(w,S,D),x===null?C=w:x.sibling=w,x=w,P=b}if(D===R.length)return t(E,P),gn&&Wo(E,D),C;if(P===null){for(;D<R.length;D++)P=h(E,R[D],k),P!==null&&(S=s(P,S,D),x===null?C=P:x.sibling=P,x=P);return gn&&Wo(E,D),C}for(P=n(E,P);D<R.length;D++)b=g(P,E,D,R[D],k),b!==null&&(r&&b.alternate!==null&&P.delete(b.key===null?D:b.key),S=s(b,S,D),x===null?C=b:x.sibling=b,x=b);return r&&P.forEach(function(v){return e(E,v)}),gn&&Wo(E,D),C}function d(E,S,R,k){var C=Ol(R);if(typeof C!="function")throw Error(ot(150));if(R=C.call(R),R==null)throw Error(ot(151));for(var x=C=null,P=S,D=S=0,b=null,w=R.next();P!==null&&!w.done;D++,w=R.next()){P.index>D?(b=P,P=null):b=P.sibling;var v=f(E,P,w.value,k);if(v===null){P===null&&(P=b);break}r&&P&&v.alternate===null&&e(E,P),S=s(v,S,D),x===null?C=v:x.sibling=v,x=v,P=b}if(w.done)return t(E,P),gn&&Wo(E,D),C;if(P===null){for(;!w.done;D++,w=R.next())w=h(E,w.value,k),w!==null&&(S=s(w,S,D),x===null?C=w:x.sibling=w,x=w);return gn&&Wo(E,D),C}for(P=n(E,P);!w.done;D++,w=R.next())w=g(P,E,D,w.value,k),w!==null&&(r&&w.alternate!==null&&P.delete(w.key===null?D:w.key),S=s(w,S,D),x===null?C=w:x.sibling=w,x=w);return r&&P.forEach(function(_){return e(E,_)}),gn&&Wo(E,D),C}function m(E,S,R,k){if(typeof R=="object"&&R!==null&&R.type===Bc&&R.key===null&&(R=R.props.children),typeof R=="object"&&R!==null){switch(R.$$typeof){case rd:e:{for(var C=R.key,x=S;x!==null;){if(x.key===C){if(C=R.type,C===Bc){if(x.tag===7){t(E,x.sibling),S=i(x,R.props.children),S.return=E,E=S;break e}}else if(x.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===no&&U0(C)===x.type){t(E,x.sibling),S=i(x,R.props),S.ref=Bl(E,x,R),S.return=E,E=S;break e}t(E,x);break}else e(E,x);x=x.sibling}R.type===Bc?(S=Zo(R.props.children,E.mode,k,R.key),S.return=E,E=S):(k=Ud(R.type,R.key,R.props,null,E.mode,k),k.ref=Bl(E,S,R),k.return=E,E=k)}return a(E);case jc:e:{for(x=R.key;S!==null;){if(S.key===x)if(S.tag===4&&S.stateNode.containerInfo===R.containerInfo&&S.stateNode.implementation===R.implementation){t(E,S.sibling),S=i(S,R.children||[]),S.return=E,E=S;break e}else{t(E,S);break}else e(E,S);S=S.sibling}S=Fp(R,E.mode,k),S.return=E,E=S}return a(E);case no:return x=R._init,m(E,S,x(R._payload),k)}if(zl(R))return p(E,S,R,k);if(Ol(R))return d(E,S,R,k);pd(E,R)}return typeof R=="string"&&R!==""||typeof R=="number"?(R=""+R,S!==null&&S.tag===6?(t(E,S.sibling),S=i(S,R),S.return=E,E=S):(t(E,S),S=Np(R,E.mode,k),S.return=E,E=S),a(E)):t(E,S)}return m}var ll=Q_(!0),X_=Q_(!1),uh=To(null),dh=null,Kc=null,Qm=null;function Xm(){Qm=Kc=dh=null}function Jm(r){var e=uh.current;dn(uh),r._currentValue=e}function Uf(r,e,t){for(;r!==null;){var n=r.alternate;if((r.childLanes&e)!==e?(r.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),r===t)break;r=r.return}}function tl(r,e){dh=r,Qm=Kc=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&e&&(ts=!0),r.firstContext=null)}function Ls(r){var e=r._currentValue;if(Qm!==r)if(r={context:r,memoizedValue:e,next:null},Kc===null){if(dh===null)throw Error(ot(308));Kc=r,dh.dependencies={lanes:0,firstContext:r}}else Kc=Kc.next=r;return e}var Yo=null;function Zm(r){Yo===null?Yo=[r]:Yo.push(r)}function J_(r,e,t,n){var i=e.interleaved;return i===null?(t.next=t,Zm(e)):(t.next=i.next,i.next=t),e.interleaved=t,Fa(r,n)}function Fa(r,e){r.lanes|=e;var t=r.alternate;for(t!==null&&(t.lanes|=e),t=r,r=r.return;r!==null;)r.childLanes|=e,t=r.alternate,t!==null&&(t.childLanes|=e),t=r,r=r.return;return t.tag===3?t.stateNode:null}var io=!1;function eg(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Z_(r,e){r=r.updateQueue,e.updateQueue===r&&(e.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function Oa(r,e){return{eventTime:r,lane:e,tag:0,payload:null,callback:null,next:null}}function vo(r,e,t){var n=r.updateQueue;if(n===null)return null;if(n=n.shared,Ar&2){var i=n.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),n.pending=e,Fa(r,t)}return i=n.interleaved,i===null?(e.next=e,Zm(n)):(e.next=i.next,i.next=e),n.interleaved=e,Fa(r,t)}function Od(r,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,Bm(r,t)}}function $0(r,e){var t=r.updateQueue,n=r.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=a:s=s.next=a,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:n.shared,effects:n.effects},r.updateQueue=t;return}r=t.lastBaseUpdate,r===null?t.firstBaseUpdate=e:r.next=e,t.lastBaseUpdate=e}function hh(r,e,t,n){var i=r.updateQueue;io=!1;var s=i.firstBaseUpdate,a=i.lastBaseUpdate,c=i.shared.pending;if(c!==null){i.shared.pending=null;var o=c,l=o.next;o.next=null,a===null?s=l:a.next=l,a=o;var u=r.alternate;u!==null&&(u=u.updateQueue,c=u.lastBaseUpdate,c!==a&&(c===null?u.firstBaseUpdate=l:c.next=l,u.lastBaseUpdate=o))}if(s!==null){var h=i.baseState;a=0,u=l=o=null,c=s;do{var f=c.lane,g=c.eventTime;if((n&f)===f){u!==null&&(u=u.next={eventTime:g,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var p=r,d=c;switch(f=e,g=t,d.tag){case 1:if(p=d.payload,typeof p=="function"){h=p.call(g,h,f);break e}h=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=d.payload,f=typeof p=="function"?p.call(g,h,f):p,f==null)break e;h=xn({},h,f);break e;case 2:io=!0}}c.callback!==null&&c.lane!==0&&(r.flags|=64,f=i.effects,f===null?i.effects=[c]:f.push(c))}else g={eventTime:g,lane:f,tag:c.tag,payload:c.payload,callback:c.callback,next:null},u===null?(l=u=g,o=h):u=u.next=g,a|=f;if(c=c.next,c===null){if(c=i.shared.pending,c===null)break;f=c,c=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(u===null&&(o=h),i.baseState=o,i.firstBaseUpdate=l,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do a|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);ic|=a,r.lanes=a,r.memoizedState=h}}function V0(r,e,t){if(r=e.effects,e.effects=null,r!==null)for(e=0;e<r.length;e++){var n=r[e],i=n.callback;if(i!==null){if(n.callback=null,n=t,typeof i!="function")throw Error(ot(191,i));i.call(n)}}}var Au={},da=To(Au),vu=To(Au),yu=To(Au);function Qo(r){if(r===Au)throw Error(ot(174));return r}function tg(r,e){switch(sn(yu,e),sn(vu,r),sn(da,Au),r=e.nodeType,r){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:bf(null,"");break;default:r=r===8?e.parentNode:e,e=r.namespaceURI||null,r=r.tagName,e=bf(e,r)}dn(da),sn(da,e)}function ul(){dn(da),dn(vu),dn(yu)}function e1(r){Qo(yu.current);var e=Qo(da.current),t=bf(e,r.type);e!==t&&(sn(vu,r),sn(da,t))}function rg(r){vu.current===r&&(dn(da),dn(vu))}var Rn=To(0);function ph(r){for(var e=r;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Lp=[];function ng(){for(var r=0;r<Lp.length;r++)Lp[r]._workInProgressVersionPrimary=null;Lp.length=0}var Md=Ba.ReactCurrentDispatcher,Dp=Ba.ReactCurrentBatchConfig,nc=0,Tn=null,oi=null,pi=null,fh=!1,tu=!1,_u=0,vR=0;function Ai(){throw Error(ot(321))}function ig(r,e){if(e===null)return!1;for(var t=0;t<e.length&&t<r.length;t++)if(!Ys(r[t],e[t]))return!1;return!0}function sg(r,e,t,n,i,s){if(nc=s,Tn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Md.current=r===null||r.memoizedState===null?SR:wR,r=t(n,i),tu){s=0;do{if(tu=!1,_u=0,25<=s)throw Error(ot(301));s+=1,pi=oi=null,e.updateQueue=null,Md.current=ER,r=t(n,i)}while(tu)}if(Md.current=mh,e=oi!==null&&oi.next!==null,nc=0,pi=oi=Tn=null,fh=!1,e)throw Error(ot(300));return r}function ag(){var r=_u!==0;return _u=0,r}function ia(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return pi===null?Tn.memoizedState=pi=r:pi=pi.next=r,pi}function Ds(){if(oi===null){var r=Tn.alternate;r=r!==null?r.memoizedState:null}else r=oi.next;var e=pi===null?Tn.memoizedState:pi.next;if(e!==null)pi=e,oi=r;else{if(r===null)throw Error(ot(310));oi=r,r={memoizedState:oi.memoizedState,baseState:oi.baseState,baseQueue:oi.baseQueue,queue:oi.queue,next:null},pi===null?Tn.memoizedState=pi=r:pi=pi.next=r}return pi}function bu(r,e){return typeof e=="function"?e(r):e}function Ip(r){var e=Ds(),t=e.queue;if(t===null)throw Error(ot(311));t.lastRenderedReducer=r;var n=oi,i=n.baseQueue,s=t.pending;if(s!==null){if(i!==null){var a=i.next;i.next=s.next,s.next=a}n.baseQueue=i=s,t.pending=null}if(i!==null){s=i.next,n=n.baseState;var c=a=null,o=null,l=s;do{var u=l.lane;if((nc&u)===u)o!==null&&(o=o.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),n=l.hasEagerState?l.eagerState:r(n,l.action);else{var h={lane:u,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};o===null?(c=o=h,a=n):o=o.next=h,Tn.lanes|=u,ic|=u}l=l.next}while(l!==null&&l!==s);o===null?a=n:o.next=c,Ys(n,e.memoizedState)||(ts=!0),e.memoizedState=n,e.baseState=a,e.baseQueue=o,t.lastRenderedState=n}if(r=t.interleaved,r!==null){i=r;do s=i.lane,Tn.lanes|=s,ic|=s,i=i.next;while(i!==r)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Ap(r){var e=Ds(),t=e.queue;if(t===null)throw Error(ot(311));t.lastRenderedReducer=r;var n=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var a=i=i.next;do s=r(s,a.action),a=a.next;while(a!==i);Ys(s,e.memoizedState)||(ts=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,n]}function t1(){}function r1(r,e){var t=Tn,n=Ds(),i=e(),s=!Ys(n.memoizedState,i);if(s&&(n.memoizedState=i,ts=!0),n=n.queue,og(s1.bind(null,t,n,r),[r]),n.getSnapshot!==e||s||pi!==null&&pi.memoizedState.tag&1){if(t.flags|=2048,Su(9,i1.bind(null,t,n,i,e),void 0,null),mi===null)throw Error(ot(349));nc&30||n1(t,e,i)}return i}function n1(r,e,t){r.flags|=16384,r={getSnapshot:e,value:t},e=Tn.updateQueue,e===null?(e={lastEffect:null,stores:null},Tn.updateQueue=e,e.stores=[r]):(t=e.stores,t===null?e.stores=[r]:t.push(r))}function i1(r,e,t,n){e.value=t,e.getSnapshot=n,a1(e)&&o1(r)}function s1(r,e,t){return t(function(){a1(e)&&o1(r)})}function a1(r){var e=r.getSnapshot;r=r.value;try{var t=e();return!Ys(r,t)}catch{return!0}}function o1(r){var e=Fa(r,1);e!==null&&qs(e,r,1,-1)}function G0(r){var e=ia();return typeof r=="function"&&(r=r()),e.memoizedState=e.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bu,lastRenderedState:r},e.queue=r,r=r.dispatch=bR.bind(null,Tn,r),[e.memoizedState,r]}function Su(r,e,t,n){return r={tag:r,create:e,destroy:t,deps:n,next:null},e=Tn.updateQueue,e===null?(e={lastEffect:null,stores:null},Tn.updateQueue=e,e.lastEffect=r.next=r):(t=e.lastEffect,t===null?e.lastEffect=r.next=r:(n=t.next,t.next=r,r.next=n,e.lastEffect=r)),r}function c1(){return Ds().memoizedState}function Nd(r,e,t,n){var i=ia();Tn.flags|=r,i.memoizedState=Su(1|e,t,void 0,n===void 0?null:n)}function Wh(r,e,t,n){var i=Ds();n=n===void 0?null:n;var s=void 0;if(oi!==null){var a=oi.memoizedState;if(s=a.destroy,n!==null&&ig(n,a.deps)){i.memoizedState=Su(e,t,s,n);return}}Tn.flags|=r,i.memoizedState=Su(1|e,t,s,n)}function H0(r,e){return Nd(8390656,8,r,e)}function og(r,e){return Wh(2048,8,r,e)}function l1(r,e){return Wh(4,2,r,e)}function u1(r,e){return Wh(4,4,r,e)}function d1(r,e){if(typeof e=="function")return r=r(),e(r),function(){e(null)};if(e!=null)return r=r(),e.current=r,function(){e.current=null}}function h1(r,e,t){return t=t!=null?t.concat([r]):null,Wh(4,4,d1.bind(null,e,r),t)}function cg(){}function p1(r,e){var t=Ds();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&ig(e,n[1])?n[0]:(t.memoizedState=[r,e],r)}function f1(r,e){var t=Ds();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&ig(e,n[1])?n[0]:(r=r(),t.memoizedState=[r,e],r)}function m1(r,e,t){return nc&21?(Ys(t,e)||(t=b_(),Tn.lanes|=t,ic|=t,r.baseState=!0),e):(r.baseState&&(r.baseState=!1,ts=!0),r.memoizedState=t)}function yR(r,e){var t=Hr;Hr=t!==0&&4>t?t:4,r(!0);var n=Dp.transition;Dp.transition={};try{r(!1),e()}finally{Hr=t,Dp.transition=n}}function g1(){return Ds().memoizedState}function _R(r,e,t){var n=_o(r);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},v1(r))y1(e,t);else if(t=J_(r,e,t,n),t!==null){var i=Wi();qs(t,r,n,i),_1(t,e,n)}}function bR(r,e,t){var n=_o(r),i={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(v1(r))y1(e,i);else{var s=r.alternate;if(r.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var a=e.lastRenderedState,c=s(a,t);if(i.hasEagerState=!0,i.eagerState=c,Ys(c,a)){var o=e.interleaved;o===null?(i.next=i,Zm(e)):(i.next=o.next,o.next=i),e.interleaved=i;return}}catch{}finally{}t=J_(r,e,i,n),t!==null&&(i=Wi(),qs(t,r,n,i),_1(t,e,n))}}function v1(r){var e=r.alternate;return r===Tn||e!==null&&e===Tn}function y1(r,e){tu=fh=!0;var t=r.pending;t===null?e.next=e:(e.next=t.next,t.next=e),r.pending=e}function _1(r,e,t){if(t&4194240){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,Bm(r,t)}}var mh={readContext:Ls,useCallback:Ai,useContext:Ai,useEffect:Ai,useImperativeHandle:Ai,useInsertionEffect:Ai,useLayoutEffect:Ai,useMemo:Ai,useReducer:Ai,useRef:Ai,useState:Ai,useDebugValue:Ai,useDeferredValue:Ai,useTransition:Ai,useMutableSource:Ai,useSyncExternalStore:Ai,useId:Ai,unstable_isNewReconciler:!1},SR={readContext:Ls,useCallback:function(r,e){return ia().memoizedState=[r,e===void 0?null:e],r},useContext:Ls,useEffect:H0,useImperativeHandle:function(r,e,t){return t=t!=null?t.concat([r]):null,Nd(4194308,4,d1.bind(null,e,r),t)},useLayoutEffect:function(r,e){return Nd(4194308,4,r,e)},useInsertionEffect:function(r,e){return Nd(4,2,r,e)},useMemo:function(r,e){var t=ia();return e=e===void 0?null:e,r=r(),t.memoizedState=[r,e],r},useReducer:function(r,e,t){var n=ia();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:e},n.queue=r,r=r.dispatch=_R.bind(null,Tn,r),[n.memoizedState,r]},useRef:function(r){var e=ia();return r={current:r},e.memoizedState=r},useState:G0,useDebugValue:cg,useDeferredValue:function(r){return ia().memoizedState=r},useTransition:function(){var r=G0(!1),e=r[0];return r=yR.bind(null,r[1]),ia().memoizedState=r,[e,r]},useMutableSource:function(){},useSyncExternalStore:function(r,e,t){var n=Tn,i=ia();if(gn){if(t===void 0)throw Error(ot(407));t=t()}else{if(t=e(),mi===null)throw Error(ot(349));nc&30||n1(n,e,t)}i.memoizedState=t;var s={value:t,getSnapshot:e};return i.queue=s,H0(s1.bind(null,n,s,r),[r]),n.flags|=2048,Su(9,i1.bind(null,n,s,t,e),void 0,null),t},useId:function(){var r=ia(),e=mi.identifierPrefix;if(gn){var t=Aa,n=Ia;t=(n&~(1<<32-Ks(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=_u++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=vR++,e=":"+e+"r"+t.toString(32)+":";return r.memoizedState=e},unstable_isNewReconciler:!1},wR={readContext:Ls,useCallback:p1,useContext:Ls,useEffect:og,useImperativeHandle:h1,useInsertionEffect:l1,useLayoutEffect:u1,useMemo:f1,useReducer:Ip,useRef:c1,useState:function(){return Ip(bu)},useDebugValue:cg,useDeferredValue:function(r){var e=Ds();return m1(e,oi.memoizedState,r)},useTransition:function(){var r=Ip(bu)[0],e=Ds().memoizedState;return[r,e]},useMutableSource:t1,useSyncExternalStore:r1,useId:g1,unstable_isNewReconciler:!1},ER={readContext:Ls,useCallback:p1,useContext:Ls,useEffect:og,useImperativeHandle:h1,useInsertionEffect:l1,useLayoutEffect:u1,useMemo:f1,useReducer:Ap,useRef:c1,useState:function(){return Ap(bu)},useDebugValue:cg,useDeferredValue:function(r){var e=Ds();return oi===null?e.memoizedState=r:m1(e,oi.memoizedState,r)},useTransition:function(){var r=Ap(bu)[0],e=Ds().memoizedState;return[r,e]},useMutableSource:t1,useSyncExternalStore:r1,useId:g1,unstable_isNewReconciler:!1};function Gs(r,e){if(r&&r.defaultProps){e=xn({},e),r=r.defaultProps;for(var t in r)e[t]===void 0&&(e[t]=r[t]);return e}return e}function $f(r,e,t,n){e=r.memoizedState,t=t(n,e),t=t==null?e:xn({},e,t),r.memoizedState=t,r.lanes===0&&(r.updateQueue.baseState=t)}var zh={isMounted:function(r){return(r=r._reactInternals)?cc(r)===r:!1},enqueueSetState:function(r,e,t){r=r._reactInternals;var n=Wi(),i=_o(r),s=Oa(n,i);s.payload=e,t!=null&&(s.callback=t),e=vo(r,s,i),e!==null&&(qs(e,r,i,n),Od(e,r,i))},enqueueReplaceState:function(r,e,t){r=r._reactInternals;var n=Wi(),i=_o(r),s=Oa(n,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=vo(r,s,i),e!==null&&(qs(e,r,i,n),Od(e,r,i))},enqueueForceUpdate:function(r,e){r=r._reactInternals;var t=Wi(),n=_o(r),i=Oa(t,n);i.tag=2,e!=null&&(i.callback=e),e=vo(r,i,n),e!==null&&(qs(e,r,n,t),Od(e,r,n))}};function W0(r,e,t,n,i,s,a){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(n,s,a):e.prototype&&e.prototype.isPureReactComponent?!pu(t,n)||!pu(i,s):!0}function b1(r,e,t){var n=!1,i=Eo,s=e.contextType;return typeof s=="object"&&s!==null?s=Ls(s):(i=ns(e)?tc:ji.current,n=e.contextTypes,s=(n=n!=null)?ol(r,i):Eo),e=new e(t,s),r.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=zh,r.stateNode=e,e._reactInternals=r,n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=i,r.__reactInternalMemoizedMaskedChildContext=s),e}function z0(r,e,t,n){r=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==r&&zh.enqueueReplaceState(e,e.state,null)}function Vf(r,e,t,n){var i=r.stateNode;i.props=t,i.state=r.memoizedState,i.refs={},eg(r);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Ls(s):(s=ns(e)?tc:ji.current,i.context=ol(r,s)),i.state=r.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&($f(r,e,s,t),i.state=r.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&zh.enqueueReplaceState(i,i.state,null),hh(r,t,i,n),i.state=r.memoizedState),typeof i.componentDidMount=="function"&&(r.flags|=4194308)}function dl(r,e){try{var t="",n=e;do t+=Xw(n),n=n.return;while(n);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:r,source:e,stack:i,digest:null}}function Op(r,e,t){return{value:r,source:null,stack:t??null,digest:e??null}}function Gf(r,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var RR=typeof WeakMap=="function"?WeakMap:Map;function S1(r,e,t){t=Oa(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){vh||(vh=!0,Zf=n),Gf(r,e)},t}function w1(r,e,t){t=Oa(-1,t),t.tag=3;var n=r.type.getDerivedStateFromError;if(typeof n=="function"){var i=e.value;t.payload=function(){return n(i)},t.callback=function(){Gf(r,e)}}var s=r.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){Gf(r,e),typeof n!="function"&&(yo===null?yo=new Set([this]):yo.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function K0(r,e,t){var n=r.pingCache;if(n===null){n=r.pingCache=new RR;var i=new Set;n.set(e,i)}else i=n.get(e),i===void 0&&(i=new Set,n.set(e,i));i.has(t)||(i.add(t),r=jR.bind(null,r,e,t),e.then(r,r))}function q0(r){do{var e;if((e=r.tag===13)&&(e=r.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return r;r=r.return}while(r!==null);return null}function Y0(r,e,t,n,i){return r.mode&1?(r.flags|=65536,r.lanes=i,r):(r===e?r.flags|=65536:(r.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Oa(-1,1),e.tag=2,vo(t,e,1))),t.lanes|=1),r)}var TR=Ba.ReactCurrentOwner,ts=!1;function Hi(r,e,t,n){e.child=r===null?X_(e,null,t,n):ll(e,r.child,t,n)}function Q0(r,e,t,n,i){t=t.render;var s=e.ref;return tl(e,i),n=sg(r,e,t,n,s,i),t=ag(),r!==null&&!ts?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~i,ja(r,e,i)):(gn&&t&&Km(e),e.flags|=1,Hi(r,e,n,i),e.child)}function X0(r,e,t,n,i){if(r===null){var s=t.type;return typeof s=="function"&&!gg(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,E1(r,e,s,n,i)):(r=Ud(t.type,null,n,e,e.mode,i),r.ref=e.ref,r.return=e,e.child=r)}if(s=r.child,!(r.lanes&i)){var a=s.memoizedProps;if(t=t.compare,t=t!==null?t:pu,t(a,n)&&r.ref===e.ref)return ja(r,e,i)}return e.flags|=1,r=bo(s,n),r.ref=e.ref,r.return=e,e.child=r}function E1(r,e,t,n,i){if(r!==null){var s=r.memoizedProps;if(pu(s,n)&&r.ref===e.ref)if(ts=!1,e.pendingProps=n=s,(r.lanes&i)!==0)r.flags&131072&&(ts=!0);else return e.lanes=r.lanes,ja(r,e,i)}return Hf(r,e,t,n,i)}function R1(r,e,t){var n=e.pendingProps,i=n.children,s=r!==null?r.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},sn(Yc,fs),fs|=t;else{if(!(t&1073741824))return r=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:r,cachePool:null,transitions:null},e.updateQueue=null,sn(Yc,fs),fs|=r,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=s!==null?s.baseLanes:t,sn(Yc,fs),fs|=n}else s!==null?(n=s.baseLanes|t,e.memoizedState=null):n=t,sn(Yc,fs),fs|=n;return Hi(r,e,i,t),e.child}function T1(r,e){var t=e.ref;(r===null&&t!==null||r!==null&&r.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Hf(r,e,t,n,i){var s=ns(t)?tc:ji.current;return s=ol(e,s),tl(e,i),t=sg(r,e,t,n,s,i),n=ag(),r!==null&&!ts?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~i,ja(r,e,i)):(gn&&n&&Km(e),e.flags|=1,Hi(r,e,t,i),e.child)}function J0(r,e,t,n,i){if(ns(t)){var s=!0;oh(e)}else s=!1;if(tl(e,i),e.stateNode===null)Fd(r,e),b1(e,t,n),Vf(e,t,n,i),n=!0;else if(r===null){var a=e.stateNode,c=e.memoizedProps;a.props=c;var o=a.context,l=t.contextType;typeof l=="object"&&l!==null?l=Ls(l):(l=ns(t)?tc:ji.current,l=ol(e,l));var u=t.getDerivedStateFromProps,h=typeof u=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(c!==n||o!==l)&&z0(e,a,n,l),io=!1;var f=e.memoizedState;a.state=f,hh(e,n,a,i),o=e.memoizedState,c!==n||f!==o||rs.current||io?(typeof u=="function"&&($f(e,t,u,n),o=e.memoizedState),(c=io||W0(e,t,c,n,f,o,l))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=o),a.props=n,a.state=o,a.context=l,n=c):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{a=e.stateNode,Z_(r,e),c=e.memoizedProps,l=e.type===e.elementType?c:Gs(e.type,c),a.props=l,h=e.pendingProps,f=a.context,o=t.contextType,typeof o=="object"&&o!==null?o=Ls(o):(o=ns(t)?tc:ji.current,o=ol(e,o));var g=t.getDerivedStateFromProps;(u=typeof g=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(c!==h||f!==o)&&z0(e,a,n,o),io=!1,f=e.memoizedState,a.state=f,hh(e,n,a,i);var p=e.memoizedState;c!==h||f!==p||rs.current||io?(typeof g=="function"&&($f(e,t,g,n),p=e.memoizedState),(l=io||W0(e,t,l,n,f,p,o)||!1)?(u||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(n,p,o),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(n,p,o)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||c===r.memoizedProps&&f===r.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||c===r.memoizedProps&&f===r.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=p),a.props=n,a.state=p,a.context=o,n=l):(typeof a.componentDidUpdate!="function"||c===r.memoizedProps&&f===r.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||c===r.memoizedProps&&f===r.memoizedState||(e.flags|=1024),n=!1)}return Wf(r,e,t,n,s,i)}function Wf(r,e,t,n,i,s){T1(r,e);var a=(e.flags&128)!==0;if(!n&&!a)return i&&F0(e,t,!1),ja(r,e,s);n=e.stateNode,TR.current=e;var c=a&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,r!==null&&a?(e.child=ll(e,r.child,null,s),e.child=ll(e,null,c,s)):Hi(r,e,c,s),e.memoizedState=n.state,i&&F0(e,t,!0),e.child}function x1(r){var e=r.stateNode;e.pendingContext?N0(r,e.pendingContext,e.pendingContext!==e.context):e.context&&N0(r,e.context,!1),tg(r,e.containerInfo)}function Z0(r,e,t,n,i){return cl(),Ym(i),e.flags|=256,Hi(r,e,t,n),e.child}var zf={dehydrated:null,treeContext:null,retryLane:0};function Kf(r){return{baseLanes:r,cachePool:null,transitions:null}}function k1(r,e,t){var n=e.pendingProps,i=Rn.current,s=!1,a=(e.flags&128)!==0,c;if((c=a)||(c=r!==null&&r.memoizedState===null?!1:(i&2)!==0),c?(s=!0,e.flags&=-129):(r===null||r.memoizedState!==null)&&(i|=1),sn(Rn,i&1),r===null)return Bf(e),r=e.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(e.mode&1?r.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=n.children,r=n.fallback,s?(n=e.mode,s=e.child,a={mode:"hidden",children:a},!(n&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=Yh(a,n,0,null),r=Zo(r,n,t,null),s.return=e,r.return=e,s.sibling=r,e.child=s,e.child.memoizedState=Kf(t),e.memoizedState=zf,r):lg(e,a));if(i=r.memoizedState,i!==null&&(c=i.dehydrated,c!==null))return xR(r,e,a,n,c,i,t);if(s){s=n.fallback,a=e.mode,i=r.child,c=i.sibling;var o={mode:"hidden",children:n.children};return!(a&1)&&e.child!==i?(n=e.child,n.childLanes=0,n.pendingProps=o,e.deletions=null):(n=bo(i,o),n.subtreeFlags=i.subtreeFlags&14680064),c!==null?s=bo(c,s):(s=Zo(s,a,t,null),s.flags|=2),s.return=e,n.return=e,n.sibling=s,e.child=n,n=s,s=e.child,a=r.child.memoizedState,a=a===null?Kf(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=r.childLanes&~t,e.memoizedState=zf,n}return s=r.child,r=s.sibling,n=bo(s,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,r!==null&&(t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)),e.child=n,e.memoizedState=null,n}function lg(r,e){return e=Yh({mode:"visible",children:e},r.mode,0,null),e.return=r,r.child=e}function fd(r,e,t,n){return n!==null&&Ym(n),ll(e,r.child,null,t),r=lg(e,e.pendingProps.children),r.flags|=2,e.memoizedState=null,r}function xR(r,e,t,n,i,s,a){if(t)return e.flags&256?(e.flags&=-257,n=Op(Error(ot(422))),fd(r,e,a,n)):e.memoizedState!==null?(e.child=r.child,e.flags|=128,null):(s=n.fallback,i=e.mode,n=Yh({mode:"visible",children:n.children},i,0,null),s=Zo(s,i,a,null),s.flags|=2,n.return=e,s.return=e,n.sibling=s,e.child=n,e.mode&1&&ll(e,r.child,null,a),e.child.memoizedState=Kf(a),e.memoizedState=zf,s);if(!(e.mode&1))return fd(r,e,a,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var c=n.dgst;return n=c,s=Error(ot(419)),n=Op(s,n,void 0),fd(r,e,a,n)}if(c=(a&r.childLanes)!==0,ts||c){if(n=mi,n!==null){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(n.suspendedLanes|a)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,Fa(r,i),qs(n,r,i,-1))}return mg(),n=Op(Error(ot(421))),fd(r,e,a,n)}return i.data==="$?"?(e.flags|=128,e.child=r.child,e=BR.bind(null,r),i._reactRetry=e,null):(r=s.treeContext,ms=go(i.nextSibling),vs=e,gn=!0,Ws=null,r!==null&&(xs[ks++]=Ia,xs[ks++]=Aa,xs[ks++]=rc,Ia=r.id,Aa=r.overflow,rc=e),e=lg(e,n.children),e.flags|=4096,e)}function ev(r,e,t){r.lanes|=e;var n=r.alternate;n!==null&&(n.lanes|=e),Uf(r.return,e,t)}function Mp(r,e,t,n,i){var s=r.memoizedState;s===null?r.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=t,s.tailMode=i)}function C1(r,e,t){var n=e.pendingProps,i=n.revealOrder,s=n.tail;if(Hi(r,e,n.children,t),n=Rn.current,n&2)n=n&1|2,e.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=e.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&ev(r,t,e);else if(r.tag===19)ev(r,t,e);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}n&=1}if(sn(Rn,n),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)r=t.alternate,r!==null&&ph(r)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),Mp(e,!1,i,t,s);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(r=i.alternate,r!==null&&ph(r)===null){e.child=i;break}r=i.sibling,i.sibling=t,t=i,i=r}Mp(e,!0,t,null,s);break;case"together":Mp(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Fd(r,e){!(e.mode&1)&&r!==null&&(r.alternate=null,e.alternate=null,e.flags|=2)}function ja(r,e,t){if(r!==null&&(e.dependencies=r.dependencies),ic|=e.lanes,!(t&e.childLanes))return null;if(r!==null&&e.child!==r.child)throw Error(ot(153));if(e.child!==null){for(r=e.child,t=bo(r,r.pendingProps),e.child=t,t.return=e;r.sibling!==null;)r=r.sibling,t=t.sibling=bo(r,r.pendingProps),t.return=e;t.sibling=null}return e.child}function kR(r,e,t){switch(e.tag){case 3:x1(e),cl();break;case 5:e1(e);break;case 1:ns(e.type)&&oh(e);break;case 4:tg(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,i=e.memoizedProps.value;sn(uh,n._currentValue),n._currentValue=i;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(sn(Rn,Rn.current&1),e.flags|=128,null):t&e.child.childLanes?k1(r,e,t):(sn(Rn,Rn.current&1),r=ja(r,e,t),r!==null?r.sibling:null);sn(Rn,Rn.current&1);break;case 19:if(n=(t&e.childLanes)!==0,r.flags&128){if(n)return C1(r,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),sn(Rn,Rn.current),n)break;return null;case 22:case 23:return e.lanes=0,R1(r,e,t)}return ja(r,e,t)}var P1,qf,L1,D1;P1=function(r,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)r.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};qf=function(){};L1=function(r,e,t,n){var i=r.memoizedProps;if(i!==n){r=e.stateNode,Qo(da.current);var s=null;switch(t){case"input":i=gf(r,i),n=gf(r,n),s=[];break;case"select":i=xn({},i,{value:void 0}),n=xn({},n,{value:void 0}),s=[];break;case"textarea":i=_f(r,i),n=_f(r,n),s=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(r.onclick=sh)}Sf(t,n);var a;t=null;for(l in i)if(!n.hasOwnProperty(l)&&i.hasOwnProperty(l)&&i[l]!=null)if(l==="style"){var c=i[l];for(a in c)c.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(au.hasOwnProperty(l)?s||(s=[]):(s=s||[]).push(l,null));for(l in n){var o=n[l];if(c=i!=null?i[l]:void 0,n.hasOwnProperty(l)&&o!==c&&(o!=null||c!=null))if(l==="style")if(c){for(a in c)!c.hasOwnProperty(a)||o&&o.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in o)o.hasOwnProperty(a)&&c[a]!==o[a]&&(t||(t={}),t[a]=o[a])}else t||(s||(s=[]),s.push(l,t)),t=o;else l==="dangerouslySetInnerHTML"?(o=o?o.__html:void 0,c=c?c.__html:void 0,o!=null&&c!==o&&(s=s||[]).push(l,o)):l==="children"?typeof o!="string"&&typeof o!="number"||(s=s||[]).push(l,""+o):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(au.hasOwnProperty(l)?(o!=null&&l==="onScroll"&&un("scroll",r),s||c===o||(s=[])):(s=s||[]).push(l,o))}t&&(s=s||[]).push("style",t);var l=s;(e.updateQueue=l)&&(e.flags|=4)}};D1=function(r,e,t,n){t!==n&&(e.flags|=4)};function Ul(r,e){if(!gn)switch(r.tailMode){case"hidden":e=r.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?r.tail=null:t.sibling=null;break;case"collapsed":t=r.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||r.tail===null?r.tail=null:r.tail.sibling=null:n.sibling=null}}function Oi(r){var e=r.alternate!==null&&r.alternate.child===r.child,t=0,n=0;if(e)for(var i=r.child;i!==null;)t|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=r,i=i.sibling;else for(i=r.child;i!==null;)t|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=r,i=i.sibling;return r.subtreeFlags|=n,r.childLanes=t,e}function CR(r,e,t){var n=e.pendingProps;switch(qm(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Oi(e),null;case 1:return ns(e.type)&&ah(),Oi(e),null;case 3:return n=e.stateNode,ul(),dn(rs),dn(ji),ng(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(r===null||r.child===null)&&(hd(e)?e.flags|=4:r===null||r.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ws!==null&&(rm(Ws),Ws=null))),qf(r,e),Oi(e),null;case 5:rg(e);var i=Qo(yu.current);if(t=e.type,r!==null&&e.stateNode!=null)L1(r,e,t,n,i),r.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(ot(166));return Oi(e),null}if(r=Qo(da.current),hd(e)){n=e.stateNode,t=e.type;var s=e.memoizedProps;switch(n[oa]=e,n[gu]=s,r=(e.mode&1)!==0,t){case"dialog":un("cancel",n),un("close",n);break;case"iframe":case"object":case"embed":un("load",n);break;case"video":case"audio":for(i=0;i<ql.length;i++)un(ql[i],n);break;case"source":un("error",n);break;case"img":case"image":case"link":un("error",n),un("load",n);break;case"details":un("toggle",n);break;case"input":l0(n,s),un("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},un("invalid",n);break;case"textarea":d0(n,s),un("invalid",n)}Sf(t,s),i=null;for(var a in s)if(s.hasOwnProperty(a)){var c=s[a];a==="children"?typeof c=="string"?n.textContent!==c&&(s.suppressHydrationWarning!==!0&&dd(n.textContent,c,r),i=["children",c]):typeof c=="number"&&n.textContent!==""+c&&(s.suppressHydrationWarning!==!0&&dd(n.textContent,c,r),i=["children",""+c]):au.hasOwnProperty(a)&&c!=null&&a==="onScroll"&&un("scroll",n)}switch(t){case"input":nd(n),u0(n,s,!0);break;case"textarea":nd(n),h0(n);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(n.onclick=sh)}n=i,e.updateQueue=n,n!==null&&(e.flags|=4)}else{a=i.nodeType===9?i:i.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=s_(t)),r==="http://www.w3.org/1999/xhtml"?t==="script"?(r=a.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof n.is=="string"?r=a.createElement(t,{is:n.is}):(r=a.createElement(t),t==="select"&&(a=r,n.multiple?a.multiple=!0:n.size&&(a.size=n.size))):r=a.createElementNS(r,t),r[oa]=e,r[gu]=n,P1(r,e,!1,!1),e.stateNode=r;e:{switch(a=wf(t,n),t){case"dialog":un("cancel",r),un("close",r),i=n;break;case"iframe":case"object":case"embed":un("load",r),i=n;break;case"video":case"audio":for(i=0;i<ql.length;i++)un(ql[i],r);i=n;break;case"source":un("error",r),i=n;break;case"img":case"image":case"link":un("error",r),un("load",r),i=n;break;case"details":un("toggle",r),i=n;break;case"input":l0(r,n),i=gf(r,n),un("invalid",r);break;case"option":i=n;break;case"select":r._wrapperState={wasMultiple:!!n.multiple},i=xn({},n,{value:void 0}),un("invalid",r);break;case"textarea":d0(r,n),i=_f(r,n),un("invalid",r);break;default:i=n}Sf(t,i),c=i;for(s in c)if(c.hasOwnProperty(s)){var o=c[s];s==="style"?c_(r,o):s==="dangerouslySetInnerHTML"?(o=o?o.__html:void 0,o!=null&&a_(r,o)):s==="children"?typeof o=="string"?(t!=="textarea"||o!=="")&&ou(r,o):typeof o=="number"&&ou(r,""+o):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(au.hasOwnProperty(s)?o!=null&&s==="onScroll"&&un("scroll",r):o!=null&&Am(r,s,o,a))}switch(t){case"input":nd(r),u0(r,n,!1);break;case"textarea":nd(r),h0(r);break;case"option":n.value!=null&&r.setAttribute("value",""+wo(n.value));break;case"select":r.multiple=!!n.multiple,s=n.value,s!=null?Xc(r,!!n.multiple,s,!1):n.defaultValue!=null&&Xc(r,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(r.onclick=sh)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Oi(e),null;case 6:if(r&&e.stateNode!=null)D1(r,e,r.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(ot(166));if(t=Qo(yu.current),Qo(da.current),hd(e)){if(n=e.stateNode,t=e.memoizedProps,n[oa]=e,(s=n.nodeValue!==t)&&(r=vs,r!==null))switch(r.tag){case 3:dd(n.nodeValue,t,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&dd(n.nodeValue,t,(r.mode&1)!==0)}s&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[oa]=e,e.stateNode=n}return Oi(e),null;case 13:if(dn(Rn),n=e.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(gn&&ms!==null&&e.mode&1&&!(e.flags&128))Y_(),cl(),e.flags|=98560,s=!1;else if(s=hd(e),n!==null&&n.dehydrated!==null){if(r===null){if(!s)throw Error(ot(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ot(317));s[oa]=e}else cl(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Oi(e),s=!1}else Ws!==null&&(rm(Ws),Ws=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(r!==null&&r.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(r===null||Rn.current&1?ci===0&&(ci=3):mg())),e.updateQueue!==null&&(e.flags|=4),Oi(e),null);case 4:return ul(),qf(r,e),r===null&&fu(e.stateNode.containerInfo),Oi(e),null;case 10:return Jm(e.type._context),Oi(e),null;case 17:return ns(e.type)&&ah(),Oi(e),null;case 19:if(dn(Rn),s=e.memoizedState,s===null)return Oi(e),null;if(n=(e.flags&128)!==0,a=s.rendering,a===null)if(n)Ul(s,!1);else{if(ci!==0||r!==null&&r.flags&128)for(r=e.child;r!==null;){if(a=ph(r),a!==null){for(e.flags|=128,Ul(s,!1),n=a.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)s=t,r=n,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=r,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,r=a.dependencies,s.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),t=t.sibling;return sn(Rn,Rn.current&1|2),e.child}r=r.sibling}s.tail!==null&&Un()>hl&&(e.flags|=128,n=!0,Ul(s,!1),e.lanes=4194304)}else{if(!n)if(r=ph(a),r!==null){if(e.flags|=128,n=!0,t=r.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Ul(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!gn)return Oi(e),null}else 2*Un()-s.renderingStartTime>hl&&t!==1073741824&&(e.flags|=128,n=!0,Ul(s,!1),e.lanes=4194304);s.isBackwards?(a.sibling=e.child,e.child=a):(t=s.last,t!==null?t.sibling=a:e.child=a,s.last=a)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Un(),e.sibling=null,t=Rn.current,sn(Rn,n?t&1|2:t&1),e):(Oi(e),null);case 22:case 23:return fg(),n=e.memoizedState!==null,r!==null&&r.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?fs&1073741824&&(Oi(e),e.subtreeFlags&6&&(e.flags|=8192)):Oi(e),null;case 24:return null;case 25:return null}throw Error(ot(156,e.tag))}function PR(r,e){switch(qm(e),e.tag){case 1:return ns(e.type)&&ah(),r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 3:return ul(),dn(rs),dn(ji),ng(),r=e.flags,r&65536&&!(r&128)?(e.flags=r&-65537|128,e):null;case 5:return rg(e),null;case 13:if(dn(Rn),r=e.memoizedState,r!==null&&r.dehydrated!==null){if(e.alternate===null)throw Error(ot(340));cl()}return r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 19:return dn(Rn),null;case 4:return ul(),null;case 10:return Jm(e.type._context),null;case 22:case 23:return fg(),null;case 24:return null;default:return null}}var md=!1,Fi=!1,LR=typeof WeakSet=="function"?WeakSet:Set,Ct=null;function qc(r,e){var t=r.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){Dn(r,e,n)}else t.current=null}function Yf(r,e,t){try{t()}catch(n){Dn(r,e,n)}}var tv=!1;function DR(r,e){if(If=rh,r=N_(),zm(r)){if("selectionStart"in r)var t={start:r.selectionStart,end:r.selectionEnd};else e:{t=(t=r.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var i=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var a=0,c=-1,o=-1,l=0,u=0,h=r,f=null;t:for(;;){for(var g;h!==t||i!==0&&h.nodeType!==3||(c=a+i),h!==s||n!==0&&h.nodeType!==3||(o=a+n),h.nodeType===3&&(a+=h.nodeValue.length),(g=h.firstChild)!==null;)f=h,h=g;for(;;){if(h===r)break t;if(f===t&&++l===i&&(c=a),f===s&&++u===n&&(o=a),(g=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=g}t=c===-1||o===-1?null:{start:c,end:o}}else t=null}t=t||{start:0,end:0}}else t=null;for(Af={focusedElem:r,selectionRange:t},rh=!1,Ct=e;Ct!==null;)if(e=Ct,r=e.child,(e.subtreeFlags&1028)!==0&&r!==null)r.return=e,Ct=r;else for(;Ct!==null;){e=Ct;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var d=p.memoizedProps,m=p.memoizedState,E=e.stateNode,S=E.getSnapshotBeforeUpdate(e.elementType===e.type?d:Gs(e.type,d),m);E.__reactInternalSnapshotBeforeUpdate=S}break;case 3:var R=e.stateNode.containerInfo;R.nodeType===1?R.textContent="":R.nodeType===9&&R.documentElement&&R.removeChild(R.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ot(163))}}catch(k){Dn(e,e.return,k)}if(r=e.sibling,r!==null){r.return=e.return,Ct=r;break}Ct=e.return}return p=tv,tv=!1,p}function ru(r,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&r)===r){var s=i.destroy;i.destroy=void 0,s!==void 0&&Yf(e,t,s)}i=i.next}while(i!==n)}}function Kh(r,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&r)===r){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function Qf(r){var e=r.ref;if(e!==null){var t=r.stateNode;switch(r.tag){case 5:r=t;break;default:r=t}typeof e=="function"?e(r):e.current=r}}function I1(r){var e=r.alternate;e!==null&&(r.alternate=null,I1(e)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(e=r.stateNode,e!==null&&(delete e[oa],delete e[gu],delete e[Nf],delete e[pR],delete e[fR])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function A1(r){return r.tag===5||r.tag===3||r.tag===4}function rv(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||A1(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Xf(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(r,e):t.insertBefore(r,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(r,t)):(e=t,e.appendChild(r)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=sh));else if(n!==4&&(r=r.child,r!==null))for(Xf(r,e,t),r=r.sibling;r!==null;)Xf(r,e,t),r=r.sibling}function Jf(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.insertBefore(r,e):t.appendChild(r);else if(n!==4&&(r=r.child,r!==null))for(Jf(r,e,t),r=r.sibling;r!==null;)Jf(r,e,t),r=r.sibling}var Ti=null,Hs=!1;function to(r,e,t){for(t=t.child;t!==null;)O1(r,e,t),t=t.sibling}function O1(r,e,t){if(ua&&typeof ua.onCommitFiberUnmount=="function")try{ua.onCommitFiberUnmount(Bh,t)}catch{}switch(t.tag){case 5:Fi||qc(t,e);case 6:var n=Ti,i=Hs;Ti=null,to(r,e,t),Ti=n,Hs=i,Ti!==null&&(Hs?(r=Ti,t=t.stateNode,r.nodeType===8?r.parentNode.removeChild(t):r.removeChild(t)):Ti.removeChild(t.stateNode));break;case 18:Ti!==null&&(Hs?(r=Ti,t=t.stateNode,r.nodeType===8?Cp(r.parentNode,t):r.nodeType===1&&Cp(r,t),du(r)):Cp(Ti,t.stateNode));break;case 4:n=Ti,i=Hs,Ti=t.stateNode.containerInfo,Hs=!0,to(r,e,t),Ti=n,Hs=i;break;case 0:case 11:case 14:case 15:if(!Fi&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var s=i,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&Yf(t,e,a),i=i.next}while(i!==n)}to(r,e,t);break;case 1:if(!Fi&&(qc(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(c){Dn(t,e,c)}to(r,e,t);break;case 21:to(r,e,t);break;case 22:t.mode&1?(Fi=(n=Fi)||t.memoizedState!==null,to(r,e,t),Fi=n):to(r,e,t);break;default:to(r,e,t)}}function nv(r){var e=r.updateQueue;if(e!==null){r.updateQueue=null;var t=r.stateNode;t===null&&(t=r.stateNode=new LR),e.forEach(function(n){var i=UR.bind(null,r,n);t.has(n)||(t.add(n),n.then(i,i))})}}function Us(r,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var i=t[n];try{var s=r,a=e,c=a;e:for(;c!==null;){switch(c.tag){case 5:Ti=c.stateNode,Hs=!1;break e;case 3:Ti=c.stateNode.containerInfo,Hs=!0;break e;case 4:Ti=c.stateNode.containerInfo,Hs=!0;break e}c=c.return}if(Ti===null)throw Error(ot(160));O1(s,a,i),Ti=null,Hs=!1;var o=i.alternate;o!==null&&(o.return=null),i.return=null}catch(l){Dn(i,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)M1(e,r),e=e.sibling}function M1(r,e){var t=r.alternate,n=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(Us(e,r),ta(r),n&4){try{ru(3,r,r.return),Kh(3,r)}catch(d){Dn(r,r.return,d)}try{ru(5,r,r.return)}catch(d){Dn(r,r.return,d)}}break;case 1:Us(e,r),ta(r),n&512&&t!==null&&qc(t,t.return);break;case 5:if(Us(e,r),ta(r),n&512&&t!==null&&qc(t,t.return),r.flags&32){var i=r.stateNode;try{ou(i,"")}catch(d){Dn(r,r.return,d)}}if(n&4&&(i=r.stateNode,i!=null)){var s=r.memoizedProps,a=t!==null?t.memoizedProps:s,c=r.type,o=r.updateQueue;if(r.updateQueue=null,o!==null)try{c==="input"&&s.type==="radio"&&s.name!=null&&n_(i,s),wf(c,a);var l=wf(c,s);for(a=0;a<o.length;a+=2){var u=o[a],h=o[a+1];u==="style"?c_(i,h):u==="dangerouslySetInnerHTML"?a_(i,h):u==="children"?ou(i,h):Am(i,u,h,l)}switch(c){case"input":vf(i,s);break;case"textarea":i_(i,s);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var g=s.value;g!=null?Xc(i,!!s.multiple,g,!1):f!==!!s.multiple&&(s.defaultValue!=null?Xc(i,!!s.multiple,s.defaultValue,!0):Xc(i,!!s.multiple,s.multiple?[]:"",!1))}i[gu]=s}catch(d){Dn(r,r.return,d)}}break;case 6:if(Us(e,r),ta(r),n&4){if(r.stateNode===null)throw Error(ot(162));i=r.stateNode,s=r.memoizedProps;try{i.nodeValue=s}catch(d){Dn(r,r.return,d)}}break;case 3:if(Us(e,r),ta(r),n&4&&t!==null&&t.memoizedState.isDehydrated)try{du(e.containerInfo)}catch(d){Dn(r,r.return,d)}break;case 4:Us(e,r),ta(r);break;case 13:Us(e,r),ta(r),i=r.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(hg=Un())),n&4&&nv(r);break;case 22:if(u=t!==null&&t.memoizedState!==null,r.mode&1?(Fi=(l=Fi)||u,Us(e,r),Fi=l):Us(e,r),ta(r),n&8192){if(l=r.memoizedState!==null,(r.stateNode.isHidden=l)&&!u&&r.mode&1)for(Ct=r,u=r.child;u!==null;){for(h=Ct=u;Ct!==null;){switch(f=Ct,g=f.child,f.tag){case 0:case 11:case 14:case 15:ru(4,f,f.return);break;case 1:qc(f,f.return);var p=f.stateNode;if(typeof p.componentWillUnmount=="function"){n=f,t=f.return;try{e=n,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(d){Dn(n,t,d)}}break;case 5:qc(f,f.return);break;case 22:if(f.memoizedState!==null){sv(h);continue}}g!==null?(g.return=f,Ct=g):sv(h)}u=u.sibling}e:for(u=null,h=r;;){if(h.tag===5){if(u===null){u=h;try{i=h.stateNode,l?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(c=h.stateNode,o=h.memoizedProps.style,a=o!=null&&o.hasOwnProperty("display")?o.display:null,c.style.display=o_("display",a))}catch(d){Dn(r,r.return,d)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=l?"":h.memoizedProps}catch(d){Dn(r,r.return,d)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===r)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===r)break e;for(;h.sibling===null;){if(h.return===null||h.return===r)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Us(e,r),ta(r),n&4&&nv(r);break;case 21:break;default:Us(e,r),ta(r)}}function ta(r){var e=r.flags;if(e&2){try{e:{for(var t=r.return;t!==null;){if(A1(t)){var n=t;break e}t=t.return}throw Error(ot(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(ou(i,""),n.flags&=-33);var s=rv(r);Jf(r,s,i);break;case 3:case 4:var a=n.stateNode.containerInfo,c=rv(r);Xf(r,c,a);break;default:throw Error(ot(161))}}catch(o){Dn(r,r.return,o)}r.flags&=-3}e&4096&&(r.flags&=-4097)}function IR(r,e,t){Ct=r,N1(r)}function N1(r,e,t){for(var n=(r.mode&1)!==0;Ct!==null;){var i=Ct,s=i.child;if(i.tag===22&&n){var a=i.memoizedState!==null||md;if(!a){var c=i.alternate,o=c!==null&&c.memoizedState!==null||Fi;c=md;var l=Fi;if(md=a,(Fi=o)&&!l)for(Ct=i;Ct!==null;)a=Ct,o=a.child,a.tag===22&&a.memoizedState!==null?av(i):o!==null?(o.return=a,Ct=o):av(i);for(;s!==null;)Ct=s,N1(s),s=s.sibling;Ct=i,md=c,Fi=l}iv(r)}else i.subtreeFlags&8772&&s!==null?(s.return=i,Ct=s):iv(r)}}function iv(r){for(;Ct!==null;){var e=Ct;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Fi||Kh(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!Fi)if(t===null)n.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:Gs(e.type,t.memoizedProps);n.componentDidUpdate(i,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&V0(e,s,n);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}V0(e,a,t)}break;case 5:var c=e.stateNode;if(t===null&&e.flags&4){t=c;var o=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":o.autoFocus&&t.focus();break;case"img":o.src&&(t.src=o.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var u=l.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&du(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ot(163))}Fi||e.flags&512&&Qf(e)}catch(f){Dn(e,e.return,f)}}if(e===r){Ct=null;break}if(t=e.sibling,t!==null){t.return=e.return,Ct=t;break}Ct=e.return}}function sv(r){for(;Ct!==null;){var e=Ct;if(e===r){Ct=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Ct=t;break}Ct=e.return}}function av(r){for(;Ct!==null;){var e=Ct;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Kh(4,e)}catch(o){Dn(e,t,o)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var i=e.return;try{n.componentDidMount()}catch(o){Dn(e,i,o)}}var s=e.return;try{Qf(e)}catch(o){Dn(e,s,o)}break;case 5:var a=e.return;try{Qf(e)}catch(o){Dn(e,a,o)}}}catch(o){Dn(e,e.return,o)}if(e===r){Ct=null;break}var c=e.sibling;if(c!==null){c.return=e.return,Ct=c;break}Ct=e.return}}var AR=Math.ceil,gh=Ba.ReactCurrentDispatcher,ug=Ba.ReactCurrentOwner,Ps=Ba.ReactCurrentBatchConfig,Ar=0,mi=null,Yn=null,ki=0,fs=0,Yc=To(0),ci=0,wu=null,ic=0,qh=0,dg=0,nu=null,Zi=null,hg=0,hl=1/0,ka=null,vh=!1,Zf=null,yo=null,gd=!1,lo=null,yh=0,iu=0,em=null,jd=-1,Bd=0;function Wi(){return Ar&6?Un():jd!==-1?jd:jd=Un()}function _o(r){return r.mode&1?Ar&2&&ki!==0?ki&-ki:gR.transition!==null?(Bd===0&&(Bd=b_()),Bd):(r=Hr,r!==0||(r=window.event,r=r===void 0?16:k_(r.type)),r):1}function qs(r,e,t,n){if(50<iu)throw iu=0,em=null,Error(ot(185));Lu(r,t,n),(!(Ar&2)||r!==mi)&&(r===mi&&(!(Ar&2)&&(qh|=t),ci===4&&oo(r,ki)),is(r,n),t===1&&Ar===0&&!(e.mode&1)&&(hl=Un()+500,Hh&&xo()))}function is(r,e){var t=r.callbackNode;gE(r,e);var n=th(r,r===mi?ki:0);if(n===0)t!==null&&m0(t),r.callbackNode=null,r.callbackPriority=0;else if(e=n&-n,r.callbackPriority!==e){if(t!=null&&m0(t),e===1)r.tag===0?mR(ov.bind(null,r)):z_(ov.bind(null,r)),dR(function(){!(Ar&6)&&xo()}),t=null;else{switch(S_(n)){case 1:t=jm;break;case 4:t=y_;break;case 16:t=eh;break;case 536870912:t=__;break;default:t=eh}t=H1(t,F1.bind(null,r))}r.callbackPriority=e,r.callbackNode=t}}function F1(r,e){if(jd=-1,Bd=0,Ar&6)throw Error(ot(327));var t=r.callbackNode;if(rl()&&r.callbackNode!==t)return null;var n=th(r,r===mi?ki:0);if(n===0)return null;if(n&30||n&r.expiredLanes||e)e=_h(r,n);else{e=n;var i=Ar;Ar|=2;var s=B1();(mi!==r||ki!==e)&&(ka=null,hl=Un()+500,Jo(r,e));do try{NR();break}catch(c){j1(r,c)}while(!0);Xm(),gh.current=s,Ar=i,Yn!==null?e=0:(mi=null,ki=0,e=ci)}if(e!==0){if(e===2&&(i=kf(r),i!==0&&(n=i,e=tm(r,i))),e===1)throw t=wu,Jo(r,0),oo(r,n),is(r,Un()),t;if(e===6)oo(r,n);else{if(i=r.current.alternate,!(n&30)&&!OR(i)&&(e=_h(r,n),e===2&&(s=kf(r),s!==0&&(n=s,e=tm(r,s))),e===1))throw t=wu,Jo(r,0),oo(r,n),is(r,Un()),t;switch(r.finishedWork=i,r.finishedLanes=n,e){case 0:case 1:throw Error(ot(345));case 2:zo(r,Zi,ka);break;case 3:if(oo(r,n),(n&130023424)===n&&(e=hg+500-Un(),10<e)){if(th(r,0)!==0)break;if(i=r.suspendedLanes,(i&n)!==n){Wi(),r.pingedLanes|=r.suspendedLanes&i;break}r.timeoutHandle=Mf(zo.bind(null,r,Zi,ka),e);break}zo(r,Zi,ka);break;case 4:if(oo(r,n),(n&4194240)===n)break;for(e=r.eventTimes,i=-1;0<n;){var a=31-Ks(n);s=1<<a,a=e[a],a>i&&(i=a),n&=~s}if(n=i,n=Un()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*AR(n/1960))-n,10<n){r.timeoutHandle=Mf(zo.bind(null,r,Zi,ka),n);break}zo(r,Zi,ka);break;case 5:zo(r,Zi,ka);break;default:throw Error(ot(329))}}}return is(r,Un()),r.callbackNode===t?F1.bind(null,r):null}function tm(r,e){var t=nu;return r.current.memoizedState.isDehydrated&&(Jo(r,e).flags|=256),r=_h(r,e),r!==2&&(e=Zi,Zi=t,e!==null&&rm(e)),r}function rm(r){Zi===null?Zi=r:Zi.push.apply(Zi,r)}function OR(r){for(var e=r;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var i=t[n],s=i.getSnapshot;i=i.value;try{if(!Ys(s(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function oo(r,e){for(e&=~dg,e&=~qh,r.suspendedLanes|=e,r.pingedLanes&=~e,r=r.expirationTimes;0<e;){var t=31-Ks(e),n=1<<t;r[t]=-1,e&=~n}}function ov(r){if(Ar&6)throw Error(ot(327));rl();var e=th(r,0);if(!(e&1))return is(r,Un()),null;var t=_h(r,e);if(r.tag!==0&&t===2){var n=kf(r);n!==0&&(e=n,t=tm(r,n))}if(t===1)throw t=wu,Jo(r,0),oo(r,e),is(r,Un()),t;if(t===6)throw Error(ot(345));return r.finishedWork=r.current.alternate,r.finishedLanes=e,zo(r,Zi,ka),is(r,Un()),null}function pg(r,e){var t=Ar;Ar|=1;try{return r(e)}finally{Ar=t,Ar===0&&(hl=Un()+500,Hh&&xo())}}function sc(r){lo!==null&&lo.tag===0&&!(Ar&6)&&rl();var e=Ar;Ar|=1;var t=Ps.transition,n=Hr;try{if(Ps.transition=null,Hr=1,r)return r()}finally{Hr=n,Ps.transition=t,Ar=e,!(Ar&6)&&xo()}}function fg(){fs=Yc.current,dn(Yc)}function Jo(r,e){r.finishedWork=null,r.finishedLanes=0;var t=r.timeoutHandle;if(t!==-1&&(r.timeoutHandle=-1,uR(t)),Yn!==null)for(t=Yn.return;t!==null;){var n=t;switch(qm(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&ah();break;case 3:ul(),dn(rs),dn(ji),ng();break;case 5:rg(n);break;case 4:ul();break;case 13:dn(Rn);break;case 19:dn(Rn);break;case 10:Jm(n.type._context);break;case 22:case 23:fg()}t=t.return}if(mi=r,Yn=r=bo(r.current,null),ki=fs=e,ci=0,wu=null,dg=qh=ic=0,Zi=nu=null,Yo!==null){for(e=0;e<Yo.length;e++)if(t=Yo[e],n=t.interleaved,n!==null){t.interleaved=null;var i=n.next,s=t.pending;if(s!==null){var a=s.next;s.next=i,n.next=a}t.pending=n}Yo=null}return r}function j1(r,e){do{var t=Yn;try{if(Xm(),Md.current=mh,fh){for(var n=Tn.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}fh=!1}if(nc=0,pi=oi=Tn=null,tu=!1,_u=0,ug.current=null,t===null||t.return===null){ci=1,wu=e,Yn=null;break}e:{var s=r,a=t.return,c=t,o=e;if(e=ki,c.flags|=32768,o!==null&&typeof o=="object"&&typeof o.then=="function"){var l=o,u=c,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var g=q0(a);if(g!==null){g.flags&=-257,Y0(g,a,c,s,e),g.mode&1&&K0(s,l,e),e=g,o=l;var p=e.updateQueue;if(p===null){var d=new Set;d.add(o),e.updateQueue=d}else p.add(o);break e}else{if(!(e&1)){K0(s,l,e),mg();break e}o=Error(ot(426))}}else if(gn&&c.mode&1){var m=q0(a);if(m!==null){!(m.flags&65536)&&(m.flags|=256),Y0(m,a,c,s,e),Ym(dl(o,c));break e}}s=o=dl(o,c),ci!==4&&(ci=2),nu===null?nu=[s]:nu.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var E=S1(s,o,e);$0(s,E);break e;case 1:c=o;var S=s.type,R=s.stateNode;if(!(s.flags&128)&&(typeof S.getDerivedStateFromError=="function"||R!==null&&typeof R.componentDidCatch=="function"&&(yo===null||!yo.has(R)))){s.flags|=65536,e&=-e,s.lanes|=e;var k=w1(s,c,e);$0(s,k);break e}}s=s.return}while(s!==null)}$1(t)}catch(C){e=C,Yn===t&&t!==null&&(Yn=t=t.return);continue}break}while(!0)}function B1(){var r=gh.current;return gh.current=mh,r===null?mh:r}function mg(){(ci===0||ci===3||ci===2)&&(ci=4),mi===null||!(ic&268435455)&&!(qh&268435455)||oo(mi,ki)}function _h(r,e){var t=Ar;Ar|=2;var n=B1();(mi!==r||ki!==e)&&(ka=null,Jo(r,e));do try{MR();break}catch(i){j1(r,i)}while(!0);if(Xm(),Ar=t,gh.current=n,Yn!==null)throw Error(ot(261));return mi=null,ki=0,ci}function MR(){for(;Yn!==null;)U1(Yn)}function NR(){for(;Yn!==null&&!oE();)U1(Yn)}function U1(r){var e=G1(r.alternate,r,fs);r.memoizedProps=r.pendingProps,e===null?$1(r):Yn=e,ug.current=null}function $1(r){var e=r;do{var t=e.alternate;if(r=e.return,e.flags&32768){if(t=PR(t,e),t!==null){t.flags&=32767,Yn=t;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{ci=6,Yn=null;return}}else if(t=CR(t,e,fs),t!==null){Yn=t;return}if(e=e.sibling,e!==null){Yn=e;return}Yn=e=r}while(e!==null);ci===0&&(ci=5)}function zo(r,e,t){var n=Hr,i=Ps.transition;try{Ps.transition=null,Hr=1,FR(r,e,t,n)}finally{Ps.transition=i,Hr=n}return null}function FR(r,e,t,n){do rl();while(lo!==null);if(Ar&6)throw Error(ot(327));t=r.finishedWork;var i=r.finishedLanes;if(t===null)return null;if(r.finishedWork=null,r.finishedLanes=0,t===r.current)throw Error(ot(177));r.callbackNode=null,r.callbackPriority=0;var s=t.lanes|t.childLanes;if(vE(r,s),r===mi&&(Yn=mi=null,ki=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||gd||(gd=!0,H1(eh,function(){return rl(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=Ps.transition,Ps.transition=null;var a=Hr;Hr=1;var c=Ar;Ar|=4,ug.current=null,DR(r,t),M1(t,r),nR(Af),rh=!!If,Af=If=null,r.current=t,IR(t),cE(),Ar=c,Hr=a,Ps.transition=s}else r.current=t;if(gd&&(gd=!1,lo=r,yh=i),s=r.pendingLanes,s===0&&(yo=null),dE(t.stateNode),is(r,Un()),e!==null)for(n=r.onRecoverableError,t=0;t<e.length;t++)i=e[t],n(i.value,{componentStack:i.stack,digest:i.digest});if(vh)throw vh=!1,r=Zf,Zf=null,r;return yh&1&&r.tag!==0&&rl(),s=r.pendingLanes,s&1?r===em?iu++:(iu=0,em=r):iu=0,xo(),null}function rl(){if(lo!==null){var r=S_(yh),e=Ps.transition,t=Hr;try{if(Ps.transition=null,Hr=16>r?16:r,lo===null)var n=!1;else{if(r=lo,lo=null,yh=0,Ar&6)throw Error(ot(331));var i=Ar;for(Ar|=4,Ct=r.current;Ct!==null;){var s=Ct,a=s.child;if(Ct.flags&16){var c=s.deletions;if(c!==null){for(var o=0;o<c.length;o++){var l=c[o];for(Ct=l;Ct!==null;){var u=Ct;switch(u.tag){case 0:case 11:case 15:ru(8,u,s)}var h=u.child;if(h!==null)h.return=u,Ct=h;else for(;Ct!==null;){u=Ct;var f=u.sibling,g=u.return;if(I1(u),u===l){Ct=null;break}if(f!==null){f.return=g,Ct=f;break}Ct=g}}}var p=s.alternate;if(p!==null){var d=p.child;if(d!==null){p.child=null;do{var m=d.sibling;d.sibling=null,d=m}while(d!==null)}}Ct=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,Ct=a;else e:for(;Ct!==null;){if(s=Ct,s.flags&2048)switch(s.tag){case 0:case 11:case 15:ru(9,s,s.return)}var E=s.sibling;if(E!==null){E.return=s.return,Ct=E;break e}Ct=s.return}}var S=r.current;for(Ct=S;Ct!==null;){a=Ct;var R=a.child;if(a.subtreeFlags&2064&&R!==null)R.return=a,Ct=R;else e:for(a=S;Ct!==null;){if(c=Ct,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Kh(9,c)}}catch(C){Dn(c,c.return,C)}if(c===a){Ct=null;break e}var k=c.sibling;if(k!==null){k.return=c.return,Ct=k;break e}Ct=c.return}}if(Ar=i,xo(),ua&&typeof ua.onPostCommitFiberRoot=="function")try{ua.onPostCommitFiberRoot(Bh,r)}catch{}n=!0}return n}finally{Hr=t,Ps.transition=e}}return!1}function cv(r,e,t){e=dl(t,e),e=S1(r,e,1),r=vo(r,e,1),e=Wi(),r!==null&&(Lu(r,1,e),is(r,e))}function Dn(r,e,t){if(r.tag===3)cv(r,r,t);else for(;e!==null;){if(e.tag===3){cv(e,r,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(yo===null||!yo.has(n))){r=dl(t,r),r=w1(e,r,1),e=vo(e,r,1),r=Wi(),e!==null&&(Lu(e,1,r),is(e,r));break}}e=e.return}}function jR(r,e,t){var n=r.pingCache;n!==null&&n.delete(e),e=Wi(),r.pingedLanes|=r.suspendedLanes&t,mi===r&&(ki&t)===t&&(ci===4||ci===3&&(ki&130023424)===ki&&500>Un()-hg?Jo(r,0):dg|=t),is(r,e)}function V1(r,e){e===0&&(r.mode&1?(e=ad,ad<<=1,!(ad&130023424)&&(ad=4194304)):e=1);var t=Wi();r=Fa(r,e),r!==null&&(Lu(r,e,t),is(r,t))}function BR(r){var e=r.memoizedState,t=0;e!==null&&(t=e.retryLane),V1(r,t)}function UR(r,e){var t=0;switch(r.tag){case 13:var n=r.stateNode,i=r.memoizedState;i!==null&&(t=i.retryLane);break;case 19:n=r.stateNode;break;default:throw Error(ot(314))}n!==null&&n.delete(e),V1(r,t)}var G1;G1=function(r,e,t){if(r!==null)if(r.memoizedProps!==e.pendingProps||rs.current)ts=!0;else{if(!(r.lanes&t)&&!(e.flags&128))return ts=!1,kR(r,e,t);ts=!!(r.flags&131072)}else ts=!1,gn&&e.flags&1048576&&K_(e,lh,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;Fd(r,e),r=e.pendingProps;var i=ol(e,ji.current);tl(e,t),i=sg(null,e,n,r,i,t);var s=ag();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ns(n)?(s=!0,oh(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,eg(e),i.updater=zh,e.stateNode=i,i._reactInternals=e,Vf(e,n,r,t),e=Wf(null,e,n,!0,s,t)):(e.tag=0,gn&&s&&Km(e),Hi(null,e,i,t),e=e.child),e;case 16:n=e.elementType;e:{switch(Fd(r,e),r=e.pendingProps,i=n._init,n=i(n._payload),e.type=n,i=e.tag=VR(n),r=Gs(n,r),i){case 0:e=Hf(null,e,n,r,t);break e;case 1:e=J0(null,e,n,r,t);break e;case 11:e=Q0(null,e,n,r,t);break e;case 14:e=X0(null,e,n,Gs(n.type,r),t);break e}throw Error(ot(306,n,""))}return e;case 0:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Gs(n,i),Hf(r,e,n,i,t);case 1:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Gs(n,i),J0(r,e,n,i,t);case 3:e:{if(x1(e),r===null)throw Error(ot(387));n=e.pendingProps,s=e.memoizedState,i=s.element,Z_(r,e),hh(e,n,null,t);var a=e.memoizedState;if(n=a.element,s.isDehydrated)if(s={element:n,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=dl(Error(ot(423)),e),e=Z0(r,e,n,t,i);break e}else if(n!==i){i=dl(Error(ot(424)),e),e=Z0(r,e,n,t,i);break e}else for(ms=go(e.stateNode.containerInfo.firstChild),vs=e,gn=!0,Ws=null,t=X_(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(cl(),n===i){e=ja(r,e,t);break e}Hi(r,e,n,t)}e=e.child}return e;case 5:return e1(e),r===null&&Bf(e),n=e.type,i=e.pendingProps,s=r!==null?r.memoizedProps:null,a=i.children,Of(n,i)?a=null:s!==null&&Of(n,s)&&(e.flags|=32),T1(r,e),Hi(r,e,a,t),e.child;case 6:return r===null&&Bf(e),null;case 13:return k1(r,e,t);case 4:return tg(e,e.stateNode.containerInfo),n=e.pendingProps,r===null?e.child=ll(e,null,n,t):Hi(r,e,n,t),e.child;case 11:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Gs(n,i),Q0(r,e,n,i,t);case 7:return Hi(r,e,e.pendingProps,t),e.child;case 8:return Hi(r,e,e.pendingProps.children,t),e.child;case 12:return Hi(r,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,i=e.pendingProps,s=e.memoizedProps,a=i.value,sn(uh,n._currentValue),n._currentValue=a,s!==null)if(Ys(s.value,a)){if(s.children===i.children&&!rs.current){e=ja(r,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var c=s.dependencies;if(c!==null){a=s.child;for(var o=c.firstContext;o!==null;){if(o.context===n){if(s.tag===1){o=Oa(-1,t&-t),o.tag=2;var l=s.updateQueue;if(l!==null){l=l.shared;var u=l.pending;u===null?o.next=o:(o.next=u.next,u.next=o),l.pending=o}}s.lanes|=t,o=s.alternate,o!==null&&(o.lanes|=t),Uf(s.return,t,e),c.lanes|=t;break}o=o.next}}else if(s.tag===10)a=s.type===e.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(ot(341));a.lanes|=t,c=a.alternate,c!==null&&(c.lanes|=t),Uf(a,t,e),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===e){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}Hi(r,e,i.children,t),e=e.child}return e;case 9:return i=e.type,n=e.pendingProps.children,tl(e,t),i=Ls(i),n=n(i),e.flags|=1,Hi(r,e,n,t),e.child;case 14:return n=e.type,i=Gs(n,e.pendingProps),i=Gs(n.type,i),X0(r,e,n,i,t);case 15:return E1(r,e,e.type,e.pendingProps,t);case 17:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Gs(n,i),Fd(r,e),e.tag=1,ns(n)?(r=!0,oh(e)):r=!1,tl(e,t),b1(e,n,i),Vf(e,n,i,t),Wf(null,e,n,!0,r,t);case 19:return C1(r,e,t);case 22:return R1(r,e,t)}throw Error(ot(156,e.tag))};function H1(r,e){return v_(r,e)}function $R(r,e,t,n){this.tag=r,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Cs(r,e,t,n){return new $R(r,e,t,n)}function gg(r){return r=r.prototype,!(!r||!r.isReactComponent)}function VR(r){if(typeof r=="function")return gg(r)?1:0;if(r!=null){if(r=r.$$typeof,r===Mm)return 11;if(r===Nm)return 14}return 2}function bo(r,e){var t=r.alternate;return t===null?(t=Cs(r.tag,e,r.key,r.mode),t.elementType=r.elementType,t.type=r.type,t.stateNode=r.stateNode,t.alternate=r,r.alternate=t):(t.pendingProps=e,t.type=r.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=r.flags&14680064,t.childLanes=r.childLanes,t.lanes=r.lanes,t.child=r.child,t.memoizedProps=r.memoizedProps,t.memoizedState=r.memoizedState,t.updateQueue=r.updateQueue,e=r.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=r.sibling,t.index=r.index,t.ref=r.ref,t}function Ud(r,e,t,n,i,s){var a=2;if(n=r,typeof r=="function")gg(r)&&(a=1);else if(typeof r=="string")a=5;else e:switch(r){case Bc:return Zo(t.children,i,s,e);case Om:a=8,i|=8;break;case hf:return r=Cs(12,t,e,i|2),r.elementType=hf,r.lanes=s,r;case pf:return r=Cs(13,t,e,i),r.elementType=pf,r.lanes=s,r;case ff:return r=Cs(19,t,e,i),r.elementType=ff,r.lanes=s,r;case e_:return Yh(t,i,s,e);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case Jy:a=10;break e;case Zy:a=9;break e;case Mm:a=11;break e;case Nm:a=14;break e;case no:a=16,n=null;break e}throw Error(ot(130,r==null?r:typeof r,""))}return e=Cs(a,t,e,i),e.elementType=r,e.type=n,e.lanes=s,e}function Zo(r,e,t,n){return r=Cs(7,r,n,e),r.lanes=t,r}function Yh(r,e,t,n){return r=Cs(22,r,n,e),r.elementType=e_,r.lanes=t,r.stateNode={isHidden:!1},r}function Np(r,e,t){return r=Cs(6,r,null,e),r.lanes=t,r}function Fp(r,e,t){return e=Cs(4,r.children!==null?r.children:[],r.key,e),e.lanes=t,e.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},e}function GR(r,e,t,n,i){this.tag=e,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vp(0),this.expirationTimes=vp(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vp(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function vg(r,e,t,n,i,s,a,c,o){return r=new GR(r,e,t,c,o),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Cs(3,null,null,e),r.current=s,s.stateNode=r,s.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},eg(s),r}function HR(r,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:jc,key:n==null?null:""+n,children:r,containerInfo:e,implementation:t}}function W1(r){if(!r)return Eo;r=r._reactInternals;e:{if(cc(r)!==r||r.tag!==1)throw Error(ot(170));var e=r;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ns(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ot(171))}if(r.tag===1){var t=r.type;if(ns(t))return W_(r,t,e)}return e}function z1(r,e,t,n,i,s,a,c,o){return r=vg(t,n,!0,r,i,s,a,c,o),r.context=W1(null),t=r.current,n=Wi(),i=_o(t),s=Oa(n,i),s.callback=e??null,vo(t,s,i),r.current.lanes=i,Lu(r,i,n),is(r,n),r}function Qh(r,e,t,n){var i=e.current,s=Wi(),a=_o(i);return t=W1(t),e.context===null?e.context=t:e.pendingContext=t,e=Oa(s,a),e.payload={element:r},n=n===void 0?null:n,n!==null&&(e.callback=n),r=vo(i,e,a),r!==null&&(qs(r,i,a,s),Od(r,i,a)),a}function bh(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function lv(r,e){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var t=r.retryLane;r.retryLane=t!==0&&t<e?t:e}}function yg(r,e){lv(r,e),(r=r.alternate)&&lv(r,e)}function WR(){return null}var K1=typeof reportError=="function"?reportError:function(r){console.error(r)};function _g(r){this._internalRoot=r}Xh.prototype.render=_g.prototype.render=function(r){var e=this._internalRoot;if(e===null)throw Error(ot(409));Qh(r,e,null,null)};Xh.prototype.unmount=_g.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var e=r.containerInfo;sc(function(){Qh(null,r,null,null)}),e[Na]=null}};function Xh(r){this._internalRoot=r}Xh.prototype.unstable_scheduleHydration=function(r){if(r){var e=R_();r={blockedOn:null,target:r,priority:e};for(var t=0;t<ao.length&&e!==0&&e<ao[t].priority;t++);ao.splice(t,0,r),t===0&&x_(r)}};function bg(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function Jh(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function uv(){}function zR(r,e,t,n,i){if(i){if(typeof n=="function"){var s=n;n=function(){var l=bh(a);s.call(l)}}var a=z1(e,n,r,0,null,!1,!1,"",uv);return r._reactRootContainer=a,r[Na]=a.current,fu(r.nodeType===8?r.parentNode:r),sc(),a}for(;i=r.lastChild;)r.removeChild(i);if(typeof n=="function"){var c=n;n=function(){var l=bh(o);c.call(l)}}var o=vg(r,0,!1,null,null,!1,!1,"",uv);return r._reactRootContainer=o,r[Na]=o.current,fu(r.nodeType===8?r.parentNode:r),sc(function(){Qh(e,o,t,n)}),o}function Zh(r,e,t,n,i){var s=t._reactRootContainer;if(s){var a=s;if(typeof i=="function"){var c=i;i=function(){var o=bh(a);c.call(o)}}Qh(e,a,r,i)}else a=zR(t,e,r,i,n);return bh(a)}w_=function(r){switch(r.tag){case 3:var e=r.stateNode;if(e.current.memoizedState.isDehydrated){var t=Kl(e.pendingLanes);t!==0&&(Bm(e,t|1),is(e,Un()),!(Ar&6)&&(hl=Un()+500,xo()))}break;case 13:sc(function(){var n=Fa(r,1);if(n!==null){var i=Wi();qs(n,r,1,i)}}),yg(r,1)}};Um=function(r){if(r.tag===13){var e=Fa(r,134217728);if(e!==null){var t=Wi();qs(e,r,134217728,t)}yg(r,134217728)}};E_=function(r){if(r.tag===13){var e=_o(r),t=Fa(r,e);if(t!==null){var n=Wi();qs(t,r,e,n)}yg(r,e)}};R_=function(){return Hr};T_=function(r,e){var t=Hr;try{return Hr=r,e()}finally{Hr=t}};Rf=function(r,e,t){switch(e){case"input":if(vf(r,t),e=t.name,t.type==="radio"&&e!=null){for(t=r;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==r&&n.form===r.form){var i=Gh(n);if(!i)throw Error(ot(90));r_(n),vf(n,i)}}}break;case"textarea":i_(r,t);break;case"select":e=t.value,e!=null&&Xc(r,!!t.multiple,e,!1)}};d_=pg;h_=sc;var KR={usingClientEntryPoint:!1,Events:[Iu,Gc,Gh,l_,u_,pg]},$l={findFiberByHostInstance:qo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},qR={bundleType:$l.bundleType,version:$l.version,rendererPackageName:$l.rendererPackageName,rendererConfig:$l.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ba.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=m_(r),r===null?null:r.stateNode},findFiberByHostInstance:$l.findFiberByHostInstance||WR,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vd.isDisabled&&vd.supportsFiber)try{Bh=vd.inject(qR),ua=vd}catch{}}_s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=KR;_s.createPortal=function(r,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!bg(e))throw Error(ot(200));return HR(r,e,null,t)};_s.createRoot=function(r,e){if(!bg(r))throw Error(ot(299));var t=!1,n="",i=K1;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=vg(r,1,!1,null,null,t,!1,n,i),r[Na]=e.current,fu(r.nodeType===8?r.parentNode:r),new _g(e)};_s.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var e=r._reactInternals;if(e===void 0)throw typeof r.render=="function"?Error(ot(188)):(r=Object.keys(r).join(","),Error(ot(268,r)));return r=m_(e),r=r===null?null:r.stateNode,r};_s.flushSync=function(r){return sc(r)};_s.hydrate=function(r,e,t){if(!Jh(e))throw Error(ot(200));return Zh(null,r,e,!0,t)};_s.hydrateRoot=function(r,e,t){if(!bg(r))throw Error(ot(405));var n=t!=null&&t.hydratedSources||null,i=!1,s="",a=K1;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=z1(e,null,r,1,t??null,i,!1,s,a),r[Na]=e.current,fu(r),n)for(r=0;r<n.length;r++)t=n[r],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new Xh(e)};_s.render=function(r,e,t){if(!Jh(e))throw Error(ot(200));return Zh(null,r,e,!1,t)};_s.unmountComponentAtNode=function(r){if(!Jh(r))throw Error(ot(40));return r._reactRootContainer?(sc(function(){Zh(null,null,r,!1,function(){r._reactRootContainer=null,r[Na]=null})}),!0):!1};_s.unstable_batchedUpdates=pg;_s.unstable_renderSubtreeIntoContainer=function(r,e,t,n){if(!Jh(t))throw Error(ot(200));if(r==null||r._reactInternals===void 0)throw Error(ot(38));return Zh(r,e,t,!1,n)};_s.version="18.3.1-next-f1338f8080-20240426";function q1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(q1)}catch(r){console.error(r)}}q1(),qy.exports=_s;var YR=qy.exports,dv=YR;uf.createRoot=dv.createRoot,uf.hydrateRoot=dv.hydrateRoot;/**
 * @remix-run/router v1.16.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Eu(){return Eu=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Eu.apply(this,arguments)}var uo;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(uo||(uo={}));const hv="popstate";function QR(r){r===void 0&&(r={});function e(n,i){let{pathname:s,search:a,hash:c}=n.location;return nm("",{pathname:s,search:a,hash:c},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(n,i){return typeof i=="string"?i:Sh(i)}return JR(e,t,null,r)}function Qn(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function Y1(r,e){if(!r){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function XR(){return Math.random().toString(36).substr(2,8)}function pv(r,e){return{usr:r.state,key:r.key,idx:e}}function nm(r,e,t,n){return t===void 0&&(t=null),Eu({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof e=="string"?wl(e):e,{state:t,key:e&&e.key||n||XR()})}function Sh(r){let{pathname:e="/",search:t="",hash:n=""}=r;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function wl(r){let e={};if(r){let t=r.indexOf("#");t>=0&&(e.hash=r.substr(t),r=r.substr(0,t));let n=r.indexOf("?");n>=0&&(e.search=r.substr(n),r=r.substr(0,n)),r&&(e.pathname=r)}return e}function JR(r,e,t,n){n===void 0&&(n={});let{window:i=document.defaultView,v5Compat:s=!1}=n,a=i.history,c=uo.Pop,o=null,l=u();l==null&&(l=0,a.replaceState(Eu({},a.state,{idx:l}),""));function u(){return(a.state||{idx:null}).idx}function h(){c=uo.Pop;let m=u(),E=m==null?null:m-l;l=m,o&&o({action:c,location:d.location,delta:E})}function f(m,E){c=uo.Push;let S=nm(d.location,m,E);l=u()+1;let R=pv(S,l),k=d.createHref(S);try{a.pushState(R,"",k)}catch(C){if(C instanceof DOMException&&C.name==="DataCloneError")throw C;i.location.assign(k)}s&&o&&o({action:c,location:d.location,delta:1})}function g(m,E){c=uo.Replace;let S=nm(d.location,m,E);l=u();let R=pv(S,l),k=d.createHref(S);a.replaceState(R,"",k),s&&o&&o({action:c,location:d.location,delta:0})}function p(m){let E=i.location.origin!=="null"?i.location.origin:i.location.href,S=typeof m=="string"?m:Sh(m);return S=S.replace(/ $/,"%20"),Qn(E,"No window.location.(origin|href) available to create URL for href: "+S),new URL(S,E)}let d={get action(){return c},get location(){return r(i,a)},listen(m){if(o)throw new Error("A history only accepts one active listener");return i.addEventListener(hv,h),o=m,()=>{i.removeEventListener(hv,h),o=null}},createHref(m){return e(i,m)},createURL:p,encodeLocation(m){let E=p(m);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:f,replace:g,go(m){return a.go(m)}};return d}var fv;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(fv||(fv={}));function ZR(r,e,t){t===void 0&&(t="/");let n=typeof e=="string"?wl(e):e,i=Sg(n.pathname||"/",t);if(i==null)return null;let s=Q1(r);eT(s);let a=null;for(let c=0;a==null&&c<s.length;++c){let o=hT(i);a=lT(s[c],o)}return a}function Q1(r,e,t,n){e===void 0&&(e=[]),t===void 0&&(t=[]),n===void 0&&(n="");let i=(s,a,c)=>{let o={relativePath:c===void 0?s.path||"":c,caseSensitive:s.caseSensitive===!0,childrenIndex:a,route:s};o.relativePath.startsWith("/")&&(Qn(o.relativePath.startsWith(n),'Absolute route path "'+o.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),o.relativePath=o.relativePath.slice(n.length));let l=So([n,o.relativePath]),u=t.concat(o);s.children&&s.children.length>0&&(Qn(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+l+'".')),Q1(s.children,e,u,l)),!(s.path==null&&!s.index)&&e.push({path:l,score:oT(l,s.index),routesMeta:u})};return r.forEach((s,a)=>{var c;if(s.path===""||!((c=s.path)!=null&&c.includes("?")))i(s,a);else for(let o of X1(s.path))i(s,a,o)}),e}function X1(r){let e=r.split("/");if(e.length===0)return[];let[t,...n]=e,i=t.endsWith("?"),s=t.replace(/\?$/,"");if(n.length===0)return i?[s,""]:[s];let a=X1(n.join("/")),c=[];return c.push(...a.map(o=>o===""?s:[s,o].join("/"))),i&&c.push(...a),c.map(o=>r.startsWith("/")&&o===""?"/":o)}function eT(r){r.sort((e,t)=>e.score!==t.score?t.score-e.score:cT(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}const tT=/^:[\w-]+$/,rT=3,nT=2,iT=1,sT=10,aT=-2,mv=r=>r==="*";function oT(r,e){let t=r.split("/"),n=t.length;return t.some(mv)&&(n+=aT),e&&(n+=nT),t.filter(i=>!mv(i)).reduce((i,s)=>i+(tT.test(s)?rT:s===""?iT:sT),n)}function cT(r,e){return r.length===e.length&&r.slice(0,-1).every((n,i)=>n===e[i])?r[r.length-1]-e[e.length-1]:0}function lT(r,e){let{routesMeta:t}=r,n={},i="/",s=[];for(let a=0;a<t.length;++a){let c=t[a],o=a===t.length-1,l=i==="/"?e:e.slice(i.length)||"/",u=uT({path:c.relativePath,caseSensitive:c.caseSensitive,end:o},l);if(!u)return null;Object.assign(n,u.params);let h=c.route;s.push({params:n,pathname:So([i,u.pathname]),pathnameBase:gT(So([i,u.pathnameBase])),route:h}),u.pathnameBase!=="/"&&(i=So([i,u.pathnameBase]))}return s}function uT(r,e){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[t,n]=dT(r.path,r.caseSensitive,r.end),i=e.match(t);if(!i)return null;let s=i[0],a=s.replace(/(.)\/+$/,"$1"),c=i.slice(1);return{params:n.reduce((l,u,h)=>{let{paramName:f,isOptional:g}=u;if(f==="*"){let d=c[h]||"";a=s.slice(0,s.length-d.length).replace(/(.)\/+$/,"$1")}const p=c[h];return g&&!p?l[f]=void 0:l[f]=(p||"").replace(/%2F/g,"/"),l},{}),pathname:s,pathnameBase:a,pattern:r}}function dT(r,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),Y1(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let n=[],i="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,c,o)=>(n.push({paramName:c,isOptional:o!=null}),o?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(n.push({paramName:"*"}),i+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":r!==""&&r!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),n]}function hT(r){try{return r.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Y1(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),r}}function Sg(r,e){if(e==="/")return r;if(!r.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=r.charAt(t);return n&&n!=="/"?null:r.slice(t)||"/"}function pT(r,e){e===void 0&&(e="/");let{pathname:t,search:n="",hash:i=""}=typeof r=="string"?wl(r):r;return{pathname:t?t.startsWith("/")?t:fT(t,e):e,search:vT(n),hash:yT(i)}}function fT(r,e){let t=e.replace(/\/+$/,"").split("/");return r.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function jp(r,e,t,n){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function mT(r){return r.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function J1(r,e){let t=mT(r);return e?t.map((n,i)=>i===r.length-1?n.pathname:n.pathnameBase):t.map(n=>n.pathnameBase)}function Z1(r,e,t,n){n===void 0&&(n=!1);let i;typeof r=="string"?i=wl(r):(i=Eu({},r),Qn(!i.pathname||!i.pathname.includes("?"),jp("?","pathname","search",i)),Qn(!i.pathname||!i.pathname.includes("#"),jp("#","pathname","hash",i)),Qn(!i.search||!i.search.includes("#"),jp("#","search","hash",i)));let s=r===""||i.pathname==="",a=s?"/":i.pathname,c;if(a==null)c=t;else{let h=e.length-1;if(!n&&a.startsWith("..")){let f=a.split("/");for(;f[0]==="..";)f.shift(),h-=1;i.pathname=f.join("/")}c=h>=0?e[h]:"/"}let o=pT(i,c),l=a&&a!=="/"&&a.endsWith("/"),u=(s||a===".")&&t.endsWith("/");return!o.pathname.endsWith("/")&&(l||u)&&(o.pathname+="/"),o}const So=r=>r.join("/").replace(/\/\/+/g,"/"),gT=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),vT=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,yT=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function _T(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const eb=["post","put","patch","delete"];new Set(eb);const bT=["get",...eb];new Set(bT);/**
 * React Router v6.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ru(){return Ru=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Ru.apply(this,arguments)}const wg=Ie.createContext(null),ST=Ie.createContext(null),lc=Ie.createContext(null),ep=Ie.createContext(null),uc=Ie.createContext({outlet:null,matches:[],isDataRoute:!1}),tb=Ie.createContext(null);function wT(r,e){let{relative:t}=e===void 0?{}:e;Ou()||Qn(!1);let{basename:n,navigator:i}=Ie.useContext(lc),{hash:s,pathname:a,search:c}=ib(r,{relative:t}),o=a;return n!=="/"&&(o=a==="/"?n:So([n,a])),i.createHref({pathname:o,search:c,hash:s})}function Ou(){return Ie.useContext(ep)!=null}function tp(){return Ou()||Qn(!1),Ie.useContext(ep).location}function rb(r){Ie.useContext(lc).static||Ie.useLayoutEffect(r)}function nb(){let{isDataRoute:r}=Ie.useContext(uc);return r?MT():ET()}function ET(){Ou()||Qn(!1);let r=Ie.useContext(wg),{basename:e,future:t,navigator:n}=Ie.useContext(lc),{matches:i}=Ie.useContext(uc),{pathname:s}=tp(),a=JSON.stringify(J1(i,t.v7_relativeSplatPath)),c=Ie.useRef(!1);return rb(()=>{c.current=!0}),Ie.useCallback(function(l,u){if(u===void 0&&(u={}),!c.current)return;if(typeof l=="number"){n.go(l);return}let h=Z1(l,JSON.parse(a),s,u.relative==="path");r==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:So([e,h.pathname])),(u.replace?n.replace:n.push)(h,u.state,u)},[e,n,a,s,r])}function ib(r,e){let{relative:t}=e===void 0?{}:e,{future:n}=Ie.useContext(lc),{matches:i}=Ie.useContext(uc),{pathname:s}=tp(),a=JSON.stringify(J1(i,n.v7_relativeSplatPath));return Ie.useMemo(()=>Z1(r,JSON.parse(a),s,t==="path"),[r,a,s,t])}function RT(r,e){return TT(r,e)}function TT(r,e,t,n){Ou()||Qn(!1);let{navigator:i}=Ie.useContext(lc),{matches:s}=Ie.useContext(uc),a=s[s.length-1],c=a?a.params:{};a&&a.pathname;let o=a?a.pathnameBase:"/";a&&a.route;let l=tp(),u;if(e){var h;let m=typeof e=="string"?wl(e):e;o==="/"||(h=m.pathname)!=null&&h.startsWith(o)||Qn(!1),u=m}else u=l;let f=u.pathname||"/",g=f;if(o!=="/"){let m=o.replace(/^\//,"").split("/");g="/"+f.replace(/^\//,"").split("/").slice(m.length).join("/")}let p=ZR(r,{pathname:g}),d=LT(p&&p.map(m=>Object.assign({},m,{params:Object.assign({},c,m.params),pathname:So([o,i.encodeLocation?i.encodeLocation(m.pathname).pathname:m.pathname]),pathnameBase:m.pathnameBase==="/"?o:So([o,i.encodeLocation?i.encodeLocation(m.pathnameBase).pathname:m.pathnameBase])})),s,t,n);return e&&d?Ie.createElement(ep.Provider,{value:{location:Ru({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:uo.Pop}},d):d}function xT(){let r=OT(),e=_T(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),t=r instanceof Error?r.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Ie.createElement(Ie.Fragment,null,Ie.createElement("h2",null,"Unexpected Application Error!"),Ie.createElement("h3",{style:{fontStyle:"italic"}},e),t?Ie.createElement("pre",{style:i},t):null,null)}const kT=Ie.createElement(xT,null);class CT extends Ie.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?Ie.createElement(uc.Provider,{value:this.props.routeContext},Ie.createElement(tb.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function PT(r){let{routeContext:e,match:t,children:n}=r,i=Ie.useContext(wg);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),Ie.createElement(uc.Provider,{value:e},n)}function LT(r,e,t,n){var i;if(e===void 0&&(e=[]),t===void 0&&(t=null),n===void 0&&(n=null),r==null){var s;if((s=t)!=null&&s.errors)r=t.matches;else return null}let a=r,c=(i=t)==null?void 0:i.errors;if(c!=null){let u=a.findIndex(h=>h.route.id&&(c==null?void 0:c[h.route.id])!==void 0);u>=0||Qn(!1),a=a.slice(0,Math.min(a.length,u+1))}let o=!1,l=-1;if(t&&n&&n.v7_partialHydration)for(let u=0;u<a.length;u++){let h=a[u];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(l=u),h.route.id){let{loaderData:f,errors:g}=t,p=h.route.loader&&f[h.route.id]===void 0&&(!g||g[h.route.id]===void 0);if(h.route.lazy||p){o=!0,l>=0?a=a.slice(0,l+1):a=[a[0]];break}}}return a.reduceRight((u,h,f)=>{let g,p=!1,d=null,m=null;t&&(g=c&&h.route.id?c[h.route.id]:void 0,d=h.route.errorElement||kT,o&&(l<0&&f===0?(p=!0,m=null):l===f&&(p=!0,m=h.route.hydrateFallbackElement||null)));let E=e.concat(a.slice(0,f+1)),S=()=>{let R;return g?R=d:p?R=m:h.route.Component?R=Ie.createElement(h.route.Component,null):h.route.element?R=h.route.element:R=u,Ie.createElement(PT,{match:h,routeContext:{outlet:u,matches:E,isDataRoute:t!=null},children:R})};return t&&(h.route.ErrorBoundary||h.route.errorElement||f===0)?Ie.createElement(CT,{location:t.location,revalidation:t.revalidation,component:d,error:g,children:S(),routeContext:{outlet:null,matches:E,isDataRoute:!0}}):S()},null)}var sb=function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r}(sb||{}),wh=function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r}(wh||{});function DT(r){let e=Ie.useContext(wg);return e||Qn(!1),e}function IT(r){let e=Ie.useContext(ST);return e||Qn(!1),e}function AT(r){let e=Ie.useContext(uc);return e||Qn(!1),e}function ab(r){let e=AT(),t=e.matches[e.matches.length-1];return t.route.id||Qn(!1),t.route.id}function OT(){var r;let e=Ie.useContext(tb),t=IT(wh.UseRouteError),n=ab(wh.UseRouteError);return e!==void 0?e:(r=t.errors)==null?void 0:r[n]}function MT(){let{router:r}=DT(sb.UseNavigateStable),e=ab(wh.UseNavigateStable),t=Ie.useRef(!1);return rb(()=>{t.current=!0}),Ie.useCallback(function(i,s){s===void 0&&(s={}),t.current&&(typeof i=="number"?r.navigate(i):r.navigate(i,Ru({fromRouteId:e},s)))},[r,e])}function na(r){Qn(!1)}function NT(r){let{basename:e="/",children:t=null,location:n,navigationType:i=uo.Pop,navigator:s,static:a=!1,future:c}=r;Ou()&&Qn(!1);let o=e.replace(/^\/*/,"/"),l=Ie.useMemo(()=>({basename:o,navigator:s,static:a,future:Ru({v7_relativeSplatPath:!1},c)}),[o,c,s,a]);typeof n=="string"&&(n=wl(n));let{pathname:u="/",search:h="",hash:f="",state:g=null,key:p="default"}=n,d=Ie.useMemo(()=>{let m=Sg(u,o);return m==null?null:{location:{pathname:m,search:h,hash:f,state:g,key:p},navigationType:i}},[o,u,h,f,g,p,i]);return d==null?null:Ie.createElement(lc.Provider,{value:l},Ie.createElement(ep.Provider,{children:t,value:d}))}function FT(r){let{children:e,location:t}=r;return RT(im(e),t)}new Promise(()=>{});function im(r,e){e===void 0&&(e=[]);let t=[];return Ie.Children.forEach(r,(n,i)=>{if(!Ie.isValidElement(n))return;let s=[...e,i];if(n.type===Ie.Fragment){t.push.apply(t,im(n.props.children,s));return}n.type!==na&&Qn(!1),!n.props.index||!n.props.children||Qn(!1);let a={id:n.props.id||s.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(a.children=im(n.props.children,s)),t.push(a)}),t}/**
 * React Router DOM v6.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function sm(){return sm=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},sm.apply(this,arguments)}function jT(r,e){if(r==null)return{};var t={},n=Object.keys(r),i,s;for(s=0;s<n.length;s++)i=n[s],!(e.indexOf(i)>=0)&&(t[i]=r[i]);return t}function BT(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function UT(r,e){return r.button===0&&(!e||e==="_self")&&!BT(r)}const $T=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],VT="6";try{window.__reactRouterVersion=VT}catch{}const GT="startTransition",gv=jw[GT];function HT(r){let{basename:e,children:t,future:n,window:i}=r,s=Ie.useRef();s.current==null&&(s.current=QR({window:i,v5Compat:!0}));let a=s.current,[c,o]=Ie.useState({action:a.action,location:a.location}),{v7_startTransition:l}=n||{},u=Ie.useCallback(h=>{l&&gv?gv(()=>o(h)):o(h)},[o,l]);return Ie.useLayoutEffect(()=>a.listen(u),[a,u]),Ie.createElement(NT,{basename:e,children:t,location:c.location,navigationType:c.action,navigator:a,future:n})}const WT=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",zT=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Eh=Ie.forwardRef(function(e,t){let{onClick:n,relative:i,reloadDocument:s,replace:a,state:c,target:o,to:l,preventScrollReset:u,unstable_viewTransition:h}=e,f=jT(e,$T),{basename:g}=Ie.useContext(lc),p,d=!1;if(typeof l=="string"&&zT.test(l)&&(p=l,WT))try{let R=new URL(window.location.href),k=l.startsWith("//")?new URL(R.protocol+l):new URL(l),C=Sg(k.pathname,g);k.origin===R.origin&&C!=null?l=C+k.search+k.hash:d=!0}catch{}let m=wT(l,{relative:i}),E=KT(l,{replace:a,state:c,target:o,preventScrollReset:u,relative:i,unstable_viewTransition:h});function S(R){n&&n(R),R.defaultPrevented||E(R)}return Ie.createElement("a",sm({},f,{href:p||m,onClick:d||s?n:S,ref:t,target:o}))});var vv;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(vv||(vv={}));var yv;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(yv||(yv={}));function KT(r,e){let{target:t,replace:n,state:i,preventScrollReset:s,relative:a,unstable_viewTransition:c}=e===void 0?{}:e,o=nb(),l=tp(),u=ib(r,{relative:a});return Ie.useCallback(h=>{if(UT(h,t)){h.preventDefault();let f=n!==void 0?n:Sh(l)===Sh(u);o(r,{replace:f,state:i,preventScrollReset:s,relative:a,unstable_viewTransition:c})}},[l,o,u,n,i,t,r,s,a,c])}var ob={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(Cd,function(){return function(t){function n(s){if(i[s])return i[s].exports;var a=i[s]={exports:{},id:s,loaded:!1};return t[s].call(a.exports,a,a.exports,n),a.loaded=!0,a.exports}var i={};return n.m=t,n.c=i,n.p="dist/",n(0)}([function(t,n,i){function s(T){return T&&T.__esModule?T:{default:T}}var a=Object.assign||function(T){for(var L=1;L<arguments.length;L++){var I=arguments[L];for(var N in I)Object.prototype.hasOwnProperty.call(I,N)&&(T[N]=I[N])}return T},c=i(1),o=(s(c),i(6)),l=s(o),u=i(7),h=s(u),f=i(8),g=s(f),p=i(9),d=s(p),m=i(10),E=s(m),S=i(11),R=s(S),k=i(14),C=s(k),x=[],P=!1,D={offset:120,delay:0,easing:"ease",duration:400,disable:!1,once:!1,startEvent:"DOMContentLoaded",throttleDelay:99,debounceDelay:50,disableMutationObserver:!1},b=function(){var T=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(T&&(P=!0),P)return x=(0,R.default)(x,D),(0,E.default)(x,D.once),x},w=function(){x=(0,C.default)(),b()},v=function(){x.forEach(function(T,L){T.node.removeAttribute("data-aos"),T.node.removeAttribute("data-aos-easing"),T.node.removeAttribute("data-aos-duration"),T.node.removeAttribute("data-aos-delay")})},_=function(T){return T===!0||T==="mobile"&&d.default.mobile()||T==="phone"&&d.default.phone()||T==="tablet"&&d.default.tablet()||typeof T=="function"&&T()===!0},y=function(T){D=a(D,T),x=(0,C.default)();var L=document.all&&!window.atob;return _(D.disable)||L?v():(D.disableMutationObserver||g.default.isSupported()||(console.info(`
      aos: MutationObserver is not supported on this browser,
      code mutations observing has been disabled.
      You may have to call "refreshHard()" by yourself.
    `),D.disableMutationObserver=!0),document.querySelector("body").setAttribute("data-aos-easing",D.easing),document.querySelector("body").setAttribute("data-aos-duration",D.duration),document.querySelector("body").setAttribute("data-aos-delay",D.delay),D.startEvent==="DOMContentLoaded"&&["complete","interactive"].indexOf(document.readyState)>-1?b(!0):D.startEvent==="load"?window.addEventListener(D.startEvent,function(){b(!0)}):document.addEventListener(D.startEvent,function(){b(!0)}),window.addEventListener("resize",(0,h.default)(b,D.debounceDelay,!0)),window.addEventListener("orientationchange",(0,h.default)(b,D.debounceDelay,!0)),window.addEventListener("scroll",(0,l.default)(function(){(0,E.default)(x,D.once)},D.throttleDelay)),D.disableMutationObserver||g.default.ready("[data-aos]",w),x)};t.exports={init:y,refresh:b,refreshHard:w}},function(t,n){},,,,,function(t,n){(function(i){function s(_,y,T){function L(ct){var ht=re,kt=pe;return re=pe=void 0,le=ct,ue=_.apply(kt,ht)}function I(ct){return le=ct,ee=setTimeout(U,y),ye?L(ct):ue}function N(ct){var ht=ct-Z,kt=ct-le,Sr=y-ht;return mt?w(Sr,fe-kt):Sr}function M(ct){var ht=ct-Z,kt=ct-le;return Z===void 0||ht>=y||ht<0||mt&&kt>=fe}function U(){var ct=v();return M(ct)?j(ct):void(ee=setTimeout(U,N(ct)))}function j(ct){return ee=void 0,Ye&&re?L(ct):(re=pe=void 0,ue)}function Q(){ee!==void 0&&clearTimeout(ee),le=0,re=Z=pe=ee=void 0}function Y(){return ee===void 0?ue:j(v())}function he(){var ct=v(),ht=M(ct);if(re=arguments,pe=this,Z=ct,ht){if(ee===void 0)return I(Z);if(mt)return ee=setTimeout(U,y),L(Z)}return ee===void 0&&(ee=setTimeout(U,y)),ue}var re,pe,fe,ue,ee,Z,le=0,ye=!1,mt=!1,Ye=!0;if(typeof _!="function")throw new TypeError(f);return y=u(y)||0,c(T)&&(ye=!!T.leading,mt="maxWait"in T,fe=mt?b(u(T.maxWait)||0,y):fe,Ye="trailing"in T?!!T.trailing:Ye),he.cancel=Q,he.flush=Y,he}function a(_,y,T){var L=!0,I=!0;if(typeof _!="function")throw new TypeError(f);return c(T)&&(L="leading"in T?!!T.leading:L,I="trailing"in T?!!T.trailing:I),s(_,y,{leading:L,maxWait:y,trailing:I})}function c(_){var y=typeof _>"u"?"undefined":h(_);return!!_&&(y=="object"||y=="function")}function o(_){return!!_&&(typeof _>"u"?"undefined":h(_))=="object"}function l(_){return(typeof _>"u"?"undefined":h(_))=="symbol"||o(_)&&D.call(_)==p}function u(_){if(typeof _=="number")return _;if(l(_))return g;if(c(_)){var y=typeof _.valueOf=="function"?_.valueOf():_;_=c(y)?y+"":y}if(typeof _!="string")return _===0?_:+_;_=_.replace(d,"");var T=E.test(_);return T||S.test(_)?R(_.slice(2),T?2:8):m.test(_)?g:+_}var h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},f="Expected a function",g=NaN,p="[object Symbol]",d=/^\s+|\s+$/g,m=/^[-+]0x[0-9a-f]+$/i,E=/^0b[01]+$/i,S=/^0o[0-7]+$/i,R=parseInt,k=(typeof i>"u"?"undefined":h(i))=="object"&&i&&i.Object===Object&&i,C=(typeof self>"u"?"undefined":h(self))=="object"&&self&&self.Object===Object&&self,x=k||C||Function("return this")(),P=Object.prototype,D=P.toString,b=Math.max,w=Math.min,v=function(){return x.Date.now()};t.exports=a}).call(n,function(){return this}())},function(t,n){(function(i){function s(v,_,y){function T(Ye){var ct=he,ht=re;return he=re=void 0,Z=Ye,fe=v.apply(ht,ct)}function L(Ye){return Z=Ye,ue=setTimeout(M,_),le?T(Ye):fe}function I(Ye){var ct=Ye-ee,ht=Ye-Z,kt=_-ct;return ye?b(kt,pe-ht):kt}function N(Ye){var ct=Ye-ee,ht=Ye-Z;return ee===void 0||ct>=_||ct<0||ye&&ht>=pe}function M(){var Ye=w();return N(Ye)?U(Ye):void(ue=setTimeout(M,I(Ye)))}function U(Ye){return ue=void 0,mt&&he?T(Ye):(he=re=void 0,fe)}function j(){ue!==void 0&&clearTimeout(ue),Z=0,he=ee=re=ue=void 0}function Q(){return ue===void 0?fe:U(w())}function Y(){var Ye=w(),ct=N(Ye);if(he=arguments,re=this,ee=Ye,ct){if(ue===void 0)return L(ee);if(ye)return ue=setTimeout(M,_),T(ee)}return ue===void 0&&(ue=setTimeout(M,_)),fe}var he,re,pe,fe,ue,ee,Z=0,le=!1,ye=!1,mt=!0;if(typeof v!="function")throw new TypeError(h);return _=l(_)||0,a(y)&&(le=!!y.leading,ye="maxWait"in y,pe=ye?D(l(y.maxWait)||0,_):pe,mt="trailing"in y?!!y.trailing:mt),Y.cancel=j,Y.flush=Q,Y}function a(v){var _=typeof v>"u"?"undefined":u(v);return!!v&&(_=="object"||_=="function")}function c(v){return!!v&&(typeof v>"u"?"undefined":u(v))=="object"}function o(v){return(typeof v>"u"?"undefined":u(v))=="symbol"||c(v)&&P.call(v)==g}function l(v){if(typeof v=="number")return v;if(o(v))return f;if(a(v)){var _=typeof v.valueOf=="function"?v.valueOf():v;v=a(_)?_+"":_}if(typeof v!="string")return v===0?v:+v;v=v.replace(p,"");var y=m.test(v);return y||E.test(v)?S(v.slice(2),y?2:8):d.test(v)?f:+v}var u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},h="Expected a function",f=NaN,g="[object Symbol]",p=/^\s+|\s+$/g,d=/^[-+]0x[0-9a-f]+$/i,m=/^0b[01]+$/i,E=/^0o[0-7]+$/i,S=parseInt,R=(typeof i>"u"?"undefined":u(i))=="object"&&i&&i.Object===Object&&i,k=(typeof self>"u"?"undefined":u(self))=="object"&&self&&self.Object===Object&&self,C=R||k||Function("return this")(),x=Object.prototype,P=x.toString,D=Math.max,b=Math.min,w=function(){return C.Date.now()};t.exports=s}).call(n,function(){return this}())},function(t,n){function i(u){var h=void 0,f=void 0;for(h=0;h<u.length;h+=1)if(f=u[h],f.dataset&&f.dataset.aos||f.children&&i(f.children))return!0;return!1}function s(){return window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver}function a(){return!!s()}function c(u,h){var f=window.document,g=s(),p=new g(o);l=h,p.observe(f.documentElement,{childList:!0,subtree:!0,removedNodes:!0})}function o(u){u&&u.forEach(function(h){var f=Array.prototype.slice.call(h.addedNodes),g=Array.prototype.slice.call(h.removedNodes),p=f.concat(g);if(i(p))return l()})}Object.defineProperty(n,"__esModule",{value:!0});var l=function(){};n.default={isSupported:a,ready:c}},function(t,n){function i(f,g){if(!(f instanceof g))throw new TypeError("Cannot call a class as a function")}function s(){return navigator.userAgent||navigator.vendor||window.opera||""}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function f(g,p){for(var d=0;d<p.length;d++){var m=p[d];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(g,m.key,m)}}return function(g,p,d){return p&&f(g.prototype,p),d&&f(g,d),g}}(),c=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,o=/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i,l=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i,u=/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i,h=function(){function f(){i(this,f)}return a(f,[{key:"phone",value:function(){var g=s();return!(!c.test(g)&&!o.test(g.substr(0,4)))}},{key:"mobile",value:function(){var g=s();return!(!l.test(g)&&!u.test(g.substr(0,4)))}},{key:"tablet",value:function(){return this.mobile()&&!this.phone()}}]),f}();n.default=new h},function(t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=function(a,c,o){var l=a.node.getAttribute("data-aos-once");c>a.position?a.node.classList.add("aos-animate"):typeof l<"u"&&(l==="false"||!o&&l!=="true")&&a.node.classList.remove("aos-animate")},s=function(a,c){var o=window.pageYOffset,l=window.innerHeight;a.forEach(function(u,h){i(u,l+o,c)})};n.default=s},function(t,n,i){function s(l){return l&&l.__esModule?l:{default:l}}Object.defineProperty(n,"__esModule",{value:!0});var a=i(12),c=s(a),o=function(l,u){return l.forEach(function(h,f){h.node.classList.add("aos-init"),h.position=(0,c.default)(h.node,u.offset)}),l};n.default=o},function(t,n,i){function s(l){return l&&l.__esModule?l:{default:l}}Object.defineProperty(n,"__esModule",{value:!0});var a=i(13),c=s(a),o=function(l,u){var h=0,f=0,g=window.innerHeight,p={offset:l.getAttribute("data-aos-offset"),anchor:l.getAttribute("data-aos-anchor"),anchorPlacement:l.getAttribute("data-aos-anchor-placement")};switch(p.offset&&!isNaN(p.offset)&&(f=parseInt(p.offset)),p.anchor&&document.querySelectorAll(p.anchor)&&(l=document.querySelectorAll(p.anchor)[0]),h=(0,c.default)(l).top,p.anchorPlacement){case"top-bottom":break;case"center-bottom":h+=l.offsetHeight/2;break;case"bottom-bottom":h+=l.offsetHeight;break;case"top-center":h+=g/2;break;case"bottom-center":h+=g/2+l.offsetHeight;break;case"center-center":h+=g/2+l.offsetHeight/2;break;case"top-top":h+=g;break;case"bottom-top":h+=l.offsetHeight+g;break;case"center-top":h+=l.offsetHeight/2+g}return p.anchorPlacement||p.offset||isNaN(u)||(f=u),h+f};n.default=o},function(t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=function(s){for(var a=0,c=0;s&&!isNaN(s.offsetLeft)&&!isNaN(s.offsetTop);)a+=s.offsetLeft-(s.tagName!="BODY"?s.scrollLeft:0),c+=s.offsetTop-(s.tagName!="BODY"?s.scrollTop:0),s=s.offsetParent;return{top:c,left:a}};n.default=i},function(t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=function(s){return s=s||document.querySelectorAll("[data-aos]"),Array.prototype.map.call(s,function(a){return{node:a}})};n.default=i}])})})(ob);var qT=ob.exports;const YT=Fh(qT);var cb={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},_v=gs.createContext&&gs.createContext(cb),QT=["attr","size","title"];function XT(r,e){if(r==null)return{};var t=JT(r,e),n,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);for(i=0;i<s.length;i++)n=s[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(t[n]=r[n])}return t}function JT(r,e){if(r==null)return{};var t={};for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)){if(e.indexOf(n)>=0)continue;t[n]=r[n]}return t}function Rh(){return Rh=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Rh.apply(this,arguments)}function bv(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Th(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?bv(Object(t),!0).forEach(function(n){ZT(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):bv(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function ZT(r,e,t){return e=ex(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function ex(r){var e=tx(r,"string");return typeof e=="symbol"?e:e+""}function tx(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function lb(r){return r&&r.map((e,t)=>gs.createElement(e.tag,Th({key:t},e.attr),lb(e.child)))}function ko(r){return e=>gs.createElement(rx,Rh({attr:Th({},r.attr)},e),lb(r.child))}function rx(r){var e=t=>{var{attr:n,size:i,title:s}=r,a=XT(r,QT),c=i||t.size||"1em",o;return t.className&&(o=t.className),r.className&&(o=(o?o+" ":"")+r.className),gs.createElement("svg",Rh({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,n,a,{className:o,style:Th(Th({color:r.color||t.color},t.style),r.style),height:c,width:c,xmlns:"http://www.w3.org/2000/svg"}),s&&gs.createElement("title",null,s),r.children)};return _v!==void 0?gs.createElement(_v.Consumer,null,t=>e(t)):e(cb)}function nx(r){return ko({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"},child:[]}]})(r)}function ix(r){return ko({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"},child:[]}]})(r)}function sx(r){return ko({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M447.1 112c-34.2.5-62.3 28.4-63 62.6-.5 24.3 12.5 45.6 32 56.8V344c0 57.3-50.2 104-112 104-60 0-109.2-44.1-111.9-99.2C265 333.8 320 269.2 320 192V36.6c0-11.4-8.1-21.3-19.3-23.5L237.8.5c-13-2.6-25.6 5.8-28.2 18.8L206.4 35c-2.6 13 5.8 25.6 18.8 28.2l30.7 6.1v121.4c0 52.9-42.2 96.7-95.1 97.2-53.4.5-96.9-42.7-96.9-96V69.4l30.7-6.1c13-2.6 21.4-15.2 18.8-28.2l-3.1-15.7C107.7 6.4 95.1-2 82.1.6L19.3 13C8.1 15.3 0 25.1 0 36.6V192c0 77.3 55.1 142 128.1 156.8C130.7 439.2 208.6 512 304 512c97 0 176-75.4 176-168V231.4c19.1-11.1 32-31.7 32-55.4 0-35.7-29.2-64.5-64.9-64zm.9 80c-8.8 0-16-7.2-16-16s7.2-16 16-16 16 7.2 16 16-7.2 16-16 16z"},child:[]}]})(r)}function ax(r){return ko({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(r)}function ox(r){return ko({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M461.2 128H80c-8.84 0-16-7.16-16-16s7.16-16 16-16h384c8.84 0 16-7.16 16-16 0-26.51-21.49-48-48-48H64C28.65 32 0 60.65 0 96v320c0 35.35 28.65 64 64 64h397.2c28.02 0 50.8-21.53 50.8-48V176c0-26.47-22.78-48-50.8-48zM416 336c-17.67 0-32-14.33-32-32s14.33-32 32-32 32 14.33 32 32-14.33 32-32 32z"},child:[]}]})(r)}function cx(r){return ko({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm101.8-262.2L295.6 256l62.2 62.2c4.7 4.7 4.7 12.3 0 17l-22.6 22.6c-4.7 4.7-12.3 4.7-17 0L256 295.6l-62.2 62.2c-4.7 4.7-12.3 4.7-17 0l-22.6-22.6c-4.7-4.7-4.7-12.3 0-17l62.2-62.2-62.2-62.2c-4.7-4.7-4.7-12.3 0-17l22.6-22.6c4.7-4.7 12.3-4.7 17 0l62.2 62.2 62.2-62.2c4.7-4.7 12.3-4.7 17 0l22.6 22.6c4.7 4.7 4.7 12.3 0 17z"},child:[]}]})(r)}const lx=()=>{Ie.useEffect(()=>{YT.init({duration:200})},[]);const r=[{id:1,name:"Agent",to:"/signup"},{id:2,name:"Patient",to:"/signup"},{id:3,name:"Doctor",to:"/signup"}];return ce.jsx("main",{className:"w-full md:p-10 p-4 h-screen flex items-center justify-center",children:ce.jsxs("div",{className:"md:w-1/2  w-full shadow-xl rounded- p-4 overflow-hidden",children:[ce.jsx("h1",{className:"my-4 text-2xl uppercase text-center font-semibold font-siz ",children:"Welcome to Remote Doctor"}),ce.jsx("p",{className:"my-2 text-green-600 text-xl underline underline-offset-2 uppercase text-left font-semibold ",children:"Login as:"}),ce.jsx("ul",{className:"flex flex-col gap-4 w-full",children:r.map(({name:e,to:t,id:n},i)=>ce.jsx(Eh,{"data-aos":"fade-left","data-aos-duration":`${n===1?"1000":n===2?"2000":"3000"}`,to:t,className:`p-4 text-center bg-green-500 rounded-md text-white  border-2 border-green-500 transition-[background] duration-300 overflow-hidden relative after:contents-[''] after:absolute after:w-full after:h-2 after:bg-green-600  shadows shadow-orange-300  after:-left-0 after:-bottom-0 after:-right-0 \r
              font-semibold font-md\r
              `,children:ce.jsxs("span",{className:"relative z-1",children:[" ",e]})},e))}),ce.jsx(Eh,{"data-aos":"flip-left","data-aos-duration":"3000",to:"/signup",className:"inline-block my-5 bg-transparent py-3 px-6 rounded-md border-2 border-green-500 hover:bg-green-50",children:ce.jsxs("span",{className:"flex items-center gap-3",children:["Signup",ce.jsx(nx,{size:16,className:"text-green-500"})]})})]})})},ux=()=>ce.jsx("div",{children:"Agent"});var Eg={exports:{}},nl=typeof Reflect=="object"?Reflect:null,Sv=nl&&typeof nl.apply=="function"?nl.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},$d;nl&&typeof nl.ownKeys=="function"?$d=nl.ownKeys:Object.getOwnPropertySymbols?$d=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:$d=function(e){return Object.getOwnPropertyNames(e)};function dx(r){console&&console.warn&&console.warn(r)}var ub=Number.isNaN||function(e){return e!==e};function Xr(){Xr.init.call(this)}Eg.exports=Xr;Eg.exports.once=mx;Xr.EventEmitter=Xr;Xr.prototype._events=void 0;Xr.prototype._eventsCount=0;Xr.prototype._maxListeners=void 0;var wv=10;function rp(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(Xr,"defaultMaxListeners",{enumerable:!0,get:function(){return wv},set:function(r){if(typeof r!="number"||r<0||ub(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");wv=r}});Xr.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Xr.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||ub(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function db(r){return r._maxListeners===void 0?Xr.defaultMaxListeners:r._maxListeners}Xr.prototype.getMaxListeners=function(){return db(this)};Xr.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var c=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw c.context=a,c}var o=s[e];if(o===void 0)return!1;if(typeof o=="function")Sv(o,this,t);else for(var l=o.length,u=gb(o,l),n=0;n<l;++n)Sv(u[n],this,t);return!0};function hb(r,e,t,n){var i,s,a;if(rp(t),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),s=r._events),a=s[e]),a===void 0)a=s[e]=t,++r._eventsCount;else if(typeof a=="function"?a=s[e]=n?[t,a]:[a,t]:n?a.unshift(t):a.push(t),i=db(r),i>0&&a.length>i&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=r,c.type=e,c.count=a.length,dx(c)}return r}Xr.prototype.addListener=function(e,t){return hb(this,e,t,!1)};Xr.prototype.on=Xr.prototype.addListener;Xr.prototype.prependListener=function(e,t){return hb(this,e,t,!0)};function hx(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function pb(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},i=hx.bind(n);return i.listener=t,n.wrapFn=i,i}Xr.prototype.once=function(e,t){return rp(t),this.on(e,pb(this,e,t)),this};Xr.prototype.prependOnceListener=function(e,t){return rp(t),this.prependListener(e,pb(this,e,t)),this};Xr.prototype.removeListener=function(e,t){var n,i,s,a,c;if(rp(t),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(s=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){c=n[a].listener,s=a;break}if(s<0)return this;s===0?n.shift():px(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,c||t)}return this};Xr.prototype.off=Xr.prototype.removeListener;Xr.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),a;for(i=0;i<s.length;++i)a=s[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function fb(r,e,t){var n=r._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?fx(i):gb(i,i.length)}Xr.prototype.listeners=function(e){return fb(this,e,!0)};Xr.prototype.rawListeners=function(e){return fb(this,e,!1)};Xr.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):mb.call(r,e)};Xr.prototype.listenerCount=mb;function mb(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}Xr.prototype.eventNames=function(){return this._eventsCount>0?$d(this._events):[]};function gb(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function px(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function fx(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function mx(r,e){return new Promise(function(t,n){function i(a){r.removeListener(e,s),n(a)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",i),t([].slice.call(arguments))}vb(r,e,s,{once:!0}),e!=="error"&&gx(r,i,{once:!0})})}function gx(r,e,t){typeof r.on=="function"&&vb(r,"error",e,t)}function vb(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function i(s){n.once&&r.removeEventListener(e,i),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var vx=Eg.exports;const yx=Fh(vx);var yb={exports:{}};(function(r,e){var t={};/*! For license information please see videosdk.js.LICENSE.txt */(function(n,i){r.exports=i()})(self,()=>(()=>{var n={5414:a=>{a.exports=(()=>{var c={43:function(h,f,g){var p,d;(function(m,E){p=function(){var S=function(){},R="undefined",k=typeof window!==R&&typeof window.navigator!==R&&/Trident\/|MSIE /.test(window.navigator.userAgent),C=["trace","debug","info","warn","error"];function x(I,N){var M=I[N];if(typeof M.bind=="function")return M.bind(I);try{return Function.prototype.bind.call(M,I)}catch{return function(){return Function.prototype.apply.apply(M,[I,arguments])}}}function P(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function D(I){return I==="debug"&&(I="log"),typeof console!==R&&(I==="trace"&&k?P:console[I]!==void 0?x(console,I):console.log!==void 0?x(console,"log"):S)}function b(I,N){for(var M=0;M<C.length;M++){var U=C[M];this[U]=M<I?S:this.methodFactory(U,I,N)}this.log=this.debug}function w(I,N,M){return function(){typeof console!==R&&(b.call(this,N,M),this[I].apply(this,arguments))}}function v(I,N,M){return D(I)||w.apply(this,arguments)}function _(I,N,M){var U,j=this,Q="loglevel";function Y(){var re;if(typeof window!==R&&Q){try{re=window.localStorage[Q]}catch{}if(typeof re===R)try{var pe=window.document.cookie,fe=pe.indexOf(encodeURIComponent(Q)+"=");fe!==-1&&(re=/^([^;]+)/.exec(pe.slice(fe))[1])}catch{}return j.levels[re]===void 0&&(re=void 0),re}}typeof I=="string"?Q+=":"+I:typeof I=="symbol"&&(Q=void 0),j.name=I,j.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},j.methodFactory=M||v,j.getLevel=function(){return U},j.setLevel=function(re,pe){if(typeof re=="string"&&j.levels[re.toUpperCase()]!==void 0&&(re=j.levels[re.toUpperCase()]),!(typeof re=="number"&&re>=0&&re<=j.levels.SILENT))throw"log.setLevel() called with invalid level: "+re;if(U=re,pe!==!1&&function(fe){var ue=(C[fe]||"silent").toUpperCase();if(typeof window!==R&&Q){try{return void(window.localStorage[Q]=ue)}catch{}try{window.document.cookie=encodeURIComponent(Q)+"="+ue+";"}catch{}}}(re),b.call(j,re,I),typeof console===R&&re<j.levels.SILENT)return"No console available for logging"},j.setDefaultLevel=function(re){Y()||j.setLevel(re,!1)},j.enableAll=function(re){j.setLevel(j.levels.TRACE,re)},j.disableAll=function(re){j.setLevel(j.levels.SILENT,re)};var he=Y();he==null&&(he=N??"WARN"),j.setLevel(he,!1)}var y=new _,T={};y.getLogger=function(I){if(typeof I!="symbol"&&typeof I!="string"||I==="")throw new TypeError("You must supply a name when creating a logger.");var N=T[I];return N||(N=T[I]=new _(I,y.getLevel(),y.methodFactory)),N};var L=typeof window!==R?window.log:void 0;return y.noConflict=function(){return typeof window!==R&&window.log===y&&(window.log=L),y},y.getLoggers=function(){return T},y.default=y,y},(d=p.call(f,g,f,h))===void 0||(h.exports=d)})()}},o={};function l(h){var f=o[h];if(f!==void 0)return f.exports;var g=o[h]={exports:{}};return c[h].call(g.exports,g,g.exports,l),g.exports}l.d=(h,f)=>{for(var g in f)l.o(f,g)&&!l.o(h,g)&&Object.defineProperty(h,g,{enumerable:!0,get:f[g]})},l.o=(h,f)=>Object.prototype.hasOwnProperty.call(h,f),l.r=h=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(h,"__esModule",{value:!0})};var u={};return(()=>{l.r(u),l.d(u,{VideoSDKMetrics:()=>Et});const h="inbound",f="outbound",g={codec_id_in:"",codec_in:{mime_type:null,clock_rate:null,sdp_fmtp_line:null},delta_jitter_ms_in:0,delta_rtt_ms_out:null,percent_packets_lost_in:0,delta_packets_in:0,delta_packets_lost_in:0,total_packets_in:0,total_packets_lost_in:0,total_KBytes_in:0,delta_KBytes_in:0,delta_kbs_in:0,timestamp_in:null,ssrc:"",total_concealment_events:0,delta_concealment_events:0,total_inserted_samples_for_decelaration:0,delta_inserted_samples_for_decelaration:0,total_removed_samples_for_accelaration:0,delta_removed_samples_for_accelaration:0,direction:h},p={codec_id_out:"",codec_out:{mime_type:null,clock_rate:null,sdp_fmtp_line:null},delta_jitter_ms_out:0,delta_rtt_ms_out:null,percent_packets_lost_out:0,delta_packets_out:0,delta_packets_lost_out:0,total_packets_out:0,total_packets_lost_out:0,total_KBytes_out:0,delta_KBytes_out:0,delta_kbs_out:0,timestamp_out:null,ssrc:"",direction:f},d={codec_id_in:"",size_in:{width:null,height:null,framerate:null},codec_in:{mime_type:null,clock_rate:null},delta_jitter_ms_in:0,percent_packets_lost_in:0,delta_packets_in:0,delta_packets_lost_in:0,total_packets_in:0,total_packets_lost_in:0,total_KBytes_in:0,delta_KBytes_in:0,delta_kbs_in:0,ssrc:"",direction:h},m={codec_id_out:"",size_out:{width:null,height:null,framerate:null},codec_out:{mime_type:null,clock_rate:null},delta_jitter_ms_out:0,delta_rtt_ms_out:null,percent_packets_lost_out:0,delta_packets_out:0,delta_packets_lost_out:0,total_packets_out:0,total_packets_lost_out:0,total_KBytes_out:0,delta_KBytes_out:0,delta_kbs_out:0,limitation_out:{reason:null,durations:null,resolutionChanges:0},timestamp_out:null,ssrc:"",direction:f},E="inbound-rtp",S="bytesReceived",R="bytesSent",k="currentRoundTripTime",C="roundTripTime",x="fractionLost",P="frameHeight",D="frameWidth",b="qualityLimitationReason",w="qualityLimitationDurations",v="qualityLimitationResolutionChanges",_="jitter",y="packetsLost",T="packetsReceived",L="packetsSent",I="responsesReceived",N="selected",M="totalRoundTripTime",U="roundTripTimeMeasurements",j="framesDecoded",Q="framesEncoded",Y="totalDecodeTime",he="totalEncodeTime",re="pliCount",pe="nackCount",fe="audio",ue="video",ee={0:"ETHERNET",2:"CELLULAR_5G",3:"WIFI",5:"CELLULAR_4G",10:"CELLULAR"},Z="audio",le="video",ye="network",mt="data";var Ye=l(43);const ct=()=>`${new Date().toISOString()} | metrics`,ht=(Ae,Ne,Ze)=>`${Ae} | ${Ne} | ${Ze}`;Ye.setDefaultLevel(Ye.levels.TRACE);const kt=(Ae,Ne,Ze)=>{Ze?Ye.debug(ht(ct(),Ae,Ne),Ze):Ye.debug(ht(ct(),Ae,Ne))},Sr=(Ae,Ne)=>{Ye.warn(ht(ct(),Ae,Ne))},wt=(Ae,Ne)=>{Ye.error(ht(ct(),Ae,Ne))},Zt="extractor   ",vr=(Ae,Ne,Ze)=>{if(!Ne)return null;const Oe={};let vt=Ne.audio[Ae];vt||(vt=Ze===h?{...g}:{...p}),Oe.audio=vt;let Mt=Ne.video[Ae];return Mt||(Mt=Ze===h?{...d}:{...m}),Oe.video=Mt,Oe},Wr=(Ae,Ne,Ze,Oe)=>{let vt=!1;const Mt=Oe[Ne].total_rtt_ms_out,ke=Oe[Ne].total_rtt_measure_out,lr=Ze?Ze[Ne].total_rtt_ms_out:0,yr=Ze?Ze[Ne].total_rtt_measure_out:0,wr={rtt:null,totalRTT:Mt,totalRTTMeasurements:ke};if(Ae.timestamp===Oe[Ne].timestamp_out||!Object.prototype.hasOwnProperty.call(Ae,C)||Object.prototype.hasOwnProperty.call(Ae,U)&&(vt=!0,Number(Ae.roundTripTimeMeasurements)===0||Number(Ae.roundTripTimeMeasurements)-yr===ke))return wr;const Ur=1e3*Number(Ae.roundTripTime);let yn=Mt+Ur,Ge=ke+1;return vt&&(yn=1e3*Number(Ae.totalRoundTripTime)-lr,Ge=Number(Ae.roundTripTimeMeasurements)-yr),{rtt:Ur,totalRTT:yn,totalRTTMeasurements:Ge}},br=(Ae,Ne,Ze)=>Ae.timestamp===Ze[Ne].timestamp_out?null:Object.prototype.hasOwnProperty.call(Ae,_)?1e3*(Number(Ae.jitter)||0):null,Br=(Ae,Ne,Ze,Oe)=>{if(!Object.prototype.hasOwnProperty.call(Ae,L)||!Object.prototype.hasOwnProperty.call(Ae,R))return{packetsSent:Ze[Ne].total_packets_out,packetsLost:Ze[Ne].total_packets_lost_out,bytesSent:Ze[Ne].total_KBytes_out};const vt=Number(Ae.packetsSent)||0-(Oe?Oe[Ne].total_packets_out:0),Mt=vt-Ze[Ne].total_packets_out,ke=Number(Ae.bytesSent)/1024-(Oe?Oe[Ne].total_KBytes_out:0),lr=ke-Ze[Ne].total_KBytes_out,yr=Ae.timestamp||Date.now(),wr=Oe?Oe.timestamp:null;let Ur=Ze.timestamp;!Ur&&wr&&(Ur=wr);const yn=Ur?yr-Ur:0;return{packetsSent:vt,deltaPacketsSent:Mt,KBytesSent:ke,deltaKBytesSent:lr,kbsSent:yn>0?.008*lr*1024/yn*1e3:0}},Jr=(Ae,Ne,Ze,Oe)=>{let vt=Ze[Ne].total_packets_lost_out,Mt=0,ke=0;return Object.prototype.hasOwnProperty.call(Ae,y)&&(vt=Number(Ae.packetsLost)||0-(Oe?Oe[Ne].total_packets_lost_out:0),Mt=vt-Ze[Ne].total_packets_lost_out),Object.prototype.hasOwnProperty.call(Ae,x)&&(ke=Number(100*Ae.fractionLost)),{packetsLost:vt,deltaPacketsLost:Mt,fractionLost:ke}},Qt=(Ae,Ne,Ze,Oe)=>{if(!Object.prototype.hasOwnProperty.call(Ae,T)||!Object.prototype.hasOwnProperty.call(Ae,y)||!Object.prototype.hasOwnProperty.call(Ae,S))return{percent_packets_lost:Ze[Ne].percent_packets_lost_in,packetsReceived:Ze[Ne].total_packets_in,packetsLost:Ze[Ne].total_packets_lost_in,bytesReceived:Ze[Ne].total_KBytes_in};const vt=(Number(Ae.packetsReceived)||0)-(Oe?Oe[Ne].total_packets_in:0),Mt=(Number(Ae.packetsLost)||0)-(Oe?Oe[Ne].total_packets_lost_in:0),ke=Mt-Ze[Ne].total_packets_lost_in,lr=vt-Ze[Ne].total_packets_in,yr=vt!==Ze[Ne].total_packets_in?100*ke/(ke+lr):0,wr=Number(Ae.bytesReceived)/1024-(Oe?Oe[Ne].total_KBytes_in:0),Ur=wr-Ze[Ne].total_KBytes_in,yn=Ae.timestamp||Date.now(),Ge=Oe?Oe.timestamp:null;let Ot=Ze.timestamp;!Ot&&Ge&&(Ot=Ge);const xt=Ot?yn-Ot:0;return{percentPacketsLost:yr,packetsReceived:vt,deltaPacketsReceived:lr,packetsLost:Mt,deltaPacketsLost:ke,KBytesReceived:wr,deltaKBytesReceived:Ur,kbsReceived:xt>0?.008*Ur*1024/xt*1e3:0}},zt=Ae=>Ae.candidateType!=="relay"?"":Ae.relayProtocol||"",At=Ae=>Object.prototype.hasOwnProperty.call(Ae,P)&&Object.prototype.hasOwnProperty.call(Ae,D)?{width:Ae.frameWidth||null,height:Ae.frameHeight||null,framerate:Ae.framesPerSecond}:{width:null,height:null,framerate:null};class Lr{constructor(Ne,Ze){this._callbacks={onStatsCollected:null},this._id=`collector-${Ze}`,this._moduleName=this._id,this._probeId=Ze,this._config=Ne,this._state="idle",this._statsReports=[]}registerCallback(Ne,Ze,Oe){Ne in this._callbacks?(this._callbacks[Ne]={callback:Ze,context:Oe},kt(this._moduleName,`registered callback '${Ne}'`)):wt(this._moduleName,`can't register callback for '${Ne}' - not found`)}unregisterCallback(Ne){Ne in this._callbacks?(this._callbacks[Ne]=null,delete this._callbacks[Ne],kt(this._moduleName,`unregistered callback '${Ne}'`)):wt(this._moduleName,`can't unregister callback for '${Ne}' - not found`)}analyze(Ne,Ze){const Oe=(Mt=>{const ke={name:"",meetingId:"",peerId:"",timestamp:null,count:0,audio:{},video:{},network:{infrastructure:3},data:{delta_kbs_bandwidth_in:0,delta_kbs_bandwidth_out:0,delta_rtt_connectivity_ms:null,total_rtt_connectivity_ms:0}};if(Mt){const lr={...Mt,audio:{},video:{},data:{...Mt.data},network:{...Mt.network}};return Object.keys(Mt.audio).forEach(yr=>{lr.audio[yr]={...Mt.audio[yr]}}),Object.keys(Mt.video).forEach(yr=>{lr.video[yr]={...Mt.video[yr]}}),lr}return{...ke,audio:{},video:{},data:{...ke.data},network:{...ke.network}}})(Ze);Oe.name=this._config.name,Oe.meetingId=this._config.meetingId,Oe.peerId=this._config.peerId,Oe.count=Ze?Ze.count+1:1;let vt=null;return Ne.forEach(Mt=>{!vt&&Mt.timestamp&&(vt=Mt.timestamp),((ke,lr,yr,wr)=>{if(!ke)return[];switch(ke.type){case"candidate-pair":let Ur=!1;if(ke.nominated&&ke.state==="succeeded"&&(Ur=!0,kt(Zt,`analyze() - got stats ${ke.type} for ${yr}`,ke),N in ke&&!ke.selected&&(Ur=!1)),Ur){ke.localCandidateId,ke.remoteCandidateId;const Ge=((xt,Ke,Zr)=>{const kr=(xt.bytesReceived||0)/1024-0,Or=(xt.bytesSent||0)/1024-0,sr=xt.timestamp||Date.now(),ar=kr-Ke.data.total_KBytes_in,Mr=Or-Ke.data.total_KBytes_out,tn=null;let _n=Ke.timestamp;!_n&&tn&&(_n=tn);const Jn=_n?sr-_n:0;return{total_KBytes_received:kr,total_KBytes_sent:Or,delta_KBytes_received:ar,delta_KBytes_sent:Mr,kbs_speed_received:Jn>0?.008*ar*1024/Jn*1e3:0,kbs_speed_sent:Jn>0?.008*Mr*1024/Jn*1e3:0}})(ke,lr),Ot=((xt=>{xt.availableIncomingBitrate,xt.availableOutgoingBitrate})(ke),((xt,Ke,Zr,kr)=>{if(!Object.prototype.hasOwnProperty.call(xt,k))return{rtt:null,totalRTT:kr.data.total_rtt_connectivity_ms,totalRTTMeasurements:kr.data.total_rtt_connectivity_measure};const Or=1e3*Number(xt.currentRoundTripTime);let sr=kr.data.total_rtt_connectivity_ms+Or,ar=kr.data.total_rtt_connectivity_measure+1;return Object.prototype.hasOwnProperty.call(xt,M)&&(sr=1e3*Number(xt.totalRoundTripTime)-0),Object.prototype.hasOwnProperty.call(xt,I)&&(ar=Number(xt.responsesReceived)-0),{rtt:Or,totalRTT:sr,totalRTTMeasurements:ar}})(ke,0,wr,lr));return[{type:mt,value:{total_KBytes_in:Ge.total_KBytes_received}},{type:mt,value:{total_KBytes_out:Ge.total_KBytes_sent}},{type:mt,value:{delta_KBytes_in:Ge.delta_KBytes_received}},{type:mt,value:{delta_KBytes_out:Ge.delta_KBytes_sent}},{type:mt,value:{delta_kbs_in:Ge.kbs_speed_received}},{type:mt,value:{delta_kbs_out:Ge.kbs_speed_sent}},{type:mt,value:{delta_rtt_connectivity_ms:Ot.rtt}}]}break;case"local-candidate":if(ke.id===lr.network.local_candidate_id)return[{type:ye,value:{infrastructure:ke.networkType}},{type:ye,value:{local_candidate_protocol:ke.protocol||""}},{type:ye,value:{local_candidate_relay_protocol:zt(ke)}}];break;case E:{kt(Zt,`analyze() - got stats ${ke.type} for ${yr}`,ke);const Ge=ke.ssrc,Ot=vr(Ge,lr,h);Ot&&(Ot.timestamp=lr.timestamp);const xt=vr(Ge,wr,h);if(xt&&(xt.timestamp=wr.timestamp),ke.mediaType===fe){const Ke=Qt(ke,fe,Ot,xt),Zr=br(ke,fe,Ot),kr=ke.codecId||"",Or=((sr,ar,Mr,tn)=>{const _n=Number(sr.concealmentEvents)||0,Jn=_n-(Mr.audio.total_concealment_events||0),ss=Number(sr.insertedSamplesForDeceleration)||0,li=ss-(Mr.audio.total_inserted_samples_for_decelaration||0),Zn=Number(sr.removedSamplesForAcceleration)||0;return{totalConcealmentEvents:_n,deltaConcealmentEvents:Jn,totalInsertedSamplesForDecelaration:ss,deltaInsertedSamplesForDecelaration:li,totalRemovedSamplesForAccelaration:Zn,deltaRemovedSampleForAccelaration:Zn-(Mr.audio.total_removed_samples_for_accelaration||0)}})(ke,0,Ot);return[{ssrc:Ge,type:Z,value:{codec_id_in:kr}},{ssrc:Ge,type:Z,value:{total_packets_in:Ke.packetsReceived}},{ssrc:Ge,type:Z,value:{delta_packets_in:Ke.deltaPacketsReceived}},{ssrc:Ge,type:Z,value:{total_packets_lost_in:Ke.packetsLost}},{ssrc:Ge,type:Z,value:{delta_packets_lost_in:Ke.deltaPacketsLost}},{ssrc:Ge,type:Z,value:{percent_packets_lost_in:Ke.percentPacketsLost}},{ssrc:Ge,type:Z,value:{total_KBytes_in:Ke.KBytesReceived}},{ssrc:Ge,type:Z,value:{delta_KBytes_in:Ke.deltaKBytesReceived}},{ssrc:Ge,type:Z,value:{delta_kbs_in:Ke.kbsReceived}},{ssrc:Ge,type:Z,value:{delta_jitter_ms_in:Zr}},{ssrc:Ge,type:Z,value:{total_concealment_events:Or.totalConcealmentEvents}},{ssrc:Ge,type:Z,value:{delta_concealment_events:Or.deltaConcealmentEvents}},{ssrc:Ge,type:Z,value:{total_inserted_samples_for_decelaration:Or.totalInsertedSamplesForDecelaration}},{ssrc:Ge,type:Z,value:{delta_inserted_samples_for_decelaration:Or.deltaInsertedSamplesForDecelaration}},{ssrc:Ge,type:Z,value:{total_removed_samples_for_accelaration:Or.totalRemovedSamplesForAccelaration}},{ssrc:Ge,type:Z,value:{delta_removed_samples_for_accelaration:Or.deltaRemovedSampleForAccelaration}},{ssrc:Ge,type:Z,value:{track_in:ke.trackId}},{ssrc:Ge,type:Z,value:{track_id_in:ke.trackIdentifier}},{ssrc:Ge,type:Z,value:{media_source_id:ke.mediaSourceId}}]}if(ke.mediaType===ue){((sr,ar)=>{if(!Object.prototype.hasOwnProperty.call(sr,j)||!Object.prototype.hasOwnProperty.call(sr,Y))return{delta_ms_decode_frame:ar.video.delta_ms_decode_frame_in,frames_decoded:ar.video.total_frames_decoded_in,total_decode_time:ar.video.total_time_decoded_in};sr.framesDecoded,sr.totalDecodeTime,ar.video.total_time_decoded_in,ar.video.total_frames_decoded_in})(ke,Ot);const Ke=Qt(ke,ue,Ot,xt),Zr=br(ke,ue,Ot),kr=(ke.decoderImplementation,ke.codecId||null),Or=At(ke);return((sr,ar,Mr)=>{if(!Object.prototype.hasOwnProperty.call(sr,re)||!Object.prototype.hasOwnProperty.call(sr,pe))return{pliCount:ar.total_pli_sent_in,nackCount:ar.total_nack_sent_in,deltaPliCount:0,deltaNackCount:0};sr.pliCount,Mr&&Mr.video.total_pli_sent_in,sr.nackCount,Mr&&Mr.video.total_nack_sent_in,ar.video.total_pli_sent_in,ar.video.total_nack_sent_in})(ke,Ot,xt),[{ssrc:Ge,type:le,value:{codec_id_in:kr}},{ssrc:Ge,type:le,value:{total_packets_in:Ke.packetsReceived}},{ssrc:Ge,type:le,value:{delta_packets_in:Ke.deltaPacketsReceived}},{ssrc:Ge,type:le,value:{total_packets_lost_in:Ke.packetsLost}},{ssrc:Ge,type:le,value:{delta_packets_lost_in:Ke.deltaPacketsLost}},{ssrc:Ge,type:le,value:{percent_packets_lost_in:Ke.percentPacketsLost}},{ssrc:Ge,type:le,value:{total_KBytes_in:Ke.KBytesReceived}},{ssrc:Ge,type:le,value:{delta_KBytes_in:Ke.deltaKBytesReceived}},{ssrc:Ge,type:le,value:{delta_kbs_in:Ke.kbsReceived}},{ssrc:Ge,type:le,value:{delta_jitter_ms_in:Zr}},{ssrc:Ge,type:le,value:{size_in:Or}},{ssrc:Ge,type:le,value:{track_in:ke.trackId}},{ssrc:Ge,type:le,value:{track_id_in:ke.trackIdentifier}},{ssrc:Ge,type:le,value:{media_source_id:ke.mediaSourceId}}]}break}case"outbound-rtp":{kt(Zt,`analyze() - got stats ${ke.type} for ${yr}`,ke);const Ge=ke.ssrc,Ot=vr(Ge,lr,f);Ot&&(Ot.timestamp=lr.timestamp);const xt=vr(Ge,wr,f);if(xt&&(xt.timestamp=wr.timestamp),ke.mediaType===fe){const Ke=ke.codecId||null,Zr=Br(ke,fe,Ot,xt);return[{ssrc:Ge,type:Z,value:{codec_id_out:Ke}},{ssrc:Ge,type:Z,value:{total_packets_out:Zr.packetsSent}},{ssrc:Ge,type:Z,value:{delta_packets_out:Zr.deltaPacketsSent}},{ssrc:Ge,type:Z,value:{total_KBytes_out:Zr.KBytesSent}},{ssrc:Ge,type:Z,value:{delta_KBytes_out:Zr.deltaKBytesSent}},{ssrc:Ge,type:Z,value:{delta_kbs_out:Zr.kbsSent}},{ssrc:Ge,type:Z,value:{track_out:ke.trackId}},{ssrc:Ge,type:Z,value:{track_id_out:ke.trackIdentifier}},{ssrc:Ge,type:Z,value:{media_source_id:ke.mediaSourceId}}]}if(ke.mediaType===ue){ke.encoderImplementation;const Ke=ke.codecId||null,Zr=(((sr,ar)=>{if(!Object.prototype.hasOwnProperty.call(sr,Q)||!Object.prototype.hasOwnProperty.call(sr,he))return{delta_ms_encode_frame:ar.video.delta_ms_encode_frame_out,frames_encoded:ar.video.total_frames_encoded_out,total_encode_time:ar.video.total_time_encoded_out};sr.framesEncoded,sr.totalEncodeTime,ar.video.total_time_encoded_out,ar.video.total_frames_encoded_out})(ke,Ot),At(ke)),kr=(sr=>{const ar=Object.prototype.hasOwnProperty.call(sr,b)?sr.qualityLimitationReason:null,Mr=Object.prototype.hasOwnProperty.call(sr,v)?sr.qualityLimitationResolutionChanges:null,tn=Object.prototype.hasOwnProperty.call(sr,w)?sr.qualityLimitationDurations:null;return tn&&Object.keys(tn).forEach(_n=>{tn[_n]>1e3&&(tn[_n]=Number(tn[_n]/1e3))}),{reason:ar,durations:tn,resolutionChanges:Mr}})(ke),Or=(((sr,ar,Mr)=>{if(!Object.prototype.hasOwnProperty.call(sr,re)||!Object.prototype.hasOwnProperty.call(sr,pe))return{pliCount:ar.total_pli_received_out,nackCount:ar.total_nack_received_out,deltaPliCount:0,deltaNackCount:0};sr.pliCount,Mr&&Mr.video.total_pli_received_out,sr.nackCount,Mr&&Mr.video.total_nack_received_out,ar.video.total_pli_received_out,ar.video.total_nack_received_out})(ke,Ot,xt),Br(ke,ue,Ot,xt));return[{ssrc:Ge,type:le,value:{codec_id_out:Ke}},{ssrc:Ge,type:le,value:{total_packets_out:Or.packetsSent}},{ssrc:Ge,type:le,value:{delta_packets_out:Or.deltaPacketsSent}},{ssrc:Ge,type:le,value:{total_KBytes_out:Or.KBytesSent}},{ssrc:Ge,type:le,value:{delta_KBytes_out:Or.deltaKBytesSent}},{ssrc:Ge,type:le,value:{delta_kbs_out:Or.kbsSent}},{ssrc:Ge,type:le,value:{size_out:Zr}},{ssrc:Ge,type:le,value:{limitation_out:kr}},{ssrc:Ge,type:le,value:{track_out:ke.trackId}},{ssrc:Ge,type:le,value:{track_id_out:ke.trackIdentifier}},{ssrc:Ge,type:le,value:{media_source_id:ke.mediaSourceId}}]}break}case"media-source":{kt(Zt,`analyze() - got stats ${ke.type} for ${yr}`,ke);const Ge=[];return Object.keys(lr.audio).forEach(Ot=>{const xt=lr.audio[Ot];if(xt.media_source_id===ke.id){kt(Zt,`analyze() - got stats ${ke.type} for ${yr}`,ke);var Ke=ke.trackIdentifier;Ge.push({ssrc:xt.ssrc,type:Z,value:{track_id_out:Ke}})}}),Object.keys(lr.video).forEach(Ot=>{const xt=lr.video[Ot];if(xt.media_source_id===ke.id){kt(Zt,`analyze() - got stats ${ke.type} for ${yr}`,ke);var Ke=ke.trackIdentifier;Ge.push({ssrc:xt.ssrc,type:le,value:{track_id_out:Ke}})}}),Ge}case"track":{kt(Zt,`analyze() - got stats ${ke.type} for ${yr}`,ke);const Ge=[];return Object.keys(lr.audio).forEach(Ot=>{const xt=lr.audio[Ot];if(xt.track_in===ke.id||xt.track_out===ke.id){kt(Zt,`analyze() - got stats ${ke.type} for ${yr}`,ke);var Ke=ke.trackIdentifier;ke.id===xt.track_in?Ge.push({ssrc:xt.ssrc,type:Z,value:{track_id_in:Ke}}):Ge.push({ssrc:xt.ssrc,type:Z,value:{track_id_out:Ke}})}}),Object.keys(lr.video).forEach(Ot=>{const xt=lr.video[Ot];if(xt.track_in===ke.id||xt.track_out===ke.id){kt(Zt,`analyze() - got stats ${ke.type} for ${yr}`,ke);var Ke=ke.trackIdentifier;ke.id===xt.track_in?Ge.push({ssrc:xt.ssrc,type:le,value:{track_id_in:Ke}}):Ge.push({ssrc:xt.ssrc,type:le,value:{track_id_out:Ke}})}}),Ge}case"codec":const yn=[];return Object.keys(lr.audio).forEach(Ge=>{const Ot=lr.audio[Ge];if(Ot.codec_id_in===ke.id||Ot.codec_id_out===ke.id){kt(Zt,`analyze() - got stats ${ke.type} for ${yr}`,ke);const xt=(Ke=>({channels:Ke.channels||null,clock_rate:Ke.clockRate||null,mime_type:Ke.mimeType||null,sdp_fmtp_line:Ke.sdpFmtpLine||null}))(ke);ke.id===Ot.codec_id_in?yn.push({ssrc:Ot.ssrc,type:Z,value:{codec_in:xt}}):yn.push({ssrc:Ot.ssrc,type:Z,value:{codec_out:xt}})}}),Object.keys(lr.video).forEach(Ge=>{const Ot=lr.video[Ge];if(Ot.codec_id_in===ke.id||Ot.codec_id_out===ke.id){kt(Zt,`analyze() - got stats ${ke.type} for ${yr}`,ke);const xt=(Ke=>({clock_rate:Ke.clockRate||null,mime_type:Ke.mimeType||null}))(ke);ke.id===Ot.codec_id_in?yn.push({ssrc:Ot.ssrc,type:le,value:{codec_in:xt}}):yn.push({ssrc:Ot.ssrc,type:le,value:{codec_out:xt}})}}),yn;case"remote-inbound-rtp":{kt(Zt,`analyze() - got stats ${ke.type} for ${yr}`,ke);const Ge=ke.ssrc,Ot=vr(Ge,lr,f),xt=vr(Ge,wr,f);if(ke.kind===fe){const Ke=Wr(ke,fe,xt,Ot),Zr=br(ke,fe,Ot),kr=Jr(ke,fe,Ot,xt);return[{ssrc:Ge,type:Z,value:{delta_rtt_ms_out:Ke.rtt}},{ssrc:Ge,type:Z,value:{delta_jitter_ms_out:Zr}},{ssrc:Ge,type:Z,value:{timestamp_out:ke.timestamp}},{ssrc:Ge,type:Z,value:{total_packets_lost_out:kr.packetsLost}},{ssrc:Ge,type:Z,value:{delta_packets_lost_out:kr.deltaPacketsLost}},{ssrc:Ge,type:Z,value:{percent_packets_lost_out:kr.fractionLost}}]}if(ke.kind===ue){const Ke=Wr(ke,ue,xt,Ot),Zr=br(ke,ue,Ot),kr=Jr(ke,ue,Ot,xt);return[{ssrc:Ge,type:le,value:{delta_rtt_ms_out:Ke.rtt}},{ssrc:Ge,type:le,value:{delta_jitter_ms_out:Zr}},{ssrc:Ge,type:le,value:{timestamp_out:ke.timestamp}},{ssrc:Ge,type:le,value:{total_packets_lost_out:kr.packetsLost}},{ssrc:Ge,type:le,value:{delta_packets_lost_out:kr.deltaPacketsLost}}]}break}case"remote-outbound-rtp":{kt(Zt,`analyze() - got stats ${ke.type} for ${yr}`,ke);const Ge=ke.ssrc,Ot=vr(Ge,lr,f),xt=vr(Ge,wr,f);if(ke.kind===fe){const Ke=Wr(ke,fe,xt,Ot);return[{ssrc:Ge,type:Z,value:{delta_rtt_ms_in:Ke.rtt}},{ssrc:Ge,type:Z,value:{timestamp_in:ke.timestamp}}]}break}}return[]})(Mt,Oe,Oe.name,null).forEach(ke=>{if(ke.value&&ke.type)if(ke.ssrc){let wr=Oe[ke.type][ke.ssrc];wr||(lr=ke.type,yr=Mt.type,wr=lr===fe?yr===E?{...g}:{...p}:yr===E?{...d}:{...m},wr.ssrc=ke.ssrc,Oe[ke.type][ke.ssrc]=wr),Object.keys(ke.value).forEach(Ur=>{ke.value[Ur]!==void 0&&(wr[Ur]=ke.value[Ur])})}else Object.keys(ke.value).forEach(wr=>{ke.value[wr]!==void 0&&(Oe[ke.type][wr]=ke.value[wr])});var lr,yr})}),Oe.timestamp=vt,Oe}async collectStats(){try{const Ne=await this._config.monitoringObject.getStats(),Ze=this.analyze(Ne,this._statsReports.slice().pop()||null);return this._statsReports.push(Ze),this.fireOnStatsCollected(Ze),Ne}catch(Ne){return wt(this._moduleName,`got error ${Ne}`),null}}fireOnStatsCollected(Ne){if(this._callbacks.onStatsCollected){const Ze={};Ze.meetingId=Ne.meetingId,Ze.peerId=Ne.peerId,Ze.name=Ne.name,Ze.audio=[],Ze.video=[],Object.values(Ne.audio).forEach(Oe=>{const vt={};vt.network=ee[Ne.network.infrastructure],vt.timestamp=Ne.timestamp,Oe.direction==h?(vt.codec=Oe.codec_in.mime_type,vt.jitter=Oe.delta_jitter_ms_in,vt.bitrate=Oe.delta_kbs_in,vt.packetsLost=Oe.delta_packets_lost_in,vt.rtt=Ne.data.delta_rtt_connectivity_ms||0,vt.totalPackets=Oe.delta_packets_in,vt.concealmentEvents=Oe.delta_concealment_events,vt.removedSampleForAccelaration=Oe.delta_removed_samples_for_accelaration,vt.insertedSamplesForDecelaration=Oe.delta_inserted_samples_for_decelaration,vt.trackId=Oe.track_id_in):Oe.direction==f&&(vt.codec=Oe.codec_out.mime_type,vt.jitter=Oe.delta_jitter_ms_out,vt.bitrate=Oe.delta_kbs_out,vt.packetsLost=Oe.delta_packets_lost_out,vt.rtt=Ne.data.delta_rtt_connectivity_ms||0,vt.totalPackets=Oe.delta_packets_out,vt.trackId=Oe.track_id_out),Ze.audio.push(vt)}),Object.values(Ne.video).forEach(Oe=>{const vt={};vt.network=ee[Ne.network.infrastructure],vt.timestamp=Ne.timestamp,Oe.direction==h?(vt.codec=Oe.codec_in.mime_type,vt.jitter=Oe.delta_jitter_ms_in,vt.bitrate=Oe.delta_kbs_in,vt.packetsLost=Oe.delta_packets_lost_in,vt.rtt=Ne.data.delta_rtt_connectivity_ms||0,vt.totalPackets=Oe.delta_packets_in,vt.size=Oe.size_in,vt.trackId=Oe.track_id_in):Oe.direction==f&&(vt.codec=Oe.codec_out.mime_type,vt.jitter=Oe.delta_jitter_ms_out,vt.bitrate=Oe.delta_kbs_out,vt.packetsLost=Oe.delta_packets_lost_out,vt.rtt=Ne.data.delta_rtt_connectivity_ms||0,vt.totalPackets=Oe.delta_packets_out,vt.limitation=Oe.limitation_out,vt.size=Oe.size_out,vt.trackId=Oe.track_id_out),Ze.video.push(vt)}),this._callbacks.onStatsCollected.callback(Ze)}}}class yt{constructor(Ne){this._id=Ne.name&&Ne.name.substr(0,12).padEnd(12," "),this._moduleName=this._id,this._config=Ne,this._collector=new Lr(this._config,this._id)}get id(){return this._id}start(){this._collectorIntervalId?Sr("Probe already started."):(kt(this._moduleName,"Probe Started"),this._collectorIntervalId=setInterval(()=>{kt(this._moduleName,"Collector collecting stats"),this._collector.collectStats()},this._config.refreshEvery))}stop(){this._collectorIntervalId?(clearInterval(this._collectorIntervalId),kt(this._moduleName,"Probe Stopped")):Sr("Probe not running, Please start first.")}set onStatsCollected(Ne){Ne?this._collector.registerCallback("onStatsCollected",Ne):this._collector.unregisterCallback("onStatsCollected")}}const Qe={refreshEvery:2e3,startAfter:0,stopAfter:-1,verbose:!1,peerId:"peerId",meetingId:"meetingId",name:"name"};class Et{constructor(Ne){var Ze;this._config={defaultConfig:Qe,...Ne},this._probes=[],Ze=this._config.verbose||!1,Ye.setLevel(Ze?Ye.levels.TRACE:Ye.levels.INFO),kt("VideoSDKMetrics","VideoSDKMetrics initialized")}get probes(){return this._probes}addNewProbe(Ne,Ze){if(!Ne)throw new Error("undefined monitoring object");const Oe={monitoringObject:Ne,...Ze,...this._config},vt=new yt(Oe);return this._probes.push(vt),vt}removeExistingProbe(Ne){if(!Ne)throw new Error("undefined probe");Ne.stop(),this._probes=this._probes.filter(Ze=>Ne.id!==Ze.id)}startAllProbes(){this._probes.forEach((Ne,Ze)=>{Ne.start()})}stopAllProbes(){this._probes.forEach(Ne=>Ne.stop())}}})(),u})()},8274:(a,c,o)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.Logger=void 0;const l=o(7833),u="awaitqueue";c.Logger=class{constructor(h){h?(this._debug=(0,l.default)(`${u}:${h}`),this._warn=(0,l.default)(`${u}:WARN:${h}`),this._error=(0,l.default)(`${u}:ERROR:${h}`)):(this._debug=(0,l.default)(u),this._warn=(0,l.default)(`${u}:WARN`),this._error=(0,l.default)(`${u}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},8876:(a,c,o)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.AwaitQueue=c.AwaitQueueRemovedTaskError=c.AwaitQueueStoppedError=void 0;const l=new(o(8274)).Logger;class u extends Error{constructor(g){super(g??"AwaitQueue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,u)}}c.AwaitQueueStoppedError=u;class h extends Error{constructor(g){super(g??"AwaitQueue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,h)}}c.AwaitQueueRemovedTaskError=h,c.AwaitQueue=class{constructor(){this.pendingTasks=new Map,this.nextTaskId=0,this.stopping=!1}get size(){return this.pendingTasks.size}async push(f,g){if(g=g??f.name,l.debug(`push() [name:${g}]`),typeof f!="function")throw new TypeError("given task is not a function");if(g)try{Object.defineProperty(f,"name",{value:g})}catch{}return new Promise((p,d)=>{const m={id:this.nextTaskId++,task:f,name:g,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:E=>{if(m.completed)return;m.completed=!0,this.pendingTasks.delete(m.id),l.debug(`resolving task [name:${m.name}]`),p(E);const[S]=this.pendingTasks.values();S&&!S.executedAt&&this.execute(S)},reject:E=>{if(!m.completed&&(m.completed=!0,this.pendingTasks.delete(m.id),l.debug(`rejecting task [name:${m.name}]: %s`,String(E)),d(E),!this.stopping)){const[S]=this.pendingTasks.values();S&&!S.executedAt&&this.execute(S)}}};this.pendingTasks.set(m.id,m),this.pendingTasks.size===1&&this.execute(m)})}stop(){l.debug("stop()"),this.stopping=!0;for(const f of this.pendingTasks.values())l.debug(`stop() | stopping task [name:${f.name}]`),f.reject(new u);this.stopping=!1}remove(f){l.debug(`remove() [taskIdx:${f}]`);const g=Array.from(this.pendingTasks.values())[f];g?g.reject(new h):l.debug(`stop() | no task with given idx [taskIdx:${f}]`)}dump(){const f=Date.now();let g=0;return Array.from(this.pendingTasks.values()).map(p=>({idx:g++,task:p.task,name:p.name,enqueuedTime:p.executedAt?p.executedAt-p.enqueuedAt:f-p.enqueuedAt,executionTime:p.executedAt?f-p.executedAt:0}))}async execute(f){if(l.debug(`execute() [name:${f.name}]`),f.executedAt)throw new Error("task already being executed");f.executedAt=Date.now();try{const g=await f.task();f.resolve(g)}catch(g){f.reject(g)}}}},9027:(a,c,o)=>{o.d(c,{$:()=>l});var l={networkPriorities:{audio:"high",dominatingVideo:"high",otherVideos:"medium",screenShare:"medium"},aspectRatios:{fourThree:{label:"fourThree",value:1.333},oneSixNine:{label:"oneSixNine",value:1.777}},audioProfiles:{speech_low_quality:{sampleRate:16e3,bitRate:24,sampleSize:16,stereo:!1,dtx:!0,fec:!0,maxPlaybackRate:16e3,packetTime:20,autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,channelCount:1},speech_standard:{sampleRate:32e3,bitRate:24,sampleSize:24,stereo:!1,dtx:!0,fec:!0,maxPlaybackRate:32e3,packetTime:30,autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,channelCount:1},music_standard:{sampleRate:48e3,bitRate:40,sampleSize:32,stereo:!1,dtx:!1,fec:!0,maxPlaybackRate:48e3,packetTime:40,autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1,channelCount:1},standard_stereo:{sampleRate:48e3,sampleSize:32,bitRate:64,stereo:!0,dtx:!1,fec:!0,maxPlaybackRate:48e3,packetTime:40,autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1,channelCount:2},high_quality:{sampleRate:48e3,sampleSize:32,bitRate:128,stereo:!1,dtx:!1,fec:!0,maxPlaybackRate:48e3,packetTime:60,autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1,channelCount:1},high_quality_stereo:{sampleRate:48e3,sampleSize:32,bitRate:192,stereo:!0,dtx:!1,fec:!0,maxPlaybackRate:48e3,packetTime:60,autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1,channelCount:2}},videoProfiles:{h90p_w160p:{width:160,height:90,bitRate:6e4,frameRate:15,aspectRatio:"oneSixNine"},h180p_w320p:{width:320,height:180,bitRate:12e4,frameRate:15,aspectRatio:"oneSixNine"},h216p_w384p:{width:384,height:216,bitRate:18e4,frameRate:15,aspectRatio:"oneSixNine"},h360p_w640p:{width:640,height:360,bitRate:3e5,frameRate:20,aspectRatio:"oneSixNine"},h540p_w960p:{width:960,height:540,bitRate:6e5,frameRate:25,aspectRatio:"oneSixNine"},h720p_w1280p:{width:1280,height:720,bitRate:2e6,frameRate:30,aspectRatio:"oneSixNine"},h1080p_w1920p:{width:1920,height:1080,bitRate:3e6,frameRate:30,aspectRatio:"oneSixNine"},h1440p_w2560p:{width:2560,height:1440,bitRate:5e6,frameRate:30,aspectRatio:"oneSixNine"},h2160p_w3840p:{width:3840,height:2160,bitRate:8e6,frameRate:30,aspectRatio:"oneSixNine"},h120p_w160p:{width:160,height:120,bitRate:8e4,frameRate:15,aspectRatio:"fourThree"},h180p_w240p:{width:240,height:180,bitRate:1e5,frameRate:15,aspectRatio:"fourThree"},h240p_w320p:{width:320,height:240,bitRate:15e4,frameRate:15,aspectRatio:"fourThree"},h360p_w480p:{width:480,height:360,bitRate:225e3,frameRate:20,aspectRatio:"fourThree"},h480p_w640p:{width:640,height:480,bitRate:3e5,frameRate:25,aspectRatio:"fourThree"},h540p_w720p:{width:720,height:540,bitRate:45e4,frameRate:30,aspectRatio:"fourThree"},h720p_w960p:{width:960,height:720,bitRate:15e5,frameRate:30,aspectRatio:"fourThree"},h1080p_w1440p:{width:1440,height:1080,bitRate:25e5,frameRate:30,aspectRatio:"fourThree"},h1440p_w1920p:{width:1920,height:1440,bitRate:35e5,frameRate:30,aspectRatio:"fourThree"}},screenShareProfiles:{h360p_30fps:{width:640,height:360,bitRate:2e5,frameRate:3},h720p_5fps:{width:1280,height:720,bitRate:4e5,frameRate:5},h720p_15fps:{width:1280,height:720,bitRate:1e6,frameRate:15},h1080p_15fps:{width:1920,height:1080,bitRate:15e5,frameRate:15},h1080p_30fps:{width:1920,height:1080,bitRate:1e6,frameRate:15}},simulcastProfiles:{3840:[{scaleResolutionDownBy:12,maxBitRate:15e4},{scaleResolutionDownBy:6,maxBitRate:5e5},{scaleResolutionDownBy:1,maxBitRate:1e7}],1920:[{scaleResolutionDownBy:6,maxBitRate:15e4},{scaleResolutionDownBy:3,maxBitRate:5e5},{scaleResolutionDownBy:1,maxBitRate:35e5}],1280:[{scaleResolutionDownBy:4,maxBitRate:15e4},{scaleResolutionDownBy:2,maxBitRate:5e5},{scaleResolutionDownBy:1,maxBitRate:12e5}],640:[{scaleResolutionDownBy:2,maxBitRate:15e4},{scaleResolutionDownBy:1,maxBitRate:5e5}],320:[{scaleResolutionDownBy:1,maxBitRate:15e4}]},requestTimeout:2e4,requestRetries:3,transportOptions:{tcp:!0},videoKSVCEncodings:[{scalabilityMode:"S3T3_KEY"}],videoSVCEncodings:[{scalabilityMode:"S3T3",dtx:!0}]}},7080:(a,c,o)=>{o.d(c,{q:()=>u,s:()=>l});var l={INVALID_API_KEY:4001,INVALID_TOKEN:4002,INVALID_MEETING_ID:4003,INVALID_PARTICIPANT_ID:4004,DUPLICATE_PARTICIPANT:4005,ACCOUNT_DEACTIVATED:4006,ACCOUNT_DISCONTINUED:4007,INVALID_PERMISSIONS:4008,MAX_PARTCIPANT_REACHED:4009,MAX_SPEAKER_REACHED:4010,START_RECORDING_FAILED:4011,STOP_RECORDING_FAILED:4012,START_LIVESTREAM_FAILED:4013,STOP_LIVESTREAM_FAILED:4014,INVALID_LIVESTREAM_CONFIG:4015,START_HLS_FAILED:4016,STOP_HLS_FAILED:4017,START_TRANSCRIPTION_FAILED:4031,STOP_TRANSCRIPTION_FAILED:4032,RECORDING_FAILED:5001,LIVESTREAM_FAILED:5002,HLS_FAILED:5003,TRANSCRIPTION_FAILED:5007,ERROR_GET_VIDEO_MEDIA:3011,ERROR_GET_AUDIO_MEDIA:3012,ERROR_GET_DISPLAY_MEDIA:3013,ERROR_GET_VIDEO_MEDIA_PERMISSION_DENIED:3014,ERROR_GET_AUDIO_MEDIA_PERMISSION_DENIED:3015,ERROR_GET_DISPLAY_MEDIA_PERMISSION_DENIED:3016,ERROR_CAMERA_ACCESS_DENIED_OR_DISMISSED:3017,ERROR_MICROPHONE_ACCESS_DENIED_OR_DISMISSED:3018,ERROR_CAMERA_PERMISSION_DENIED_BY_OS:3019,ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS:3020,ERROR_CAMERA_NOT_FOUND:3021,ERROR_MICROPHONE_NOT_FOUND:3022,ERROR_CAMERA_IN_USE:3023,ERROR_MICROPHONE_IN_USE:3024,ERROR_CAMERA_PERMISSION_OR_AUTOPLAY_ISSUE:3025,ERROR_VIDEO_SOURCE_INITIATION_FAILED:3026,ERROR_WEBCAM_TRACK_ENDED:3027,ERROR_MICROPHONE_TRACK_ENDED:3028,ERROR_INVALID_CUSTOM_VIDEO_TRACK:3029,ERROR_INVALID_CUSTOM_AUDIO_TRACK:3030,ERROR_CUSTOM_VIDEO_TRACK_ENDED:3031,ERROR_CUSTOM_AUDIO_TRACK_ENDED:3032,ERROR_CAMERA_ACCESS_UNAVAILABLE:3033,ERROR_MICROPHONE_ACCESS_UNAVAILABLE:3034,ERROR_ACTION_PERFORMED_BEFORE_MEETING_JOINED:3035,ERROR_RN_CAMERA_ACCESS_DENIED_OR_DISMISSED:3036,ERROR_RN_CAMERA_NOT_FOUND:3037,ERROR_RN_MIC_ACCESS_DENIED_OR_DISMISSED:3038,ERROR_RN_MIC_NOT_FOUND:3039,ERROR_RN_CAMERA_ACCESS_UNAVAILABLE:3040,ERROR_RN_MIC_ACCESS_UNAVAILABLE:3041,ERROR_RN_CAMERA_TRACK_ENDED:3042,ERROR_RN_MIC_TRACK_ENDED:3043},u={ERROR_GET_VIDEO_MEDIA:{code:3011,message:"Your browser/Device does not support Video."},ERROR_GET_AUDIO_MEDIA:{code:3012,message:"Your browser/Device does not support Audio."},ERROR_GET_DISPLAY_MEDIA:{code:3013,message:"Your browser/Device does not support Screen Sharing."},ERROR_GET_VIDEO_MEDIA_PERMISSION_DENIED:{code:3014,message:"Video capture permission denied."},ERROR_GET_AUDIO_MEDIA_PERMISSION_DENIED:{code:3015,message:"Audio capture permission denied."},ERROR_GET_DISPLAY_MEDIA_PERMISSION_DENIED:{code:3016,message:"Screen sharing permission denied."},ERROR_CAMERA_ACCESS_DENIED_OR_DISMISSED:{code:3017,message:"Oops! It seems like camera access was denied or dismissed. To proceed, kindly grant access through your browser settings."},ERROR_MICROPHONE_ACCESS_DENIED_OR_DISMISSED:{code:3018,message:"Oops! It seems like microphone access was denied or dismissed. To proceed, kindly grant access through your browser settings."},ERROR_CAMERA_PERMISSION_DENIED_BY_OS:{code:3019,message:"Camera permission denied by OS system settings. Please check the system settings and grant permission for this browser."},ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS:{code:3020,message:"Microphone permission denied by OS system settings. Please check the system settings and grant permission for this browser."},ERROR_CAMERA_NOT_FOUND:{code:3021,message:"Please ensure your camera is connected and turned on, and that the camera driver is installed and up-to-date."},ERROR_MICROPHONE_NOT_FOUND:{code:3022,message:"Please ensure your microphone is connected and turned on."},ERROR_CAMERA_IN_USE:{code:3023,message:"The camera is being used by another application. Please close any programs utilizing the camera, such as video conferencing tools, screen recording software, or other browsers. Restart your browser and attempt again."},ERROR_MICROPHONE_IN_USE:{code:3024,message:"The microphone is being used by another application. Please close any programs utilizing the microphone, such as video conferencing tools, screen recording software, or other browsers. Restart your browser and attempt again."},ERROR_CAMERA_PERMISSION_OR_AUTOPLAY_ISSUE:{code:3025,message:"It seems like there's an issue with camera permission or video autoplay, you can check out this link for details: http://tinyurl.com/autoplay-issue"},ERROR_VIDEO_SOURCE_INITIATION_FAILED:{code:3026,message:"Unable to initiate video source. Please verify browser settings for video permissions."},ERROR_WEBCAM_TRACK_ENDED:{code:3027,message:"Webcam track has ended or the webcam is disconnected. Please ensure your webcam is properly connected and try restarting it."},ERROR_MICROPHONE_TRACK_ENDED:{code:3028,message:"Microphone track has ended or the microphone is disconnected. Please check your microphone connection and try again."},ERROR_INVALID_CUSTOM_VIDEO_TRACK:{code:3029,message:"The provided custom video track is invalid; reverting to the default video track. Please ensure that the video track meets the required specifications."},ERROR_INVALID_CUSTOM_AUDIO_TRACK:{code:3030,message:"The provided custom audio track is invalid; reverting to the default audio track. Please ensure that the audio track meets the required specifications."},ERROR_CUSTOM_VIDEO_TRACK_ENDED:{code:3031,message:"The provided custom video track is in an ended state. Please verify the video track's status, and try again."},ERROR_CUSTOM_AUDIO_TRACK_ENDED:{code:3032,message:"The provided custom audio track is in an ended state. Please verify the audio track's status, and try again."},ERROR_CAMERA_ACCESS_UNAVAILABLE:{code:3033,message:"Camera access unavailable: Please ensure your device is compatible and that you're on a secure website (https://)."},ERROR_MICROPHONE_ACCESS_UNAVAILABLE:{code:3034,message:"Microphone access unavailable: Please ensure your device is compatible and that you're on a secure website (https://)."},ERROR_ACTION_PERFORMED_BEFORE_MEETING_JOINED:{code:3035,message:"Oops! Something went wrong. The room was in a connecting state, and during that time, an action encountered an issue. Please try again after joining a meeting."},ERROR_RN_CAMERA_ACCESS_DENIED_OR_DISMISSED:{code:3036,message:"Oops! It seems like camera access was denied or dismissed. To proceed, kindly grant access through your App settings."},ERROR_RN_CAMERA_NOT_FOUND:{code:3037,message:"Please ensure your camera is connected and turned on"},ERROR_RN_MIC_ACCESS_DENIED_OR_DISMISSED:{code:3038,message:"Oops! It seems like mic access was denied or dismissed. To proceed, kindly grant access through your App settings."},ERROR_RN_MIC_NOT_FOUND:{code:3039,message:"Please ensure your mic is connected and turned on"},ERROR_RN_CAMERA_ACCESS_UNAVAILABLE:{code:3040,message:"Camera access unavailable: Please ensure your device is compatible."},ERROR_RN_MIC_ACCESS_UNAVAILABLE:{code:3041,message:"Microphone access unavailable: Please ensure your device is compatible."},ERROR_RN_CAMERA_TRACK_ENDED:{code:3042,message:"Camera track has ended. Please make sure your camera is turned on or try restarting it."},ERROR_RN_MIC_TRACK_ENDED:{code:3043,message:"Microphone track has ended or the microphone is disconnected. Please check your microphone connection and try again."}}},5071:(a,c,o)=>{o.d(c,{V:()=>l});var l={HLS_STARTING:"HLS_STARTING",HLS_STARTED:"HLS_STARTED",HLS_PLAYABLE:"HLS_PLAYABLE",HLS_STOPPING:"HLS_STOPPING",HLS_STOPPED:"HLS_STOPPED"}},2107:(a,c,o)=>{o.d(c,{n:()=>l});var l={CONFERENCE:"CONFERENCE",VIEWER:"VIEWER"}},1751:(a,c,o)=>{o.r(c),o.d(c,{CameraDeviceInfo:()=>Ha,DeviceInfo:()=>Xs,MicrophoneDeviceInfo:()=>Wa,VideoSDK:()=>Il,ZujoSDK:()=>yw});var l=o(2284),u=o(467),h=o(3029),f=o(2901),g=o(4467),p=o(4756),d=o.n(p),m=o(6880),E=o.n(m);function S(A,O){var F=Object.keys(A);if(Object.getOwnPropertySymbols){var z=Object.getOwnPropertySymbols(A);O&&(z=z.filter(function(q){return Object.getOwnPropertyDescriptor(A,q).enumerable})),F.push.apply(F,z)}return F}function R(A){for(var O=1;O<arguments.length;O++){var F=arguments[O]!=null?arguments[O]:{};O%2?S(Object(F),!0).forEach(function(z){(0,g.A)(A,z,F[z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(A,Object.getOwnPropertyDescriptors(F)):S(Object(F)).forEach(function(z){Object.defineProperty(A,z,Object.getOwnPropertyDescriptor(F,z))})}return A}function k(A){return"Minified Redux error #"+A+"; visit https://redux.js.org/Errors?code="+A+" for the full message or use the non-minified dev environment for full errors. "}var C=typeof Symbol=="function"&&Symbol.observable||"@@observable",x=function(){return Math.random().toString(36).substring(7).split("").join(".")},P={INIT:"@@redux/INIT"+x(),REPLACE:"@@redux/REPLACE"+x(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+x()}};function D(A){if(typeof A!="object"||A===null)return!1;for(var O=A;Object.getPrototypeOf(O)!==null;)O=Object.getPrototypeOf(O);return Object.getPrototypeOf(A)===O}function b(A,O,F){var z;if(typeof O=="function"&&typeof F=="function"||typeof F=="function"&&typeof arguments[3]=="function")throw new Error(k(0));if(typeof O=="function"&&F===void 0&&(F=O,O=void 0),F!==void 0){if(typeof F!="function")throw new Error(k(1));return F(b)(A,O)}if(typeof A!="function")throw new Error(k(2));var q=A,ne=O,de=[],ge=de,W=!1;function te(){ge===de&&(ge=de.slice())}function K(){if(W)throw new Error(k(3));return ne}function ve(Fe){if(typeof Fe!="function")throw new Error(k(4));if(W)throw new Error(k(5));var at=!0;return te(),ge.push(Fe),function(){if(at){if(W)throw new Error(k(6));at=!1,te();var Se=ge.indexOf(Fe);ge.splice(Se,1),de=null}}}function Te(Fe){if(!D(Fe))throw new Error(k(7));if(Fe.type===void 0)throw new Error(k(8));if(W)throw new Error(k(9));try{W=!0,ne=q(ne,Fe)}finally{W=!1}for(var at=de=ge,Se=0;Se<at.length;Se++)(0,at[Se])();return Fe}return Te({type:P.INIT}),(z={dispatch:Te,subscribe:ve,getState:K,replaceReducer:function(Fe){if(typeof Fe!="function")throw new Error(k(10));q=Fe,Te({type:P.REPLACE})}})[C]=function(){var Fe,at=ve;return(Fe={subscribe:function(Se){if(typeof Se!="object"||Se===null)throw new Error(k(11));function We(){Se.next&&Se.next(K())}return We(),{unsubscribe:at(We)}}})[C]=function(){return this},Fe},z}function w(){for(var A=arguments.length,O=new Array(A),F=0;F<A;F++)O[F]=arguments[F];return O.length===0?function(z){return z}:O.length===1?O[0]:O.reduce(function(z,q){return function(){return z(q.apply(void 0,arguments))}})}function v(){for(var A=arguments.length,O=new Array(A),F=0;F<A;F++)O[F]=arguments[F];return function(z){return function(){var q=z.apply(void 0,arguments),ne=function(){throw new Error(k(15))},de={getState:q.getState,dispatch:function(){return ne.apply(void 0,arguments)}},ge=O.map(function(W){return W(de)});return ne=w.apply(void 0,ge)(q.dispatch),R(R({},q),{},{dispatch:ne})}}}function _(A){return function(O){var F=O.dispatch,z=O.getState;return function(q){return function(ne){return typeof ne=="function"?ne(F,z,A):q(ne)}}}}var y=_();y.withExtraArgument=_;const T=y;var L=o(2211),I=o.n(L);function N(A,O){var F=Object.keys(A);if(Object.getOwnPropertySymbols){var z=Object.getOwnPropertySymbols(A);O&&(z=z.filter(function(q){return Object.getOwnPropertyDescriptor(A,q).enumerable})),F.push.apply(F,z)}return F}function M(A){for(var O=1;O<arguments.length;O++){var F=arguments[O]!=null?arguments[O]:{};O%2?N(Object(F),!0).forEach(function(z){(0,g.A)(A,z,F[z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(A,Object.getOwnPropertyDescriptors(F)):N(Object(F)).forEach(function(z){Object.defineProperty(A,z,Object.getOwnPropertyDescriptor(F,z))})}return A}var U={url:null,state:"new",activeSpeakerId:null,statsPeerId:null,faceDetection:!1};const j=function(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:U,O=arguments.length>1?arguments[1]:void 0;switch(O.type){case"SET_ROOM_URL":var F=O.payload.url;return M(M({},A),{},{url:F});case"SET_ROOM_STATE":var z=O.payload.state;return M(M({},A),{},z==="connected"?{state:z}:{state:z,activeSpeakerId:null,statsPeerId:null});case"SET_ROOM_ACTIVE_SPEAKER":var q=O.payload.peerId;return M(M({},A),{},{activeSpeakerId:q});case"SET_ROOM_STATS_PEER_ID":var ne=O.payload.peerId;return A.statsPeerId===ne?M(M({},A),{},{statsPeerId:null}):M(M({},A),{},{statsPeerId:ne});case"SET_FACE_DETECTION":var de=O.payload;return M(M({},A),{},{faceDetection:de});case"REMOVE_PEER":var ge=O.payload.peerId,W=M({},A);return ge&&ge===A.activeSpeakerId&&(W.activeSpeakerId=null),ge&&ge===A.statsPeerId&&(W.statsPeerId=null),W;default:return A}};function Q(A,O){var F=Object.keys(A);if(Object.getOwnPropertySymbols){var z=Object.getOwnPropertySymbols(A);O&&(z=z.filter(function(q){return Object.getOwnPropertyDescriptor(A,q).enumerable})),F.push.apply(F,z)}return F}function Y(A){for(var O=1;O<arguments.length;O++){var F=arguments[O]!=null?arguments[O]:{};O%2?Q(Object(F),!0).forEach(function(z){(0,g.A)(A,z,F[z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(A,Object.getOwnPropertyDescriptors(F)):Q(Object(F)).forEach(function(z){Object.defineProperty(A,z,Object.getOwnPropertyDescriptor(F,z))})}return A}var he={id:null,displayName:null,displayNameSet:!1,device:null,canSendMic:!1,canSendWebcam:!1,canChangeWebcam:!1,webcamInProgress:!1,shareInProgress:!1,audioOnly:!1,audioOnlyInProgress:!1,audioMuted:!1,restartIceInProgress:!1};const re=function(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:he,O=arguments.length>1?arguments[1]:void 0;switch(O.type){case"SET_ROOM_STATE":return O.payload.state==="closed"?Y(Y({},A),{},{webcamInProgress:!1,shareInProgress:!1,audioOnly:!1,audioOnlyInProgress:!1,audioMuted:!1,restartIceInProgress:!1}):A;case"SET_ME":var F=O.payload,z=F.peerId,q=F.displayName,ne=F.displayNameSet,de=F.device;return Y(Y({},A),{},{id:z,displayName:q,displayNameSet:ne,device:de});case"SET_MEDIA_CAPABILITIES":var ge=O.payload,W=ge.canSendMic,te=ge.canSendWebcam;return Y(Y({},A),{},{canSendMic:W,canSendWebcam:te});case"SET_CAN_CHANGE_WEBCAM":var K=O.payload;return Y(Y({},A),{},{canChangeWebcam:K});case"SET_WEBCAM_IN_PROGRESS":var ve=O.payload.flag;return Y(Y({},A),{},{webcamInProgress:ve});case"SET_SHARE_IN_PROGRESS":var Te=O.payload.flag;return Y(Y({},A),{},{shareInProgress:Te});case"SET_DISPLAY_NAME":var Fe=O.payload.displayName;return Fe||(Fe=A.displayName),Y(Y({},A),{},{displayName:Fe,displayNameSet:!0});case"SET_AUDIO_ONLY_STATE":var at=O.payload.enabled;return Y(Y({},A),{},{audioOnly:at});case"SET_AUDIO_ONLY_IN_PROGRESS":var Se=O.payload.flag;return Y(Y({},A),{},{audioOnlyInProgress:Se});case"SET_AUDIO_MUTED_STATE":var We=O.payload.enabled;return Y(Y({},A),{},{audioMuted:We});case"SET_RESTART_ICE_IN_PROGRESS":var $e=O.payload.flag;return Y(Y({},A),{},{restartIceInProgress:$e});default:return A}};function pe(A,O){var F=Object.keys(A);if(Object.getOwnPropertySymbols){var z=Object.getOwnPropertySymbols(A);O&&(z=z.filter(function(q){return Object.getOwnPropertyDescriptor(A,q).enumerable})),F.push.apply(F,z)}return F}function fe(A){for(var O=1;O<arguments.length;O++){var F=arguments[O]!=null?arguments[O]:{};O%2?pe(Object(F),!0).forEach(function(z){(0,g.A)(A,z,F[z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(A,Object.getOwnPropertyDescriptors(F)):pe(Object(F)).forEach(function(z){Object.defineProperty(A,z,Object.getOwnPropertyDescriptor(F,z))})}return A}var ue={};const ee=function(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ue,O=arguments.length>1?arguments[1]:void 0;switch(O.type){case"SET_ROOM_STATE":return O.payload.state==="closed"?{}:A;case"ADD_PRODUCER":var F=O.payload.producer;return fe(fe({},A),{},(0,g.A)({},F.id,F));case"REMOVE_PRODUCER":var z=O.payload.producerId,q=fe({},A);return delete q[z],q;case"SET_PRODUCER_PAUSED":var ne=O.payload.producerId,de=fe(fe({},A[ne]),{},{paused:!0});return fe(fe({},A),{},(0,g.A)({},ne,de));case"SET_PRODUCER_RESUMED":var ge=O.payload.producerId,W=fe(fe({},A[ge]),{},{paused:!1});return fe(fe({},A),{},(0,g.A)({},ge,W));case"SET_PRODUCER_TRACK":var te=O.payload,K=te.producerId,ve=te.track,Te=fe(fe({},A[K]),{},{track:ve});return fe(fe({},A),{},(0,g.A)({},K,Te));case"SET_PRODUCER_SCORE":var Fe=O.payload,at=Fe.producerId,Se=Fe.score,We=A[at];if(!We)return A;var $e=fe(fe({},We),{},{score:Se});return fe(fe({},A),{},(0,g.A)({},at,$e));default:return A}};function Z(A,O){var F=Object.keys(A);if(Object.getOwnPropertySymbols){var z=Object.getOwnPropertySymbols(A);O&&(z=z.filter(function(q){return Object.getOwnPropertyDescriptor(A,q).enumerable})),F.push.apply(F,z)}return F}function le(A){for(var O=1;O<arguments.length;O++){var F=arguments[O]!=null?arguments[O]:{};O%2?Z(Object(F),!0).forEach(function(z){(0,g.A)(A,z,F[z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(A,Object.getOwnPropertyDescriptors(F)):Z(Object(F)).forEach(function(z){Object.defineProperty(A,z,Object.getOwnPropertyDescriptor(F,z))})}return A}var ye={};const mt=function(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ye,O=arguments.length>1?arguments[1]:void 0;switch(O.type){case"SET_ROOM_STATE":return O.payload.state==="closed"?{}:A;case"ADD_DATA_PRODUCER":var F=O.payload.dataProducer;return le(le({},A),{},(0,g.A)({},F.id,F));case"REMOVE_DATA_PRODUCER":var z=O.payload.dataProducerId,q=le({},A);return delete q[z],q;default:return A}};var Ye=o(5458);function ct(A,O){var F=Object.keys(A);if(Object.getOwnPropertySymbols){var z=Object.getOwnPropertySymbols(A);O&&(z=z.filter(function(q){return Object.getOwnPropertyDescriptor(A,q).enumerable})),F.push.apply(F,z)}return F}function ht(A){for(var O=1;O<arguments.length;O++){var F=arguments[O]!=null?arguments[O]:{};O%2?ct(Object(F),!0).forEach(function(z){(0,g.A)(A,z,F[z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(A,Object.getOwnPropertyDescriptors(F)):ct(Object(F)).forEach(function(z){Object.defineProperty(A,z,Object.getOwnPropertyDescriptor(F,z))})}return A}var kt={};function Sr(A,O){var F=Object.keys(A);if(Object.getOwnPropertySymbols){var z=Object.getOwnPropertySymbols(A);O&&(z=z.filter(function(q){return Object.getOwnPropertyDescriptor(A,q).enumerable})),F.push.apply(F,z)}return F}function wt(A){for(var O=1;O<arguments.length;O++){var F=arguments[O]!=null?arguments[O]:{};O%2?Sr(Object(F),!0).forEach(function(z){(0,g.A)(A,z,F[z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(A,Object.getOwnPropertyDescriptors(F)):Sr(Object(F)).forEach(function(z){Object.defineProperty(A,z,Object.getOwnPropertyDescriptor(F,z))})}return A}var Zt={};function vr(A,O){var F=Object.keys(A);if(Object.getOwnPropertySymbols){var z=Object.getOwnPropertySymbols(A);O&&(z=z.filter(function(q){return Object.getOwnPropertyDescriptor(A,q).enumerable})),F.push.apply(F,z)}return F}function Wr(A){for(var O=1;O<arguments.length;O++){var F=arguments[O]!=null?arguments[O]:{};O%2?vr(Object(F),!0).forEach(function(z){(0,g.A)(A,z,F[z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(A,Object.getOwnPropertyDescriptors(F)):vr(Object(F)).forEach(function(z){Object.defineProperty(A,z,Object.getOwnPropertyDescriptor(F,z))})}return A}var br={},Br=[];const Jr=function(A){for(var O=Object.keys(A),F={},z=0;z<O.length;z++){var q=O[z];typeof A[q]=="function"&&(F[q]=A[q])}var ne,de=Object.keys(F);try{(function(ge){Object.keys(ge).forEach(function(W){var te=ge[W];if(te(void 0,{type:P.INIT})===void 0)throw new Error(k(12));if(te(void 0,{type:P.PROBE_UNKNOWN_ACTION()})===void 0)throw new Error(k(13))})})(F)}catch(ge){ne=ge}return function(ge,W){if(ge===void 0&&(ge={}),ne)throw ne;for(var te=!1,K={},ve=0;ve<de.length;ve++){var Te=de[ve],Fe=F[Te],at=ge[Te],Se=Fe(at,W);if(Se===void 0)throw W&&W.type,new Error(k(14));K[Te]=Se,te=te||Se!==at}return(te=te||de.length!==Object.keys(ge).length)?K:ge}}({room:j,me:re,producers:ee,dataProducers:mt,peers:function(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:kt,O=arguments.length>1?arguments[1]:void 0;switch(O.type){case"SET_ROOM_STATE":return O.payload.state==="closed"?{}:A;case"ADD_PEER":var F=O.payload.peer;return ht(ht({},A),{},(0,g.A)({},F.id,F));case"REMOVE_PEER":var z=O.payload.peerId,q=ht({},A);return delete q[z],q;case"SET_PEER_DISPLAY_NAME":var ne=O.payload,de=ne.displayName,ge=A[ne.peerId];if(!ge)throw new Error("no Peer found");var W=ht(ht({},ge),{},{displayName:de});return ht(ht({},A),{},(0,g.A)({},W.id,W));case"ADD_CONSUMER":var te=O.payload,K=te.consumer,ve=A[te.peerId];if(!ve)throw new Error("no Peer found for new Consumer");var Te=[].concat((0,Ye.A)(ve.consumers),[K.id]),Fe=ht(ht({},ve),{},{consumers:Te});return ht(ht({},A),{},(0,g.A)({},Fe.id,Fe));case"REMOVE_CONSUMER":var at=O.payload,Se=at.consumerId,We=A[at.peerId];if(!We)return A;var $e=We.consumers.indexOf(Se);if($e===-1)throw new Error("Consumer not found");var bt=We.consumers.slice();bt.splice($e,1);var It=ht(ht({},We),{},{consumers:bt});return ht(ht({},A),{},(0,g.A)({},It.id,It));case"ADD_DATA_CONSUMER":var xe=O.payload,ie=xe.dataConsumer,_t=xe.peerId;if(!_t)return A;var Xt=A[_t];if(!Xt)throw new Error("no Peer found for new DataConsumer");var Je=[].concat((0,Ye.A)(Xt.dataConsumers),[ie.id]),cr=ht(ht({},Xt),{},{dataConsumers:Je});return ht(ht({},A),{},(0,g.A)({},cr.id,cr));case"REMOVE_DATA_CONSUMER":var xr=O.payload,Qr=xr.dataConsumerId,jt=xr.peerId;if(!jt)return A;var gr=A[jt];if(!gr)return A;var ln=gr.dataConsumers.indexOf(Qr);if(ln===-1)throw new Error("DataConsumer not found");var Fr=gr.dataConsumers.slice();Fr.splice(ln,1);var hs=ht(ht({},gr),{},{dataConsumers:Fr});return ht(ht({},A),{},(0,g.A)({},hs.id,hs));default:return A}},consumers:function(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Zt,O=arguments.length>1?arguments[1]:void 0;switch(O.type){case"SET_ROOM_STATE":return O.payload.state==="closed"?{}:A;case"ADD_CONSUMER":var F=O.payload.consumer;return wt(wt({},A),{},(0,g.A)({},F.id,F));case"REMOVE_CONSUMER":var z=O.payload.consumerId,q=wt({},A);return delete q[z],q;case"SET_CONSUMER_PAUSED":var ne,de=O.payload,ge=de.consumerId,W=de.originator,te=A[ge];return ne=wt(wt({},te),{},W==="local"?{locallyPaused:!0}:{remotelyPaused:!0}),wt(wt({},A),{},(0,g.A)({},ge,ne));case"SET_CONSUMER_RESUMED":var K,ve=O.payload,Te=ve.consumerId,Fe=ve.originator,at=A[Te];return K=wt(wt({},at),{},Fe==="local"?{locallyPaused:!1}:{remotelyPaused:!1}),wt(wt({},A),{},(0,g.A)({},Te,K));case"SET_CONSUMER_CURRENT_LAYERS":var Se=O.payload,We=Se.consumerId,$e=Se.spatialLayer,bt=Se.temporalLayer,It=wt(wt({},A[We]),{},{currentSpatialLayer:$e,currentTemporalLayer:bt});return wt(wt({},A),{},(0,g.A)({},We,It));case"SET_CONSUMER_PREFERRED_LAYERS":var xe=O.payload,ie=xe.consumerId,_t=xe.spatialLayer,Xt=xe.temporalLayer,Je=wt(wt({},A[ie]),{},{preferredSpatialLayer:_t,preferredTemporalLayer:Xt});return wt(wt({},A),{},(0,g.A)({},ie,Je));case"SET_CONSUMER_PRIORITY":var cr=O.payload,xr=cr.consumerId,Qr=cr.priority,jt=wt(wt({},A[xr]),{},{priority:Qr});return wt(wt({},A),{},(0,g.A)({},xr,jt));case"SET_CONSUMER_TRACK":var gr=O.payload,ln=gr.consumerId,Fr=gr.track,hs=wt(wt({},A[ln]),{},{track:Fr});return wt(wt({},A),{},(0,g.A)({},ln,hs));case"SET_CONSUMER_SCORE":var ea=O.payload,Fn=ea.consumerId,xc=ea.score,Al=A[Fn];if(!Al)return A;var ed=wt(wt({},Al),{},{score:xc});return wt(wt({},A),{},(0,g.A)({},Fn,ed));default:return A}},dataConsumers:function(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:br,O=arguments.length>1?arguments[1]:void 0;switch(O.type){case"SET_ROOM_STATE":return O.payload.state==="closed"?{}:A;case"ADD_DATA_CONSUMER":var F=O.payload.dataConsumer;return Wr(Wr({},A),{},(0,g.A)({},F.id,F));case"REMOVE_DATA_CONSUMER":var z=O.payload.dataConsumerId,q=Wr({},A);return delete q[z],q;default:return A}},notifications:function(){var A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Br,O=arguments.length>1?arguments[1]:void 0;switch(O.type){case"ADD_NOTIFICATION":var F=O.payload.notification;return[].concat((0,Ye.A)(A),[F]);case"REMOVE_NOTIFICATION":var z=O.payload.notificationId;return A.filter(function(q){return q.id!==z});case"REMOVE_ALL_NOTIFICATIONS":return[];default:return A}}});var Qt=o(2487),zt=o(7007),At=o(296),Lr=(o(2487).default,(0,f.A)(function A(){(0,h.A)(this,A),this.roomClient=null})),yt=new(function(){function A(){(0,h.A)(this,A),A.instance||(A.instance=new Lr)}return(0,f.A)(A,[{key:"getInstance",value:function(){return A.instance}}])}());Object.freeze(yt);var Qe=yt.getInstance(),Et=function(){return(0,f.A)(function A(O){(0,h.A)(this,A),this.id=O.id,this.kind=O.track.kind,this.codec=O.codec,this.track=O.track,this.producerOrConsumer=O.instance,O.appData&&O.appData.share===!0&&O.track.kind==="video"&&(this.kind="share"),O.appData&&O.appData.share===!0&&O.track.kind==="audio"&&(this.kind="shareAudio")},[{key:"pause",value:function(){Qe.roomClient._pauseConsumer(this.producerOrConsumer)}},{key:"resume",value:function(){Qe.roomClient._resumeConsumer(this.producerOrConsumer)}},{key:"paused",get:function(){return this.producerOrConsumer.paused}}])}();function Ae(A,O){var F=typeof Symbol<"u"&&A[Symbol.iterator]||A["@@iterator"];if(!F){if(Array.isArray(A)||(F=function(W,te){if(W){if(typeof W=="string")return Ne(W,te);var K=Object.prototype.toString.call(W).slice(8,-1);if(K==="Object"&&W.constructor&&(K=W.constructor.name),K==="Map"||K==="Set")return Array.from(W);if(K==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(K))return Ne(W,te)}}(A))||O){F&&(A=F);var z=0,q=function(){};return{s:q,n:function(){return z>=A.length?{done:!0}:{done:!1,value:A[z++]}},e:function(W){throw W},f:q}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ne,de=!0,ge=!1;return{s:function(){F=F.call(A)},n:function(){var W=F.next();return de=W.done,W},e:function(W){ge=!0,ne=W},f:function(){try{de||F.return==null||F.return()}finally{if(ge)throw ne}}}}function Ne(A,O){(O==null||O>A.length)&&(O=A.length);for(var F=0,z=new Array(O);F<O;F++)z[F]=A[F];return z}var Ze="stream-enabled",Oe="stream-disabled",vt="media-status-changed",Mt="video-quality-changed",ke=function(){return(0,f.A)(function q(ne){var de=this;(0,h.A)(this,q),(0,g.A)(this,"captureImage",(0,u.A)(d().mark(function ge(){var W,te,K,ve,Te,Fe,at,Se,We=arguments;return d().wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:te=(W=We.length>0&&We[0]!==void 0?We[0]:{}).height,K=W.width,$e.prev=1,ve=(0,Ye.A)(de.streams.values()),Te=Ae(ve),$e.prev=4,at=d().mark(function bt(){var It,xe,ie,_t,Xt;return d().wrap(function(Je){for(;;)switch(Je.prev=Je.next){case 0:if((It=Fe.value).kind!="video"){Je.next=19;break}return Je.prev=2,(xe=new MediaStream).addTrack(It.track),(ie=document.createElement("video")).srcObject=xe,ie.playsInline=!0,(_t=document.createElement("canvas")).id="canvasId",Je.next=12,new Promise(function(cr,xr){ie.addEventListener("loadeddata",(0,u.A)(d().mark(function Qr(){var jt,gr,ln,Fr,hs,ea;return d().wrap(function(Fn){for(;;)switch(Fn.prev=Fn.next){case 0:return jt=ie.videoWidth,gr=ie.videoHeight,ln=16/9,te==null&&K==null&&(te=gr,K=jt),te==null&&te==null||(te<=0||te>gr)&&(te=gr),K==null&&K==null||(K<=0||K>jt)&&(K=jt),te==null&&(te=K/ln),K==null&&(K=te*ln),_t.width=K,_t.height=te,Fn.prev=9,Fn.next=12,ie.play();case 12:document.body.appendChild(ie),Fr=(_t.width-jt*ln)/2,hs=(_t.height-gr*ln)/2,_t.getContext("2d").clearRect(0,0,Fr/2,hs/2),_t.getContext("2d").drawImage(ie,0,0),ea=_t.toDataURL("image/jpeg").split(";base64,")[1],document.body.appendChild(_t),document.body.removeChild(_t),document.body.removeChild(ie),cr(ea),Fn.next=28;break;case 24:Fn.prev=24,Fn.t0=Fn.catch(9),xr(Fn.t0),console.log("error in video",Fn.t0);case 28:case"end":return Fn.stop()}},Qr,null,[[9,24]])})))});case 12:return Xt=Je.sent,Je.abrupt("return",{v:Xt});case 16:Je.prev=16,Je.t0=Je.catch(2),console.error("err on image capture",Je.t0);case 19:case"end":return Je.stop()}},bt,null,[[2,16]])}),Te.s();case 7:if((Fe=Te.n()).done){$e.next=14;break}return $e.delegateYield(at(),"t0",9);case 9:if(!(Se=$e.t0)){$e.next=12;break}return $e.abrupt("return",Se.v);case 12:$e.next=7;break;case 14:$e.next=19;break;case 16:$e.prev=16,$e.t1=$e.catch(4),Te.e($e.t1);case 19:return $e.prev=19,Te.f(),$e.finish(19);case 22:throw new Error("Camera must be on to capture an image");case 25:$e.prev=25,$e.t2=$e.catch(1),console.error("Error in captureImage::",$e.t2),Qe.roomClient._videosdkLogs&&Qe.roomClient._videosdkLogs.pushLogs({logText:"Error on image capture",logType:"ERROR",attributes:{error:$e.t2.message}});case 29:case"end":return $e.stop()}},ge,null,[[1,25],[4,16,19,22]])}))),this.id=ne.id,this.displayName=ne.displayName,this.streams=new Map,this.quality="low",this.local=ne.local||!1,this.pinState={cam:!1,share:!1},this.webcamOn=!1,this.micOn=!1,this.mode=ne.mode,this.metaData=ne.metaData,this.eventEmitter=new zt.EventEmitter},[{key:"_setPinState",value:function(q){q.cam!=null&&(this.pinState.cam=q.cam),q.share!=null&&(this.pinState.share=q.share)}},{key:"remove",value:function(){Qe.roomClient.removePeer(this.id)}},{key:"enableMic",value:function(){Qe.roomClient.enablePeerMic(this.id)}},{key:"disableMic",value:function(){Qe.roomClient.disablePeerMic(this.id)}},{key:"enableWebcam",value:function(){Qe.roomClient.enablePeerWebcam(this.id)}},{key:"disableWebcam",value:function(){Qe.roomClient.disablePeerWebcam(this.id)}},{key:"addStream",value:function(q){this.streams.set(q.id,q),q.kind!=="video"||this.local||Qe.roomClient.setConsumerQuality(q.id,this.quality),this.eventEmitter.emit(Ze,q)}},{key:"updateStream",value:function(q){this.streams.set(q.id,q),this.eventEmitter.emit(Ze,q)}},{key:"deleteStream",value:function(q){var ne=this.streams.get(q);if(ne!=null)return this.streams.delete(q),this.eventEmitter.emit(Oe,ne),ne}},{key:"updateParticipantMediaState",value:function(q,ne){q=="audio"?this.micOn=ne:q=="video"&&(this.webcamOn=ne),this.eventEmitter.emit(vt,{peerId:this.id,kind:q,newStatus:ne})}},{key:"videoQualityChanged",value:function(q,ne){this.eventEmitter.emit(Mt,{peerId:this.id,prevQuality:q,currentQuality:ne})}},{key:"setQuality",value:function(q){this.quality===q||this.local||(this.quality=q,(0,Ye.A)(this.streams.entries()).forEach(function(ne){var de=ne[1];de.kind==="video"&&Qe.roomClient.setConsumerQuality(de.id,q)}))}},{key:"setViewPort",value:function(q,ne){(0,Ye.A)(this.streams.entries()).forEach(function(de){var ge=de[1];ge.kind==="video"&&Qe.roomClient.setViewPort(ge.producerOrConsumer,q,ne)})}},{key:"pin",value:function(q){switch(q){case"SHARE_AND_CAM":case void 0:this._setPinState({cam:!0,share:!0});break;case"CAM":this._setPinState({cam:!0});break;case"SHARE":this._setPinState({share:!0});break;default:throw new Error("Unknown pin type")}Qe.roomClient.pinStateChange({peerId:this.id,state:this.pinState})}},{key:"unpin",value:function(q){switch(q){case"SHARE_AND_CAM":case void 0:this._setPinState({cam:!1,share:!1});break;case"CAM":this._setPinState({cam:!1});break;case"SHARE":this._setPinState({share:!1});break;default:throw new Error("Unknown unpin type")}Qe.roomClient.pinStateChange({peerId:this.id,state:this.pinState})}},{key:"switchTo",value:(z=(0,u.A)(d().mark(function q(ne){var de,ge,W;return d().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return de=ne.meetingId,ge=ne.payload,W=ne.token,te.next=3,Qe.roomClient.switchPeerRoom({peerId:this.id,roomId:de,payload:ge,token:W});case 3:case"end":return te.stop()}},q,this)})),function(q){return z.apply(this,arguments)})},{key:"getVideoStats",value:(F=(0,u.A)(d().mark(function q(){var ne,de,ge,W,te;return d().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(!this.local){K.next=6;break}return K.next=3,Qe.roomClient.getVideoRemoteStats();case 3:return K.abrupt("return",K.sent);case 6:ne=(0,Ye.A)(this.streams.entries()),de=Ae(ne),K.prev=8,de.s();case 10:if((ge=de.n()).done){K.next=18;break}if(W=(0,At.A)(ge.value,2),te=W[0],W[1].kind!="video"){K.next=16;break}return K.next=15,Qe.roomClient.getConsumerRemoteStats(te);case 15:return K.abrupt("return",K.sent);case 16:K.next=10;break;case 18:K.next=23;break;case 20:K.prev=20,K.t0=K.catch(8),de.e(K.t0);case 23:return K.prev=23,de.f(),K.finish(23);case 26:case"end":return K.stop()}},q,this,[[8,20,23,26]])})),function(){return F.apply(this,arguments)})},{key:"getShareStats",value:(O=(0,u.A)(d().mark(function q(){var ne,de,ge,W,te;return d().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(!this.local){K.next=6;break}return K.next=3,Qe.roomClient.getShareRemoteStats();case 3:return K.abrupt("return",K.sent);case 6:ne=(0,Ye.A)(this.streams.entries()),de=Ae(ne),K.prev=8,de.s();case 10:if((ge=de.n()).done){K.next=18;break}if(W=(0,At.A)(ge.value,2),te=W[0],W[1].kind!="share"){K.next=16;break}return K.next=15,Qe.roomClient.getConsumerRemoteStats(te);case 15:return K.abrupt("return",K.sent);case 16:K.next=10;break;case 18:K.next=23;break;case 20:K.prev=20,K.t0=K.catch(8),de.e(K.t0);case 23:return K.prev=23,de.f(),K.finish(23);case 26:case"end":return K.stop()}},q,this,[[8,20,23,26]])})),function(){return O.apply(this,arguments)})},{key:"getAudioStats",value:(A=(0,u.A)(d().mark(function q(){var ne,de,ge,W,te;return d().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(this.micOn){K.next=2;break}return K.abrupt("return",[]);case 2:if(!this.local){K.next=8;break}return K.next=5,Qe.roomClient.getAudioRemoteStats();case 5:return K.abrupt("return",K.sent);case 8:ne=(0,Ye.A)(this.streams.entries()),de=Ae(ne),K.prev=10,de.s();case 12:if((ge=de.n()).done){K.next=20;break}if(W=(0,At.A)(ge.value,2),te=W[0],W[1].kind!="audio"){K.next=18;break}return K.next=17,Qe.roomClient.getConsumerRemoteStats(te);case 17:return K.abrupt("return",K.sent);case 18:K.next=12;break;case 20:K.next=25;break;case 22:K.prev=22,K.t0=K.catch(10),de.e(K.t0);case 25:return K.prev=25,de.f(),K.finish(25);case 28:case"end":return K.stop()}},q,this,[[10,22,25,28]])})),function(){return A.apply(this,arguments)})},{key:"consumeMicStreams",value:function(){Qe.roomClient.consumeMicStreams(this.id)}},{key:"consumeWebcamStreams",value:function(){Qe.roomClient.consumeWebcamStreams(this.id)}},{key:"stopConsumingWebcamStreams",value:function(){Qe.roomClient.stopConsumingWebcamStreams(this.id)}},{key:"stopConsumingMicStreams",value:function(){Qe.roomClient.stopConsumingMicStreams(this.id)}},{key:"on",value:function(q,ne){switch(q){case Ze:case Oe:case vt:case Mt:this.eventEmitter.on(q,ne);break;default:throw new Error("Invalid event type")}}},{key:"off",value:function(q,ne){switch(q){case Ze:case Oe:case vt:case Mt:this.eventEmitter.off(q,ne);break;default:throw new Error("Invalid event type")}}}]);var A,O,F,z}();function lr(A,O,F){(function(z,q){if(q.has(z))throw new TypeError("Cannot initialize the same private elements twice on an object")})(A,O),O.set(A,F)}function yr(A,O,F){if(typeof A=="function"?A===O:A.has(O))return arguments.length<3?O:F;throw new TypeError("Private element is not present on this object")}var wr=new WeakMap,Ur=function(){return(0,f.A)(function O(F,z){var q,ne,de,ge=F.id,W=F.displayName;(0,h.A)(this,O),lr(this,wr,void 0),this.id=ge,this.displayName=W,ne=this,de=z,(q=wr).set(yr(q,ne),de)},[{key:"switchTo",value:(A=(0,u.A)(d().mark(function O(F){var z,q,ne;return d().wrap(function(de){for(;;)switch(de.prev=de.next){case 0:return z=F.meetingId,q=F.payload,ne=F.token,de.next=3,Qe.roomClient.connectionSwitchPeerRoom({roomId:z,connectionRoomId:(ge=wr,W=this,ge.get(yr(ge,W))),payload:q,peerId:this.id,token:ne});case 3:case"end":return de.stop()}var ge,W},O,this)})),function(O){return A.apply(this,arguments)})}]);var A}(),yn="participant-joined",Ge="participant-left",Ot="chat-message",xt=function(){return(0,f.A)(function O(F,z){var q=this;(0,h.A)(this,O),this.eventEmitter=new zt.EventEmitter,this.id=F,this.participants=new Map,z.forEach(function(ne){q.participants.set(ne.id,new Ur(ne,q.id))})},[{key:"participantJoin",value:function(O){var F=new Ur(O,this.id);this.participants.set(O.id,F),this.eventEmitter.emit(yn,F)}},{key:"participantLeft",value:function(O){this.participants.delete(O),this.eventEmitter.emit(Ge,O)}},{key:"sendChatMessage",value:function(O){Qe.roomClient.connectionSendChatMessage({roomId:this.id,message:O})}},{key:"sendChatMessageEvent",value:function(O){var F=O.participantId,z=O.message;this.eventEmitter.emit(Ot,{participantId:F,message:z})}},{key:"end",value:(A=(0,u.A)(d().mark(function O(){return d().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.next=2,Qe.roomClient.connectionEndMeeting({roomId:this.id});case 2:case"end":return F.stop()}},O,this)})),function(){return A.apply(this,arguments)})},{key:"on",value:function(O,F){switch(O){case yn:case Ge:case Ot:this.eventEmitter.on(O,F);break;default:throw new Error("Invalid event type")}}},{key:"off",value:function(O,F){switch(O){case yn:case Ge:case Ot:this.eventEmitter.off(O,F);break;default:throw new Error("Invalid event type")}}}]);var A}(),Ke=function(){return(0,f.A)(function A(O){var F=O.roomId,z=O.peers,q=O.payload;(0,h.A)(this,A),this.id=F,this.payload=q,this.meeting=new xt(F,z)},[{key:"close",value:function(){Qe.roomClient.closeConnection(this.id)}}])}();function Zr(A,O){if(O.has(A))throw new TypeError("Cannot initialize the same private elements twice on an object")}function kr(A,O){return A.get(Or(A,O))}function Or(A,O,F){if(typeof A=="function"?A===O:A.has(O))return arguments.length<3?O:F;throw new TypeError("Private element is not present on this object")}var sr="error",ar="meeting-joined",Mr="meeting-left",tn="participant-mode-changed",_n="participant-joined",Jn="participant-left",ss="speaker-changed",li="presenter-changed",Zn="main-participant-changed",As="chat-message",Ua="entry-requested",as="entry-responded",fa="recording-state-changed",ma="recording-started",$n="recording-stopped",je="livestream-state-changed",ga="livestream-started",Qs="livestream-stopped",$a="hls-state-changed",va="hls-started",Va="hls-stopped",ya="whiteboard-started",Pe="whiteboard-stopped",Ga="video-state-changed",be="video-seeked",Ve="mic-requested",He="webcam-requested",lt="stream-enabled",$t="stream-disabled",Vt="pin-state-changed",hr="connection-open",or="connection-close",Nt="switch-meeting",Cr="meeting-state-changed",Gt="transcription-state-changed",pr="transcription-text",Er=new WeakMap,Nr=new WeakSet,hn=function(){return(0,f.A)(function W(te,K,ve){var Te,Fe,at,Se,We,$e,bt,It,xe=this;(0,h.A)(this,W),Zr(Te=this,Fe=Nr),Fe.add(Te),function(ie,_t,Xt){Zr(ie,_t),_t.set(ie,Xt)}(this,Er,void 0),(0,g.A)(this,"pubSub",{publish:(We=(0,u.A)(d().mark(function ie(_t,Xt,Je,cr){return d().wrap(function(xr){for(;;)switch(xr.prev=xr.next){case 0:if(cr==null){xr.next=3;break}if((0,l.A)(cr)=="object"){xr.next=3;break}throw new Error('"payload" can only be object.');case 3:return xr.next=5,xe.roomClient.pubsubPublish(_t,Xt,Je,cr);case 5:case"end":return xr.stop()}},ie)})),function(ie,_t,Xt,Je){return We.apply(this,arguments)}),subscribe:(Se=(0,u.A)(d().mark(function ie(_t,Xt){var Je;return d().wrap(function(cr){for(;;)switch(cr.prev=cr.next){case 0:if(!kr(Er,xe).listeners(_t).includes(Xt)){cr.next=2;break}return cr.abrupt("return");case 2:return cr.next=4,xe.roomClient.pubsubSubscribe(_t);case 4:return Je=cr.sent,kr(Er,xe).on(_t,Xt),cr.abrupt("return",Je);case 7:case"end":return cr.stop()}},ie)})),function(ie,_t){return Se.apply(this,arguments)}),unsubscribe:(at=(0,u.A)(d().mark(function ie(_t,Xt){return d().wrap(function(Je){for(;;)switch(Je.prev=Je.next){case 0:if(kr(Er,xe).off(_t,Xt),kr(Er,xe).listeners(_t).length!=0){Je.next=4;break}return Je.next=4,xe.roomClient.pubsubUnsubscribe(_t);case 4:case"end":return Je.stop()}},ie)})),function(ie,_t){return at.apply(this,arguments)})}),(0,g.A)(this,"uploadBase64File",function(){var ie=(0,u.A)(d().mark(function _t(Xt){var Je,cr,xr,Qr,jt,gr,ln;return d().wrap(function(Fr){for(;;)switch(Fr.prev=Fr.next){case 0:if(Je=Xt.base64Data,cr=Xt.token,xr=Xt.fileName,Fr.prev=1,Je&&cr&&xr){Fr.next=4;break}throw new Error("please provide base64Data, token and fileName");case 4:return Qr="https://".concat(xe.baseUrl,"/base64-upload?roomId=").concat(xe.id),jt={fileName:xr,base64Data:Je},Fr.next=8,fetch(Qr,{method:"POST",body:JSON.stringify(jt),headers:{"Content-Type":"application/json",Authorization:cr}});case 8:return gr=Fr.sent,Fr.next=11,gr.json();case 11:return ln=Fr.sent,Fr.abrupt("return",ln.url);case 15:Fr.prev=15,Fr.t0=Fr.catch(1),console.error("Error while Uploading Base64 File::",Fr.t0),xe.roomClient._videosdkLogs&&xe.roomClient._videosdkLogs.pushLogs({logText:"Error while Uploading Base64 File",logType:"ERROR",attributes:{error:Fr.t0.message}});case 19:case"end":return Fr.stop()}},_t,null,[[1,15]])}));return function(_t){return ie.apply(this,arguments)}}()),(0,g.A)(this,"fetchBase64File",function(){var ie=(0,u.A)(d().mark(function _t(Xt){var Je,cr,xr,Qr,jt;return d().wrap(function(gr){for(;;)switch(gr.prev=gr.next){case 0:if(Je=Xt.url,cr=Xt.token,gr.prev=1,Je&&cr){gr.next=4;break}throw new Error("please provide url and token");case 4:return gr.next=6,fetch(Je,{headers:{Authorization:cr}});case 6:return xr=gr.sent,gr.next=9,xr.arrayBuffer();case 9:return Qr=gr.sent,jt=window.btoa(new Uint8Array(Qr).reduce(function(ln,Fr){return ln+String.fromCharCode(Fr)},"")),gr.abrupt("return",jt);case 14:gr.prev=14,gr.t0=gr.catch(1),console.error("Error while fetching Base64 File::",gr.t0),xe.roomClient._videosdkLogs&&xe.roomClient._videosdkLogs.pushLogs({logText:"Error while fetching Base64 File",logType:"ERROR",attributes:{error:gr.t0.message}});case 18:case"end":return gr.stop()}},_t,null,[[1,14]])}));return function(_t){return ie.apply(this,arguments)}}()),this.id=te,this.roomClient=ve,this.activeSpeakerId=null,this.activePresenterId=null,this.mainParticipantId=null,this.connections=new Map,this.localParticipant=K,this.participants=new Map,this.baseUrl=null,this.livestreamState="LIVESTREAM_STOPPED",this.recordingState="RECORDING_STOPPED",this.hlsState="HLS_STOPPED",this.transcriptionState="TRANSCRIPTION_STOPPED",this.hlsUrls={downstreamUrl:null,playbackHlsUrl:null,livestreamUrl:null},this.messages=[],this.eventEmitter=new zt.EventEmitter,$e=Er,bt=this,It=new zt.EventEmitter,$e.set(Or($e,bt),It),this.eventEmitter.setMaxListeners(9999),kr(Er,this).setMaxListeners(9999),this.roomClient.on("ERROR",function(ie){return xe.handleError(ie)}),this.roomClient.on("ADD_PEER",function(ie){return xe.handlePeerAdd(ie)}),this.roomClient.on("REMOVE_PEER",function(ie){return xe.handlePeerRemove(ie)}),this.roomClient.on("ADD_PRODUCER",function(ie){return xe.handleProducerAdd(ie)}),this.roomClient.on("UPDATE_PRODUCER",function(ie){return xe.handleUpdateProducer(ie)}),this.roomClient.on("REMOVE_PRODUCER",function(ie){return xe.handleProducerRemove(ie)}),this.roomClient.on("ADD_CONSUMER",function(ie){return xe.handleConsumerAdd(ie)}),this.roomClient.on("REMOVE_CONSUMER",function(ie){return xe.handleConsumerRemove(ie)}),this.roomClient.on("PARTICIPANT_MEDIA_STATE_CHANGED",function(ie){return xe.handleParticipantMediaStateChanged(ie)}),this.roomClient.on("CHAT_MESSAGE",function(ie){return xe.handleNewChatMessage(ie)}),this.roomClient.on("SET_ROOM_ACTIVE_SPEAKER",function(ie){return xe.handleSpeakerChange(ie)}),this.roomClient.on("ENTRY_REQUESTED",function(ie){return xe.handleEntryRequested(ie)}),this.roomClient.on("ENTRY_RESPONDED",function(ie){return xe.handleEntryResponded(ie)}),this.roomClient.on("MEETING_JOINED",function(ie){return xe.handleMeetingJoined(ie)}),this.roomClient.on("MEETING_LEFT",function(ie){return xe.handleMeetingLeft(ie)}),this.roomClient.on("RECORDING_STATE_CHANGED",function(ie){xe.handleRecordingStateChanged(ie)}),this.roomClient.on("RECORDING_STARTED",function(ie){return xe.handleRecordingStarted(ie)}),this.roomClient.on("RECORDING_STOPPED",function(ie){return xe.handleRecordingStopped(ie)}),this.roomClient.on("LIVESTREAM_STATE_CHANGED",function(ie){xe.handleLivestreamStateChanged(ie)}),this.roomClient.on("LIVESTREAM_STARTED",function(ie){return xe.handleLivestreamStarted(ie)}),this.roomClient.on("LIVESTREAM_STOPPED",function(ie){return xe.handleLivestreamStopped(ie)}),this.roomClient.on("HLS_STATE_CHANGED",function(ie){xe.handleHlsStateChanged(ie)}),this.roomClient.on("HLS_STARTED",function(ie){xe.handleHlsStarted(ie)}),this.roomClient.on("HLS_STOPPED",function(ie){xe.handleHlsStopped(ie)}),this.roomClient.on("TRANSCRIPTION_STATE_CHANGED",function(ie){xe.handleTranscriptionStateChanged(ie)}),this.roomClient.on("TRANSCRIPTION_TEXT",function(ie){xe.handleTranscriptionText(ie)}),this.roomClient.on("WHITEBOARD_STARTED",function(ie){return xe.handleWhiteboardStarted(ie)}),this.roomClient.on("WHITEBOARD_STOPPED",function(ie){return xe.handleWhiteboardStopped(ie)}),this.roomClient.on("VIDEO_STATE_CHANGED",function(ie){return xe.handleVideoStateChanged(ie)}),this.roomClient.on("VIDEO_SEEKED",function(ie){return xe.handleVideoSeeked(ie)}),this.roomClient.on("PIN_STATE_CHANGED",function(ie){xe.handlePinStateChanged(ie)}),this.roomClient.on("MIC_REQUESTED",function(ie){return xe.handleMicRequested(ie)}),this.roomClient.on("WEBCAM_REQUESTED",function(ie){return xe.handleWebcamRequested(ie)}),this.roomClient.on("CONNECTION_OPEN",function(ie){return xe.handleConnectionOpen(ie)}),this.roomClient.on("CONNECTION_CLOSE",function(ie){return xe.handleConnectionClose(ie)}),this.roomClient.on("CONNECTION_PARTICIPANT_JOIN",function(ie){return xe.handleConnectionParticipantJoin(ie)}),this.roomClient.on("SWITCH_ROOM",function(ie){return xe.handleSwitchMeeting(ie)}),this.roomClient.on("CONNECTION_CHAT_MESSAGE",function(ie){return xe.handleConnectionChatMessage(ie)}),this.roomClient.on("CONNECTION_PARTICIPANT_LEFT",function(ie){xe.handleConnectionParticipantLeft(ie)}),this.roomClient.on("PUBSUB_MESSAGE",function(ie){return Or(Nr,xe,kn).call(xe,ie)}),this.roomClient.on("PEER_MODE_CHANGED",function(ie){return Or(Nr,xe,vi).call(xe,ie)}),this.updateMainParticipant(this.localParticipant.id),this.roomClient.on("MEETING_STATE_CHANGED",function(ie){return xe.handleMeetingStateChanged(ie)}),this.roomClient.on("VIDEO_QUALITY_CHANGED",function(ie){return xe.handleVideoQualityChanged(ie)})},[{key:"handleError",value:function(W){this.eventEmitter.listenerCount(sr)>0&&this.eventEmitter.emit(sr,W)}},{key:"join",value:function(){this.roomClient.join()}},{key:"changeMode",value:function(W){this.roomClient.changeMode(W)}},{key:"leave",value:function(){this.roomClient.close({sendLeft:!0})}},{key:"end",value:function(){this.roomClient.closeRoom()}},{key:"respondEntry",value:function(W,te){this.roomClient.respondEntry(W,te)}},{key:"pinnedParticipants",get:function(){return this.roomClient._pinnedParticipants}},{key:"muteMic",value:function(){this.roomClient.disableMic()}},{key:"unmuteMic",value:function(){var W=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;this.roomClient.enableMic(W)}},{key:"publishAudio",value:(ge=(0,u.A)(d().mark(function W(){var te,K=arguments;return d().wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return te=K.length>0&&K[0]!==void 0?K[0]:void 0,ve.next=3,this.roomClient.enableMic(te);case 3:return ve.abrupt("return");case 4:case"end":return ve.stop()}},W,this)})),function(){return ge.apply(this,arguments)})},{key:"unpublishAudio",value:(de=(0,u.A)(d().mark(function W(){return d().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return te.next=2,this.roomClient.disableMic();case 2:return te.abrupt("return");case 3:case"end":return te.stop()}},W,this)})),function(){return de.apply(this,arguments)})},{key:"disableWebcam",value:function(){this.roomClient.disableWebcam()}},{key:"enableWebcam",value:function(){var W=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;this.roomClient.enableWebcam(W)}},{key:"publishVideo",value:(ne=(0,u.A)(d().mark(function W(){var te,K=arguments;return d().wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return te=K.length>0&&K[0]!==void 0?K[0]:void 0,this.roomClient.enableWebcam(te),ve.abrupt("return");case 3:case"end":return ve.stop()}},W,this)})),function(){return ne.apply(this,arguments)})},{key:"unpublishVideo",value:(q=(0,u.A)(d().mark(function W(){return d().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return this.roomClient.disableWebcam(),te.abrupt("return");case 2:case"end":return te.stop()}},W,this)})),function(){return q.apply(this,arguments)})},{key:"disableScreenShare",value:function(){this.roomClient.disableShare()}},{key:"enableScreenShare",value:function(){var W=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;this.roomClient.enableShare(W)}},{key:"pubblishScreenShare",value:function(){var W=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;this.roomClient.enableShare(W)}},{key:"unpublishScreenShare",value:function(){this.roomClient.disableShare()}},{key:"sendChatMessage",value:function(W){this.roomClient.sendChatMessage(W);var te={text:W,timestamp:new Date().getTime(),senderId:this.localParticipant.id,senderName:this.localParticipant.displayName};this.handleNewChatMessage(te)}},{key:"startRecording",value:function(W,te,K,ve){this.roomClient.startRecording(W,te,K,ve)}},{key:"stopRecording",value:function(){this.roomClient.stopRecording()}},{key:"startTranscription",value:function(W){this.roomClient.startTranscription(W)}},{key:"stopTranscription",value:function(){this.roomClient.stopTranscription()}},{key:"startLivestream",value:function(W,te){this.roomClient.startLivestream(W,te)}},{key:"stopLivestream",value:function(){this.roomClient.stopLivestream()}},{key:"startHls",value:(z=(0,u.A)(d().mark(function W(te,K){return d().wrap(function(ve){for(;;)switch(ve.prev=ve.next){case 0:return ve.next=2,this.roomClient.startHls(te,K);case 2:case"end":return ve.stop()}},W,this)})),function(W,te){return z.apply(this,arguments)})},{key:"stopHls",value:function(){this.roomClient.stopHls()}},{key:"getMics",value:(F=(0,u.A)(d().mark(function W(){return d().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return te.next=2,this.roomClient.getMics();case 2:return te.abrupt("return",te.sent);case 3:case"end":return te.stop()}},W,this)})),function(){return F.apply(this,arguments)})},{key:"getWebcams",value:(O=(0,u.A)(d().mark(function W(){return d().wrap(function(te){for(;;)switch(te.prev=te.next){case 0:return te.next=2,this.roomClient.getWebcams();case 2:return te.abrupt("return",te.sent);case 3:case"end":return te.stop()}},W,this)})),function(){return O.apply(this,arguments)})},{key:"changeMic",value:function(W){this.roomClient.changeMic(W)}},{key:"changeWebcam",value:function(W){this.roomClient.changeWebcam(W)}},{key:"replaceWebcamStream",value:function(W){this.roomClient.replaceWebcamStream(W)}},{key:"setWebcamQuality",value:function(W){this.roomClient.setWebcamQuality(W)}},{key:"startWhiteboard",value:function(){this.roomClient.startWhiteboard()}},{key:"stopWhiteboard",value:function(){this.roomClient.stopWhiteboard()}},{key:"startVideo",value:function(W){var te=W.link;this.roomClient.startVideo({link:te})}},{key:"stopVideo",value:function(){this.roomClient.stopVideo()}},{key:"resumeVideo",value:function(){this.roomClient.resumeVideo()}},{key:"refreshConnection",value:function(){this.roomClient.restartIce()}},{key:"pauseVideo",value:function(W){var te=W.currentTime;this.roomClient.pauseVideo(te)}},{key:"seekVideo",value:function(W){var te=W.currentTime;this.roomClient.seekVideo(te)}},{key:"handlePeerAdd",value:function(W){var te=W.peer,K=new ke(te);this.participants.set(K.id,K),this.eventEmitter.emit(_n,K),this.participants.size===1&&this.updateMainParticipant(K.id)}},{key:"handlePeerRemove",value:function(W){var te=W.peerId,K=this.participants.get(te);K!=null&&(this.participants.delete(te),this.eventEmitter.emit(Jn,K),this.activePresenterId===K.id&&(this.activePresenterId=null,this.eventEmitter.emit(li,this.activePresenterId)),this.mainParticipantId===K.id&&(this.participants.size>0?this.updateMainParticipant(this.participants.entries().next().value[1].id):this.updateMainParticipant(this.localParticipant.id)))}},{key:"handleProducerAdd",value:function(W){var te=W.producer,K=new Et(te);this.localParticipant.addStream(K),K.kind==="share"&&(this.activePresenterId=this.localParticipant.id,this.eventEmitter.emit(li,this.activePresenterId),this.updateMainParticipant(this.localParticipant.id))}},{key:"handleUpdateProducer",value:function(W){var te=W.producer,K=new Et(te);this.localParticipant.updateStream(K)}},{key:"handleProducerRemove",value:function(W){var te=W.producerId,K=this.localParticipant.deleteStream(te);if(K&&K.kind==="share"){this.activePresenterId=null,this.eventEmitter.emit(li,this.activePresenterId);var ve=this.participants.size>0?this.participants.entries().next().value[1].id:null;this.updateMainParticipant(this.activeSpeakerId||ve||this.localParticipant.id)}}},{key:"handleConsumerAdd",value:function(W){var te=W.consumer,K=W.peerId,ve=this.participants.get(K);if(ve){var Te=new Et(te);ve.addStream(Te),this.eventEmitter.emit(lt,Te),Te.kind==="share"&&(this.activePresenterId=ve.id,this.eventEmitter.emit(li,this.activePresenterId),this.updateMainParticipant(ve.id))}}},{key:"handleConsumerRemove",value:function(W){var te=W.consumerId,K=W.peerId,ve=this.participants.get(K);if(ve!=null&&ve){var Te=ve.deleteStream(te);if(this.eventEmitter.emit($t,Te),Te&&Te.kind==="share"){this.activePresenterId=null,this.eventEmitter.emit(li,this.activePresenterId);var Fe=this.participants.size>0?this.participants.entries().next().value[1].id:null;this.updateMainParticipant(this.activeSpeakerId||Fe||this.localParticipant.id)}}}},{key:"handleParticipantMediaStateChanged",value:function(W){var te=W.peerId,K=W.kind,ve=W.newState,Te=this.participants.get(te);Te&&Te&&(K=="audio"?Te.micOn=ve:K=="video"&&(Te.webcamOn=ve),Te.updateParticipantMediaState(K,ve))}},{key:"handleSpeakerChange",value:function(W){var te=W.peerId;this.activeSpeakerId!==te&&(this.activeSpeakerId=te,this.eventEmitter.emit(ss,te),te&&te!==this.localParticipant.id&&this.activePresenterId!==this.mainParticipantId&&te!==this.mainParticipantId&&this.updateMainParticipant(te))}},{key:"handleNewChatMessage",value:function(W){var te=W.senderId,K={senderId:te,text:W.text,timestamp:W.timestamp};if(this.localParticipant.id===te)K.senderName=this.localParticipant.displayName;else{var ve=this.participants.get(te);ve&&(K.senderName=ve.displayName)}this.messages.push(K),this.eventEmitter.emit(As,K)}},{key:"updateMainParticipant",value:function(W){this.mainParticipantId=W;var te=null;te=W===this.localParticipant.id?this.localParticipant:this.participants.get(this.mainParticipantId),this.eventEmitter.emit(Zn,te)}},{key:"handleEntryRequested",value:function(W){var te=this,K=W.id,ve=W.name;this.eventEmitter.emit(Ua,{participantId:K,name:ve,allow:function(){te.roomClient.respondEntry(K,"allowed")},deny:function(){te.roomClient.respondEntry(K,"denied")}})}},{key:"handleEntryResponded",value:function(W){var te=W.id,K=W.decision;this.eventEmitter.emit(as,te,K)}},{key:"handleMeetingJoined",value:function(W){var te=W.peers,K=W.poll,ve=W.messages,Te=W.baseUrl;this.baseUrl=Te,ve.length>0&&(this.messages=ve),this.eventEmitter.emit(ar,{peers:te,poll:K,messages:ve})}},{key:"handleMeetingLeft",value:function(W){this.eventEmitter.emit(Mr,W)}},{key:"handleRecordingStateChanged",value:function(W){this.recordingState=W.status,this.eventEmitter.emit(fa,W)}},{key:"handleLivestreamStateChanged",value:function(W){this.livestreamState=W.status,this.eventEmitter.emit(je,W)}},{key:"handleHlsStateChanged",value:function(W){this.hlsState=W.status,W.status=="HLS_PLAYABLE"?this.hlsUrls={downstreamUrl:W.downstreamUrl,playbackHlsUrl:W.playbackHlsUrl,livestreamUrl:W.livestreamUrl}:W.status=="HLS_STOPPED"&&(this.hlsUrls={downstreamUrl:null,playbackHlsUrl:null,livestreamUrl:null}),this.eventEmitter.emit($a,W)}},{key:"handleTranscriptionStateChanged",value:function(W){this.transcriptionState=W.status,this.eventEmitter.emit(Gt,W)}},{key:"handleTranscriptionText",value:function(W){this.eventEmitter.emit(pr,W)}},{key:"handleRecordingStarted",value:function(){this.eventEmitter.emit(ma)}},{key:"handleRecordingStopped",value:function(){this.eventEmitter.emit($n)}},{key:"handleLivestreamStarted",value:function(){this.eventEmitter.emit(ga)}},{key:"handleLivestreamStopped",value:function(){this.eventEmitter.emit(Qs)}},{key:"handleHlsStarted",value:function(W){this.eventEmitter.emit(va,W)}},{key:"handleHlsStopped",value:function(){this.eventEmitter.emit(Va)}},{key:"handleWhiteboardStarted",value:function(W){var te=W.state;this.eventEmitter.emit(ya,te)}},{key:"handleWhiteboardStopped",value:function(W){(function(te){if(te==null)throw new TypeError("Cannot destructure "+te)})(W),this.eventEmitter.emit(Pe)}},{key:"handleVideoStateChanged",value:function(W){this.eventEmitter.emit(Ga,W)}},{key:"handleVideoSeeked",value:function(W){var te=W.currentTime;this.eventEmitter.emit(be,{currentTime:te})}},{key:"handlePinStateChanged",value:function(W){var te=W.peerId,K=W.state,ve=W.pinnedBy;this.eventEmitter.emit(Vt,{participantId:te,state:K,pinnedBy:ve})}},{key:"handleMeetingStateChanged",value:function(W){var te=W.state;this.eventEmitter.emit(Cr,{state:te})}},{key:"handleVideoQualityChanged",value:function(W){var te=W.peerId,K=W.prevQuality,ve=W.currentQuality,Te=this.participants.get(te);Te&&Te&&Te.videoQualityChanged(K,ve)}},{key:"handleMicRequested",value:function(W){var te=this,K=W.peerId;this.eventEmitter.emit(Ve,{participantId:K,accept:function(){return te.unmuteMic()},reject:function(){}})}},{key:"handleWebcamRequested",value:function(W){var te=this,K=W.peerId;this.eventEmitter.emit(He,{participantId:K,accept:function(){return te.enableWebcam()},reject:function(){}})}},{key:"handleConnectionParticipantJoin",value:function(W){var te=W.roomId,K=W.peer,ve=this.connections.get(te);ve!=null&&ve.meeting.participantJoin(K)}},{key:"handleConnectionParticipantLeft",value:function(W){var te=W.roomId,K=W.peerId,ve=this.connections.get(te);ve!=null&&ve.meeting.participantLeft(K)}},{key:"handleConnectionOpen",value:function(W){var te=W.peers,K=W.roomId,ve=W.payload,Te=new Ke({roomId:K,peers:te,payload:ve});this.connections.set(Te.id,Te),this.eventEmitter.emit(hr,Te)}},{key:"handleConnectionClose",value:function(W){var te=W.roomId;this.connections.get(te)!=null&&(this.connections.delete(te),this.eventEmitter.emit(or,te))}},{key:"handleSwitchMeeting",value:function(W){var te=W.roomId,K=W.token,ve=W.payload,Te=W.peerId,Fe=W.connectionPeerId,at=W.connectionRoomId,Se=Te?{meetingId:te,payload:ve,token:K,participantId:Te}:{meetingId:te,payload:ve,token:K,connectionParticipantId:Fe,connectionMeetingId:at};this.eventEmitter.emit(Nt,Se)}},{key:"handleConnectionChatMessage",value:function(W){var te=W.roomId,K=W.peerId,ve=W.message,Te=this.connections.get(te);Te!=null&&Te.meeting.sendChatMessageEvent({participantId:K,message:ve})}},{key:"connectTo",value:(A=(0,u.A)(d().mark(function W(te){var K,ve;return d().wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return K=te.meetingId,ve=te.payload,Te.next=3,this.roomClient.openConnection({roomId:K,payload:ve});case 3:case"end":return Te.stop()}},W,this)})),function(W){return A.apply(this,arguments)})},{key:"selectedCameraDevice",get:function(){var W;return(W=this.roomClient._webcam)===null||W===void 0?void 0:W.device}},{key:"selectedMicrophoneDevice",get:function(){var W;return(W=this.roomClient._mic)===null||W===void 0?void 0:W.device}},{key:"on",value:function(W,te){switch(W){case _n:case Jn:case ss:case li:case Zn:case As:case Ua:case as:case fa:case ma:case $n:case je:case ga:case Qs:case va:case Va:case $a:case Gt:case pr:case lt:case $t:case ya:case Pe:case ar:case Mr:case Ga:case be:case Ve:case He:case Vt:case hr:case or:case Nt:case Cr:case tn:case sr:this.eventEmitter.on(W,te);break;default:throw new Error("Invalid event type")}}},{key:"off",value:function(W,te){switch(W){case _n:case Jn:case ss:case li:case Zn:case As:case Ua:case as:case fa:case ma:case $n:case je:case ga:case Qs:case $a:case va:case Va:case Gt:case pr:case lt:case $t:case ya:case Pe:case ar:case Mr:case Ga:case be:case Ve:case He:case Vt:case hr:case or:case Nt:case Cr:case sr:case tn:this.eventEmitter.off(W,te);break;default:throw new Error("Invalid event type")}}}]);var A,O,F,z,q,ne,de,ge}();function kn(A){var O=A.topic,F=A.message,z=A.senderId,q=A.timestamp,ne=A.senderName,de=A.id,ge=A.payload;O&&F&&kr(Er,this).emit(O,{message:F,senderId:z,timestamp:q,topic:O,senderName:ne,id:de,payload:ge})}function vi(A){var O=A.peerId,F=A.mode;O===this.localParticipant.id?this.localParticipant.mode=F:this.participants.get(O).mode=F,this.eventEmitter.emit(tn,{participantId:O,mode:F})}var er=o(7080),Bi=o(5071),ei=o(2107),qi=o(4973),Pi=o(9027);function os(A,O){if(O&&((0,l.A)(O)==="object"||typeof O=="function"))return O;if(O!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(F){if(F===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return F}(A)}function cs(A){return cs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(O){return O.__proto__||Object.getPrototypeOf(O)},cs(A)}function Os(A,O){return Os=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(F,z){return F.__proto__=z,F},Os(A,O)}function _a(A,O){if(typeof O!="function"&&O!==null)throw new TypeError("Super expression must either be null or a function");A.prototype=Object.create(O&&O.prototype,{constructor:{value:A,writable:!0,configurable:!0}}),Object.defineProperty(A,"prototype",{writable:!1}),O&&Os(A,O)}function ba(A,O,F){return O=cs(O),os(A,Co()?Reflect.construct(O,F||[],cs(A).constructor):O.apply(A,F))}function Co(){try{var A=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Co=function(){return!!A})()}var Xs=function(A){function O(F,z,q,ne){return(0,h.A)(this,O),ba(this,O,[F,z,q,ne])}return _a(O,A),(0,f.A)(O)}((0,f.A)(function A(O,F,z,q){(0,h.A)(this,A),this.deviceId=O,this.groupId=F,this.kind=z,this.label=q})),Ha=function(A){function O(F,z,q,ne){return(0,h.A)(this,O),ba(this,O,[F,z,q,ne])}return _a(O,A),(0,f.A)(O)}(Xs),Wa=function(A){function O(F,z,q,ne){return(0,h.A)(this,O),ba(this,O,[F,z,q,ne])}return _a(O,A),(0,f.A)(O)}(Xs),Po=function(A){function O(F,z,q,ne){return(0,h.A)(this,O),ba(this,O,[F,z,q,ne])}return _a(O,A),(0,f.A)(O)}(Xs),Vn={AUDIO:"audio",VIDEO:"video",AUDIO_AND_VIDEO:"audio_video"},dc=(o(328),o(7654));function Sa(A,O){return A==null||O==null?NaN:A<O?-1:A>O?1:A>=O?0:NaN}function hc(A,O){return A==null||O==null?NaN:O<A?-1:O>A?1:O>=A?0:NaN}function Lo(A){let O,F,z;function q(ne,de,ge=0,W=ne.length){if(ge<W){if(O(de,de)!==0)return W;do{const te=ge+W>>>1;F(ne[te],de)<0?ge=te+1:W=te}while(ge<W)}return ge}return A.length!==2?(O=Sa,F=(ne,de)=>Sa(A(ne),de),z=(ne,de)=>A(ne)-de):(O=A===Sa||A===hc?A:Do,F=A,z=A),{left:q,center:function(ne,de,ge=0,W=ne.length){const te=q(ne,de,ge,W-1);return te>ge&&z(ne[te-1],de)>-z(ne[te],de)?te-1:te},right:function(ne,de,ge=0,W=ne.length){if(ge<W){if(O(de,de)!==0)return W;do{const te=ge+W>>>1;F(ne[te],de)<=0?ge=te+1:W=te}while(ge<W)}return ge}}}function Do(){return 0}const St=Lo(Sa),J=St.right,it=(Lo(function(A){return A===null?NaN:+A}).center,J);function tr(A,O){switch(arguments.length){case 0:break;case 1:this.range(A);break;default:this.range(O).domain(A)}return this}function an(){var A,O=[.5],F=[0,1],z=1;function q(ne){return ne!=null&&ne<=ne?F[it(O,ne,0,z)]:A}return q.domain=function(ne){return arguments.length?(O=Array.from(ne),z=Math.min(O.length,F.length-1),q):O.slice()},q.range=function(ne){return arguments.length?(F=Array.from(ne),z=Math.min(O.length,F.length-1),q):F.slice()},q.invertExtent=function(ne){var de=F.indexOf(ne);return[O[de-1],O[de]]},q.unknown=function(ne){return arguments.length?(A=ne,q):A},q.copy=function(){return an().domain(O).range(F).unknown(A)},tr.apply(q,arguments)}function Gn(A,O){var F=Object.keys(A);if(Object.getOwnPropertySymbols){var z=Object.getOwnPropertySymbols(A);O&&(z=z.filter(function(q){return Object.getOwnPropertyDescriptor(A,q).enumerable})),F.push.apply(F,z)}return F}function Hn(A){for(var O=1;O<arguments.length;O++){var F=arguments[O]!=null?arguments[O]:{};O%2?Gn(Object(F),!0).forEach(function(z){Kt(A,z,F[z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(A,Object.getOwnPropertyDescriptors(F)):Gn(Object(F)).forEach(function(z){Object.defineProperty(A,z,Object.getOwnPropertyDescriptor(F,z))})}return A}function yi(A,O){if(!(A instanceof O))throw new TypeError("Cannot call a class as a function")}function ju(A,O){for(var F=0;F<O.length;F++){var z=O[F];z.enumerable=z.enumerable||!1,z.configurable=!0,"value"in z&&(z.writable=!0),Object.defineProperty(A,Tl(z.key),z)}}function _i(A,O,F){return O&&ju(A.prototype,O),Object.defineProperty(A,"prototype",{writable:!1}),A}function Kt(A,O,F){return(O=Tl(O))in A?Object.defineProperty(A,O,{value:F,enumerable:!0,configurable:!0,writable:!0}):A[O]=F,A}function Io(A,O){if(typeof O!="function"&&O!==null)throw new TypeError("Super expression must either be null or a function");A.prototype=Object.create(O&&O.prototype,{constructor:{value:A,writable:!0,configurable:!0}}),Object.defineProperty(A,"prototype",{writable:!1}),O&&pc(A,O)}function zr(A){return zr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(O){return O.__proto__||Object.getPrototypeOf(O)},zr(A)}function pc(A,O){return pc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(F,z){return F.__proto__=z,F},pc(A,O)}function Ms(A,O){if(A==null)return{};var F,z,q=function(de,ge){if(de==null)return{};var W,te,K={},ve=Object.keys(de);for(te=0;te<ve.length;te++)W=ve[te],ge.indexOf(W)>=0||(K[W]=de[W]);return K}(A,O);if(Object.getOwnPropertySymbols){var ne=Object.getOwnPropertySymbols(A);for(z=0;z<ne.length;z++)F=ne[z],O.indexOf(F)>=0||Object.prototype.propertyIsEnumerable.call(A,F)&&(q[F]=A[F])}return q}function _r(A){if(A===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A}function Ao(A){var O=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var F,z=zr(A);if(O){var q=zr(this).constructor;F=Reflect.construct(z,arguments,q)}else F=z.apply(this,arguments);return function(ne,de){if(de&&(typeof de=="object"||typeof de=="function"))return de;if(de!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _r(ne)}(this,F)}}function El(A,O){for(;!Object.prototype.hasOwnProperty.call(A,O)&&(A=zr(A))!==null;);return A}function fc(){return fc=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(A,O,F){var z=El(A,O);if(z){var q=Object.getOwnPropertyDescriptor(z,O);return q.get?q.get.call(arguments.length<3?A:F):q.value}},fc.apply(this,arguments)}function mc(A,O,F,z){return mc=typeof Reflect<"u"&&Reflect.set?Reflect.set:function(q,ne,de,ge){var W,te=El(q,ne);if(te){if((W=Object.getOwnPropertyDescriptor(te,ne)).set)return W.set.call(ge,de),!0;if(!W.writable)return!1}if(W=Object.getOwnPropertyDescriptor(ge,ne)){if(!W.writable)return!1;W.value=de,Object.defineProperty(ge,ne,W)}else Kt(ge,ne,de);return!0},mc(A,O,F,z)}function Cn(A,O,F,z,q){if(!mc(A,O,F,z||A)&&q)throw new TypeError("failed to set property");return F}function bi(A,O){return function(F){if(Array.isArray(F))return F}(A)||function(F,z){var q=F==null?null:typeof Symbol<"u"&&F[Symbol.iterator]||F["@@iterator"];if(q!=null){var ne,de,ge,W,te=[],K=!0,ve=!1;try{if(ge=(q=q.call(F)).next,z===0){if(Object(q)!==q)return;K=!1}else for(;!(K=(ne=ge.call(q)).done)&&(te.push(ne.value),te.length!==z);K=!0);}catch(Te){ve=!0,de=Te}finally{try{if(!K&&q.return!=null&&(W=q.return(),Object(W)!==W))return}finally{if(ve)throw de}}return te}}(A,O)||Rl(A,O)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Ns(A){return function(O){if(Array.isArray(O))return gc(O)}(A)||function(O){if(typeof Symbol<"u"&&O[Symbol.iterator]!=null||O["@@iterator"]!=null)return Array.from(O)}(A)||Rl(A)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Rl(A,O){if(A){if(typeof A=="string")return gc(A,O);var F=Object.prototype.toString.call(A).slice(8,-1);return F==="Object"&&A.constructor&&(F=A.constructor.name),F==="Map"||F==="Set"?Array.from(A):F==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(F)?gc(A,O):void 0}}function gc(A,O){(O==null||O>A.length)&&(O=A.length);for(var F=0,z=new Array(O);F<O;F++)z[F]=A[F];return z}function Tl(A){var O=function(F,z){if(typeof F!="object"||F===null)return F;var q=F[Symbol.toPrimitive];if(q!==void 0){var ne=q.call(F,z||"default");if(typeof ne!="object")return ne;throw new TypeError("@@toPrimitive must return a primitive value.")}return(z==="string"?String:Number)(F)}(A,"string");return typeof O=="symbol"?O:String(O)}function me(A,O){return function(F,z){return z.get?z.get.call(F):z.value}(A,xl(A,O,"get"))}function Rt(A,O,F){return function(z,q,ne){if(q.set)q.set.call(z,ne);else{if(!q.writable)throw new TypeError("attempted to set read only private field");q.value=ne}}(A,xl(A,O,"set"),F),F}function xl(A,O,F){if(!O.has(A))throw new TypeError("attempted to "+F+" private field on non-instance");return O.get(A)}function Ht(A,O,F){if(!O.has(A))throw new TypeError("attempted to get private field on non-instance");return F}function kl(A,O){if(O.has(A))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Tt(A,O,F){kl(A,O),O.set(A,F)}function Wn(A,O){kl(A,O),O.add(A)}var Oo="https://speed.cloudflare.com",Cl={autoStart:!0,downloadApiUrl:"".concat(Oo,"/__down"),uploadApiUrl:"".concat(Oo,"/__up"),logMeasurementApiUrl:null,logAimApiUrl:"https://aim.cloudflare.com/__log",turnServerUri:"turn.speed.cloudflare.com:50000",turnServerCredsApiUrl:"".concat(Oo,"/turn-creds"),turnServerUser:null,turnServerPass:null,rpkiInvalidHost:"invalid.rpki.cloudflare.com",cfTraceUrl:"".concat(Oo,"/cdn-cgi/trace"),includeCredentials:!1,measurements:[{type:"latency",numPackets:1},{type:"download",bytes:1e5,count:1,bypassMinDuration:!0},{type:"latency",numPackets:20},{type:"download",bytes:1e5,count:9},{type:"download",bytes:1e6,count:8},{type:"upload",bytes:1e5,count:8},{type:"packetLoss",numPackets:1e3,batchSize:10,batchWaitTime:10,responsesWaitTime:3e3},{type:"upload",bytes:1e6,count:6},{type:"download",bytes:1e7,count:6},{type:"upload",bytes:1e7,count:4},{type:"download",bytes:25e6,count:4},{type:"upload",bytes:25e6,count:4},{type:"download",bytes:1e8,count:3},{type:"upload",bytes:5e7,count:3},{type:"download",bytes:25e7,count:2}],measureDownloadLoadedLatency:!0,measureUploadLoadedLatency:!0,loadedLatencyThrottle:400,bandwidthFinishRequestDuration:1e3,estimatedServerTime:10,latencyPercentile:.5,bandwidthPercentile:.9,bandwidthMinRequestDuration:10,loadedRequestMinDuration:250,loadedLatencyMaxPoints:20},Pl={aimMeasurementScoring:{packetLoss:an([.01,.05,.25,.5],[10,5,0,-10,-20]),latency:an([10,20,50,100,500],[20,10,5,0,-10,-20]),loadedLatencyIncrease:an([10,20,50,100,500],[20,10,5,0,-10,-20]),jitter:an([10,20,100,500],[10,5,0,-10,-20]),download:an([1e6,1e7,5e7,1e8],[0,5,10,20,30]),upload:an([1e6,1e7,5e7,1e8],[0,5,10,20,30])},aimExperiencesDefs:{streaming:{input:["latency","packetLoss","download","loadedLatencyIncrease"],pointThresholds:[15,20,40,60]},gaming:{input:["latency","packetLoss","loadedLatencyIncrease"],pointThresholds:[5,15,25,30]},rtc:{input:["latency","jitter","packetLoss","loadedLatencyIncrease"],pointThresholds:[5,15,25,40]}}},Bu=function(A){var O=A.headers.get("server-timing");if(O){var F=O.match(/dur=([0-9.]+)/);if(F)return+F[1]}},Uu=function(A){return A.responseStart-A.requestStart},$u=function(A){return A.responseEnd-A.responseStart},Vu=function(A){return A.ping+A.payloadDownloadTime},Gu=function(A){return A.ttfb},Hu=function(A,O){var F=A.duration,z=A.transferSize,q=F/1e3;return q?8*(z||1.005*+O)/q:void 0},Wu=function(A,O){var F=A.duration/1e3;return F?8*O*1.005/F:void 0},zu=dc(function(A){return"0".repeat(A)}),Mo=new WeakMap,No=new WeakMap,Fo=new WeakMap,vc=new WeakMap,yc=new WeakMap,_c=new WeakMap,jo=new WeakMap,bc=new WeakMap,wa=new WeakMap,Sc=new WeakMap,wc=new WeakMap,za=new WeakMap,Ka=new WeakMap,qa=new WeakMap,Ss=new WeakMap,Ea=new WeakMap,Ya=new WeakMap,Ra=new WeakMap,Bo=new WeakMap,X=new WeakMap,B=new WeakMap,V=new WeakMap,$=new WeakSet,G=new WeakSet,se=new WeakSet,ae=new WeakSet;function Be(A){var O=this;A!==me(this,za)&&(Rt(this,za,A),setTimeout(function(){return me(O,vc).call(O,me(O,za))}))}function we(A,O){var F=this,z=me(this,wa)[A],q=z.bytes,ne=z.dir,de=me(this,qa),ge=de[ne].hasOwnProperty(q)?de[ne][q]:{timings:[],numMeasurements:me(this,wa).filter(function(W){var te=W.bytes,K=W.dir;return q===te&&ne===K}).map(function(W){return W.count}).reduce(function(W,te){return W+te},0)};O&&ge.timings.push(O),ge.timings=ge.timings.slice(-ge.numMeasurements),de[ne][q]=ge,O?setTimeout(function(){me(F,_c).call(F,Hn({type:ne,bytes:q},O),de)}):me(this,yc).call(this,me(this,wa)[A],de)}function gt(){var A=this,O=me(this,wa),F=O[me(this,Ss)];if(me(this,Ea)>=F.count){var z=me(this,Ka);if(me(this,Ra)>this.finishRequestDuration&&!F.bypassMinDuration){var q=F.dir;me(this,Ka)[q]=!0,Object.values(me(this,Ka)).every(function(Se){return Se})&&me(this,jo).call(this,me(this,qa))}Rt(this,Ea,0),Rt(this,Ra,-1/0),performance.clearResourceTimings();do Rt(this,Ss,me(this,Ss)+1);while(me(this,Ss)<O.length&&z[O[me(this,Ss)].dir]);if(me(this,Ss)>=O.length)return Rt(this,Ka,{down:!0,up:!0}),Ht(this,$,Be).call(this,!1),void me(this,jo).call(this,me(this,qa));F=O[me(this,Ss)]}var ne=me(this,Ss);me(this,Ea)===0&&Ht(this,G,we).call(this,ne);var de=F,ge=de.bytes,W=de.dir==="down",te=me(this,W?Sc:wc),K=Object.assign({},me(this,Mo));W&&(K.bytes="".concat(ge));var ve,Te="".concat(te.startsWith("http")||te.startsWith("//")?"":window.location.origin).concat(te,"?").concat(Object.entries(K).map(function(Se){var We=bi(Se,2),$e=We[0],bt=We[1];return"".concat($e,"=").concat(bt)}).join("&")),Fe=Object.assign({},W?{}:{method:"POST",body:zu(ge)},me(this,No)),at=Rt(this,B,fetch(Te,Fe).then(function(Se){if(Se.ok)return Se;throw Error(Se.statusText)}).then(function(Se){return A.getServerTime&&(ve=A.getServerTime(Se)),Se}).then(function(Se){return Se.text().then(function(We){return me(A,Fo)&&me(A,Fo).call(A,{url:Te,headers:Se.headers,body:We}),We})}).then(function(Se,We){if(at._cancel)We("cancelled");else{var $e=performance.getEntriesByName(Te).slice(-1)[0],bt={transferSize:$e.transferSize,ttfb:Uu($e),payloadDownloadTime:$u($e),serverTime:ve||-1,measTime:new Date};if(bt.ping=Math.max(.01,bt.ttfb-(ve||me(A,X))),bt.duration=(W?Vu:Gu)(bt),bt.bps=(W?Hu:Wu)(bt,ge),W&&ge){var It=+ge;bt.transferSize&&(bt.transferSize<It||bt.transferSize/It>1.05)&&console.warn("Requested ".concat(It,"B but received ").concat(bt.transferSize,"B (").concat(Math.round(bt.transferSize/It*1e4)/100,"%)."))}Ht(A,G,we).call(A,ne,bt);var xe=bt.duration;Rt(A,Ra,me(A,Ra)<0?xe:Math.min(me(A,Ra),xe)),Rt(A,Ea,me(A,Ea)+1),Rt(A,Ya,0),me(A,Bo)?Rt(A,V,setTimeout(function(){return Ht(A,se,gt).call(A)},me(A,Bo))):Ht(A,se,gt).call(A)}}).catch(function(Se){var We,$e;at._cancel||(console.warn("Error fetching ".concat(Te,": ").concat(Se)),Rt(A,Ya,(We=me(A,Ya),$e=We++,We)),$e<20?Ht(A,se,gt).call(A):(Rt(A,Ya,0),Ht(A,$,Be).call(A,!1),me(A,bc).call(A,"Connection failed to ".concat(Te,". Gave up after ").concat(20," retries."))))}))}function qe(){var A=me(this,B);A&&(A._cancel=!0)}var ut=function(){function A(O){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},z=F.downloadApiUrl,q=F.uploadApiUrl,ne=F.throttleMs,de=ne===void 0?0:ne,ge=F.estimatedServerTime,W=ge===void 0?0:ge;if(yi(this,A),Wn(this,ae),Wn(this,se),Wn(this,G),Wn(this,$),Tt(this,Mo,{writable:!0,value:{}}),Tt(this,No,{writable:!0,value:{}}),Kt(this,"finishRequestDuration",1e3),Kt(this,"getServerTime",Bu),Tt(this,Fo,{writable:!0,value:function(te){return te}}),Tt(this,vc,{writable:!0,value:function(){}}),Tt(this,yc,{writable:!0,value:function(){}}),Tt(this,_c,{writable:!0,value:function(){}}),Tt(this,jo,{writable:!0,value:function(){}}),Tt(this,bc,{writable:!0,value:function(){}}),Tt(this,wa,{writable:!0,value:void 0}),Tt(this,Sc,{writable:!0,value:void 0}),Tt(this,wc,{writable:!0,value:void 0}),Tt(this,za,{writable:!0,value:!1}),Tt(this,Ka,{writable:!0,value:{down:!1,up:!1}}),Tt(this,qa,{writable:!0,value:{down:{},up:{}}}),Tt(this,Ss,{writable:!0,value:0}),Tt(this,Ea,{writable:!0,value:0}),Tt(this,Ya,{writable:!0,value:0}),Tt(this,Ra,{writable:!0,value:-1/0}),Tt(this,Bo,{writable:!0,value:0}),Tt(this,X,{writable:!0,value:0}),Tt(this,B,{writable:!0,value:void 0}),Tt(this,V,{writable:!0,value:void 0}),!O)throw new Error("Missing measurements argument");if(!z)throw new Error("Missing downloadApiUrl argument");if(!q)throw new Error("Missing uploadApiUrl argument");Rt(this,wa,O),Rt(this,Sc,z),Rt(this,wc,q),Rt(this,Bo,de),Rt(this,X,Math.max(0,W))}return _i(A,[{key:"results",get:function(){return me(this,qa)}},{key:"qsParams",get:function(){return me(this,Mo)},set:function(O){Rt(this,Mo,O)}},{key:"fetchOptions",get:function(){return me(this,No)},set:function(O){Rt(this,No,O)}},{key:"responseHook",set:function(O){Rt(this,Fo,O)}},{key:"onRunningChange",set:function(O){Rt(this,vc,O)}},{key:"onNewMeasurementStarted",set:function(O){Rt(this,yc,O)}},{key:"onMeasurementResult",set:function(O){Rt(this,_c,O)}},{key:"onFinished",set:function(O){Rt(this,jo,O)}},{key:"onConnectionError",set:function(O){Rt(this,bc,O)}},{key:"pause",value:function(){clearTimeout(me(this,V)),Ht(this,ae,qe).call(this),Ht(this,$,Be).call(this,!1)}},{key:"play",value:function(){me(this,za)||(Ht(this,$,Be).call(this,!0),Ht(this,se,gt).call(this))}}]),A}(),oe=["measureParallelLatency","parallelLatencyThrottleMs","downloadApiUrl","uploadApiUrl","estimatedServerTime"],Re=new WeakMap,tt=new WeakSet;function rt(A){var O=this;me(this,Re)&&(A?setTimeout(function(){return me(O,Re).play()},20):me(this,Re).pause())}var _e=function(A){Io(F,A);var O=Ao(F);function F(z){var q,ne,de,ge=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},W=ge.measureParallelLatency,te=W!==void 0&&W,K=ge.parallelLatencyThrottleMs,ve=K===void 0?100:K,Te=ge.downloadApiUrl,Fe=ge.uploadApiUrl,at=ge.estimatedServerTime,Se=at===void 0?0:at,We=Ms(ge,oe);return yi(this,F),Wn(_r(de=O.call(this,z,Hn({downloadApiUrl:Te,uploadApiUrl:Fe,estimatedServerTime:Se},We))),tt),Tt(_r(de),Re,{writable:!0,value:void 0}),te&&(Rt(_r(de),Re,new ut([{dir:"down",bytes:0,count:1/0,bypassMinDuration:!0}],{downloadApiUrl:Te,uploadApiUrl:Fe,estimatedServerTime:Se,throttleMs:ve})),me(_r(de),Re).qsParams={during:"".concat(z[0].dir,"load")},Cn((q=_r(de),zr(F.prototype)),"onRunningChange",Ht(_r(de),tt,rt),q,!0),Cn((ne=_r(de),zr(F.prototype)),"onConnectionError",function(){return me(_r(de),Re).pause()},ne,!0)),de}return _i(F,[{key:"latencyResults",get:function(){return me(this,Re)&&me(this,Re).results.down[0].timings}},{key:"onParallelLatencyResult",set:function(z){me(this,Re)&&(me(this,Re).onMeasurementResult=function(q){return z(q)})}},{key:"fetchOptions",get:function(){return fc(zr(F.prototype),"fetchOptions",this)},set:function(z){Cn(zr(F.prototype),"fetchOptions",z,this,!0),me(this,Re)&&(me(this,Re).fetchOptions=z)}},{key:"onRunningChange",set:function(z){var q=this;Cn(zr(F.prototype),"onRunningChange",function(ne){Ht(q,tt,rt).call(q,ne),z(ne)},this,!0)}},{key:"onConnectionError",set:function(z){var q=this;Cn(zr(F.prototype),"onConnectionError",function(){me(q,Re)&&me(q,Re).pause(),z.apply(void 0,arguments)},this,!0)}}]),F}(ut),Ue=["measurementId","logApiUrl"],pt=new WeakMap,Bt=new WeakMap,Wt=new WeakMap,Dt=new WeakMap,Ut=new WeakSet,Ft=new WeakSet;function qt(A){me(this,Dt)&&(Rt(this,Wt,+A.headers.get("cf-meta-request-time")),Rt(this,Bt,A.body.slice(-300).split("___").pop()))}function nr(A){if(me(this,Dt)){var O={type:A.type,bytes:A.bytes,ping:Math.round(A.ping),ttfb:Math.round(A.ttfb),payloadDownloadTime:Math.round(A.payloadDownloadTime),duration:Math.round(A.duration),transferSize:Math.round(A.transferSize),serverTime:Math.round(A.serverTime),token:me(this,Bt),requestTime:me(this,Wt),measId:me(this,pt)};Rt(this,Bt,null),Rt(this,Wt,null),fetch(me(this,Dt),Hn({method:"POST",body:JSON.stringify(O)},this.fetchOptions))}}var Lt=function(A){Io(F,A);var O=Ao(F);function F(z){var q,ne,de,ge,W=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},te=W.measurementId,K=W.logApiUrl,ve=Ms(W,Ue);return yi(this,F),Wn(_r(ge=O.call(this,z,ve)),Ft),Wn(_r(ge),Ut),Tt(_r(ge),pt,{writable:!0,value:void 0}),Tt(_r(ge),Bt,{writable:!0,value:void 0}),Tt(_r(ge),Wt,{writable:!0,value:void 0}),Tt(_r(ge),Dt,{writable:!0,value:void 0}),Rt(_r(ge),pt,te),Rt(_r(ge),Dt,K),Cn((q=_r(ge),zr(F.prototype)),"qsParams",K?{measId:me(_r(ge),pt)}:{},q,!0),Cn((ne=_r(ge),zr(F.prototype)),"responseHook",function(Te){return Ht(_r(ge),Ut,qt).call(_r(ge),Te)},ne,!0),Cn((de=_r(ge),zr(F.prototype)),"onMeasurementResult",function(Te){return Ht(_r(ge),Ft,nr).call(_r(ge),Te)},de,!0),ge}return _i(F,[{key:"qsParams",set:function(z){Cn(zr(F.prototype),"qsParams",me(this,Dt)?Hn({measId:me(this,pt)},z):z,this,!0)}},{key:"responseHook",set:function(z){var q=this;Cn(zr(F.prototype),"responseHook",function(ne){z(ne),Ht(q,Ut,qt).call(q,ne)},this,!0)}},{key:"onMeasurementResult",set:function(z){var q=this;Cn(zr(F.prototype),"onMeasurementResult",function(ne){for(var de=arguments.length,ge=new Array(de>1?de-1:0),W=1;W<de;W++)ge[W-1]=arguments[W];z.apply(void 0,[ne].concat(ge)),Ht(q,Ft,nr).call(q,ne)},this,!0)}}]),F}(_e),dt=new WeakMap,en=new WeakMap,Kr=new WeakMap,ir=new WeakSet,qr=new WeakSet,jr=new WeakSet,on=function(){function A(O){if(yi(this,A),Wn(this,jr),Wn(this,qr),Wn(this,ir),Tt(this,dt,{writable:!0,value:!1}),Tt(this,en,{writable:!0,value:void 0}),Tt(this,Kr,{writable:!0,value:void 0}),!O)throw new Error("Missing operation to perform");Rt(this,Kr,O),this.play()}return _i(A,[{key:"pause",value:function(){Ht(this,jr,In).call(this),Ht(this,ir,pn).call(this,!1)}},{key:"stop",value:function(){this.pause()}},{key:"play",value:function(){me(this,dt)||(Ht(this,ir,pn).call(this,!0),Ht(this,qr,$r).call(this))}}]),A}();function pn(A){A!==me(this,dt)&&Rt(this,dt,A)}function $r(){var A=this,O=Rt(this,en,me(this,Kr).call(this).then(function(){!O._cancel&&Ht(A,qr,$r).call(A)}))}function In(){var A=me(this,en);A&&(A._cancel=!0)}var nt=new WeakMap,mr=function(){function A(){var O=this,F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},z=F.download,q=F.upload;if(yi(this,A),Kt(this,"qsParams",{}),Kt(this,"fetchOptions",{}),Tt(this,nt,{writable:!0,value:[]}),!z&&!q)throw new Error("Missing at least one of download/upload config");[[z,"download"],[q,"upload"]].filter(function(de){return bi(de,1)[0]}).forEach(function(de){var ge=bi(de,2),W=ge[0],te=ge[1],K=W.apiUrl,ve=W.chunkSize;if(!K)throw new Error("Missing ".concat(te," apiUrl argument"));if(!ve)throw new Error("Missing ".concat(te," chunkSize argument"))});var ne=function(de){var ge=de.apiUrl,W=de.qsParams,te=W===void 0?{}:W,K=de.fetchOptions,ve=K===void 0?{}:K;return new on(function(){var Te=Object.assign({},te,O.qsParams),Fe="".concat(ge.startsWith("http")||ge.startsWith("//")?"":window.location.origin).concat(ge,"?").concat(Object.entries(Te).map(function(Se){var We=bi(Se,2),$e=We[0],bt=We[1];return"".concat($e,"=").concat(bt)}).join("&")),at=Object.assign({},ve,O.fetchOptions);return fetch(Fe,at).then(function(Se){if(Se.ok)return Se;throw Error(Se.statusText)}).then(function(Se){return Se.text()})})};z&&me(this,nt).push(ne({apiUrl:z.apiUrl,qsParams:{bytes:"".concat(z.chunkSize)}})),q&&me(this,nt).push(ne({apiUrl:q.apiUrl,fetchOptions:{method:"POST",body:"0".repeat(q.chunkSize)}}))}return _i(A,[{key:"pause",value:function(){me(this,nt).forEach(function(O){return O.pause()})}},{key:"stop",value:function(){this.pause()}},{key:"play",value:function(){me(this,nt).forEach(function(O){return O.play()})}}]),A}(),Vr=["iceServers","acceptIceCandidate","dataChannelCfg"],bn=new WeakMap,ti=new WeakMap,An=new WeakMap,On=new WeakMap,Pn=new WeakMap,Si=function(){function A(){var O=this,F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},z=F.iceServers,q=z===void 0?[]:z,ne=F.acceptIceCandidate,de=ne===void 0?function(Fe){var at=Fe.protocol||"";if(!at&&Fe.candidate){var Se=Fe.candidate.split(" ");Se.length>=3&&(at=Se[2])}return at.toLowerCase()==="udp"}:ne,ge=F.dataChannelCfg,W=ge===void 0?{ordered:!1,maxRetransmits:0}:ge,te=Ms(F,Vr);yi(this,A),Kt(this,"onOpen",function(){}),Kt(this,"onClose",function(){}),Kt(this,"onMessageReceived",function(){}),Tt(this,bn,{writable:!0,value:!1}),Tt(this,ti,{writable:!0,value:void 0}),Tt(this,An,{writable:!0,value:void 0}),Tt(this,On,{writable:!0,value:void 0}),Tt(this,Pn,{writable:!0,value:void 0});var K=new RTCPeerConnection(Hn({iceServers:q},te)),ve=new RTCPeerConnection(Hn({iceServers:q},te)),Te=K.createDataChannel("channel",W);Te.onopen=function(){Rt(O,bn,!0),O.onOpen()},Te.onclose=function(){return O.close()},ve.ondatachannel=function(Fe){var at=Fe.channel;at.onclose=function(){return O.close()},at.onmessage=function(Se){return O.onMessageReceived(Se.data)},Rt(O,Pn,at)},K.onicecandidate=function(Fe){Fe.candidate&&de(Fe.candidate)&&ve.addIceCandidate(Fe.candidate)},ve.onicecandidate=function(Fe){Fe.candidate&&de(Fe.candidate)&&K.addIceCandidate(Fe.candidate)},K.createOffer().then(function(Fe){return K.setLocalDescription(Fe)}).then(function(){return ve.setRemoteDescription(K.localDescription)}).then(function(){return ve.createAnswer()}).then(function(Fe){return ve.setLocalDescription(Fe)}).then(function(){return K.setRemoteDescription(ve.localDescription)}),Rt(this,ti,K),Rt(this,An,ve),Rt(this,On,Te),Rt(this,bn,!1)}return _i(A,[{key:"send",value:function(O){return me(this,On).send(O)}},{key:"close",value:function(){return me(this,ti)&&me(this,ti).close(),me(this,An)&&me(this,An).close(),me(this,On)&&me(this,On).close(),me(this,Pn)&&me(this,Pn).close(),me(this,bn)&&this.onClose(),Rt(this,bn,!1),this}}]),A}(),Sn=new WeakMap,Mn=new WeakMap,wi=new WeakMap,wn=new WeakMap,ri=new WeakMap,zn=new WeakMap,Yi=function(){function A(){var O=this,F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},z=F.turnServerUri,q=F.turnServerCredsApi,ne=F.turnServerCredsApiParser,de=ne===void 0?function(ie){return{turnServerUser:ie.username,turnServerPass:ie.credential}}:ne,ge=F.turnServerCredsApiIncludeCredentials,W=ge!==void 0&&ge,te=F.turnServerUser,K=F.turnServerPass,ve=F.numMsgs,Te=ve===void 0?100:ve,Fe=F.batchSize,at=Fe===void 0?10:Fe,Se=F.batchWaitTime,We=Se===void 0?10:Se,$e=F.responsesWaitTime,bt=$e===void 0?5e3:$e,It=F.connectionTimeout,xe=It===void 0?5e3:It;if(yi(this,A),Tt(this,Sn,{writable:!0,value:function(){}}),Tt(this,Mn,{writable:!0,value:function(){}}),Tt(this,wi,{writable:!0,value:function(){}}),Kt(this,"onMsgSent",function(){}),Kt(this,"onAllMsgsSent",function(){}),Kt(this,"onMsgReceived",function(){}),Tt(this,wn,{writable:!0,value:{}}),Tt(this,ri,{writable:!0,value:void 0}),Tt(this,zn,{writable:!0,value:void 0}),!z)throw new Error("Missing turnServerUri argument");if(!(te&&K||q))throw new Error("Missing either turnServerCredsApi or turnServerUser+turnServerPass arguments");Rt(this,zn,Te),(te&&K?Promise.resolve({turnServerUser:te,turnServerPass:K}):fetch(q,{credentials:W?"include":void 0}).then(function(ie){return ie.json()}).then(function(ie){if(ie.error)throw ie.error;return ie}).then(de)).catch(function(ie){return me(O,Sn).call(O,ie)}).then(function(ie){var _t=ie.turnServerUser,Xt=ie.turnServerPass,Je=Rt(O,ri,new Si({iceServers:[{urls:"turn:".concat(z,"?transport=udp"),username:_t,credential:Xt}],iceTransportPolicy:"relay"})),cr=!1;setTimeout(function(){cr||(Je.close(),me(O,Mn).call(O,"ICE connection timeout!"))},xe);var xr=me(O,wn);Je.onOpen=function(){cr=!0;var Qr=O;(function jt(gr){if(gr<=Te){for(var ln=gr;ln<=Math.min(Te,gr+at-1);)xr[ln]=!1,Je.send(ln),Qr.onMsgSent(ln),ln++;setTimeout(function(){return jt(ln)},We)}else{Qr.onAllMsgsSent(Object.keys(xr).length);var Fr=function(){Je.close(),me(Qr,wi).call(Qr,Qr.results)},hs=setTimeout(Fr,bt),ea=Object.values(me(Qr,wn)).filter(function(Fn){return!Fn}).length;Je.onMessageReceived=function(Fn){clearTimeout(hs),xr[Fn]=!0,Qr.onMsgReceived(Fn),--ea<=0&&Object.values(me(Qr,wn)).every(function(xc){return xc})?Fr():hs=setTimeout(Fr,bt)}}})(1)},Je.onMessageReceived=function(Qr){xr[Qr]=!0,O.onMsgReceived(Qr)}}).catch(function(ie){return me(O,Mn).call(O,ie.toString())})}return _i(A,[{key:"onCredentialsFailure",set:function(O){Rt(this,Sn,O)}},{key:"onConnectionError",set:function(O){Rt(this,Mn,O)}},{key:"onFinished",set:function(O){Rt(this,wi,O)}},{key:"results",get:function(){var O=me(this,zn),F=Object.keys(me(this,wn)).length,z=Object.entries(me(this,wn)).filter(function(q){return!bi(q,2)[1]}).map(function(q){return+bi(q,1)[0]});return{totalMessages:O,numMessagesSent:F,packetLoss:z.length/F,lostMessages:z}}}]),A}(),Ui=["downloadChunkSize","uploadChunkSize","downloadApiUrl","uploadApiUrl"],dr=new WeakMap,ni=function(A){Io(F,A);var O=Ao(F);function F(){var z,q,ne,de,ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},W=ge.downloadChunkSize,te=ge.uploadChunkSize,K=ge.downloadApiUrl,ve=ge.uploadApiUrl,Te=Ms(ge,Ui);return yi(this,F),Tt(_r(de=O.call(this,Te)),dr,{writable:!0,value:void 0}),(W||te)&&(Rt(_r(de),dr,new mr({download:W?{apiUrl:K,chunkSize:W}:null,upload:te?{apiUrl:ve,chunkSize:te}:null})),Cn((z=_r(de),zr(F.prototype)),"onCredentialsFailure",Cn((ne=_r(de),zr(F.prototype)),"onConnectionError",Cn((q=_r(de),zr(F.prototype)),"onFinished",function(){return me(_r(de),dr).stop()},q,!0),ne,!0),z,!0)),de}return _i(F,[{key:"qsParams",set:function(z){me(this,dr)&&(me(this,dr).qsParams=z)}},{key:"fetchOptions",set:function(z){me(this,dr)&&(me(this,dr).fetchOptions=z)}},{key:"onCredentialsFailure",set:function(z){var q=this;Cn(zr(F.prototype),"onCredentialsFailure",function(){z.apply(void 0,arguments),me(q,dr)&&me(q,dr).stop()},this,!0)}},{key:"onConnectionError",set:function(z){var q=this;Cn(zr(F.prototype),"onConnectionError",function(){z.apply(void 0,arguments),me(q,dr)&&me(q,dr).stop()},this,!0)}},{key:"onFinished",set:function(z){var q=this;Cn(zr(F.prototype),"onFinished",function(){z.apply(void 0,arguments),me(q,dr)&&me(q,dr).stop()},this,!0)}}]),F}(Yi),Ln=["reachable"],Kn=_i(function A(O){var F=this,z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},q=z.timeout,ne=q===void 0?-1:q,de=z.fetchOptions,ge=de===void 0?{}:de;yi(this,A),Kt(this,"onFinished",function(){});var W=!1,te=function(K){var ve=K.reachable,Te=Ms(K,Ln);W||(W=!0,F.onFinished(Hn({targetUrl:O,reachable:ve},Te)))};fetch(O,ge).then(function(K){te({reachable:!0,response:K})}).catch(function(K){te({reachable:!1,error:K})}),ne>0&&setTimeout(function(){return te({reachable:!1,error:"Request timeout"})},ne)}),ui=function(A){var O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5;if(!A.length)return 0;var F=A.slice().sort(function(de,ge){return de-ge}),z=(A.length-1)*O,q=z%1;if(q===0)return F[Math.round(z)];var ne=[Math.floor,Math.ceil].map(function(de){return F[de(z)]});return ne[0]+(ne[1]-ne[0])*q},fn=new WeakMap,Nn=new WeakMap,Li=function(){function A(O){var F=this;yi(this,A),Kt(this,"getLatencyPoints",function(z){return z.timings.map(function(q){return q.ping})}),Kt(this,"getLatency",function(z){return ui(F.getLatencyPoints(z),me(F,fn).latencyPercentile)}),Kt(this,"getBandwidthPoints",function(z){return Object.entries(z).map(function(q){var ne=bi(q,2),de=ne[0];return ne[1].timings.map(function(ge){var W=ge.bps,te=ge.duration,K=ge.ping,ve=ge.measTime,Te=ge.serverTime,Fe=ge.transferSize;return{bytes:+de,bps:W,duration:te,ping:K,measTime:ve,serverTime:Te,transferSize:Fe}})}).flat()}),Kt(this,"getBandwidth",function(z){return ui(F.getBandwidthPoints(z).filter(function(q){return q.duration>=me(F,fn).bandwidthMinRequestDuration}).map(function(q){return q.bps}).filter(function(q){return q}),me(F,fn).bandwidthPercentile)}),Kt(this,"getLoadedLatency",function(z){return F.getLatency({timings:me(F,Nn).call(F,z)})}),Kt(this,"getLoadedJitter",function(z){return F.getJitter({timings:me(F,Nn).call(F,z)})}),Kt(this,"getLoadedLatencyPoints",function(z){return F.getLatencyPoints({timings:me(F,Nn).call(F,z)})}),Kt(this,"getPacketLoss",function(z){return z.packetLoss}),Kt(this,"getPacketLossDetails",function(z){return z}),Kt(this,"getReachability",function(z){return!!z.reachable}),Kt(this,"getReachabilityDetails",function(z){return{host:z.host,reachable:z.reachable}}),Tt(this,fn,{writable:!0,value:void 0}),Tt(this,Nn,{writable:!0,value:function(z){return Object.values(z).filter(function(q){return q.timings.length&&Math.min.apply(Math,Ns(q.timings.map(function(ne){return ne.duration})))>=me(F,fn).loadedRequestMinDuration}).map(function(q){return q.sideLatency||[]}).flat().slice(-me(F,fn).loadedLatencyMaxPoints)}}),Rt(this,fn,O)}return _i(A,[{key:"getJitter",value:function(O){var F=this.getLatencyPoints(O);return F.length<2?null:F.reduce(function(z,q){var ne=z.sumDeltas,de=ne===void 0?0:ne,ge=z.prevLatency;return{sumDeltas:de+(ge!==void 0?Math.abs(ge-q):0),prevLatency:q}},{}).sumDeltas/(F.length-1)}}]),A}(),di=Li,Di=["bad","poor","average","good","great"],ii={loadedLatencyIncrease:function(A){return A.latency&&(A.downLoadedLatency||A.upLoadedLatency)?Math.max(A.downLoadedLatency,A.upLoadedLatency)-A.latency:void 0}},qn={packetLoss:0},rn=new WeakMap,mn=function(){function A(O){yi(this,A),Tt(this,rn,{writable:!0,value:void 0}),Rt(this,rn,O)}return _i(A,[{key:"getScores",value:function(O){var F=Object.assign.apply(Object,Ns(Object.entries(me(this,rn).aimMeasurementScoring).map(function(z){var q=bi(z,2),ne=q[0],de=q[1],ge=ii.hasOwnProperty(ne)?ii[ne](O):O[ne];return ge===void 0?qn.hasOwnProperty(ne)?Kt({},ne,qn[ne]):{}:Kt({},ne,ge===void 0?0:+de(ge))})));return Object.assign.apply(Object,[{}].concat(Ns(Object.entries(me(this,rn).aimExperiencesDefs).filter(function(z){return bi(z,2)[1].input.every(function(q){return F.hasOwnProperty(q)})}).map(function(z){var q,ne=bi(z,2),de=ne[0],ge=ne[1],W=ge.input,te=ge.pointThresholds,K=Math.max(0,(q=W.map(function(Te){return F[Te]}),q.reduce(function(Te,Fe){return Te+Fe},0))),ve=an(te,[0,1,2,3,4])(K);return Kt({},de,{points:K,classificationIdx:ve,classificationName:Di[ve]})}))))}}]),A}(),ur=mn,st=new WeakMap,Xe=new WeakMap,Rr=new WeakMap,Tr=new WeakMap,ls=new WeakMap,Fs=new WeakMap,$i=new WeakMap,ws=new WeakMap,Qa=function(){function A(O){var F=this;yi(this,A),Kt(this,"raw",void 0),Kt(this,"getUnloadedLatency",function(){return me(F,Tr).call(F,"getLatency","latency")}),Kt(this,"getUnloadedJitter",function(){return me(F,Tr).call(F,"getJitter","latency")}),Kt(this,"getUnloadedLatencyPoints",function(){return me(F,Tr).call(F,"getLatencyPoints","latency",[])}),Kt(this,"getDownLoadedLatency",function(){return me(F,Tr).call(F,"getLoadedLatency","download")}),Kt(this,"getDownLoadedJitter",function(){return me(F,Tr).call(F,"getLoadedJitter","download")}),Kt(this,"getDownLoadedLatencyPoints",function(){return me(F,Tr).call(F,"getLoadedLatencyPoints","download",[])}),Kt(this,"getUpLoadedLatency",function(){return me(F,Tr).call(F,"getLoadedLatency","upload")}),Kt(this,"getUpLoadedJitter",function(){return me(F,Tr).call(F,"getLoadedJitter","upload")}),Kt(this,"getUpLoadedLatencyPoints",function(){return me(F,Tr).call(F,"getLoadedLatencyPoints","upload",[])}),Kt(this,"getDownloadBandwidth",function(){return me(F,Tr).call(F,"getBandwidth","download")}),Kt(this,"getDownloadBandwidthPoints",function(){return me(F,Tr).call(F,"getBandwidthPoints","download",[])}),Kt(this,"getUploadBandwidth",function(){return me(F,Tr).call(F,"getBandwidth","upload")}),Kt(this,"getUploadBandwidthPoints",function(){return me(F,Tr).call(F,"getBandwidthPoints","upload",[])}),Kt(this,"getPacketLoss",function(){return me(F,Tr).call(F,"getPacketLoss","packetLoss")}),Kt(this,"getPacketLossDetails",function(){return me(F,Tr).call(F,"getPacketLossDetails","packetLoss",void 0,!0)}),Kt(this,"getScores",function(){return me(F,Rr).getScores(F.getSummary())}),Tt(this,st,{writable:!0,value:void 0}),Tt(this,Xe,{writable:!0,value:void 0}),Tt(this,Rr,{writable:!0,value:void 0}),Tt(this,Tr,{writable:!0,value:function(z,q){var ne=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,de=arguments.length>3&&arguments[3]!==void 0&&arguments[3];return F.raw.hasOwnProperty(q)&&F.raw[q].started?de&&F.raw[q].error?{error:F.raw[q].error}:me(F,Xe)[z](F.raw[q].results):ne}}),Tt(this,ls,{writable:!0,value:function(){return me(F,Tr).call(F,"getReachability","v4Reachability")}}),Tt(this,Fs,{writable:!0,value:function(){return me(F,Tr).call(F,"getReachabilityDetails","v4Reachability")}}),Tt(this,$i,{writable:!0,value:function(){return me(F,Tr).call(F,"getReachability","v6Reachability")}}),Tt(this,ws,{writable:!0,value:function(){return me(F,Tr).call(F,"getReachabilityDetails","v6Reachability")}}),Rt(this,st,O),this.clear(),Rt(this,Xe,new di(me(this,st))),Rt(this,Rr,new ur(me(this,st)))}return _i(A,[{key:"isFinished",get:function(){return Object.values(this.raw).every(function(O){return O.finished})}},{key:"clear",value:function(){this.raw=Object.assign.apply(Object,[{}].concat(Ns(Ns(new Set(me(this,st).measurements.map(function(O){return O.type}))).map(function(O){return Kt({},O,{started:!1,finished:!1,results:{}})}))))}},{key:"getSummary",value:function(){var O={download:this.getDownloadBandwidth,upload:this.getUploadBandwidth,latency:this.getUnloadedLatency,jitter:this.getUnloadedJitter,downLoadedLatency:this.getDownLoadedLatency,downLoadedJitter:this.getDownLoadedJitter,upLoadedLatency:this.getUpLoadedLatency,upLoadedJitter:this.getUpLoadedJitter,packetLoss:this.getPacketLoss,v4Reachability:me(this,ls),v6Reachability:me(this,$i)};return Object.assign.apply(Object,Ns(Object.entries(O).map(function(F){var z=bi(F,2),q=z[0],ne=(0,z[1])();return ne===void 0?{}:Kt({},q,ne)})))}}]),A}(),us=Qa,js=function(A){var O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return A&&Math.round(A*Math.pow(10,O))/Math.pow(10,O)},Bs=function(A){return A.map(function(O){return js(O,2)})},ft=function(A){return A.map(function(O){return{bytes:+O.bytes,bps:js(O.bps)}})},Yr={latencyMs:["getUnloadedLatencyPoints",Bs],download:["getDownloadBandwidthPoints",ft],upload:["getUploadBandwidthPoints",ft],downLoadedLatencyMs:["getDownLoadedLatencyPoints",Bs],upLoadedLatencyMs:["getUpLoadedLatencyPoints",Bs],packetLoss:["getPacketLossDetails",function(A){return A.error?void 0:{numMessages:A.numMessagesSent,lossRatio:js(A.packetLoss,4)}}]},Js=function(A,O){var F=O.apiUrl,z={};Object.entries(Yr).forEach(function(ne){var de=bi(ne,2),ge=de[0],W=bi(de[1],2),te=W[0],K=W[1],ve=K===void 0?function(Fe){return Fe}:K,Te=A[te]();Te&&(z[ge]=ve(Te))});var q=A.getScores();q&&(z.scores=Object.assign.apply(Object,[{}].concat(Ns(Object.entries(q).map(function(ne){var de,ge=bi(ne,2),W=ge[0],te=ge[1];return Kt({},W,{points:(de=te).points,classification:de.classificationName})}))))),fetch(F,{method:"POST",body:JSON.stringify(z)})},Uo=["type"],Xa=["numPackets"],Ja=["bytes"],$o=["latency","latencyUnderLoad","download","upload"],Ec=function(){return"".concat(Math.round(1e16*Math.random()))},Vo=new WeakMap,Zs=new WeakMap,cn=new WeakMap,Za=new WeakMap,et=new WeakMap,Ii=new WeakMap,Rc=new WeakMap,Ku=new WeakMap,qu=new WeakMap,eo=new WeakMap,Yu=new WeakMap,Ll=new WeakSet,up=new WeakSet,Dl=new WeakSet,Go=new WeakSet,Yg=new WeakSet,Qg=new WeakSet,ds=new WeakSet,pw=function(){function A(){var O=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};yi(this,A),Wn(this,ds),Wn(this,Qg),Wn(this,Yg),Wn(this,Go),Wn(this,Dl),Wn(this,up),Wn(this,Ll),Kt(this,"onRunningChange",function(){}),Kt(this,"onResultsChange",function(){}),Tt(this,Vo,{writable:!0,value:function(){}}),Tt(this,Zs,{writable:!0,value:function(){}}),Tt(this,cn,{writable:!0,value:void 0}),Tt(this,Za,{writable:!0,value:void 0}),Tt(this,et,{writable:!0,value:Ec()}),Tt(this,Ii,{writable:!0,value:-1}),Tt(this,Rc,{writable:!0,value:void 0}),Tt(this,Ku,{writable:!0,value:1e6}),Tt(this,qu,{writable:!0,value:1e6}),Tt(this,eo,{writable:!0,value:!1}),Tt(this,Yu,{writable:!0,value:!1}),Rt(this,cn,Object.assign({},Cl,O,Pl)),Rt(this,Za,new us(me(this,cn))),me(this,cn).autoStart&&this.play()}return _i(A,[{key:"results",get:function(){return me(this,Za)}},{key:"isRunning",get:function(){return me(this,eo)}},{key:"isFinished",get:function(){return me(this,Yu)}},{key:"onFinish",set:function(O){Rt(this,Vo,O)}},{key:"onError",set:function(O){Rt(this,Zs,O)}},{key:"pause",value:function(){$o.includes(Ht(this,Dl,Xu).call(this))&&me(this,Rc).pause(),Ht(this,Ll,Qu).call(this,!1)}},{key:"play",value:function(){me(this,eo)||(Ht(this,Ll,Qu).call(this,!0),Ht(this,ds,Es).call(this))}},{key:"restart",value:function(){Ht(this,Yg,fw).call(this),this.play()}}]),A}();function Qu(A){A!==me(this,eo)&&(Rt(this,eo,A),this.onRunningChange(me(this,eo)))}function Xg(A){var O=this;A!==me(this,Yu)&&(Rt(this,Yu,A),A&&setTimeout(function(){return me(O,Vo).call(O,O.results)}))}function Xu(){return me(this,Ii)<0||me(this,Ii)>=me(this,cn).measurements.length?null:me(this,cn).measurements[me(this,Ii)].type}function Tc(){return me(this,Za).raw[Ht(this,Dl,Xu).call(this)]||void 0}function fw(){Ht(this,Qg,mw).call(this),Rt(this,et,Ec()),Rt(this,Ii,-1),Rt(this,Rc,void 0),Ht(this,Ll,Qu).call(this,!1),Ht(this,up,Xg).call(this,!1),me(this,Za).clear()}function mw(){var A=me(this,Rc);A&&(A.onFinished=A.onConnectionError=A.onFail=A.onMsgReceived=A.onCredentialsFailure=A.onMeasurementResult=function(){},$o.includes(Ht(this,Dl,Xu).call(this))&&A.pause())}function Es(){var A,O=this;if(!($o.includes(Ht(this,Dl,Xu).call(this))&&Ht(this,Go,Tc).call(this)&&Ht(this,Go,Tc).call(this).started)||Ht(this,Go,Tc).call(this).finished||Ht(this,Go,Tc).call(this).finishedCurrentRound||Ht(this,Go,Tc).call(this).error){if(Rt(this,Ii,(A=me(this,Ii),++A)),me(this,Ii)>=me(this,cn).measurements.length)return Ht(this,Ll,Qu).call(this,!1),void Ht(this,up,Xg).call(this,!0);var F,z=me(this,cn).measurements[me(this,Ii)],q=z.type,ne=Ms(z,Uo),de=Ht(this,Go,Tc).call(this),ge=me(this,cn),W=ge.downloadApiUrl,te=ge.uploadApiUrl,K=ge.estimatedServerTime;switch(q){case"v4Reachability":case"v6Reachability":(F=new Kn("https://".concat(ne.host),{fetchOptions:{method:"GET",mode:"no-cors"}})).onFinished=function(xe){de.finished=!0,de.results=Hn({host:ne.host},xe),O.onResultsChange({type:q}),Ht(O,ds,Es).call(O)};break;case"rpki":(F=new Kn("https://".concat(me(this,cn).rpkiInvalidHost),{timeout:5e3})).onFinished=function(xe){(xe.response?xe.response.json():Promise.resolve()).then(function(ie){de.finished=!0,de.results=Hn({host:me(O,cn).rpkiInvalidHost,filteringInvalids:!xe.reachable},ie?{asn:ie.asn,name:ie.name}:{}),O.onResultsChange({type:q}),Ht(O,ds,Es).call(O)})};break;case"nxdomain":(F=new Kn("https://".concat(ne.nxhost),{fetchOptions:{mode:"no-cors"}})).onFinished=function(xe){de.finished=!0,de.results={host:ne.nxhost,reachable:xe.reachable},O.onResultsChange({type:q}),Ht(O,ds,Es).call(O)};break;case"packetLoss":case"packetLossUnderLoad":de.finished=!1;var ve=ne.numPackets,Te=Ms(ne,Xa),Fe=me(this,cn),at=Fe.turnServerUri,Se=Fe.turnServerCredsApiUrl,We=Fe.turnServerUser,$e=Fe.turnServerPass,bt=Fe.includeCredentials;(F=new ni(Hn({turnServerUri:at,turnServerCredsApi:Se,turnServerCredsApiIncludeCredentials:bt,turnServerUser:We,turnServerPass:$e,numMsgs:ve,downloadChunkSize:ne.loadDown?me(this,Ku):void 0,uploadChunkSize:ne.loadUp?me(this,qu):void 0,downloadApiUrl:W,uploadApiUrl:te},Te))).onMsgReceived=function(){de.results=Object.assign({},F.results),O.onResultsChange({type:q})},F.onFinished=function(){de.finished=!0,O.onResultsChange({type:q}),Ht(O,ds,Es).call(O)},F.onConnectionError=function(xe){de.error=xe,O.onResultsChange({type:q}),me(O,Zs).call(O,"Connection error while measuring packet loss: ".concat(xe)),Ht(O,ds,Es).call(O)},F.onCredentialsFailure=function(){de.error="unable to get turn server credentials",O.onResultsChange({type:q}),me(O,Zs).call(O,"Error while measuring packet loss: unable to get turn server credentials."),Ht(O,ds,Es).call(O)};break;case"latency":case"latencyUnderLoad":de.finished=!1,(F=new Lt([{dir:"down",bytes:0,count:ne.numPackets,bypassMinDuration:!0}],{downloadApiUrl:W,uploadApiUrl:te,estimatedServerTime:K,logApiUrl:me(this,cn).logMeasurementApiUrl,measurementId:me(this,et),downloadChunkSize:ne.loadDown?me(this,Ku):void 0,uploadChunkSize:ne.loadUp?me(this,qu):void 0})).fetchOptions={credentials:me(this,cn).includeCredentials?"include":void 0},F.onMeasurementResult=F.onNewMeasurementStarted=function(xe,ie){de.results=Object.assign({},ie.down[0]),O.onResultsChange({type:q})},F.onFinished=function(){de.finished=!0,O.onResultsChange({type:q}),me(O,eo)&&Ht(O,ds,Es).call(O)},F.onConnectionError=function(xe){de.error=xe,O.onResultsChange({type:q}),me(O,Zs).call(O,"Connection error while measuring latency: ".concat(xe)),Ht(O,ds,Es).call(O)},F.play();break;case"download":case"upload":if(de.finished||de.error)Ht(this,ds,Es).call(this);else{delete de.finishedCurrentRound;var It=me(this,cn)["measure".concat(q==="download"?"Down":"Up","loadLoadedLatency")];(F=new Lt([Hn({dir:q==="download"?"down":"up"},ne)],{downloadApiUrl:W,uploadApiUrl:te,estimatedServerTime:K,logApiUrl:me(this,cn).logMeasurementApiUrl,measurementId:me(this,et),measureParallelLatency:It,parallelLatencyThrottleMs:me(this,cn).loadedLatencyThrottle})).fetchOptions={credentials:me(this,cn).includeCredentials?"include":void 0},F.finishRequestDuration=me(this,cn).bandwidthFinishRequestDuration,F.onNewMeasurementStarted=function(xe){var ie=xe.count,_t=xe.bytes,Xt=de.results=Object.assign({},de.results);!Xt.hasOwnProperty(_t)&&(Xt[_t]={timings:[],numMeasurements:0,sideLatency:It?[]:void 0}),Xt[_t].numMeasurements-Xt[_t].timings.length!==ie&&(Xt[_t].numMeasurements+=ie,O.onResultsChange({type:q}))},F.onMeasurementResult=function(xe){var ie=xe.bytes,_t=Ms(xe,Ja);de.results[ie].timings.push(_t),de.results=Object.assign({},de.results),O.onResultsChange({type:q})},F.onParallelLatencyResult=function(xe){de.results[ne.bytes].sideLatency.push(xe),de.results=Object.assign({},de.results),O.onResultsChange({type:q})},F.onFinished=function(xe){var ie=!me(O,cn).measurements.slice(me(O,Ii)+1).map(function(Je){return Je.type}).includes(q),_t=Math.min.apply(Math,Ns(Object.values(q==="download"?xe.down:xe.up).slice(-1)[0].timings.map(function(Je){return Je.duration})));if(ie||!ne.bypassMinDuration&&_t>me(O,cn).bandwidthFinishRequestDuration){de.finished=!0,O.onResultsChange({type:q});var Xt=.5*Object.keys(de.results).map(function(Je){return+Je}).sort(function(Je,cr){return cr-Je})[0];q==="download"&&Rt(O,Ku,Xt),q==="upload"&&Rt(O,qu,Xt)}else de.finishedCurrentRound=!0;me(O,eo)&&Ht(O,ds,Es).call(O)},F.onConnectionError=function(xe){de.error=xe,O.onResultsChange({type:q}),me(O,Zs).call(O,"Connection error while measuring ".concat(q,": ").concat(xe)),Ht(O,ds,Es).call(O)},F.play()}}Rt(this,Rc,F),de.started=!0,this.onResultsChange({type:q})}else me(this,Rc).play()}var Ju=new WeakMap,dp=new WeakMap,gw=function(A){Io(F,A);var O=Ao(F);function F(z){var q,ne;yi(this,F);for(var de=arguments.length,ge=new Array(de>1?de-1:0),W=1;W<de;W++)ge[W-1]=arguments[W];return Tt(_r(ne=O.call.apply(O,[this,z].concat(ge))),Ju,{writable:!0,value:void 0}),Tt(_r(ne),dp,{writable:!0,value:function(te){me(_r(ne),Ju)&&Js(te,{apiUrl:me(_r(ne),Ju)})}}),Cn((q=_r(ne),zr(F.prototype)),"onFinish",me(_r(ne),dp),q,!0),Rt(_r(ne),Ju,Object.assign({},Cl,z,Pl).logAimApiUrl),ne}return _i(F,[{key:"onFinish",set:function(z){var q=this;Cn(zr(F.prototype),"onFinish",function(ne){z(ne),me(q,dp).call(q,ne)},this,!0)}}]),F}(pw);function Jg(A,O){var F=typeof Symbol<"u"&&A[Symbol.iterator]||A["@@iterator"];if(!F){if(Array.isArray(A)||(F=function(W,te){if(W){if(typeof W=="string")return Zg(W,te);var K=Object.prototype.toString.call(W).slice(8,-1);if(K==="Object"&&W.constructor&&(K=W.constructor.name),K==="Map"||K==="Set")return Array.from(W);if(K==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(K))return Zg(W,te)}}(A))||O){F&&(A=F);var z=0,q=function(){};return{s:q,n:function(){return z>=A.length?{done:!0}:{done:!1,value:A[z++]}},e:function(W){throw W},f:q}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var ne,de=!0,ge=!1;return{s:function(){F=F.call(A)},n:function(){var W=F.next();return de=W.done,W},e:function(W){ge=!0,ne=W},f:function(){try{de||F.return==null||F.return()}finally{if(ge)throw ne}}}}function Zg(A,O){(O==null||O>A.length)&&(O=A.length);for(var F=0,z=new Array(O);F<O;F++)z[F]=A[F];return z}var vw=[T],e0=!1,Il=function(){return(0,f.A)(function K(){(0,h.A)(this,K)},null,[{key:"config",value:function(K){if(!K)throw new Error("'token' is empty, please provide it in config");this.apiKey=K;var ve=b(Jr,void 0,v.apply(void 0,vw));window.STORE=ve,Qt.default.init({store:ve})}},{key:"getCameras",value:(te=(0,u.A)(d().mark(function K(){var ve,Te,Fe,at;return d().wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:if(Se.prev=0,ve=navigator.userAgent.includes("Firefox"),Te=[],!ve){Se.next=8;break}return Se.next=6,new Promise(function(We,$e){navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then((0,u.A)(d().mark(function bt(){var It;return d().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:return xe.next=2,navigator.mediaDevices.enumerateDevices();case 2:It=xe.sent,Te=It.filter(function(ie){return ie.kind==="videoinput"}).map(function(ie){return new Ha(ie.deviceId,ie.groupId,ie.kind,ie.label)}),We(Te);case 5:case"end":return xe.stop()}},bt)}))).catch(function(bt){console.error("Error in getCameras()",bt),$e(bt)})});case 6:Se.next=12;break;case 8:return Se.next=10,navigator.mediaDevices.enumerateDevices();case 10:Fe=Se.sent,Te=Fe.filter(function(We){return We.kind==="videoinput"}).map(function(We){return new Ha(We.deviceId,We.groupId,We.kind,We.label)});case 12:return Se.abrupt("return",Te);case 15:Se.prev=15,Se.t0=Se.catch(0),at=Se.t0.message,Se.t0 instanceof TypeError&&Se.t0.name==="TypeError"&&(at=er.q.ERROR_CAMERA_ACCESS_UNAVAILABLE.message),console.error("An error occurred in getCameras(), ".concat(at));case 20:case"end":return Se.stop()}},K,null,[[0,15]])})),function(){return te.apply(this,arguments)})},{key:"getMicrophones",value:(W=(0,u.A)(d().mark(function K(){var ve,Te,Fe,at;return d().wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:if(Se.prev=0,ve=navigator.userAgent.includes("Firefox"),Te=[],!ve){Se.next=8;break}return Se.next=6,new Promise(function(We,$e){navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((0,u.A)(d().mark(function bt(){var It;return d().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:return xe.next=2,navigator.mediaDevices.enumerateDevices();case 2:It=xe.sent,Te=It.filter(function(ie){return ie.kind==="audioinput"}).map(function(ie){return new Wa(ie.deviceId,ie.groupId,ie.kind,ie.label)}),We(Te);case 5:case"end":return xe.stop()}},bt)}))).catch(function(bt){console.error("Error in getMicrophones()",bt),$e(bt)})});case 6:Se.next=12;break;case 8:return Se.next=10,navigator.mediaDevices.enumerateDevices();case 10:Fe=Se.sent,Te=Fe.filter(function(We){return We.kind==="audioinput"}).map(function(We){return new Wa(We.deviceId,We.groupId,We.kind,We.label)});case 12:return Se.abrupt("return",Te);case 15:Se.prev=15,Se.t0=Se.catch(0),at=Se.t0.message,Se.t0 instanceof TypeError&&Se.t0.name==="TypeError"&&(at=er.q.ERROR_MICROPHONE_ACCESS_UNAVAILABLE.message),console.error("An error occurred in getMicrophones(), ".concat(at));case 20:case"end":return Se.stop()}},K,null,[[0,15]])})),function(){return W.apply(this,arguments)})},{key:"getPlaybackDevices",value:(ge=(0,u.A)(d().mark(function K(){var ve,Te,Fe,at;return d().wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:if(Se.prev=0,ve=navigator.userAgent.includes("Firefox"),Te=[],!ve){Se.next=8;break}return Se.next=6,new Promise(function(We,$e){navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((0,u.A)(d().mark(function bt(){var It;return d().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:return xe.next=2,navigator.mediaDevices.enumerateDevices();case 2:It=xe.sent,Te=It.filter(function(ie){return ie.kind==="audiooutput"}).map(function(ie){return new Po(ie.deviceId,ie.groupId,ie.kind,ie.label)}),We(Te);case 5:case"end":return xe.stop()}},bt)}))).catch(function(bt){console.error("Error in getPlaybackDevices()",bt),$e(bt)})});case 6:Se.next=12;break;case 8:return Se.next=10,navigator.mediaDevices.enumerateDevices();case 10:Fe=Se.sent,Te=Fe.filter(function(We){return We.kind==="audiooutput"}).map(function(We){return new Po(We.deviceId,We.groupId,We.kind,We.label)});case 12:return Se.abrupt("return",Te);case 15:Se.prev=15,Se.t0=Se.catch(0),at=Se.t0.message,Se.t0 instanceof TypeError&&Se.t0.name==="TypeError"&&(at="Playback device access unavailable: Please ensure your device is compatible and that you're on a secure website (https://)"),console.error("An error occurred in getPlaybackDevices(), ".concat(at));case 20:case"end":return Se.stop()}},K,null,[[0,15]])})),function(){return ge.apply(this,arguments)})},{key:"getDevices",value:(de=(0,u.A)(d().mark(function K(){var ve,Te,Fe,at,Se,We;return d().wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:return $e.prev=0,$e.next=3,navigator.mediaDevices.enumerateDevices();case 3:ve=$e.sent,Te=[],Fe=Jg(ve);try{for(Fe.s();!(at=Fe.n()).done;)Se=at.value,Te.push(new Xs(Se.deviceId,Se.groupId,Se.kind,Se.label))}catch(bt){Fe.e(bt)}finally{Fe.f()}return $e.abrupt("return",Te);case 10:$e.prev=10,$e.t0=$e.catch(0),We=$e.t0.message,$e.t0 instanceof TypeError&&(We=$e.t0.name==="TypeError"?"Could not access devices : Please ensure your devices is compatible and that you're on a secure website (https://)":$e.t0.message),console.error("An error occurred in getDevices(), ".concat(We));case 15:case"end":return $e.stop()}},K,null,[[0,10]])})),function(){return de.apply(this,arguments)})},{key:"on",value:function(K,ve){if(K!=="device-changed")throw new Error("Unsupported event type");this.addDeviceChangeEvent(),this.eventEmitter.on(K,ve)}},{key:"addDeviceChangeEvent",value:function(){var K=this;if(!e0){this.getDevices().then(function(Te){K.devices=Te});try{navigator.mediaDevices.addEventListener("devicechange",function(){var Te=(0,u.A)(d().mark(function Fe(at){var Se,We,$e,bt,It;return d().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:return Se=K.devices,xe.next=3,K.getDevices();case 3:K.devices=xe.sent,We=new Array,$e=Jg(K.devices),xe.prev=6,It=d().mark(function ie(){var _t;return d().wrap(function(Xt){for(;;)switch(Xt.prev=Xt.next){case 0:_t=bt.value,Se.filter(function(Je){return Je.deviceId==_t.deviceId&&Je.kind==_t.kind}).length==0?We.push(_t):Se=Se.filter(function(Je){return!(Je.deviceId==_t.deviceId&&Je.kind==_t.kind)});case 3:case"end":return Xt.stop()}},ie)}),$e.s();case 9:if((bt=$e.n()).done){xe.next=13;break}return xe.delegateYield(It(),"t0",11);case 11:xe.next=9;break;case 13:xe.next=18;break;case 15:xe.prev=15,xe.t1=xe.catch(6),$e.e(xe.t1);case 18:return xe.prev=18,$e.f(),xe.finish(18);case 21:We.length!=0&&K.eventEmitter.emit("device-changed",{devices:K.devices}),Se.length!=0&&K.eventEmitter.emit("device-changed",{devices:K.devices});case 23:case"end":return xe.stop()}},Fe,null,[[6,15,18,21]])}));return function(Fe){return Te.apply(this,arguments)}}()),e0=!0}catch(Te){var ve=Te.message;Te instanceof TypeError&&(ve=Te.name==="TypeError"?"Could not access devices : Please ensure your devices is compatible and that you're on a secure website (https://)":Te.message),console.error("An error occurred in device-change event, ".concat(ve))}}}},{key:"off",value:function(K,ve){if(K!=="device-changed")throw new Error("Unsupported event type");this.eventEmitter.off(K,ve)}},{key:"checkPermissions",value:(ne=(0,u.A)(d().mark(function K(ve){var Te,Fe,at,Se,We;return d().wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:if(ve||(ve=Vn.AUDIO_AND_VIDEO),Te=new Map,!ve.includes(Vn.AUDIO)&&!ve.includes(Vn.AUDIO_AND_VIDEO)){$e.next=15;break}return Fe=!0,$e.prev=4,$e.next=7,navigator.permissions.query({name:"microphone"});case 7:(at=$e.sent).state!="prompt"&&at.state!="denied"||(Fe=!1),$e.next=14;break;case 11:throw $e.prev=11,$e.t0=$e.catch(4),Error("Browser does not support microphone permission check");case 14:Te.set(Vn.AUDIO,Fe);case 15:if(!ve.includes(Vn.VIDEO)&&!ve.includes(Vn.AUDIO_AND_VIDEO)){$e.next=28;break}return Se=!0,$e.prev=17,$e.next=20,navigator.permissions.query({name:"camera"});case 20:(We=$e.sent).state!="prompt"&&We.state!="denied"||(Se=!1),$e.next=27;break;case 24:throw $e.prev=24,$e.t1=$e.catch(17),Error("Browser does not support camera permission check");case 27:Te.set(Vn.VIDEO,Se);case 28:return $e.abrupt("return",Te);case 29:case"end":return $e.stop()}},K,null,[[4,11],[17,24]])})),function(K){return ne.apply(this,arguments)})},{key:"requestPermission",value:(q=(0,u.A)(d().mark(function K(ve){var Te,Fe,at,Se,We,$e,bt,It,xe;return d().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(ve||(ve=Vn.AUDIO_AND_VIDEO),Te=new Map,!ve.includes(Vn.VIDEO)&&!ve.includes(Vn.AUDIO_AND_VIDEO)){ie.next=32;break}return at={audio:!1,video:!0},Se=!0,ie.prev=5,ie.next=8,navigator.mediaDevices.getUserMedia(at);case 8:Fe=ie.sent,ie.next=30;break;case 11:if(ie.prev=11,ie.t0=ie.catch(5),!(ie.t0 instanceof DOMException)){ie.next=27;break}ie.t1=ie.t0.name,ie.next=ie.t1==="NotAllowedError"?17:ie.t1==="NotReadableError"?19:ie.t1==="NotFoundError"?21:24;break;case 17:return ie.t0.message==="Permission denied by system"&&(We=er.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS.message),ie.abrupt("break",25);case 19:return We=Zu(ie.t0,"video"),ie.abrupt("break",25);case 21:return We=er.q.ERROR_CAMERA_NOT_FOUND.message,navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Firefox")!=-1&&(We=er.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS.message),ie.abrupt("break",25);case 24:We=ie.t0.message;case 25:ie.next=28;break;case 27:We=ie.t0 instanceof TypeError&&ie.t0.name==="TypeError"?er.q.ERROR_CAMERA_ACCESS_UNAVAILABLE.message:ie.t0.message;case 28:Se=!1,We&&console.error("An error occurred in request permission, ".concat(We));case 30:Fe&&Fe.getTracks().forEach(function(_t){_t.stop()}),Te.set(Vn.VIDEO,Se);case 32:if(!ve.includes(Vn.AUDIO)&&!ve.includes(Vn.AUDIO_AND_VIDEO)){ie.next=62;break}return bt={audio:!0,video:!1},It=!0,ie.prev=35,ie.next=38,navigator.mediaDevices.getUserMedia(bt);case 38:$e=ie.sent,ie.next=60;break;case 41:if(ie.prev=41,ie.t2=ie.catch(35),!(ie.t2 instanceof DOMException)){ie.next=57;break}ie.t3=ie.t2.name,ie.next=ie.t3==="NotAllowedError"?47:ie.t3==="NotReadableError"?49:ie.t3==="NotFoundError"?51:54;break;case 47:return ie.t2.message==="Permission denied by system"&&(xe=er.q.ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS.message),ie.abrupt("break",55);case 49:return xe=Zu(ie.t2,"audio"),ie.abrupt("break",55);case 51:return xe=er.q.ERROR_MICROPHONE_NOT_FOUND.message,navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Firefox")!=-1&&(xe=er.q.ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS.message),ie.abrupt("break",55);case 54:xe=ie.t2.message;case 55:ie.next=58;break;case 57:xe=ie.t2 instanceof TypeError&&ie.t2.name==="TypeError"?er.q.ERROR_MICROPHONE_ACCESS_UNAVAILABLE.message:ie.t2.message;case 58:It=!1,xe&&console.error("An error occurred in request permission, ".concat(xe));case 60:$e&&$e.getTracks().forEach(function(_t){_t.stop()}),Te.set(Vn.AUDIO,It);case 62:return ie.abrupt("return",Te);case 63:case"end":return ie.stop()}},K,null,[[5,11],[35,41]])})),function(K){return q.apply(this,arguments)})},{key:"isInt",value:function(K){return typeof K=="number"&&K%1==0}},{key:"getNetworkStats",value:(z=(0,u.A)(d().mark(function K(){var ve,Te,Fe,at=arguments;return d().wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:return(ve=(at.length>0&&at[0]!==void 0?at[0]:{}).timeoutDuration)&&this.isInt(ve)||(ve=6e4),Te=new Promise(function(We,$e){setTimeout(function(){$e("Not able to get NetworkStats due to timeout")},ve)}),Fe=new Promise(function(We,$e){if(navigator.onLine){var bt=new gw({measureDownloadLoadedLatency:!1,measureUploadLoadedLatency:!1,measurements:[{type:"upload",bytes:3e6,count:1,bypassMinDuration:!0},{type:"download",bytes:3e6,count:1,bypassMinDuration:!0}]});bt.isRunning?(bt.onFinish=function(It){We({downloadSpeed:parseFloat(Number(It.getDownloadBandwidth()/1048576).toFixed(2)),uploadSpeed:parseFloat(Number(It.getUploadBandwidth()/1048576).toFixed(2))})},bt.onError=function(It){$e("Not able to get NetworkStats")}):$e("Not able to get NetworkStats")}else $e("Not able to get NetworkStats due to no Network")}),Se.abrupt("return",Promise.race([Fe,Te]));case 5:case"end":return Se.stop()}},K,this)})),function(){return z.apply(this,arguments)})},{key:"analytics",value:function(K){var ve,Te,Fe;!K&&navigator&&navigator.userAgent&&(Te=navigator.userAgent,delete(Fe=E().parse(Te)).engine);try{var at;(at=K)!==null&&at!==void 0&&at.browserUserAgent||(Te=navigator.userAgent,delete(Fe=E().parse(Te)).engine)}catch{}K&&K.rawUserAgent&&(Te=K.rawUserAgent,delete(Fe=E().parse(Te)).engine),K||(K={});var Se={};Se.sdkType=K.sdkType||"javascript",Se.sdkVersion=K.sdkVersion||"0.0.83",Se.platform=K.platform||((ve=Fe)===null||ve===void 0||(ve=ve.platform)===null||ve===void 0?void 0:ve.type)||"",K.browserUserAgent=="null"?Se.browserUserAgent=void 0:Se.browserUserAgent=Fe,K.deviceUserAgent&&(Se.deviceUserAgent=K.deviceUserAgent),this._deviceInfo=Se}},{key:"initMeeting",value:function(K){var ve,Te=K.meetingId,Fe=K.customCameraVideoTrack,at=Fe===void 0?void 0:Fe,Se=K.customMicrophoneAudioTrack,We=Se===void 0?void 0:Se,$e=K.autoConsume,bt=$e===void 0||$e,It=K.preferredProtocol,xe=K.mode,ie=K.multiStream,_t=ie===void 0||ie,Xt=K.participantId,Je=K.name,cr=K.micEnabled,xr=K.webcamEnabled,Qr=K.maxResolution,jt=K.metaData,gr=K.chatEnabled,ln=K.useSpartialLayerAnalytics,Fr=K.signalingBaseUrl,hs=K.defaultCamera,ea=K.debugMode,Fn=ea===void 0||ea;if(!Te)throw new Error("'meetingId' is empty, please verify it or generate new meetingId using the API.");var xc=Xt?Xt.toString():I()({length:8}).toLowerCase(),Al=Je||I()({length:6}).toLowerCase();switch(this._deviceInfo||this.analytics(),typeof It!="string"&&(It="UDP_OVER_TCP"),(ve=It)===null||ve===void 0?void 0:ve.toUpperCase()){case"UDP_ONLY":case"UDP_OVER_TCP":case"TCP_ONLY":It=It.toUpperCase();break;default:It="UDP_OVER_TCP"}if(xe||(xe=ei.n.CONFERENCE),xe!==ei.n.CONFERENCE&&xe!==ei.n.VIEWER)throw new Error('"mode" can only be either '.concat(ei.n.CONFERENCE," or ").concat(ei.n.VIEWER));if(jt!=null&&(0,l.A)(jt)!="object")throw new Error('"metaData" can only be object.');var ed=this._deviceInfo.sdkType==="react-native",_w=ed?hs?hs==="front"?1:0:at?at.getVideoTracks()[0].getConstraints().facingMode==="user"?1:0:ed?1:0:0,r0=new Qt.default({roomId:Te,peerId:xc,secret:this.apiKey,device:"unknown",displayName:Al,mode:xe,useSimulcast:_t,produce:!0,consume:!0,useSharingSimulcast:!0,datachannel:gr!==!1,micEnabled:cr!==!1,webcamEnabled:xr!==!1,maxResolution:Qr||"hd",useSpartialLayerAnalytics:ln,_deviceInfo:this._deviceInfo,customCameraVideoTrack:at,customMicrophoneAudioTrack:We,autoConsume:bt,preferredProtocol:It,signalingBaseUrl:Fr,metaData:jt,defaultCameraIndex:_w,debugMode:Fn});Qe.roomClient=r0;var bw=new ke({id:xc,displayName:Al,local:!0,mode:xe,metaData:jt});return new hn(Te,bw,r0)}},{key:"createCameraVideoTrack",value:(F=(0,u.A)(d().mark(function K(ve){var Te,Fe,at,Se,We,$e,bt,It,xe,ie,_t,Xt,Je,cr,xr,Qr;return d().wrap(function(jt){for(;;)switch(jt.prev=jt.next){case 0:if(Te=ve.cameraId,Fe=Te===void 0?void 0:Te,at=ve.encoderConfig,Se=at===void 0?void 0:at,We=ve.facingMode,$e=We===void 0?void 0:We,bt=ve.optimizationMode,It=bt===void 0?void 0:bt,xe=ve.multiStream,ie=xe===void 0||xe,!Fe){jt.next=6;break}return jt.next=4,this.getCameras();case 4:(_t=jt.sent)&&_t.some(function(gr){return gr.deviceId})&&(_t.some(function(gr){return gr.deviceId===Fe})||console.error("No camera device found for the given cameraId, please check the passed cameraId. The default camera will be used instead."));case 6:return jt.prev=6,Xt=Se?Pi.$.videoProfiles[Se]:Pi.$.videoProfiles.h360p_w640p,Je={video:{deviceId:Fe||void 0,facingMode:$e||void 0,width:Xt.width,height:Xt.height,frameRate:Xt.frameRate}},jt.next=11,(0,qi.lp)(Je);case 11:return cr=jt.sent,It&&(cr.contentHint=It),cr.encoderConfig=Se||"h360p_w640p",cr.contentHint=It||"",cr.multiStream=ie,cr.cameraId=Fe,jt.abrupt("return",cr);case 20:if(jt.prev=20,jt.t0=jt.catch(6),jt.t0.name!=="SecurityError"){jt.next=26;break}xr=er.q.ERROR_RN_CAMERA_ACCESS_DENIED_OR_DISMISSED.message,jt.next=46;break;case 26:if(jt.t0.name!=="DOMException"){jt.next=30;break}xr=er.q.ERROR_RN_CAMERA_NOT_FOUND.message,jt.next=46;break;case 30:if(!(jt.t0 instanceof DOMException)){jt.next=45;break}jt.t1=jt.t0.name,jt.next=jt.t1==="NotAllowedError"?34:jt.t1==="NotReadableError"?36:jt.t1==="NotFoundError"?38:41;break;case 34:return xr=t0(jt.t0,"video"),jt.abrupt("break",43);case 36:return xr=Zu(jt.t0,"video"),jt.abrupt("break",43);case 38:return xr=er.q.ERROR_CAMERA_NOT_FOUND.message,navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Firefox")!=-1&&(xr=er.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS.message),jt.abrupt("break",43);case 41:return xr=jt.t0.message,jt.abrupt("break",43);case 43:jt.next=46;break;case 45:jt.t0.message=="getUserMedia is not implemented in this browser"?(Qr=er.q.ERROR_CAMERA_ACCESS_UNAVAILABLE,xr=Qr.message):xr=jt.t0.message;case 46:console.error("An error occurred in creating video track, ".concat(xr));case 47:case"end":return jt.stop()}},K,this,[[6,20]])})),function(K){return F.apply(this,arguments)})},{key:"createScreenShareVideoTrack",value:(O=(0,u.A)(d().mark(function K(ve){var Te,Fe,at,Se,We,$e,bt,It,xe;return d().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return Te=ve.encoderConfig,Fe=Te===void 0?void 0:Te,at=ve.optimizationMode,Se=at===void 0?void 0:at,We=ve.withAudio,$e=We===void 0?"enable":We,bt=Fe?Pi.$.screenShareProfiles[Fe]:Pi.$.screenShareProfiles.h720p_15fps,It={audio:$e==="enable",video:{width:bt.width,height:bt.height,frameRate:bt.frameRate}},ie.next=5,(0,qi.Zu)(It);case 5:return xe=ie.sent,Se&&(xe.contentHint=Se),ie.abrupt("return",xe);case 8:case"end":return ie.stop()}},K)})),function(K){return O.apply(this,arguments)})},{key:"createMicrophoneAudioTrack",value:(A=(0,u.A)(d().mark(function K(ve){var Te,Fe,at,Se,We,$e,bt,It,xe,ie,_t,Xt;return d().wrap(function(Je){for(;;)switch(Je.prev=Je.next){case 0:if(Te=ve.noiseConfig,Fe=Te===void 0?void 0:Te,at=ve.encoderConfig,Se=at===void 0?void 0:at,We=ve.microphoneId,!($e=We===void 0?void 0:We)){Je.next=6;break}return Je.next=4,this.getMicrophones();case 4:(bt=Je.sent)&&bt.some(function(cr){return cr.deviceId})&&(bt.some(function(cr){return cr.deviceId===$e})||console.error("No microphone device found for the given microphoneId, please check the passed microphoneId. The default microphone will be used instead."));case 6:return Je.prev=6,It=Se?Pi.$.audioProfiles[Se]:Pi.$.audioProfiles.speech_standard,xe={audio:{deviceId:$e,sampleRate:It.sampleRate,echoCancellation:Fe?Fe&&Fe.acousticEchoCancellation:It.echoCancellation,autoGainControl:Fe?Fe&&Fe.autoGainControl:It.autoGainControl,noiseSuppression:Fe?Fe&&Fe.noiseSuppression:It.noiseSuppression,channelCount:It.channelCount}},Je.next=11,(0,qi.lp)(xe);case 11:return(ie=Je.sent).encoderConfig=Se||"speech_standard",ie.microphoneId=$e,Je.abrupt("return",ie);case 17:if(Je.prev=17,Je.t0=Je.catch(6),Je.t0.name!=="SecurityError"){Je.next=23;break}_t=er.q.ERROR_RN_MIC_ACCESS_DENIED_OR_DISMISSED.message,Je.next=43;break;case 23:if(Je.t0.name!=="DOMException"){Je.next=27;break}_t=er.q.ERROR_RN_MIC_NOT_FOUND.message,Je.next=43;break;case 27:if(!(Je.t0 instanceof DOMException)){Je.next=42;break}Je.t1=Je.t0.name,Je.next=Je.t1==="NotAllowedError"?31:Je.t1==="NotReadableError"?33:Je.t1==="NotFoundError"?35:38;break;case 31:return _t=t0(Je.t0,"audio"),Je.abrupt("break",40);case 33:return _t=Zu(Je.t0,"audio"),Je.abrupt("break",40);case 35:return _t=er.q.ERROR_MICROPHONE_NOT_FOUND.message,navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Firefox")!=-1&&(_t=er.q.ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS.message),Je.abrupt("break",40);case 38:return _t=Je.t0.message,Je.abrupt("break",40);case 40:Je.next=43;break;case 42:Je.t0.message=="getUserMedia is not implemented in this browser"?(Xt=er.q.ERROR_MICROPHONE_ACCESS_UNAVAILABLE,_t=Xt.message):_t=Je.t0.message;case 43:console.error("An error occurred in creating audio track, ".concat(_t));case 44:case"end":return Je.stop()}},K,this,[[6,17]])})),function(K){return A.apply(this,arguments)})}]);var A,O,F,z,q,ne,de,ge,W,te}();function t0(A,O){return(A.message==="Permission denied"||A.message==="Permission dismissed"?O==="video"?er.q.ERROR_CAMERA_ACCESS_DENIED_OR_DISMISSED:er.q.ERROR_MICROPHONE_ACCESS_DENIED_OR_DISMISSED:A.message.includes("The request is not allowed by the user agent")?O==="video"?er.q.ERROR_CAMERA_PERMISSION_OR_AUTOPLAY_ISSUE:er.q.ERROR_MICROPHONE_ACCESS_DENIED_OR_DISMISSED:A.message==="Permission denied by system"?O==="video"?er.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS:er.q.ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS:O==="video"?er.q.ERROR_GET_VIDEO_MEDIA_PERMISSION_DENIED:er.q.ERROR_GET_AUDIO_MEDIA_PERMISSION_DENIED).message}function Zu(A,O){return(A.message==="Device in use"?O==="video"?er.q.ERROR_CAMERA_IN_USE:er.q.ERROR_MICROPHONE_IN_USE:O==="video"?er.q.ERROR_VIDEO_SOURCE_INITIATION_FAILED:er.q.ERROR_MICROPHONE_IN_USE).message}(0,g.A)(Il,"devices",[]),(0,g.A)(Il,"eventEmitter",new zt),(0,g.A)(Il,"Constants",{errors:er.s,recordingEvents:{RECORDING_STARTING:"RECORDING_STARTING",RECORDING_STARTED:"RECORDING_STARTED",RECORDING_STOPPING:"RECORDING_STOPPING",RECORDING_STOPPED:"RECORDING_STOPPED"},livestreamEvents:{LIVESTREAM_STARTING:"LIVESTREAM_STARTING",LIVESTREAM_STARTED:"LIVESTREAM_STARTED",LIVESTREAM_STOPPING:"LIVESTREAM_STOPPING",LIVESTREAM_STOPPED:"LIVESTREAM_STOPPED"},hlsEvents:Bi.V,transcriptionEvents:{TRANSCRIPTION_STARTING:"TRANSCRIPTION_STARTING",TRANSCRIPTION_STARTED:"TRANSCRIPTION_STARTED",TRANSCRIPTION_STOPPING:"TRANSCRIPTION_STOPPING",TRANSCRIPTION_STOPPED:"TRANSCRIPTION_STOPPED"},modes:ei.n,permission:Vn});var yw=Il},2487:(a,c,o)=>{o.r(c),o.d(c,{default:()=>Ga});var l=o(2284),u=o(467),h=o(3029),f=o(2901),g=o(4467),p=o(4756),d=o.n(p),m=o(9566),E=o(76),S=o(7833),R=o.n(S),k="mediasoup-demo",C=function(){return(0,f.A)(function be(Ve){(0,h.A)(this,be),Ve?(this._debug=R()("".concat(k,":").concat(Ve)),this._warn=R()("".concat(k,":WARN:").concat(Ve)),this._error=R()("".concat(k,":ERROR:").concat(Ve))):(this._debug=R()(k),this._warn=R()("".concat(k,":WARN")),this._error=R()("".concat(k,":ERROR"))),R().disable(),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)},[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}])}(),x=o(1396),P=x.enc.Latin1.parse("6gf9Oz5Y(6fOWPP@3XPv0Mwp51yfJ0HiZW^0*!9NdUuZ*VdKmRC@f))&^!Iriw)q"),D=x.enc.Latin1.parse("BHrabik^$W^y*HL@A*$4YKj(");function b(be){return w.apply(this,arguments)}function w(){return(w=(0,u.A)(d().mark(function be(Ve){var He,lt,$t,Vt,hr,or,Nt,Cr,Gt,pr,Er,Nr,hn;return d().wrap(function(kn){for(;;)switch(kn.prev=kn.next){case 0:return He=Ve.roomId,lt=Ve.secret,$t=Ve.signalingBaseUrl,Vt="call-api.videosdk.live",hr=[],or=null,Nt={},Cr={},Gt={},pr=null,kn.next=10,fetch("https://".concat($t,"/infra/v1/meetings/init-config"),{method:"POST",headers:{Authorization:lt,"Content-Type":"application/json"},body:JSON.stringify({roomId:He})}).then(function(vi){return vi.json()}).catch(function(vi){return{}});case 10:return Er=kn.sent,(Nr=Er.data)&&(Vt=Nr.baseUrl,hn=Nr.observability,hr=v(Nr.iceServers),or=hn.jwt,Nt=hn.traces,Cr=hn.logs,Gt=hn.metaData,pr=Nr.signalingUrl),kn.abrupt("return",{baseUrl:Vt,iceServers:hr,observabilityJwt:or,traces:Nt,logs:Cr,metaData:Gt,signalingUrl:pr});case 14:case"end":return kn.stop()}},be)}))).apply(this,arguments)}function v(be){try{var Ve=x.AES.decrypt(be,P,{iv:D,mode:x.mode.CBC,padding:x.pad.ZeroPadding}).toString(x.enc.Utf8);return JSON.parse(Ve)}catch{return[]}}var _=o(2215),y=o.n(_),T="mediasoup-demo.user",L="mediasoup-demo.devices";function I(be){var Ve=be.displayName;y().set(T,{displayName:Ve})}function N(){return y().getJSON(L)}var M=o(2211),U=o.n(M),j=function(be){return{type:"SET_ROOM_STATE",payload:{state:be}}},Q=function(be){return{type:"SET_ROOM_ACTIVE_SPEAKER",payload:{peerId:be}}},Y=function(be){return{type:"SET_ROOM_STATS_PEER_ID",payload:{peerId:be}}},he=function(be){return{type:"SET_MEDIA_CAPABILITIES",payload:{canSendMic:be.canSendMic,canSendWebcam:be.canSendWebcam}}},re=function(be){return{type:"SET_DISPLAY_NAME",payload:{displayName:be}}},pe=function(be){return{type:"SET_AUDIO_ONLY_STATE",payload:{enabled:be}}},fe=function(be){return{type:"SET_AUDIO_ONLY_IN_PROGRESS",payload:{flag:be}}},ue=function(be){return{type:"SET_AUDIO_MUTED_STATE",payload:{enabled:be}}},ee=function(be){return{type:"SET_RESTART_ICE_IN_PROGRESS",payload:{flag:be}}},Z=function(be){return{type:"ADD_PRODUCER",payload:{producer:be}}},le=function(be){return{type:"REMOVE_PRODUCER",payload:{producerId:be}}},ye=function(be,Ve){return{type:"SET_PRODUCER_TRACK",payload:{producerId:be,track:Ve}}},mt=function(be,Ve){return{type:"SET_PRODUCER_SCORE",payload:{producerId:be,score:Ve}}},Ye=function(be){return{type:"ADD_DATA_PRODUCER",payload:{dataProducer:be}}},ct=function(be){return{type:"SET_WEBCAM_IN_PROGRESS",payload:{flag:be}}},ht=function(be){return{type:"SET_SHARE_IN_PROGRESS",payload:{flag:be}}},kt=function(be){return{type:"ADD_PEER",payload:{peer:be}}},Sr=function(be){return{type:"REMOVE_PEER",payload:{peerId:be}}},wt=function(be,Ve){return{type:"SET_PEER_DISPLAY_NAME",payload:{displayName:be,peerId:Ve}}},Zt=function(be,Ve){return{type:"ADD_CONSUMER",payload:{consumer:be,peerId:Ve}}},vr=function(be,Ve){return{type:"REMOVE_CONSUMER",payload:{consumerId:be,peerId:Ve}}},Wr=function(be,Ve){return{type:"SET_CONSUMER_PAUSED",payload:{consumerId:be,originator:Ve}}},br=function(be,Ve){return{type:"SET_CONSUMER_RESUMED",payload:{consumerId:be,originator:Ve}}},Br=function(be,Ve,He){return{type:"SET_CONSUMER_CURRENT_LAYERS",payload:{consumerId:be,spatialLayer:Ve,temporalLayer:He}}},Jr=function(be,Ve,He){return{type:"SET_CONSUMER_PREFERRED_LAYERS",payload:{consumerId:be,spatialLayer:Ve,temporalLayer:He}}},Qt=function(be,Ve){return{type:"SET_CONSUMER_PRIORITY",payload:{consumerId:be,priority:Ve}}},zt=function(be,Ve){return{type:"SET_CONSUMER_SCORE",payload:{consumerId:be,score:Ve}}},At=function(be,Ve){return{type:"ADD_DATA_CONSUMER",payload:{dataConsumer:be,peerId:Ve}}},Lr=function(be,Ve){return{type:"REMOVE_DATA_CONSUMER",payload:{dataConsumerId:be,peerId:Ve}}},yt=function(be){var Ve=be.type,He=Ve===void 0?"info":Ve,lt=be.text,$t=be.title,Vt=be.timeout;if(!Vt)switch(He){case"info":Vt=3e3;break;case"error":Vt=5e3}var hr={id:U()({length:6}).toLowerCase(),type:He,title:$t,text:lt,timeout:Vt};return function(or){or(function(Nt){return{type:"ADD_NOTIFICATION",payload:{notification:Nt}}}(hr)),setTimeout(function(){or({type:"REMOVE_NOTIFICATION",payload:{notificationId:hr.id}})},Vt)}},Qe=o(7007),Et=o(296),Ae=o(9027);function Ne(be,Ve){var He=Object.keys(be);if(Object.getOwnPropertySymbols){var lt=Object.getOwnPropertySymbols(be);Ve&&(lt=lt.filter(function($t){return Object.getOwnPropertyDescriptor(be,$t).enumerable})),He.push.apply(He,lt)}return He}var Ze={},Oe={},vt={};for(var Mt in Ae.$.videoProfiles)Ae.$.videoProfiles[Mt].aspectRatio=="oneSixNine"&&(Ze[Mt]=Ae.$.videoProfiles[Mt],Ze[Mt].encoding={maxBitrate:Ze[Mt].bitRate,maxFramerate:Ze[Mt].frameRate}),Ae.$.videoProfiles[Mt].aspectRatio=="fourThree"&&(Oe[Mt]=Ae.$.videoProfiles[Mt],Oe[Mt].encoding={maxBitrate:Oe[Mt].bitRate,maxFramerate:Oe[Mt].frameRate});for(var Mt in Ae.$.screenShareProfiles)vt[Mt]=Ae.$.screenShareProfiles[Mt],vt[Mt].encoding={maxBitrate:vt[Mt].bitRate,maxFramerate:vt[Mt].frameRate};var ke=Object.values(Ze),lr=Object.values(Oe),yr=[Ze.h180p_w320p,Ze.h360p_w640p],wr=[Oe.h180p_w240p,Oe.h360p_w480p],Ur=["q","h","f"];function yn(be,Ve,He,lt,$t){var Vt=lt&&lt.videoEncoding,hr=lt==null?void 0:lt.simulcast;if(Vt||(Vt=function(Nr,hn,kn){for(var vi=function(Pi,os,cs){var Os=os>cs?os/cs:cs/os;return Math.abs(Os-1.7777777777777777)<Math.abs(Os-1.3333333333333333)?ke:lr}(Nr,hn,kn),er=vi[0].encoding,Bi=Math.max(hn,kn),ei=0;ei<vi.length;ei+=1){var qi=vi[ei];if(er=qi.encoding,qi.width>=Bi)break}return er}(be,Ve,He)),!hr)return[Vt];var or,Nt={width:Ve,height:He,encoding:{maxBitrate:Vt.maxBitrate,maxFramerate:Vt.maxFramerate}},Cr=[],Gt=(Cr=Ge(be,Nt))[0];if(Cr.length>1){var pr=Cr;or=(0,Et.A)(pr,2)[1]}var Er=Math.max(Ve,He);return Ot(Ve,He,Er>=960&&or?[Gt,or,Nt]:Er>=480?[Gt,Nt]:[Nt],$t)}function Ge(be,Ve){var He=Ve.width,lt=Ve.height,$t=He>lt?He/lt:lt/He;return Math.abs($t-1.7777777777777777)<Math.abs($t-1.3333333333333333)?yr:wr}function Ot(be,Ve,He,lt){var $t=[];return He.forEach(function(Vt,hr){if(!(hr>=Ur.length)){var or=lt?null:{maxFramerate:Vt.encoding.maxFramerate},Nt=Math.min(be,Ve),Cr=function(Gt){for(var pr=1;pr<arguments.length;pr++){var Er=arguments[pr]!=null?arguments[pr]:{};pr%2?Ne(Object(Er),!0).forEach(function(Nr){(0,g.A)(Gt,Nr,Er[Nr])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Gt,Object.getOwnPropertyDescriptors(Er)):Ne(Object(Er)).forEach(function(Nr){Object.defineProperty(Gt,Nr,Object.getOwnPropertyDescriptor(Er,Nr))})}return Gt}({rid:Ur[hr],scaleResolutionDownBy:Nt/Math.min(Vt.width,Vt.height),maxBitrate:Vt.encoding.maxBitrate},or);$t.push(Cr)}}),$t}function xt(be,Ve,He){if(!be)return{};var lt=be.id,$t=(be.preferredSpatialLayer,be.preferredTemporalLayer,be.appData),Vt=$t.width,hr=$t.height,or=$t.encodings;try{var Nt=function(er){var Bi=[];if(er&&er.length!=0){if(er.length===1){for(var ei=0;ei<3;ei++)Bi.push(Math.pow(2,3-ei-1));return Bi}var qi=!1;return er.forEach(function(Pi){Pi.scaleResolutionDownBy!==void 0?(qi=!0,Bi.push(Math.max(1,Pi.scaleResolutionDownBy))):Bi.push(1)}),qi||er.forEach(function(Pi,os){Bi[os]=Math.pow(2,er.length-os-1)}),Bi}}(or);if(!Nt)return{};for(var Cr=Math.min(Math.max(Ae.$.adaptiveScalingFactor||.75,.5),1),Gt=0,pr=0;pr<Nt.length;pr++){var Er=Cr*Vt/Nt[pr],Nr=Cr*hr/Nt[pr];if(!(Ve>=Er&&He>=Nr))break;Gt=pr}var hn=(be.temporalLayers?be.temporalLayers:3)-1;if(Gt===0&&hn>0){var kn=Vt/Nt[0],vi=hr/Nt[0];Ve<.5*kn&&He<.5*vi&&(hn-=1),hn>0&&Ve<.25*kn&&He<.25*vi&&(hn-=1)}return{consumerId:lt,newPreferredSpatialLayer:Gt,newPreferredTemporalLayer:hn}}catch{return{}}}var Ke=o(7080),Zr=(o(1751),o(5414)),kr=o(2107),Or=o(5071),sr=o(5458),ar=Array(32);function Mr(){for(var be=0;be<16;be++)ar[be]=Math.floor(16*Math.random())+48,ar[be]>=58&&(ar[be]+=39);return String.fromCharCode.apply(null,ar.slice(0,16))}function tn(){var be=(1e6*new Date().getTime()).toString().padEnd(19,"0");return Number(be)}function _n(be,Ve){var He=Object.keys(be);if(Object.getOwnPropertySymbols){var lt=Object.getOwnPropertySymbols(be);Ve&&(lt=lt.filter(function($t){return Object.getOwnPropertyDescriptor(be,$t).enumerable})),He.push.apply(He,lt)}return He}function Jn(be){for(var Ve=1;Ve<arguments.length;Ve++){var He=arguments[Ve]!=null?arguments[Ve]:{};Ve%2?_n(Object(He),!0).forEach(function(lt){(0,g.A)(be,lt,He[lt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(be,Object.getOwnPropertyDescriptors(He)):_n(Object(He)).forEach(function(lt){Object.defineProperty(be,lt,Object.getOwnPropertyDescriptor(He,lt))})}return be}var ss=function(){return(0,f.A)(function be(Ve){var He=this,lt=Ve.roomId,$t=Ve.peerId,Vt=Ve.sdkName,hr=Ve.observabilityJwt,or=Ve.metaData,Nt=Ve.traces;(0,h.A)(this,be),this._traceId=function(){for(var Gt=0;Gt<32;Gt++)ar[Gt]=Math.floor(16*Math.random())+48,ar[Gt]>=58&&(ar[Gt]+=39);return String.fromCharCode.apply(null,ar.slice(0,32))}(),this._rootSpanId=Mr(),this._observabilityJwt=hr,this._tracesEnabled=Nt.enabled;var Cr=function(Gt){for(var pr="0123456789abcdefghijklmnopqrstuvwxyz",Er="",Nr=Gt;Nr>0;Nr--)Er+=pr[Math.floor(36*Math.random())];return Er}(8);this._spans=[],this._traceJSON={resourceSpans:[{resource:{attributes:[{key:"service.name",value:{stringValue:"videosdk-otel"}},{key:"telemetry.sdk.language",value:{stringValue:"webjs"}},{key:"telemetry.sdk.name",value:{stringValue:"opentelemetry"}},{key:"telemetry.sdk.version",value:{stringValue:"1.14.0"}},{key:"sdk-version",value:{stringValue:"0.0.1"}}],droppedAttributesCount:0},scopeSpans:[{scope:{name:Cr},spans:[]}]}]},this._tracesEnabled&&(this.addRootSpan(lt,$t,Vt,or),setInterval(function(){He.processQueue()},4e3))},[{key:"addRootSpan",value:function(be,Ve,He,lt){var $t={traceId:this._traceId,spanId:this._rootSpanId,name:"room_".concat(be,"_peer_").concat(Ve,"_sdk_").concat(He),kind:1,startTimeUnixNano:tn(),endTimeUnixNano:tn(),attributes:[{key:"roomId",value:{stringValue:be}},{key:"peerId",value:{stringValue:Ve}},{key:"sdkName",value:{stringValue:He}},{key:"userId",value:{stringValue:lt.userId}},{key:"email",value:{stringValue:lt.email}}],droppedAttributesCount:0,events:[],droppedEventsCount:0,status:{code:0},links:[],droppedLinksCount:0};this._spans.push($t)}},{key:"addSpanToTrace",value:function(be){this._spans.push(be)}},{key:"trace",value:function(be){var Ve=be.spanName,He=be.attributes,lt=He===void 0?{}:He,$t=be.span,Vt=$t===void 0?void 0:$t;if(this._tracesEnabled){var hr=Mr(),or=tn(),Nt={traceId:this._traceId,spanId:hr,parentSpanId:Vt||this._rootSpanId,name:Ve,kind:1,startTimeUnixNano:or,droppedAttributesCount:0,events:[],droppedEventsCount:0,links:[],droppedLinksCount:0};return Object.keys(lt).length>0&&(Nt.attributes=Object.entries(lt).map(function(Cr){var Gt=(0,Et.A)(Cr,2);return{key:Gt[0],value:{stringValue:Gt[1]}}})),this.addSpanToTrace(Nt),hr}}},{key:"traceAutoComplete",value:function(be){var Ve=be.spanName,He=be.attributes,lt=He===void 0?{}:He,$t=be.status,Vt=$t===void 0?1:$t,hr=be.span,or=hr===void 0?void 0:hr,Nt=be.message,Cr=Nt===void 0?"SUCCESS":Nt;if(this._tracesEnabled){var Gt=Mr(),pr=tn(),Er=tn(),Nr={traceId:this._traceId,spanId:Gt,parentSpanId:or||this._rootSpanId,name:Ve,kind:1,startTimeUnixNano:pr,endTimeUnixNano:Er,droppedAttributesCount:0,events:[],droppedEventsCount:0,links:[],droppedLinksCount:0,status:{code:Vt,message:Cr}};Object.keys(lt).length>0&&(Nr.attributes=Object.entries(lt).map(function(hn){var kn=(0,Et.A)(hn,2);return{key:kn[0],value:{stringValue:kn[1]}}})),this.addSpanToTrace(Nr)}}},{key:"completeSpan",value:function(be){var Ve=be.span,He=be.status,lt=be.message,$t=be.attributes,Vt=$t===void 0?{}:$t;if(this._tracesEnabled){var hr=tn();this._spans=this._spans.map(function(or){if(or.spanId!==Ve)return or;var Nt=Object.entries(Vt).map(function(Cr){var Gt=(0,Et.A)(Cr,2);return{key:Gt[0],value:{stringValue:Gt[1]}}});return or.attributes=or.attributes?[].concat((0,sr.A)(or.attributes),(0,sr.A)(Nt)):Nt,Jn(Jn({},or),{},{status:{code:He,message:lt},endTimeUnixNano:hr})})}}},{key:"processQueue",value:function(){var be=this;if(this._spans.length>0){this._traceJSON.resourceSpans[0].scopeSpans[0].spans=this._spans,this._spans=[];var Ve={method:"POST",headers:{Authorization:this._observabilityJwt,"Content-Type":"application/json"},body:JSON.stringify(this._traceJSON)};fetch("https://api.videosdk.live/otel/v1/traces",Ve).then(function(){var He=(0,u.A)(d().mark(function lt($t){return d().wrap(function(Vt){for(;;)switch(Vt.prev=Vt.next){case 0:return be._traceJSON.resourceSpans[0].scopeSpans[0].spans=[],Vt.next=3,$t.text();case 3:return Vt.abrupt("return",Vt.sent);case 4:case"end":return Vt.stop()}},lt)}));return function(lt){return He.apply(this,arguments)}}()).then(function(He){}).catch(function(He){be._spans=be._traceJSON.resourceSpans[0].scopeSpans[0].spans,console.error("There was a problem with the POST request:",He)})}}}])}();function li(be,Ve){var He=Object.keys(be);if(Object.getOwnPropertySymbols){var lt=Object.getOwnPropertySymbols(be);Ve&&(lt=lt.filter(function($t){return Object.getOwnPropertyDescriptor(be,$t).enumerable})),He.push.apply(He,lt)}return He}function Zn(be){for(var Ve=1;Ve<arguments.length;Ve++){var He=arguments[Ve]!=null?arguments[Ve]:{};Ve%2?li(Object(He),!0).forEach(function(lt){(0,g.A)(be,lt,He[lt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(be,Object.getOwnPropertyDescriptors(He)):li(Object(He)).forEach(function(lt){Object.defineProperty(be,lt,Object.getOwnPropertyDescriptor(He,lt))})}return be}var As=function(){return(0,f.A)(function Ve(He){var lt=He.roomId,$t=He.peerId,Vt=He.logs,hr=He.observabilityJwt,or=He.deviceInfo,Nt=He.sessionId,Cr=He.debugMode;(0,h.A)(this,Ve);var Gt=or.browserUserAgent,pr=or.deviceUserAgent,Er=or.platform;this._peerId=$t,this._roomId=lt,this._logs=Vt,this._observabilityJwt=hr,this._deviceInfo=or,this._sessionId=Nt,this._debugMode=Cr,this.browserOrDeviceInfo=Gt?{browserName:Gt.browser.name,browserVersion:Gt.browser.version,osName:Gt.os.name,osVersion:Gt.os.version,platform:Er}:pr?Zn({platform:Er},pr):null},[{key:"pushLogs",value:(be=(0,u.A)(d().mark(function Ve(He){var lt,$t,Vt,hr,or,Nt,Cr,Gt;return d().wrap(function(pr){for(;;)switch(pr.prev=pr.next){case 0:if(lt=He.logType,$t=He.logText,Vt=He.attributes,hr=He.dashboardLog,or=hr!==void 0&&hr,Nt=this._logs,Cr=Nt.enabled,Gt=Nt.endPoint,!Cr){pr.next=8;break}return pr.next=5,fetch(Gt,{method:"POST",headers:{Authorization:this._observabilityJwt,"Content-Type":"application/json"},body:JSON.stringify({logType:lt,logText:$t,attributes:Zn(Zn({},Vt),{},{roomId:this._roomId,peerId:this._peerId,SDK:"".concat(this._deviceInfo.sdkType,"-sdk"),SDK_VERSION:this._deviceInfo.sdkVersion,sessionId:this._sessionId},this.browserOrDeviceInfo),debugMode:this._debugMode,dashboardLog:or})}).then(function(Er){return Er.json()}).catch(function(Er){return console.log("error",Er),{}});case 5:return pr.abrupt("return",pr.sent);case 8:return pr.abrupt("return",null);case 9:case"end":return pr.stop()}},Ve,this)})),function(Ve){return be.apply(this,arguments)})}]);var be}(),Ua=o(4973);function as(be,Ve){var He=typeof Symbol<"u"&&be[Symbol.iterator]||be["@@iterator"];if(!He){if(Array.isArray(be)||(He=function(Nt,Cr){if(Nt){if(typeof Nt=="string")return fa(Nt,Cr);var Gt=Object.prototype.toString.call(Nt).slice(8,-1);if(Gt==="Object"&&Nt.constructor&&(Gt=Nt.constructor.name),Gt==="Map"||Gt==="Set")return Array.from(Nt);if(Gt==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Gt))return fa(Nt,Cr)}}(be))||Ve){He&&(be=He);var lt=0,$t=function(){};return{s:$t,n:function(){return lt>=be.length?{done:!0}:{done:!1,value:be[lt++]}},e:function(Nt){throw Nt},f:$t}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Vt,hr=!0,or=!1;return{s:function(){He=He.call(be)},n:function(){var Nt=He.next();return hr=Nt.done,Nt},e:function(Nt){or=!0,Vt=Nt},f:function(){try{hr||He.return==null||He.return()}finally{if(or)throw Vt}}}}function fa(be,Ve){(Ve==null||Ve>be.length)&&(Ve=be.length);for(var He=0,lt=new Array(Ve);He<Ve;He++)lt[He]=be[He];return lt}function ma(be,Ve){var He=Object.keys(be);if(Object.getOwnPropertySymbols){var lt=Object.getOwnPropertySymbols(be);Ve&&(lt=lt.filter(function($t){return Object.getOwnPropertyDescriptor(be,$t).enumerable})),He.push.apply(He,lt)}return He}function $n(be){for(var Ve=1;Ve<arguments.length;Ve++){var He=arguments[Ve]!=null?arguments[Ve]:{};Ve%2?ma(Object(He),!0).forEach(function(lt){(0,g.A)(be,lt,He[lt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(be,Object.getOwnPropertyDescriptors(He)):ma(Object(He)).forEach(function(lt){Object.defineProperty(be,lt,Object.getOwnPropertyDescriptor(He,lt))})}return be}var je,ga={sd:{low:{s:0,t:2},med:{s:0,t:2},high:{s:1,t:2},s0t0:{s:0,t:0},s0t1:{s:0,t:1},s0t2:{s:0,t:2},s1t0:{s:1,t:0},s1t1:{s:1,t:1},s1t2:{s:1,t:2},s2t0:{s:2,t:0},s2t1:{s:2,t:1},s2t2:{s:2,t:2}},hd:{low:{s:0,t:2},med:{s:1,t:2},high:{s:2,t:2},s0t0:{s:0,t:0},s0t1:{s:0,t:1},s0t2:{s:0,t:2},s1t0:{s:1,t:0},s1t1:{s:1,t:1},s1t2:{s:1,t:2},s2t0:{s:2,t:0},s2t1:{s:2,t:1},s2t2:{s:2,t:2}}},Qs={qvga:{width:{ideal:320},height:{ideal:240}},vga:{width:{ideal:640},height:{ideal:480}},sd:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:24}},hd:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:24}}},$a={sd:[{scaleResolutionDownBy:6},{scaleResolutionDownBy:4},{scaleResolutionDownBy:2}],hd:[{scaleResolutionDownBy:4},{scaleResolutionDownBy:2},{scaleResolutionDownBy:1}]},va=[{scalabilityMode:"S3T3_KEY"}],Va=[{dtx:!0,maxFramerate:10}],ya=[{scalabilityMode:"S3T3",dtx:!0}],Pe=new C("RoomClient"),Ga=function(){return(0,f.A)(function X(B){var V,$,G=B.roomId,se=B.peerId,ae=B.secret,Be=B.displayName,we=B.device,gt=B.handlerName,qe=B.useSimulcast,ut=B.useSharingSimulcast,oe=B.forceTcp,Re=B.mode,tt=B.forceH264,rt=B.forceVP9,_e=B.svc,Ue=B.datachannel,pt=B.externalVideo,Bt=B.micEnabled,Wt=B.webcamEnabled,Dt=B.maxResolution,Ut=B.useSpartialLayerAnalytics,Ft=B._deviceInfo,qt=B.customCameraVideoTrack,nr=B.customMicrophoneAudioTrack,Lt=B.autoConsume,dt=B.preferredProtocol,en=B.signalingBaseUrl,Kr=B.metaData,ir=B.defaultCameraIndex,qr=B.debugMode;(0,h.A)(this,X),(0,g.A)(this,"delay",function(jr){return new Promise(function(on){return setTimeout(on,jr)})}),Pe.debug('constructor() [roomId:"%s", peerId:"%s", displayName:"%s", device:%s]',G,se,Be,we.flag),this.useSpartialLayerAnalytics=Ut||!1,this._deviceInfo=Ft,this._eventEmitter=new Qe.EventEmitter,this._closed=!1,this._displayName=Be,this._device=we,this._forceTcp=oe,this._preferredProtocol=dt,Re==kr.n.CONFERENCE?(V=!0,$=!0):(V=!1,$=!1),this._mode=Re,this._produce=V,this._consume=$,this._useDataChannel=Ue,this._forceH264=!!tt,this._forceVP9=!!rt,this._micEnabled=!!Bt,this._webcamEnabled=!!Wt,this._externalVideo=null,this._externalVideoStream=null,this._nextDataChannelTestNumber=0,pt&&(this._externalVideo=document.createElement("video"),this._externalVideo.controls=!0,this._externalVideo.loop=!0,this._externalVideo.setAttribute("playsinline",""),this._externalVideo.src=pt,this._externalVideo.play().catch(function(jr){return Pe.warn("externalVideo.play() failed:%o",jr)})),this._handlerName=gt,this._useSimulcast=qe,this._useSharingSimulcast=ut,this._protooUrl="",this._secret=ae,this._peerId=se,this._roomId=G,this._baseUrl="",this._protoo=null,this._mediasoupDevice=null,this._sendTransport=null,this._recvTransport=null,this._micProducer=null,this._webcamProducer=null,this._shareProducer=null,this._shareAudioProducer=null,this._chatDataProducer=null,this._botDataProducer=null,this._consumers=new Map,this._dataConsumers=new Map,this._mics=new Map,this._mic={device:null},this._webcams=new Map,this._webcam={device:null,resolution:Dt||"hd"},this._pinnedParticipants=new Map,_e&&(va[0].scalabilityMode="".concat(_e,"_KEY"),ya[0].scalabilityMode=_e),this.customCameraVideoTrack=qt,this.customMicrophoneAudioTrack=nr,this._autoConsume=Lt,this._iceServers=[],this._metrics=new Zr.VideoSDKMetrics({refreshEvery:1e3,startAfter:1e3,verbose:!1}),this._stats={},this._latestStats={},this._isWebsocketAlive=!1,this._pingWebsocketInterval=null,this._pingInternetInterval=null,this._pingWebsocketFailedCounter=0,this._pongInternetCounter=0,this._transportState="",this._openTelemetry=null,this._videosdkLogs=null,this._signalingBaseUrl=en||"api.videosdk.live",this._metaData=Kr,this._defaultCameraIndex=ir,this._debugMode=!!qr},[{key:"on",value:function(X,B){this._eventEmitter.on(X,B)}},{key:"close",value:function(X){var B,V,$,G,se,ae=X.sendLeft,Be=ae===void 0||ae;if(Be&&(this._eventEmitter.emit("MEETING_STATE_CHANGED",{state:"CLOSING"}),(se=this._openTelemetry)===null||se===void 0||se.traceAutoComplete({spanName:"Meeting is in CLOSING State",status:1})),!this._closed){this._closed=!0,this._pingWebsocketInterval&&clearInterval(this._pingWebsocketInterval),this._pingWebsocketInterval=null,this._pingInternetInterval&&clearInterval(this._pingInternetInterval),this._pingInternetInterval=null,this._protoo.close(),this._metrics.running&&this._metrics.stopAllProbes(),Pe.debug("close()");var we=(B=this._openTelemetry)===null||B===void 0?void 0:B.trace({spanName:"Closing Trasnport"});this._sendTransport&&this._sendTransport.close(),this._recvTransport&&this._recvTransport.close(),(V=this._openTelemetry)===null||V===void 0||V.completeSpan({span:we,status:1,message:"Closed Trasnport"}),je.dispatch(j("closed")),Be&&this._eventEmitter.emit("MEETING_STATE_CHANGED",{state:"CLOSED"}),($=this._openTelemetry)===null||$===void 0||$.traceAutoComplete({spanName:"Meeting is in CLOSED State",status:1}),Be&&this._eventEmitter.emit("MEETING_LEFT"),(G=this._openTelemetry)===null||G===void 0||G.traceAutoComplete({spanName:"Emitted MEETING_LEFT Event",status:1})}}},{key:"join",value:(Bo=(0,u.A)(d().mark(function X(){var B,V,$,G,se,ae,Be,we,gt,qe,ut,oe=this;return d().wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:return Re.next=2,b({roomId:this._roomId,secret:this._secret,signalingBaseUrl:this._signalingBaseUrl});case 2:$=Re.sent,G=$.baseUrl,se=$.iceServers,ae=$.logs,Be=$.observabilityJwt,we=$.traces,gt=$.metaData,qe=$.signalingUrl,this._baseUrl=G,this._protooUrl="".concat(qe||"wss://".concat(this._baseUrl),"/?roomId=").concat(this._roomId,"&peerId=").concat(this._peerId,"&secret=").concat(this._secret,"&mode=").concat(this._mode),this._iceServers=se,this._tracesEnabled=we.enabled,this._openTelemetry=new ss((0,g.A)({roomId:this._roomId,peerId:this._peerId,sdkName:"".concat(this._deviceInfo.sdkType,"-sdk"),traces:we,logs:ae,observabilityJwt:Be,metaData:gt},"traces",we)),this._joinSpan=(B=this._openTelemetry)===null||B===void 0?void 0:B.trace({spanName:"Join() Calling",attributes:{DeviceInfo:JSON.stringify(this._deviceInfo),mode:this._mode,displayName:this._displayName,multiStream:this._useSimulcast,micEnabled:this._micEnabled,webcamEnabled:this._webcamEnabled,CustomVideoTrack:!!this.customCameraVideoTrack,CustomMicTrack:!!this.customMicrophoneAudioTrack,signalingUrl:qe||"signalingUrl not specify"}}),ut=new m.TJ(this._protooUrl),this._protoo=new m.xM(ut),this._eventEmitter.emit("MEETING_STATE_CHANGED",{state:"CONNECTING"}),je.dispatch(j("connecting")),(V=this._openTelemetry)===null||V===void 0||V.traceAutoComplete({spanName:"Meeting is in CONNECTING State",span:this._joinSpan,status:1}),this._protoo.on("open",function(){var tt;oe._isWebsocketAlive=!0,oe._closed=!1,oe.startPingPong(),oe._eventEmitter.emit("MEETING_STATE_CHANGED",{state:"CONNECTED"}),(tt=oe._openTelemetry)===null||tt===void 0||tt.traceAutoComplete({spanName:"Meeting is in CONNECTED State",span:oe._joinSpan,status:1}),oe.requestEntry()}),this._protoo.on("failed",function(){var tt;oe._eventEmitter.emit("MEETING_STATE_CHANGED",{state:"FAILED"}),(tt=oe._openTelemetry)===null||tt===void 0||tt.traceAutoComplete({spanName:"Meeting is in FAILED State",span:oe._joinSpan,status:2}),je.dispatch(yt({type:"error",text:"WebSocket connection failed"}))}),this._protoo.on("disconnected",function(){var tt;oe._eventEmitter.emit("MEETING_STATE_CHANGED",{state:"DISCONNECTED"}),(tt=oe._openTelemetry)===null||tt===void 0||tt.traceAutoComplete({spanName:"Meeting is in DISCONNECTED State",span:oe._joinSpan,status:1}),je.dispatch(yt({type:"error",text:"WebSocket disconnected"})),oe._sendTransport&&(oe._sendTransport.close(),oe._sendTransport=null),oe._recvTransport&&(oe._recvTransport.close(),oe._recvTransport=null),je.dispatch(j("closed"))}),this._protoo.on("close",function(){oe._closed||oe.close({sendLeft:!0})}),this._protoo.on("request",function(){var tt=(0,u.A)(d().mark(function rt(_e,Ue,pt){var Bt,Wt,Dt,Ut,Ft,qt,nr,Lt,dt,en,Kr,ir,qr,jr,on,pn,$r,In,nt,mr,Vr,bn,ti,An,On,Pn,Si,Sn,Mn,wi,wn,ri,zn,Yi,Ui,dr,ni,Ln,Kn,ui,fn,Nn,Li,di,Di,ii,qn,rn,mn,ur,st,Xe,Rr,Tr,ls,Fs,$i,ws,Qa,us,js,Bs;return d().wrap(function(ft){for(;;)switch(ft.prev=ft.next){case 0:Pe.debug('proto "request" event [method:%s, data:%o]',_e.method,_e.data),ft.t0=_e.method,ft.next=ft.t0==="close"?4:ft.t0==="newConsumer"?7:ft.t0==="newDataConsumer"?45:ft.t0==="enableMic"?72:ft.t0==="disableMic"?74:ft.t0==="enableWebcam"?88:ft.t0==="disableWebcam"?90:ft.t0==="pinStateChanged"?104:ft.t0==="switchRoom"?124:ft.t0==="statsData"?127:130;break;case 4:return Ue(),oe.close({sendLeft:!0}),ft.abrupt("break",130);case 7:if(Dt=(Bt=oe._openTelemetry)===null||Bt===void 0?void 0:Bt.trace({spanName:"Protoo REQ: newConsumer",attributes:{request:JSON.stringify(_e)}}),oe._consume){ft.next=12;break}return pt(403,"I do not want to consume"),(Ut=oe._openTelemetry)===null||Ut===void 0||Ut.completeSpan({span:Dt,status:2,message:"I do not want to consume"}),ft.abrupt("break",130);case 12:return Ft=_e.data,qt=Ft.peerId,nr=Ft.producerId,Lt=Ft.id,dt=Ft.kind,en=Ft.rtpParameters,Kr=Ft.type,ir=Ft.appData,qr=Ft.producerPaused,jr=(Wt=oe._openTelemetry)===null||Wt===void 0?void 0:Wt.trace({spanName:"Creating Consumer",span:Dt}),ft.prev=14,ft.next=17,oe._recvTransport.consume({id:Lt,producerId:nr,kind:dt,rtpParameters:en,appData:$n($n({},ir),{},{peerId:qt})});case 17:nt=ft.sent,mr=E.parseScalabilityMode(nt.rtpParameters.encodings[0].scalabilityMode),Vr=mr.spatialLayers,bn=mr.temporalLayers,nt.spatialLayers=Vr,nt.temporalLayers=bn,nt.currentSpatialLayers=Vr-1,nt.currentTemporalLayers=bn-1,oe._consumers.set(nt.id,nt),nt.on("transportclose",function(){oe._consumers.delete(nt.id);var Yr=vr(nt.id,qt);je.dispatch(Yr),oe._eventEmitter.emit(Yr.type,Yr.payload)}),(on=oe._openTelemetry)===null||on===void 0||on.completeSpan({span:jr,status:1,message:"Consumer Created"}),jr=(pn=oe._openTelemetry)===null||pn===void 0?void 0:pn.trace({spanName:"Sending Stream Enabled Event",span:Dt}),ti=Zt({id:nt.id,type:Kr,locallyPaused:!1,remotelyPaused:qr,rtpParameters:nt.rtpParameters,spatialLayers:Vr,temporalLayers:bn,currentSpatialLayer:Vr-1,currentTemporalLayer:bn-1,preferredSpatialLayer:Vr-1,preferredTemporalLayer:bn-1,priority:1,codec:nt.rtpParameters.codecs[0].mimeType.split("/")[1],track:nt.track,appData:ir,instance:nt},qt),je.dispatch(ti),oe._eventEmitter.emit(ti.type,ti.payload),Ue(),nt.kind==="video"&&je.getState().me.audioOnly&&oe._pauseConsumer(nt),($r=oe._openTelemetry)===null||$r===void 0||$r.completeSpan({span:jr,status:1,message:"Event Send Successfully"}),(In=oe._openTelemetry)===null||In===void 0||In.completeSpan({span:Dt,status:1,message:"New Consumer Created Successfully",attributes:{"consumer.consumerId":nt.id}}),nt.kind=="video"&&nt.appData.share&&((An=oe._openTelemetry)===null||An===void 0||An.traceAutoComplete({spanName:"Presenter Changed",span:Dt,attributes:{"peer.id":qt}})),ft.next=44;break;case 37:throw ft.prev=37,ft.t1=ft.catch(14),(On=oe._openTelemetry)===null||On===void 0||On.completeSpan({span:jr,status:2,message:"Error creating a Consumer: ".concat(ft.t1)}),(Pn=oe._openTelemetry)===null||Pn===void 0||Pn.completeSpan({span:Dt,status:2,message:"Error creating a Consumer: ".concat(ft.t1)}),je.dispatch(yt({type:"error",text:"Error creating a Consumer: ".concat(ft.t1)})),(Si=oe._videosdkLogs)===null||Si===void 0||Si.pushLogs({logText:"Error creating a Consumer",logType:"ERROR",attributes:{error:ft.t1.message}}),ft.t1;case 44:return ft.abrupt("break",130);case 45:if(oe._consume){ft.next=48;break}return pt(403,"I do not want to data consume"),ft.abrupt("break",130);case 48:if(oe._useDataChannel){ft.next=51;break}return pt(403,"I do not want DataChannels"),ft.abrupt("break",130);case 51:return Sn=_e.data,Mn=Sn.peerId,wi=Sn.dataProducerId,wn=Sn.id,ri=Sn.sctpStreamParameters,zn=Sn.label,Yi=Sn.protocol,Ui=Sn.appData,ft.prev=52,ft.next=55,oe._recvTransport.consumeData({id:wn,dataProducerId:wi,sctpStreamParameters:ri,label:zn,protocol:Yi,appData:$n($n({},Ui),{},{peerId:Mn})});case 55:dr=ft.sent,oe._dataConsumers.set(dr.id,dr),dr.on("transportclose",function(){oe._dataConsumers.delete(dr.id)}),dr.on("open",function(){Pe.debug('DataConsumer "open" event')}),dr.on("close",function(){Pe.warn('DataConsumer "close" event'),oe._dataConsumers.delete(dr.id),je.dispatch(yt({type:"error",text:"DataConsumer closed"}))}),dr.on("error",function(Yr){Pe.error('DataConsumer "error" event:%o',Yr),je.dispatch(yt({type:"error",text:"DataConsumer error: ".concat(Yr)}))}),dr.on("message",function(Yr){if(Pe.debug('DataConsumer "message" event [streamId:%d]',dr.sctpStreamParameters.streamId),window.DC_MESSAGE=Yr,Yr instanceof ArrayBuffer){var Js=new DataView(Yr).getUint32();return Js==Math.pow(2,32)-1?(Pe.warn("dataChannelTest finished!"),void(oe._nextDataChannelTestNumber=0)):(Js>oe._nextDataChannelTestNumber&&Pe.warn("dataChannelTest: %s packets missing",Js-oe._nextDataChannelTestNumber),void(oe._nextDataChannelTestNumber=Js+1))}if(typeof Yr=="string")switch(dr.label){case"chat":var Uo=je.getState().peers,Xa=Object.keys(Uo).map(function(Ja){return Uo[Ja]}).find(function(Ja){return Ja.dataConsumers.includes(dr.id)});if(!Xa){Pe.warn('DataConsumer "message" from unknown peer');break}je.dispatch(yt({title:"".concat(Xa.displayName," says:"),text:Yr,timeout:5e3})),oe._eventEmitter.emit("CHAT_MESSAGE",{text:Yr,senderId:Xa.id,timestamp:new Date().getTime()});break;case"bot":je.dispatch(yt({title:"Message from Bot:",text:Yr,timeout:5e3}))}else Pe.warn('ignoring DataConsumer "message" (not a string)')}),window.DC=dr,je.dispatch(At({id:dr.id,sctpStreamParameters:dr.sctpStreamParameters,label:dr.label,protocol:dr.protocol},Mn)),Ue(),ft.next=71;break;case 67:ft.prev=67,ft.t2=ft.catch(52),Pe.error('"newDataConsumer" request failed:%o',ft.t2),je.dispatch(yt({type:"error",text:"Error creating a DataConsumer: ".concat(ft.t2)}));case 71:return ft.abrupt("break",130);case 72:try{Ln=_e.data.peerId,(ni=oe._openTelemetry)===null||ni===void 0||ni.traceAutoComplete({spanName:"Emitting MIC_REQUESTED & Protoo REQ: enableMic for ".concat(Ln),status:1}),oe._eventEmitter.emit("MIC_REQUESTED",{peerId:Ln}),Ue()}catch(Yr){Pe.error('"enableMic" request failed:%o',Yr),(Kn=oe._videosdkLogs)===null||Kn===void 0||Kn.pushLogs({logText:"Error enableMic request failed",logType:"ERROR",attributes:{error:Yr.message}}),oe._emitError({code:3027,message:Yr.message})}return ft.abrupt("break",130);case 74:return ft.prev=74,ui=(fn=oe._openTelemetry)===null||fn===void 0?void 0:fn.trace({spanName:"Protoo REQ: disableMic"}),ft.next=78,oe.disableMic(!1,ui);case 78:(Nn=oe._openTelemetry)===null||Nn===void 0||Nn.completeSpan({span:ui,status:1,message:"Request Completed"}),Ue(),ft.next=87;break;case 82:ft.prev=82,ft.t3=ft.catch(74),(Li=oe._openTelemetry)===null||Li===void 0||Li.completeSpan({span:ui,status:2,message:"disableMic request failed ".concat(ft.t3)}),(di=oe._videosdkLogs)===null||di===void 0||di.pushLogs({logText:"Error disableMic request failed",logType:"ERROR",attributes:{error:ft.t3.message}}),oe._emitError({code:3028,message:ft.t3.message});case 87:return ft.abrupt("break",130);case 88:try{ii=_e.data.peerId,(Di=oe._openTelemetry)===null||Di===void 0||Di.traceAutoComplete({spanName:"Emitting WEBCAM_REQUESTED & Protoo REQ: enableWebcam for ".concat(ii),status:1}),oe._eventEmitter.emit("WEBCAM_REQUESTED",{peerId:ii}),Ue()}catch(Yr){Pe.error('"enableWebcam" request failed:%o',Yr),(qn=oe._videosdkLogs)===null||qn===void 0||qn.pushLogs({logText:"Error enableWebcam request failed",logType:"ERROR",attributes:{error:Yr.message}}),oe._emitError({code:3029,message:Yr.message})}return ft.abrupt("break",130);case 90:return ft.prev=90,rn=(mn=oe._openTelemetry)===null||mn===void 0?void 0:mn.trace({spanName:"Protoo REQ: disableWebcam"}),ft.next=94,oe.disableWebcam(rn);case 94:(ur=oe._openTelemetry)===null||ur===void 0||ur.completeSpan({span:rn,status:1,message:"Request Completed"}),Ue(),ft.next=103;break;case 98:ft.prev=98,ft.t4=ft.catch(90),(st=oe._openTelemetry)===null||st===void 0||st.completeSpan({span:rn,status:2,message:"disableWebcam request failed ".concat(ft.t4)}),(Xe=oe._videosdkLogs)===null||Xe===void 0||Xe.pushLogs({logText:"Error disableWebcam request failed",logType:"ERROR",attributes:{error:ft.t4.message}}),oe._emitError({code:3030,message:ft.t4.message});case 103:return ft.abrupt("break",130);case 104:ft.prev=104,Fs=_e.data,$i=Fs.peerId,ws=Fs.state,Qa=Fs.pinnedBy,Rr=(Tr=oe._openTelemetry)===null||Tr===void 0?void 0:Tr.trace({spanName:"Protoo REQ: pinStateChanged",attributes:{requestData:JSON.stringify({peerId:$i,state:ws,pinnedBy:Qa})}}),oe._pinnedParticipants.has($i)||oe._pinnedParticipants.set($i,{cam:!1,share:!1}),us=oe._pinnedParticipants.get($i),ws.cam!=null&&(us.cam=ws.cam),ws.share!=null&&(us.share=ws.share),oe._pinnedParticipants.set($i,us),oe._eventEmitter.emit("PIN_STATE_CHANGED",{peerId:$i,state:ws,pinnedBy:Qa}),us.share==0&&us.cam==0&&oe._pinnedParticipants.delete($i),(ls=oe._openTelemetry)===null||ls===void 0||ls.completeSpan({span:Rr,status:1,message:"Request Completed",attributes:{_pinnedParticipants:JSON.stringify(oe._pinnedParticipants)}}),Ue(),ft.next=123;break;case 118:throw ft.prev=118,ft.t5=ft.catch(104),(js=oe._openTelemetry)===null||js===void 0||js.completeSpan({span:Rr,status:2,message:"pinStateChanged request failed"}),(Bs=oe._videosdkLogs)===null||Bs===void 0||Bs.pushLogs({logText:"Error pinStateChanged request failed",logType:"ERROR",attributes:{error:ft.t5.message}}),ft.t5;case 123:return ft.abrupt("break",130);case 124:return oe._eventEmitter.emit("SWITCH_ROOM",_e.data),Ue(),ft.abrupt("break",130);case 127:return Ue({peerId:oe._peerId,statsData:oe._stats}),oe._stats={},ft.abrupt("break",130);case 130:case"end":return ft.stop()}},rt,null,[[14,37],[52,67],[74,82],[90,98],[104,118]])}));return function(rt,_e,Ue){return tt.apply(this,arguments)}}()),this._protoo.on("notification",function(){var tt=(0,u.A)(d().mark(function rt(_e){var Ue,pt,Bt,Wt,Dt,Ut,Ft,qt,nr,Lt,dt,en,Kr,ir,qr,jr,on,pn,$r,In,nt,mr,Vr,bn,ti,An,On,Pn,Si,Sn,Mn,wi,wn,ri,zn,Yi,Ui,dr,ni,Ln,Kn,ui,fn,Nn,Li,di,Di,ii,qn,rn,mn,ur,st,Xe,Rr,Tr,ls,Fs,$i,ws,Qa,us,js,Bs,ft,Yr,Js,Uo,Xa,Ja,$o,Ec,Vo,Zs,cn,Za;return d().wrap(function(et){for(;;)switch(et.prev=et.next){case 0:Pe.debug('proto "notification" event [method:%s, data:%o]',_e.method,_e.data),et.t0=_e.method,et.next=et.t0==="error"?4:et.t0==="participantMediaStateChanged"?9:et.t0==="producerScore"?10:et.t0==="entryRequested"?13:et.t0==="entryResponded"?17:et.t0==="newPeer"?23:et.t0==="peerClosed"?30:et.t0==="peerDisplayNameChanged"?36:et.t0==="downlinkBwe"?40:et.t0==="consumerClosed"?42:et.t0==="consumerPaused"?54:et.t0==="consumerResumed"?61:et.t0==="consumerLayersChanged"?68:et.t0==="consumerScore"?79:et.t0==="dataConsumerClosed"?82:et.t0==="activeSpeaker"?91:et.t0==="transcriptionStateChanged"?96:et.t0==="transcriptionText"?99:et.t0==="recordingStateChanged"?101:et.t0==="recordingStarted"?104:et.t0==="recordingStopped"?106:et.t0==="livestreamStateChanged"?108:et.t0==="livestreamStarted"?111:et.t0==="livestreamStopped"?113:et.t0==="hlsStateChanged"?115:et.t0==="hlsPlayableStateChanged"?118:et.t0==="hlsStarted"?120:et.t0==="hlsStopped"?123:et.t0==="whiteboardStarted"?125:et.t0==="whiteboardStopped"?128:et.t0==="videoStatusChanged"?130:et.t0==="videoSeeked"?132:et.t0==="connectionOpen"?135:et.t0==="connectionClose"?137:et.t0==="connectionChatMessage"?139:et.t0==="connectionParticipantJoined"?141:et.t0==="connectionParticipantLeft"?143:et.t0==="pubsubMessage"?145:et.t0==="peerModeChanged"?147:et.t0==="restartIce"?150:154;break;case 4:return Bt=_e.data,oe._eventEmitter.emit("ERROR",Bt),(Ue=oe._videosdkLogs)===null||Ue===void 0||Ue.pushLogs({logText:"Error in Meeting Session",logType:"ERROR",attributes:{error:Bt.message}}),(pt=oe._openTelemetry)===null||pt===void 0||pt.traceAutoComplete({spanName:"Emitted `ERROR` Event",attributes:{error:Bt.message},status:2}),et.abrupt("break",155);case 9:try{Wt=_e.data,Dt=Wt.peerId,Ut=Wt.kind,Ft=Wt.newState,oe._eventEmitter.emit("PARTICIPANT_MEDIA_STATE_CHANGED",{peerId:Dt,kind:Ut,newState:Ft}),Ut=="video"&&((qt=oe._openTelemetry)===null||qt===void 0||qt.traceAutoComplete({spanName:"".concat(Dt," has ").concat(Ft?"enable":"disable"," ").concat(Ut),status:1}))}catch(Ii){Pe.error('"newProducer" request failed:%o',Ii),(nr=oe._videosdkLogs)===null||nr===void 0||nr.pushLogs({logText:"Error newProducer request failed",logType:"ERROR",attributes:{error:Ii.message}})}case 10:return Lt=_e.data,dt=Lt.producerId,en=Lt.score,je.dispatch(mt(dt,en)),et.abrupt("break",155);case 13:return ir=_e.data,qr=ir.id,jr=ir.name,on=(Kr=oe._openTelemetry)===null||Kr===void 0?void 0:Kr.trace({spanName:"Protoo Noti: entryRequested",span:oe._joinSpan,attributes:{data:JSON.stringify({id:qr,name:jr})}}),qr!==oe._peerId?(oe._eventEmitter.emit("ENTRY_REQUESTED",{id:qr,name:jr}),(pn=oe._openTelemetry)===null||pn===void 0||pn.completeSpan({span:on,status:1,message:"EntryResponded Recieved"})):($r=oe._openTelemetry)===null||$r===void 0||$r.completeSpan({span:on,status:2,message:"Entry Request Failed"}),et.abrupt("break",155);case 17:return nt=_e.data,mr=nt.id,Vr=nt.decision,bn=nt.sessionId,oe._videosdkLogs=new As({roomId:oe._roomId,peerId:oe._peerId,logs:ae,observabilityJwt:Be,deviceInfo:oe._deviceInfo,sessionId:bn,debugMode:oe._debugMode}),oe._eventEmitter.emit("ENTRY_RESPONDED",{id:mr,decision:Vr}),ti=(In=oe._openTelemetry)===null||In===void 0?void 0:In.trace({spanName:"Protoo Noti: entryResponded",attributes:{data:JSON.stringify({id:mr,decision:Vr}),sessionId:bn},span:oe._joinSpan}),mr===oe._peerId&&Vr==="allowed"?(oe.joinRoom(),(An=oe._openTelemetry)===null||An===void 0||An.completeSpan({span:ti,status:1,message:"EntryResponded Recieved"})):(On=oe._openTelemetry)===null||On===void 0||On.completeSpan({span:oe._joinSpan,status:2,message:"Join Request Denied"}),et.abrupt("break",155);case 23:Pn=_e.data,Si=kt($n($n({},Pn),{},{consumers:[],dataConsumers:[]})),je.dispatch(Si),oe._eventEmitter.emit(Si.type,Si.payload),je.dispatch(yt({text:"".concat(Pn.displayName," has joined the room")}));try{(Sn=oe._openTelemetry)===null||Sn===void 0||Sn.traceAutoComplete({spanName:"Protoo Noti: newPeer ".concat(Pn.displayName),attributes:{peerData:JSON.stringify(Pn)}})}catch(Ii){(Mn=oe._videosdkLogs)===null||Mn===void 0||Mn.pushLogs({logText:"Error Protoo Noti: newPeer",logType:"ERROR",attributes:{error:Ii.message}}),console.error(Ii)}return et.abrupt("break",155);case 30:return wn=_e.data.peerId,ri=Sr(wn),je.dispatch(ri),oe._eventEmitter.emit(ri.type,ri.payload),(wi=oe._openTelemetry)===null||wi===void 0||wi.traceAutoComplete({spanName:"Protoo Noti: peerClosed for ".concat(wn)}),et.abrupt("break",155);case 36:return zn=_e.data,Yi=zn.peerId,Ui=zn.displayName,dr=zn.oldDisplayName,je.dispatch(wt(Ui,Yi)),je.dispatch(yt({text:"".concat(dr," is now ").concat(Ui)})),et.abrupt("break",155);case 40:return Pe.debug("'downlinkBwe' event:%o",_e.data),et.abrupt("break",155);case 42:if(Ln=_e.data.consumerId,Kn=oe._consumers.get(Ln)){et.next=46;break}return et.abrupt("break",155);case 46:return Kn.close(),oe._consumers.delete(Ln),ui=Kn.appData.peerId,fn=vr(Ln,ui),je.dispatch(fn),oe._eventEmitter.emit(fn.type,fn.payload),(ni=oe._openTelemetry)===null||ni===void 0||ni.traceAutoComplete({spanName:"Protoo Noti: consumerClosed for id ".concat(Ln),attributes:{consumerData:JSON.stringify(Kn)}}),et.abrupt("break",155);case 54:if(Nn=_e.data.consumerId,Li=oe._consumers.get(Nn)){et.next=58;break}return et.abrupt("break",155);case 58:return Li.pause(),je.dispatch(Wr(Nn,"remote")),et.abrupt("break",155);case 61:if(di=_e.data.consumerId,Di=oe._consumers.get(di)){et.next=65;break}return et.abrupt("break",155);case 65:return Di.resume(),je.dispatch(br(di,"remote")),et.abrupt("break",155);case 68:if(ii=_e.data,qn=ii.consumerId,rn=ii.spatialLayer,mn=ii.temporalLayer,(ur=oe._consumers.get(qn)).currentSpatialLayer=rn,ur.currentTemporalLayer=mn,ur){et.next=74;break}return et.abrupt("break",155);case 74:return ur.appData.encodings.length>1?(oe._eventEmitter.emit("VIDEO_QUALITY_CHANGED",{peerId:ur.appData.peerId,prevQuality:ur.spatialLayers-1-ur.currentSpatialLayer==0?"HIGH":ur.spatialLayers-1-ur.currentSpatialLayer==1?"MEDIUM":"LOW",currentQuality:ur.spatialLayers-1-rn==0?"HIGH":ur.spatialLayers-1-rn==1?"MEDIUM":"LOW"}),(st=oe._videosdkLogs)===null||st===void 0||st.pushLogs({logText:"Consumer Peer ".concat(ur.appData.peerId," changed to ").concat(ur.spatialLayers-1-rn==0?"HIGH":ur.spatialLayers-1-rn==1?"MEDIUM":"LOW",", previous quality was ").concat(ur.spatialLayers-1-ur.currentSpatialLayer==0?"HIGH":ur.spatialLayers-1-ur.currentSpatialLayer==1?"MEDIUM":"LOW"),logType:"INFO",attributes:{consumerId:qn}})):(oe._eventEmitter.emit("VIDEO_QUALITY_CHANGED",{peerId:ur.appData.peerId,prevQuality:"HIGH",currentQuality:"HIGH"}),(Xe=oe._videosdkLogs)===null||Xe===void 0||Xe.pushLogs({logText:"Consumer Peer ".concat(ur.appData.peerId," changed to HIGH, previous quality was HIGH"),logType:"INFO",attributes:{consumerId:qn}})),ur.currentSpatialLayer=rn,ur.currentTemporalLayer=mn,je.dispatch(Br(qn,rn,mn)),et.abrupt("break",155);case 79:return Rr=_e.data,Tr=Rr.consumerId,ls=Rr.score,je.dispatch(zt(Tr,ls)),et.abrupt("break",155);case 82:if(Fs=_e.data.dataConsumerId,$i=oe._dataConsumers.get(Fs)){et.next=86;break}return et.abrupt("break",155);case 86:return $i.close(),oe._dataConsumers.delete(Fs),ws=$i.appData.peerId,je.dispatch(Lr(Fs,ws)),et.abrupt("break",155);case 91:return Qa=_e.data.peerId,us=Q(Qa),je.dispatch(us),oe._eventEmitter.emit(us.type,us.payload),et.abrupt("break",155);case 96:return oe._eventEmitter.emit("TRANSCRIPTION_STATE_CHANGED",_e.data),(js=oe._openTelemetry)===null||js===void 0||js.traceAutoComplete({spanName:"Emitted TRANSCRIPTION_STATE_CHANGED, status : ".concat(_e.data.status),attributes:{data:JSON.stringify(_e.data)},status:1}),et.abrupt("break",155);case 99:return oe._eventEmitter.emit("TRANSCRIPTION_TEXT",_e.data),et.abrupt("break",155);case 101:return oe._eventEmitter.emit("RECORDING_STATE_CHANGED",_e.data),(Bs=oe._openTelemetry)===null||Bs===void 0||Bs.traceAutoComplete({spanName:"Emitted RECORDING_STATE_CHANGED, status : ".concat(_e.data.status),attributes:{data:JSON.stringify(_e.data)},status:1}),et.abrupt("break",155);case 104:return oe._eventEmitter.emit("RECORDING_STARTED",{}),et.abrupt("break",155);case 106:return oe._eventEmitter.emit("RECORDING_STOPPED",{}),et.abrupt("break",155);case 108:return oe._eventEmitter.emit("LIVESTREAM_STATE_CHANGED",_e.data),(ft=oe._openTelemetry)===null||ft===void 0||ft.traceAutoComplete({spanName:"Emitted LIVESTREAM_STATE_CHANGED, status : ".concat(_e.data.status),attributes:{data:JSON.stringify(_e.data)},status:1}),et.abrupt("break",155);case 111:return oe._eventEmitter.emit("LIVESTREAM_STARTED",{}),et.abrupt("break",155);case 113:return oe._eventEmitter.emit("LIVESTREAM_STOPPED",{}),et.abrupt("break",155);case 115:return oe._eventEmitter.emit("HLS_STATE_CHANGED",_e.data),(Yr=oe._openTelemetry)===null||Yr===void 0||Yr.traceAutoComplete({spanName:"Emitted HLS_STATE_CHANGED, status : ".concat(_e.data.status),attributes:{data:JSON.stringify(_e.data)},status:1}),et.abrupt("break",155);case 118:return _e.data.isPlayable&&(oe._eventEmitter.emit("HLS_STATE_CHANGED",$n($n({},_e.data),{},{status:Or.V.HLS_PLAYABLE})),(Js=oe._openTelemetry)===null||Js===void 0||Js.traceAutoComplete({spanName:"Protoo Noti: hlsPlayableStateChanged",status:1})),et.abrupt("break",155);case 120:return Uo=_e.data.downstreamUrl,oe._eventEmitter.emit("HLS_STARTED",Uo),et.abrupt("break",155);case 123:return oe._eventEmitter.emit("HLS_STOPPED",{}),et.abrupt("break",155);case 125:return Xa=_e.data.state,oe._eventEmitter.emit("WHITEBOARD_STARTED",{state:Xa}),et.abrupt("break",155);case 128:return oe._eventEmitter.emit("WHITEBOARD_STOPPED",{}),et.abrupt("break",155);case 130:return oe._eventEmitter.emit("VIDEO_STATE_CHANGED",_e.data),et.abrupt("break",155);case 132:return Ja=_e.data.currentTime,oe._eventEmitter.emit("VIDEO_SEEKED",{currentTime:Ja}),et.abrupt("break",155);case 135:return oe._eventEmitter.emit("CONNECTION_OPEN",_e.data),et.abrupt("break",155);case 137:return oe._eventEmitter.emit("CONNECTION_CLOSE",_e.data),et.abrupt("break",155);case 139:return oe._eventEmitter.emit("CONNECTION_CHAT_MESSAGE",_e.data),et.abrupt("break",155);case 141:return oe._eventEmitter.emit("CONNECTION_PARTICIPANT_JOIN",_e.data),et.abrupt("break",155);case 143:return oe._eventEmitter.emit("CONNECTION_PARTICIPANT_LEFT",_e.data),et.abrupt("break",155);case 145:return oe._eventEmitter.emit("PUBSUB_MESSAGE",_e.data),et.abrupt("break",155);case 147:return oe._eventEmitter.emit("PEER_MODE_CHANGED",_e.data),($o=oe._openTelemetry)===null||$o===void 0||$o.traceAutoComplete({spanName:"Emitted PEER_MODE_CHANGED",attributes:{data:JSON.stringify(_e.data)},status:1}),et.abrupt("break",155);case 150:return Vo=_e.data,Zs=Vo.transportId,cn=Vo.iceParameters,Za=(Ec=oe._openTelemetry)===null||Ec===void 0?void 0:Ec.trace({spanName:"Protoo Noti: restartIce for transportId :".concat(Zs),attributes:{iceParameters:JSON.stringify(cn)}}),oe.handleRemoteRestartIce({transportId:Zs,iceParameters:cn,internalSpan:Za}),et.abrupt("break",155);case 154:Pe.error('unknown protoo notification.method "%s"',_e.method);case 155:case"end":return et.stop()}},rt)}));return function(rt){return tt.apply(this,arguments)}}());case 27:case"end":return Re.stop()}},X,this)})),function(){return Bo.apply(this,arguments)})},{key:"requestEntry",value:(Ra=(0,u.A)(d().mark(function X(){var B,V,$;return d().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return $=(B=this._openTelemetry)===null||B===void 0?void 0:B.trace({spanName:"Requesting Entry",span:this._joinSpan}),G.next=3,this._protoo.request("requestEntry",{name:this._displayName});case 3:(V=this._openTelemetry)===null||V===void 0||V.completeSpan({span:$,status:1,message:"Entry Requested Successfully"});case 4:case"end":return G.stop()}},X,this)})),function(){return Ra.apply(this,arguments)})},{key:"respondEntry",value:(Ya=(0,u.A)(d().mark(function X(B,V){var $,G,se;return d().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return se=($=this._openTelemetry)===null||$===void 0?void 0:$.trace({spanName:"Responding Entry",attributes:{peerId:B,decision:V},span:this._joinSpan}),ae.next=3,this._protoo.request("respondEntry",{id:B,decision:V});case 3:(G=this._openTelemetry)===null||G===void 0||G.completeSpan({message:"Entry Responded Successfully",span:se,status:1});case 4:case"end":return ae.stop()}},X,this)})),function(X,B){return Ya.apply(this,arguments)})},{key:"startTranscription",value:(Ea=(0,u.A)(d().mark(function X(B){var V,$,G,se,ae;return d().wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:return Pe.debug("startTranscription()"),G=(V=this._openTelemetry)===null||V===void 0?void 0:V.trace({spanName:"startTranscription() Start",attributes:{config:B?JSON.stringify(B):"config Not Specify"}}),Be.prev=2,Be.next=5,this._protoo.request("startTranscription",{config:B});case 5:Be.next=13;break;case 7:Be.prev=7,Be.t0=Be.catch(2),Pe.error("startTranscription() | failed:%o",Be.t0),(se=this._openTelemetry)===null||se===void 0||se.completeSpan({span:G,status:2,message:"startTranscription() failed"}),(ae=this._videosdkLogs)===null||ae===void 0||ae.pushLogs({logText:"Error startTranscription() failed",logType:"ERROR",attributes:{error:Be.t0.message}}),this._emitError({code:4031,message:Be.t0.message});case 13:($=this._openTelemetry)===null||$===void 0||$.completeSpan({span:G,status:1,message:"startTranscription() End"});case 14:case"end":return Be.stop()}},X,this,[[2,7]])})),function(X){return Ea.apply(this,arguments)})},{key:"stopTranscription",value:(Ss=(0,u.A)(d().mark(function X(){var B,V,$,G,se;return d().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return Pe.debug("stopTranscription()"),$=(B=this._openTelemetry)===null||B===void 0?void 0:B.trace({spanName:"stopTranscription() Start"}),ae.prev=2,ae.next=5,this._protoo.request("stopTranscription",{});case 5:ae.next=12;break;case 7:ae.prev=7,ae.t0=ae.catch(2),(G=this._openTelemetry)===null||G===void 0||G.completeSpan({span:$,status:2,message:"stopTranscription() failed"}),(se=this._videosdkLogs)===null||se===void 0||se.pushLogs({logText:"Error stopTranscription() failed",logType:"ERROR",attributes:{error:ae.t0.message}}),this._emitError({code:4032,message:ae.t0.message});case 12:(V=this._openTelemetry)===null||V===void 0||V.completeSpan({span:$,status:1,message:"stopTranscription() End"});case 13:case"end":return ae.stop()}},X,this,[[2,7]])})),function(){return Ss.apply(this,arguments)})},{key:"startRecording",value:(qa=(0,u.A)(d().mark(function X(B,V,$,G){var se,ae,Be,we,gt;return d().wrap(function(qe){for(;;)switch(qe.prev=qe.next){case 0:return Pe.debug("startRecording()"),Be=(se=this._openTelemetry)===null||se===void 0?void 0:se.trace({spanName:"startRecording() Start",attributes:{webhookUrl:B||"webhookUrl Not Specify",awsDirPath:V||"awsDirPath Not Specify",config:$?JSON.stringify($):"config Not Specify",transcription:G?JSON.stringify(G):"transcription Not Specify"}}),qe.prev=2,qe.next=5,this._protoo.request("startRecording",{webhookUrl:B,awsDirPath:V,config:$,transcription:G});case 5:qe.next=13;break;case 7:qe.prev=7,qe.t0=qe.catch(2),Pe.error("startRecording() | failed:%o",qe.t0),(we=this._openTelemetry)===null||we===void 0||we.completeSpan({span:Be,status:2,message:"startRecording() failed"}),(gt=this._videosdkLogs)===null||gt===void 0||gt.pushLogs({logText:"Error startRecording() failed",logType:"ERROR",attributes:{error:qe.t0.message}}),this._emitError({code:4011,message:qe.t0.message});case 13:(ae=this._openTelemetry)===null||ae===void 0||ae.completeSpan({span:Be,status:1,message:"startRecording() End"});case 14:case"end":return qe.stop()}},X,this,[[2,7]])})),function(X,B,V,$){return qa.apply(this,arguments)})},{key:"stopRecording",value:(Ka=(0,u.A)(d().mark(function X(){var B,V,$,G,se;return d().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:if(!this._closed){ae.next=2;break}return ae.abrupt("return");case 2:return Pe.debug("stopRecording()"),$=(B=this._openTelemetry)===null||B===void 0?void 0:B.trace({spanName:"stopRecording() Start"}),ae.prev=4,ae.next=7,this._protoo.request("stopRecording",{});case 7:ae.next=14;break;case 9:ae.prev=9,ae.t0=ae.catch(4),(G=this._openTelemetry)===null||G===void 0||G.completeSpan({span:$,status:2,message:"stopRecording() failed"}),(se=this._videosdkLogs)===null||se===void 0||se.pushLogs({logText:"Error stopRecording() failed",logType:"ERROR",attributes:{error:ae.t0.message}}),this._emitError({code:4012,message:ae.t0.message});case 14:(V=this._openTelemetry)===null||V===void 0||V.completeSpan({span:$,status:1,message:"stopRecording() End"});case 15:case"end":return ae.stop()}},X,this,[[4,9]])})),function(){return Ka.apply(this,arguments)})},{key:"startLivestream",value:(za=(0,u.A)(d().mark(function X(B,V){var $,G,se,ae,Be;return d().wrap(function(we){for(;;)switch(we.prev=we.next){case 0:return Pe.debug("startLivestream()"),se=($=this._openTelemetry)===null||$===void 0?void 0:$.trace({spanName:"startLivestream() Start",attributes:{outputs:B?JSON.stringify(B):"outputs Not Specify",config:V?JSON.stringify(V):"config Not Specify"}}),we.prev=2,we.next=5,this._protoo.request("startLivestream",{outputs:B,config:V});case 5:we.next=12;break;case 7:we.prev=7,we.t0=we.catch(2),(ae=this._openTelemetry)===null||ae===void 0||ae.completeSpan({span:se,status:1,message:"startLivestream() End"}),(Be=this._videosdkLogs)===null||Be===void 0||Be.pushLogs({logText:"Error startLivestream() failed",logType:"ERROR",attributes:{error:we.t0.message}}),this._emitError({code:4013,message:we.t0.message});case 12:(G=this._openTelemetry)===null||G===void 0||G.completeSpan({span:se,status:1,message:"startLivestream() End"});case 13:case"end":return we.stop()}},X,this,[[2,7]])})),function(X,B){return za.apply(this,arguments)})},{key:"stopLivestream",value:(wc=(0,u.A)(d().mark(function X(){var B,V,$,G,se;return d().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return Pe.debug("stopLivestream()"),$=(B=this._openTelemetry)===null||B===void 0?void 0:B.trace({spanName:"stopLivestream() Start"}),ae.prev=2,ae.next=5,this._protoo.request("stopLivestream",{});case 5:ae.next=12;break;case 7:ae.prev=7,ae.t0=ae.catch(2),(G=this._videosdkLogs)===null||G===void 0||G.pushLogs({logText:"Error stopLivestream() failed",logType:"ERROR",attributes:{error:ae.t0.message}}),(se=this._openTelemetry)===null||se===void 0||se.completeSpan({span:$,status:2,message:"Error stopLivestream() failed"}),this._emitError({code:4014,message:ae.t0.message});case 12:(V=this._openTelemetry)===null||V===void 0||V.completeSpan({span:$,status:1,message:"stopLivestream() End"});case 13:case"end":return ae.stop()}},X,this,[[2,7]])})),function(){return wc.apply(this,arguments)})},{key:"startHls",value:(Sc=(0,u.A)(d().mark(function X(B,V){var $,G,se,ae,Be;return d().wrap(function(we){for(;;)switch(we.prev=we.next){case 0:return B=B||{},V=V||{},Pe.debug("startHls()"),se=($=this._openTelemetry)===null||$===void 0?void 0:$.trace({spanName:"startHls() Start",attributes:{config:B?JSON.stringify(B):"config Not Specify",transcription:V?JSON.stringify(V):"transcription Not Specify"}}),we.prev=4,we.next=7,this._protoo.request("startHls",{config:B,transcription:V});case 7:we.next=15;break;case 9:we.prev=9,we.t0=we.catch(4),(ae=this._videosdkLogs)===null||ae===void 0||ae.pushLogs({logText:"Error startHls() failed",logType:"ERROR",attributes:{error:we.t0.message}}),(Be=this._openTelemetry)===null||Be===void 0||Be.completeSpan({span:se,status:2,message:"Error startHls() failed"}),this._emitError({code:4016,message:we.t0.message}),Pe.error("startHls() | failed:%o",we.t0);case 15:(G=this._openTelemetry)===null||G===void 0||G.completeSpan({span:se,status:1,message:"startHlsSpan() End"});case 16:case"end":return we.stop()}},X,this,[[4,9]])})),function(X,B){return Sc.apply(this,arguments)})},{key:"stopHls",value:(wa=(0,u.A)(d().mark(function X(){var B,V,$,G,se;return d().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return Pe.debug("stopHls()"),$=(B=this._openTelemetry)===null||B===void 0?void 0:B.trace({spanName:"stopHls() Start"}),ae.prev=2,ae.next=5,this._protoo.request("stopHls",{});case 5:ae.next=12;break;case 7:ae.prev=7,ae.t0=ae.catch(2),(G=this._videosdkLogs)===null||G===void 0||G.pushLogs({logText:"Error stopHls() failed",logType:"ERROR",attributes:{error:ae.t0.message}}),(se=this._openTelemetry)===null||se===void 0||se.completeSpan({span:$,status:2,message:"Error stopHls() failed"}),this._emitError({code:4017,message:ae.t0.message});case 12:(V=this._openTelemetry)===null||V===void 0||V.completeSpan({span:$,status:1,message:"stopHls() End"});case 13:case"end":return ae.stop()}},X,this,[[2,7]])})),function(){return wa.apply(this,arguments)})},{key:"startWhiteboard",value:(bc=(0,u.A)(d().mark(function X(){return d().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return Pe.debug("startWhiteboard()"),B.prev=1,B.next=4,this._protoo.request("startWhiteboard",{});case 4:B.next=10;break;case 6:B.prev=6,B.t0=B.catch(1),Pe.error("startWhiteboard() | failed:%o",B.t0),this._emitError({code:3021,message:B.t0.message});case 10:case"end":return B.stop()}},X,this,[[1,6]])})),function(){return bc.apply(this,arguments)})},{key:"stopWhiteboard",value:(jo=(0,u.A)(d().mark(function X(){return d().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return Pe.debug("stopWhiteboard()"),B.prev=1,B.next=4,this._protoo.request("stopWhiteboard",{});case 4:B.next=10;break;case 6:B.prev=6,B.t0=B.catch(1),Pe.error("stopWhiteboard() | failed:%o",B.t0),this._emitError({code:3022,message:B.t0.message});case 10:case"end":return B.stop()}},X,this,[[1,6]])})),function(){return jo.apply(this,arguments)})},{key:"pinStateChange",value:(_c=(0,u.A)(d().mark(function X(B){var V,$,G,se;return d().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return $=B.peerId,G=B.state,(V=this._openTelemetry)===null||V===void 0||V.traceAutoComplete({spanName:"Pin state Change for ".concat($),attributes:{state:G?JSON.stringify(G):null},status:1}),ae.prev=2,ae.next=5,this._protoo.request("pinStateChanged",{peerId:$,state:G});case 5:ae.next=11;break;case 7:ae.prev=7,ae.t0=ae.catch(2),(se=this._videosdkLogs)===null||se===void 0||se.pushLogs({logText:"Error pinStateChange() failed",logType:"ERROR",attributes:{error:ae.t0.message}}),Pe.error("pinStateChange() | failed");case 11:case"end":return ae.stop()}},X,this,[[2,7]])})),function(X){return _c.apply(this,arguments)})},{key:"startVideo",value:(yc=(0,u.A)(d().mark(function X(B){var V,$,G;return d().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:return $=B.link,Pe.debug("startVideo()"),(V=this._videosdkLogs)===null||V===void 0||V.pushLogs({logText:"startVideo() Calling",logType:"INFO"}),se.prev=3,se.next=6,this._protoo.request("startVideo",{link:$});case 6:se.next=13;break;case 8:se.prev=8,se.t0=se.catch(3),(G=this._videosdkLogs)===null||G===void 0||G.pushLogs({logText:"Error startVideo() failed",logType:"ERROR",attributes:{error:se.t0.message}}),Pe.error("startVideo() | failed:%o",se.t0),this._emitError({code:3023,message:se.t0.message});case 13:case"end":return se.stop()}},X,this,[[3,8]])})),function(X){return yc.apply(this,arguments)})},{key:"stopVideo",value:(vc=(0,u.A)(d().mark(function X(){var B,V;return d().wrap(function($){for(;;)switch($.prev=$.next){case 0:return Pe.debug("stopVideo()"),(B=this._videosdkLogs)===null||B===void 0||B.pushLogs({logText:"stopVideo() Calling",logType:"INFO"}),$.prev=2,$.next=5,this._protoo.request("stopVideo",{});case 5:$.next=12;break;case 7:$.prev=7,$.t0=$.catch(2),(V=this._videosdkLogs)===null||V===void 0||V.pushLogs({logText:"Error stopVideo() failed",logType:"ERROR",attributes:{error:$.t0.message}}),Pe.error("stopVideo() | failed:%o",$.t0),this._emitError({code:3024,message:$.t0.message});case 12:case"end":return $.stop()}},X,this,[[2,7]])})),function(){return vc.apply(this,arguments)})},{key:"pauseVideo",value:(Fo=(0,u.A)(d().mark(function X(B){return d().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return Pe.debug("pauseVideo()"),V.prev=1,V.next=4,this._protoo.request("pauseVideo",{currentTime:B});case 4:V.next=10;break;case 6:V.prev=6,V.t0=V.catch(1),Pe.error("pauseVideo() | failed:%o",V.t0),this._emitError({code:3025,message:V.t0.message});case 10:case"end":return V.stop()}},X,this,[[1,6]])})),function(X){return Fo.apply(this,arguments)})},{key:"resumeVideo",value:(No=(0,u.A)(d().mark(function X(){return d().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return Pe.debug("resumeVideo()"),B.prev=1,B.next=4,this._protoo.request("resumeVideo",{});case 4:B.next=10;break;case 6:B.prev=6,B.t0=B.catch(1),Pe.error("resumeVideo() | failed:%o",B.t0),this._emitError({code:3026,message:B.t0.message});case 10:case"end":return B.stop()}},X,this,[[1,6]])})),function(){return No.apply(this,arguments)})},{key:"seekVideo",value:(Mo=(0,u.A)(d().mark(function X(B){return d().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return Pe.debug("seekVideo()"),V.prev=1,V.next=4,this._protoo.request("seekVideo",{currentTime:B});case 4:V.next=10;break;case 6:V.prev=6,V.t0=V.catch(1),Pe.error("seekVideo() | failed:%o",V.t0),this._emitError({code:3031,message:V.t0.message});case 10:case"end":return V.stop()}},X,this,[[1,6]])})),function(X){return Mo.apply(this,arguments)})},{key:"enablePeerMic",value:(zu=(0,u.A)(d().mark(function X(B){var V,$;return d().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return(V=this._openTelemetry)===null||V===void 0||V.traceAutoComplete({spanName:"Enabling peer ".concat(B," Mic"),status:1}),Pe.debug("enablePeerMic()"),G.prev=2,G.next=5,this._protoo.request("enablePeerMic",{peerId:B});case 5:G.next=11;break;case 7:G.prev=7,G.t0=G.catch(2),($=this._videosdkLogs)===null||$===void 0||$.pushLogs({logText:"Error enablePeerMic() failed",logType:"ERROR",attributes:{error:G.t0.message}}),Pe.error("enablePeerMic() | failed:%o",G.t0);case 11:case"end":return G.stop()}},X,this,[[2,7]])})),function(X){return zu.apply(this,arguments)})},{key:"disablePeerMic",value:(Wu=(0,u.A)(d().mark(function X(B){var V,$;return d().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return(V=this._openTelemetry)===null||V===void 0||V.traceAutoComplete({spanName:"Disabling peer ".concat(B," Mic"),status:1}),Pe.debug("disablePeerMic()"),G.prev=2,G.next=5,this._protoo.request("disablePeerMic",{peerId:B});case 5:G.next=11;break;case 7:G.prev=7,G.t0=G.catch(2),($=this._videosdkLogs)===null||$===void 0||$.pushLogs({logText:"Error disablePeerMic() failed",logType:"ERROR",attributes:{error:G.t0.message}}),Pe.error("disablePeerMic() | failed:%o",G.t0);case 11:case"end":return G.stop()}},X,this,[[2,7]])})),function(X){return Wu.apply(this,arguments)})},{key:"consumeWebcamStreams",value:(Hu=(0,u.A)(d().mark(function X(B){var V,$;return d().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(!this._closed){G.next=2;break}return G.abrupt("return");case 2:return Pe.debug("consumeWebcamStreams()"),(V=this._videosdkLogs)===null||V===void 0||V.pushLogs({logText:"consumeWebcamStreams() Calling",logType:"INFO",attributes:{peerId:B}}),G.prev=4,G.next=7,this._protoo.request("consumeVideoStreams",{peerId:B});case 7:G.next=13;break;case 9:G.prev=9,G.t0=G.catch(4),($=this._videosdkLogs)===null||$===void 0||$.pushLogs({logText:"Error consumeWebcamStreams() failed",logType:"ERROR",attributes:{error:G.t0.message}}),Pe.error("consumeWebcamStreams() | failed:%o",G.t0);case 13:case"end":return G.stop()}},X,this,[[4,9]])})),function(X){return Hu.apply(this,arguments)})},{key:"consumeMicStreams",value:(Gu=(0,u.A)(d().mark(function X(B){var V,$;return d().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return Pe.debug("consumeMicStreams()"),(V=this._videosdkLogs)===null||V===void 0||V.pushLogs({logText:"consumeMicStreams() Calling",logType:"INFO",attributes:{peerId:B}}),G.prev=2,G.next=5,this._protoo.request("consumeAudioStreams",{peerId:B});case 5:G.next=11;break;case 7:G.prev=7,G.t0=G.catch(2),($=this._videosdkLogs)===null||$===void 0||$.pushLogs({logText:"Error consumeMicStreams() failed",logType:"ERROR",attributes:{error:G.t0.message}}),Pe.error("consumeMicStreams() | failed:%o",G.t0);case 11:case"end":return G.stop()}},X,this,[[2,7]])})),function(X){return Gu.apply(this,arguments)})},{key:"stopConsumingMicStreams",value:(Vu=(0,u.A)(d().mark(function X(B){var V,$;return d().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(!this._closed){G.next=2;break}return G.abrupt("return");case 2:return Pe.debug("stopConsumingAudioStreams()"),G.prev=3,G.next=6,this._protoo.request("stopConsumingAudioStreams",{peerId:B});case 6:(V=this._videosdkLogs)===null||V===void 0||V.pushLogs({logText:"stopConsumingAudioStreams() Calling",logType:"INFO",attributes:{peerId:B}}),G.next=13;break;case 9:G.prev=9,G.t0=G.catch(3),($=this._videosdkLogs)===null||$===void 0||$.pushLogs({logText:"Error stopConsumingMicStreams() failed",logType:"ERROR",attributes:{error:G.t0.message}}),Pe.error("stopConsumingMicStreams() | failed:%o",G.t0);case 13:case"end":return G.stop()}},X,this,[[3,9]])})),function(X){return Vu.apply(this,arguments)})},{key:"stopConsumingWebcamStreams",value:($u=(0,u.A)(d().mark(function X(B){var V,$;return d().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return Pe.debug("stopConsumingWebcamStreams()"),(V=this._videosdkLogs)===null||V===void 0||V.pushLogs({logText:"stopConsumingWebcamStreams() Calling",logType:"INFO",attributes:{peerId:B}}),G.prev=2,G.next=5,this._protoo.request("stopConsumingVideoStreams",{peerId:B});case 5:G.next=11;break;case 7:G.prev=7,G.t0=G.catch(2),($=this._videosdkLogs)===null||$===void 0||$.pushLogs({logText:"Error stopConsumingWebcamStreams() failed",logType:"ERROR",attributes:{error:G.t0.message}}),Pe.error("stopConsumingWebcamStreams() | failed:%o",G.t0);case 11:case"end":return G.stop()}},X,this,[[2,7]])})),function(X){return $u.apply(this,arguments)})},{key:"changeMode",value:(Uu=(0,u.A)(d().mark(function X(B){var V,$,G,se,ae,Be,we,gt,qe,ut,oe,Re,tt,rt,_e,Ue,pt,Bt,Wt,Dt,Ut,Ft,qt,nr,Lt,dt,en,Kr=this;return d().wrap(function(ir){for(;;)switch(ir.prev=ir.next){case 0:if($=(V=this._openTelemetry)===null||V===void 0?void 0:V.trace({spanName:"changeMode() Calling with mode : ".concat(B)}),G=this._mode,ir.prev=2,G!==B){ir.next=7;break}throw(se=this._openTelemetry)===null||se===void 0||se.completeSpan({span:$,status:2,message:"changeMode() Ending"}),(ae=this._videosdkLogs)===null||ae===void 0||ae.pushLogs({logText:"You are already in ".concat(B," mode"),logType:"INFO"}),new Error("You are already in ".concat(B," mode"));case 7:if(this._mode=B,B!==kr.n.CONFERENCE){ir.next=38;break}return this._consume=!0,this._produce=!0,this._mediasoupDevice=new E.Device({handlerName:this._handlerName}),ir.next=14,this._protoo.request("getRouterRtpCapabilities");case 14:return gt=ir.sent,ir.next=17,this._mediasoupDevice.load({routerRtpCapabilities:gt});case 17:if(!this._produce){ir.next=22;break}return ir.next=20,this._protoo.request("createWebRtcTransport",{preferredProtocol:this._preferredProtocol,producing:!0,consuming:!1,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 20:qe=ir.sent,this.createProducerTransport(qe,$);case 22:if(!this._consume){ir.next=29;break}return ir.next=25,this._protoo.request("createWebRtcTransport",{preferredProtocol:this._preferredProtocol,producing:!1,consuming:!0,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 25:ut=ir.sent,oe=ut.id,Re=ut.iceParameters,tt=ut.iceCandidates,rt=ut.dtlsParameters,_e=ut.sctpParameters,this._recvTransport=this._mediasoupDevice.createRecvTransport({id:oe,iceParameters:Re,iceCandidates:tt,dtlsParameters:rt,sctpParameters:_e,iceServers:this._iceServers}),this._recvTransport.on("connect",function(qr,jr,on){var pn=qr.dtlsParameters;Kr._protoo.request("connectWebRtcTransport",{transportId:Kr._recvTransport.id,dtlsParameters:pn}).then(jr).catch(on)});case 29:return(Be=this._openTelemetry)===null||Be===void 0||Be.traceAutoComplete({spanName:"Sending changeMode request to server",span:$,status:1}),ir.next=32,this._protoo.request("changeMode",{mode:B});case 32:this._produce&&(je.dispatch(he({canSendMic:this._mediasoupDevice.canProduce("audio"),canSendWebcam:this._mediasoupDevice.canProduce("video")})),this._micEnabled&&this.enableMic(this.customMicrophoneAudioTrack),Ue=N(),this._webcamEnabled&&(!Ue||Ue.webcamEnabled||this._externalVideo)&&this.enableWebcam(this.customCameraVideoTrack,$),this.enableChatDataProducer()),window.SHOW_INFO&&(pt=je.getState(),Bt=pt.me,je.dispatch(Y(Bt.id))),(we=this._openTelemetry)===null||we===void 0||we.traceAutoComplete({spanName:"Emitting PEER_MODE_CHANGED for Peer : ".concat(this._peerId," "),span:$,status:1}),this._eventEmitter.emit("PEER_MODE_CHANGED",{peerId:this._peerId,mode:"CONFERENCE"}),ir.next=52;break;case 38:if(B!==kr.n.VIEWER){ir.next=52;break}return(Wt=this._openTelemetry)===null||Wt===void 0||Wt.traceAutoComplete({spanName:"Sending changeMode request to server",span:$,status:1}),ir.next=42,this._protoo.request("changeMode",{mode:B});case 42:this._consume=!1,this._produce=!1,this._dataConsumers.clear(),Lt=(Dt=this._openTelemetry)===null||Dt===void 0?void 0:Dt.trace({spanName:"Closing Trasnport",span:$}),(Ut=this._sendTransport)===null||Ut===void 0||Ut.close(),this._sendTransport=null,(Ft=this._recvTransport)===null||Ft===void 0||Ft.close(),this._recvTransport=null,(qt=this._openTelemetry)===null||qt===void 0||qt.completeSpan({span:Lt,status:1,message:"Closed Trasnport"}),(nr=this._openTelemetry)===null||nr===void 0||nr.completeSpan({span:Lt,status:1,message:"changeMode() Ending"});case 52:ir.next=58;break;case 54:ir.prev=54,ir.t0=ir.catch(2),(dt=this._videosdkLogs)===null||dt===void 0||dt.pushLogs({logText:"Error changeMode(".concat(B,") | failed"),logType:"ERROR",attributes:{error:ir.t0.message}}),(en=this._openTelemetry)===null||en===void 0||en.completeSpan({span:$,status:2,message:"changeMode(".concat(B,") | failed")});case 58:case"end":return ir.stop()}},X,this,[[2,54]])})),function(X){return Uu.apply(this,arguments)})},{key:"enablePeerWebcam",value:(Bu=(0,u.A)(d().mark(function X(B){var V,$;return d().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return(V=this._openTelemetry)===null||V===void 0||V.traceAutoComplete({spanName:"Enabling peer ".concat(B," Webcam"),status:1}),Pe.debug("enablePeerWebcam()"),G.prev=2,G.next=5,this._protoo.request("enablePeerWebcam",{peerId:B});case 5:G.next=11;break;case 7:G.prev=7,G.t0=G.catch(2),($=this._videosdkLogs)===null||$===void 0||$.pushLogs({logText:"Error enablePeerWebcam | failed",logType:"ERROR",attributes:{error:G.t0.message}}),Pe.error("enablePeerWebcam() | failed:%o",G.t0);case 11:case"end":return G.stop()}},X,this,[[2,7]])})),function(X){return Bu.apply(this,arguments)})},{key:"disablePeerWebcam",value:(Pl=(0,u.A)(d().mark(function X(B){var V,$;return d().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return(V=this._openTelemetry)===null||V===void 0||V.traceAutoComplete({spanName:"Disabling peer ".concat(B," Webcam"),status:1}),Pe.debug("disablePeerWebcam()"),G.prev=2,G.next=5,this._protoo.request("disablePeerWebcam",{peerId:B});case 5:G.next=10;break;case 7:G.prev=7,G.t0=G.catch(2),($=this._videosdkLogs)===null||$===void 0||$.pushLogs({logText:"Error disablePeerWebcam | failed",logType:"ERROR",attributes:{error:G.t0.message}});case 10:case"end":return G.stop()}},X,this,[[2,7]])})),function(X){return Pl.apply(this,arguments)})},{key:"enableMic",value:(Cl=(0,u.A)(d().mark(function X(){var B,V,$,G,se,ae,Be,we,gt,qe,ut,oe,Re,tt,rt,_e,Ue,pt,Bt,Wt,Dt,Ut,Ft,qt,nr,Lt,dt,en,Kr,ir,qr,jr,on,pn,$r,In,nt,mr,Vr,bn,ti,An,On,Pn,Si,Sn,Mn,wi,wn,ri,zn,Yi,Ui,dr,ni,Ln,Kn,ui,fn,Nn,Li,di,Di,ii,qn,rn,mn=this,ur=arguments;return d().wrap(function(st){for(;;)switch(st.prev=st.next){case 0:if(ae=ur.length>0&&ur[0]!==void 0?ur[0]:void 0,Be=ur.length>1&&ur[1]!==void 0?ur[1]:void 0,we=(B=this._openTelemetry)===null||B===void 0?void 0:B.trace({spanName:"enableMic() Calling ".concat(ae?"With Custom Audio Track":"Without Custom Audio Track "),attributes:{customAudioConfig:ae?JSON.stringify(ae):"Not Specify Custom Track"},span:Be||null}),Pe.debug("enableMic()"),this._micEnabled=!0,!this._micProducer){st.next=20;break}if(ut=(gt=this._openTelemetry)===null||gt===void 0?void 0:gt.trace({spanName:"Mic Producer found",span:we}),ae&&((oe=this._openTelemetry)===null||oe===void 0||oe.traceAutoComplete({spanName:"Stopping customAudioTrack",span:we,status:1}),ae.getTracks().forEach(function(Xe){Xe.stop()})),(qe=this._openTelemetry)===null||qe===void 0||qe.completeSpan({span:ut,status:1,message:"Resuming Mic Producer"}),this._micProducer.resume(),Re=this._micProducer,!this._sendTransport){st.next=18;break}return st.next=14,this._sendTransport.produce({track:this._micProducer.track,encodings:this._micProducer._appData.encodings,codecOptions:this._micProducer._appData.codecOptions});case 14:this._micProducer=st.sent,this._micProducer?(rt=Z({id:this._micProducer.id,paused:this._micProducer.paused,track:this._micProducer.track,rtpParameters:this._micProducer.rtpParameters,codec:this._micProducer.rtpParameters.codecs[0].mimeType.split("/")[1],encodings:Re._appData.encodings,codecOptions:Re._appData.codecOptions,instance:this._micProducer}),this._micProducer.track.getConstraints().deviceId&&(this._mic.device=this._mics.get(this._micProducer.track.getConstraints().deviceId)),je.dispatch(rt),this._eventEmitter.emit(rt.type,rt.payload),(tt=this._openTelemetry)===null||tt===void 0||tt.completeSpan({span:we,status:1,message:"Enable Mic Successful"})):(_e=this._openTelemetry)===null||_e===void 0||_e.completeSpan({span:we,status:2,message:"Error in enableMic() :: micProducer null"}),st.next=19;break;case 18:this._emitError(Ke.q.ERROR_ACTION_PERFORMED_BEFORE_MEETING_JOINED);case 19:return st.abrupt("return");case 20:if(!this._mediasoupDevice){st.next=29;break}if(this._mediasoupDevice.canProduce("audio")){st.next=27;break}return Bt=this._deviceInfo.sdkType=="react-native"?Ke.q.ERROR_RN_MIC_ACCESS_UNAVAILABLE.message:Ke.q.ERROR_MICROPHONE_ACCESS_UNAVAILABLE.message,(Ue=this._videosdkLogs)===null||Ue===void 0||Ue.pushLogs({logText:Bt,attributes:{error:"Error in enableMic() :: Microphone access unavailable"},logType:"ERROR",dashboardLog:!0}),Pe.error("enableMic() | cannot produce audio"),(pt=this._openTelemetry)===null||pt===void 0||pt.completeSpan({span:we,status:2,message:"Error in enableMic() :: ".concat(Bt)}),st.abrupt("return");case 27:st.next=32;break;case 29:return(Wt=this._videosdkLogs)===null||Wt===void 0||Wt.pushLogs({logText:"Oops! Something went wrong, and we're unable to enable the mic. Please try again.",logType:"ERROR",attributes:{error:"Error in enableMic(): Something went wrong."},dashboardLog:!0}),(Dt=this._openTelemetry)===null||Dt===void 0||Dt.completeSpan({span:we,status:2,message:"Error in enableMic() :: mediasoupDevice is undefined"}),st.abrupt("return");case 32:if(st.prev=32,this._externalVideo){st.next=99;break}return Pe.debug("enableMic() | calling getUserMedia()"),st.next=37,this._updateMics(we);case 37:if(this._mic.device){st.next=40;break}throw new Error("Whoops! No Microphone Found: We couldn't find your microphone. Is it plugged in and turned on? If so, try restarting your computer or checking your device settings. Also, ensure you're on a secure website (https://).");case 40:try{ae&&(Ut=ae.getAudioTracks()[0]).readyState=="ended"&&(Ut=null,Kr=Ke.q.ERROR_CUSTOM_AUDIO_TRACK_ENDED,(en=this._videosdkLogs)===null||en===void 0||en.pushLogs({logText:Kr.message,logType:"INFO",attributes:{error:"In enableMic() :: Invalid Custom Track Passed"},dashboardLog:!0}),this._emitError(Kr))}catch(Xe){qr=Ke.q.ERROR_INVALID_CUSTOM_AUDIO_TRACK,(ir=this._videosdkLogs)===null||ir===void 0||ir.pushLogs({logText:qr.message,logType:"INFO",attributes:{error:"In enableMic() :: Invalid Custom Track Passed"}}),this._emitError(qr),console.log("Invalid Custom Audio Track Passed. Reverting to default Error: ".concat(Xe))}if(Ut){st.next=97;break}return pn=(jr=this._openTelemetry)===null||jr===void 0?void 0:jr.trace({spanName:"Creating Track",span:we}),st.prev=43,st.next=46,navigator.mediaDevices.getUserMedia({audio:{deviceId:{ideal:this._mic.device.deviceId},channelCount:1,noiseSuppression:!0,echoCancellation:!0,googEchoCancellation:!0,googEchoCancellation2:!0,googAutoGainControl:!0,googAutoGainControl2:!0,googNoiseSuppression:!0,googNoiseSuppression2:!0,googHighpassFilter:!0}});case 46:$r=st.sent,st.next=95;break;case 49:if(st.prev=49,st.t0=st.catch(43),(In=this._openTelemetry)===null||In===void 0||In.completeSpan({message:"Error in enableMic() :: ".concat(st.t0.message),span:pn,status:2}),st.t0.name!=="SecurityError"){st.next=60;break}Vr=Ke.q.ERROR_RN_MIC_ACCESS_DENIED_OR_DISMISSED,bn=Vr.message,this._emitError(Vr),(nt=this._videosdkLogs)===null||nt===void 0||nt.pushLogs({logText:bn,logType:"ERROR",attributes:{error:"Error in enableMic() :: Microphone Permission Denied or Dismissed"},dashboardLog:!0}),(mr=this._openTelemetry)===null||mr===void 0||mr.completeSpan({message:"Error in enableMic() :: occurred in creating audio track, ".concat(bn),span:we,status:2}),st.next=94;break;case 60:if(st.t0.name!=="DOMException"){st.next=68;break}On=Ke.q.ERROR_RN_MIC_NOT_FOUND,Pn=On.message,this._emitError(On),(ti=this._videosdkLogs)===null||ti===void 0||ti.pushLogs({logText:Pn,logType:"ERROR",attributes:{error:"Error in enableMic() :: No Microphone Device Found"},dashboardLog:!0}),(An=this._openTelemetry)===null||An===void 0||An.completeSpan({message:"Error in enableMic() :: occurred in creating audio track, ".concat(Pn),span:we,status:2}),st.next=94;break;case 68:if(!(st.t0 instanceof DOMException)){st.next=91;break}st.t1=st.t0.name,st.next=st.t1==="NotAllowedError"?72:st.t1==="NotReadableError"?75:st.t1==="NotFoundError"?78:85;break;case 72:return Si=this.handleNotAllowedError(st.t0,this._openTelemetry,this._videosdkLogs,we,"audio"),this._emitError(Si),st.abrupt("break",89);case 75:return Sn=this.handleNotReadableError(st.t0,this._openTelemetry,this._videosdkLogs,we,"audio"),this._emitError(Sn),st.abrupt("break",89);case 78:return Mn=Ke.q.ERROR_MICROPHONE_NOT_FOUND,navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Firefox")!=-1&&(Mn=Ke.q.ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS),wi=Mn.message,this._emitError(Mn),(V=this._videosdkLogs)===null||V===void 0||V.pushLogs({logText:wi,logType:"ERROR",attributes:{error:"Error in enableMic() :: No Microphone Device Found"},dashboardLog:!0}),($=this._openTelemetry)===null||$===void 0||$.completeSpan({message:"Error in enableMic() :: occurred in creating audio track, ".concat(wi),span:we,status:2}),st.abrupt("break",89);case 85:return wn="An error occurred in creating audio track, ".concat(st.t0.message),(G=this._videosdkLogs)===null||G===void 0||G.pushLogs({logText:st.t0.message,logType:"ERROR",attributes:{error:"Error in enableMic() :: ".concat(wn)},dashboardLog:!0}),(se=this._openTelemetry)===null||se===void 0||se.completeSpan({message:"Error in enableMic() :: ".concat(wn),span:we,status:2}),st.abrupt("break",89);case 89:st.next=94;break;case 91:Yi="An error occurred in creating audio track, ".concat(st.t0.message),(ri=this._videosdkLogs)===null||ri===void 0||ri.pushLogs({logText:st.t0.message,logType:"ERROR",attributes:{error:"Error in enableMic() :: ".concat(Yi)},dashboardLog:!0}),(zn=this._openTelemetry)===null||zn===void 0||zn.completeSpan({message:"Error in enableMic() :: ".concat(Yi),span:we,status:2});case 94:return st.abrupt("return");case 95:Ut=$r.getAudioTracks()[0],(on=this._openTelemetry)===null||on===void 0||on.completeSpan({message:"Audio Track Generated",span:pn,status:1});case 97:st.next=103;break;case 99:return st.next=101,this._getExternalVideoStream();case 101:Ui=st.sent,Ut=Ui.getAudioTracks()[0].clone();case 103:if(Ft=(qt=this._openTelemetry)===null||qt===void 0?void 0:qt.trace({spanName:"Generating Producer Configuration",span:we}),dr={opusStereo:1,opusDtx:1},ae&&(ni=ae.encoderConfig?Ae.$.audioProfiles[ae.encoderConfig]:Ae.$.audioProfiles.speech_standard,dr={opusStereo:ni.stereo?1:0,opusFec:ni.fec?1:0,opusDtx:ni.dtx?1:0,opusMaxPlaybackRate:ni.maxPlaybackRate,opusPtime:ni.packetTime}),Kn={encodings:Ln=[{networkPriority:"high"}],codecOptions:dr},(nr=this._openTelemetry)===null||nr===void 0||nr.traceAutoComplete({spanName:"Generated AppData",span:Ft,attributes:{appData:JSON.stringify(Kn)},status:1}),(Lt=this._openTelemetry)===null||Lt===void 0||Lt.completeSpan({span:Ft,status:1,message:"Producer Configuration Generated"}),Ft=(dt=this._openTelemetry)===null||dt===void 0?void 0:dt.trace({spanName:"Creating Mic Producer",span:we}),!this._sendTransport){st.next=118;break}return st.next=115,this._sendTransport.produce({track:Ut,encodings:Ln,codecOptions:dr,appData:Kn});case 115:this._micProducer=st.sent,st.next=120;break;case 118:return this._emitError(Ke.q.ERROR_ACTION_PERFORMED_BEFORE_MEETING_JOINED),st.abrupt("return");case 120:this._micProducer?(Ut.getConstraints().deviceId&&(this._mic.device=this._mics.get(Ut.getConstraints().deviceId)),Nn=Z({id:this._micProducer.id,paused:this._micProducer.paused,track:this._micProducer.track,rtpParameters:this._micProducer.rtpParameters,codec:this._micProducer.rtpParameters.codecs[0].mimeType.split("/")[1],encodings:Ln,codecOptions:dr,instance:this._micProducer}),je.dispatch(Nn),this._eventEmitter.emit(Nn.type,Nn.payload),this._micProducer.on("transportclose",function(){var Xe,Rr=le(mn._micProducer.id);je.dispatch(Rr),mn._eventEmitter.emit(Rr.type,Rr.payload),(Xe=mn._micProducer)===null||Xe===void 0||Xe.close(),mn._micProducer=null}),this._micProducer.on("trackended",function(){var Xe,Rr,Tr=mn._deviceInfo.sdkType=="react-native"?Ke.q.ERROR_RN_MIC_TRACK_ENDED:Ke.q.ERROR_MICROPHONE_TRACK_ENDED;(Xe=mn._videosdkLogs)===null||Xe===void 0||Xe.pushLogs({logText:message,logType:"ERROR",attributes:{error:"Error in enableMic() :: ".concat(Tr.message)},dashboardLog:!0}),(Rr=mn._openTelemetry)===null||Rr===void 0||Rr.traceAutoComplete({spanName:"this._micProducer trackended or Microphone disconnected!",span:we,message:Tr.message,status:2}),je.dispatch(yt({type:"error",text:"Microphone disconnected!"})),mn._emitError(Tr),mn.disableMic(!0,we).catch(function(){})}),(ui=this._openTelemetry)===null||ui===void 0||ui.completeSpan({span:Ft,status:1,message:"Mic Producer Created"}),(fn=this._openTelemetry)===null||fn===void 0||fn.completeSpan({span:we,status:1,message:"Enable Mic Successful"})):((Li=this._videosdkLogs)===null||Li===void 0||Li.pushLogs({logText:"Oops! Something went wrong, and we're unable to enable the mic. Please try again.",logType:"ERROR",attributes:{error:"Error in enableMic(): Something went wrong."},dashboardLog:!0}),(di=this._openTelemetry)===null||di===void 0||di.completeSpan({span:Ft,status:2,message:"Error in enableMic() :: micProducer null"}),(Di=this._openTelemetry)===null||Di===void 0||Di.completeSpan({span:enableWebcamSpan,status:2,message:"Error in enableMic() :: micProducer null"})),st.next=133;break;case 123:return st.prev=123,st.t2=st.catch(32),(ii=this._openTelemetry)===null||ii===void 0||ii.completeSpan({span:Ft,status:2,message:"Error in enableMic() :: occurred in creating mic producer, ".concat(st.t2.message)}),(qn=this._openTelemetry)===null||qn===void 0||qn.completeSpan({span:we,status:2,message:"Error in enableMic :: ".concat(st.t2.message)}),(rn=this._videosdkLogs)===null||rn===void 0||rn.pushLogs({logText:st.t2.message,logType:"ERROR",attributes:{error:"Error in enableMic() :: ".concat(st.t2.message)},dashboardLog:!0}),Pe.error("enableMic() | failed:%o",st.t2),je.dispatch(yt({type:"error",text:"Error enabling microphone: ".concat(st.t2)})),st.next=132,this._protoo.request("produceError",{mediaType:"audio",message:st.t2.message});case 132:Ut&&Ut.stop();case 133:case"end":return st.stop()}},X,this,[[32,123],[43,49]])})),function(){return Cl.apply(this,arguments)})},{key:"disableMic",value:(Oo=(0,u.A)(d().mark(function X(){var B,V,$,G,se,ae,Be,we,gt,qe,ut,oe,Re,tt,rt,_e,Ue,pt,Bt,Wt,Dt,Ut,Ft,qt,nr,Lt=arguments;return d().wrap(function(dt){for(;;)switch(dt.prev=dt.next){case 0:if($=Lt.length>0&&Lt[0]!==void 0&&Lt[0],G=Lt.length>1&&Lt[1]!==void 0?Lt[1]:void 0,Pe.debug("disableMic()"),se=(B=this._openTelemetry)===null||B===void 0?void 0:B.trace({spanName:"disableMic() Calling",status:1,span:G||null}),this._micProducer){dt.next=8;break}return(ae=this._openTelemetry)===null||ae===void 0||ae.completeSpan({span:se,status:2,message:"Error in disableMic() :: Mic Producer Not found"}),(Be=this._videosdkLogs)===null||Be===void 0||Be.pushLogs({logText:"Attempted to call disableMic() multiple times",attributes:{error:"Error in disableMic() :: Microphone is already disabled"},logType:"ERROR",dashboardLog:!0}),dt.abrupt("return");case 8:if(we=(V=this._openTelemetry)===null||V===void 0?void 0:V.trace({spanName:"Closing Mic Producer",span:se,status:1}),this._micEnabled=!1,!this._micProducer||$){dt.next=32;break}return oe=(gt=this._openTelemetry)===null||gt===void 0?void 0:gt.trace({spanName:"Pausing Mic Producer",span:we,status:1}),this._micProducer.pause(),Re=le(this._micProducer.id),(qe=this._openTelemetry)===null||qe===void 0||qe.completeSpan({span:oe,status:1,message:"Pause Mic Successfully"}),je.dispatch(Re),this._eventEmitter.emit(Re.type,Re.payload),dt.prev=17,dt.next=20,this._protoo.request("closeProducer",{producerId:this._micProducer.id});case 20:(tt=this._openTelemetry)===null||tt===void 0||tt.completeSpan({span:we,status:1,message:"Requested Server to Close Producer"}),dt.next=30;break;case 23:dt.prev=23,dt.t0=dt.catch(17),je.dispatch(yt({type:"error",text:"Error closing server-side mic Producer: ".concat(dt.t0)})),pt="Error in disableMic() :: Failed to close server-side microphone producer. closeProducer status: ".concat($),(rt=this._openTelemetry)===null||rt===void 0||rt.completeSpan({span:we,status:2,message:"Error in disableMic() :: ".concat(dt.t0.message)}),(_e=this._openTelemetry)===null||_e===void 0||_e.completeSpan({span:se,status:2,message:pt}),(Ue=this._videosdkLogs)===null||Ue===void 0||Ue.pushLogs({logText:pt,logType:"ERROR",attributes:{error:dt.t0.message},dashboardLog:!0});case 30:return(ut=this._openTelemetry)===null||ut===void 0||ut.completeSpan({span:se,status:1,message:"Mic Disabled Successfully"}),dt.abrupt("return");case 32:return this._micProducer.close(),Bt=le(this._micProducer.id),je.dispatch(Bt),this._eventEmitter.emit(Bt.type,Bt.payload),dt.prev=36,dt.next=39,this._protoo.request("closeProducer",{producerId:this._micProducer.id});case 39:(Wt=this._openTelemetry)===null||Wt===void 0||Wt.completeSpan({span:we,status:1,message:"Requested Server to Close Producer"}),(Dt=this._openTelemetry)===null||Dt===void 0||Dt.completeSpan({span:se,status:1,message:"Mic Disabled Successfully"}),dt.next=50;break;case 43:dt.prev=43,dt.t1=dt.catch(36),je.dispatch(yt({type:"error",text:"Error closing server-side mic Producer: ".concat(dt.t1)})),nr="Error in disableMic() :: Failed to close server-side microphone producer. closeProducer status: ".concat($),(Ut=this._openTelemetry)===null||Ut===void 0||Ut.completeSpan({span:we,status:2,message:"Error in disableMic() :: ".concat(dt.t1.message)}),(Ft=this._openTelemetry)===null||Ft===void 0||Ft.completeSpan({span:se,status:2,message:nr}),(qt=this._videosdkLogs)===null||qt===void 0||qt.pushLogs({logText:nr,logType:"ERROR",attributes:{error:dt.t1.message},dashboardLog:!0});case 50:this._micProducer=null;case 51:case"end":return dt.stop()}},X,this,[[17,23],[36,43]])})),function(){return Oo.apply(this,arguments)})},{key:"muteMic",value:(Wn=(0,u.A)(d().mark(function X(){var B;return d().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return Pe.debug("muteMic()"),this._micEnabled=!1,this._micProducer.pause(),V.prev=3,V.next=6,this._protoo.request("pauseProducer",{producerId:this._micProducer.id});case 6:je.dispatch({type:"SET_PRODUCER_PAUSED",payload:{producerId:this._micProducer.id}}),V.next=14;break;case 9:V.prev=9,V.t0=V.catch(3),Pe.error("muteMic() | failed: %o",V.t0),(B=this._videosdkLogs)===null||B===void 0||B.pushLogs({logText:"Error pausing server-side mic Producer",logType:"ERROR",attributes:{error:V.t0.message}}),je.dispatch(yt({type:"error",text:"Error pausing server-side mic Producer: ".concat(V.t0)}));case 14:case"end":return V.stop()}},X,this,[[3,9]])})),function(){return Wn.apply(this,arguments)})},{key:"unmuteMic",value:(Tt=(0,u.A)(d().mark(function X(){var B;return d().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return Pe.debug("unmuteMic()"),this._micEnabled=!0,this._micProducer.resume(),V.prev=3,V.next=6,this._protoo.request("resumeProducer",{producerId:this._micProducer.id});case 6:je.dispatch({type:"SET_PRODUCER_RESUMED",payload:{producerId:this._micProducer.id}}),V.next=14;break;case 9:V.prev=9,V.t0=V.catch(3),Pe.error("unmuteMic() | failed: %o",V.t0),(B=this._videosdkLogs)===null||B===void 0||B.pushLogs({logText:"Error resuming server-side mic Producer",logType:"ERROR",attributes:{error:V.t0.message}}),je.dispatch(yt({type:"error",text:"Error resuming server-side mic Producer: ".concat(V.t0)}));case 14:case"end":return V.stop()}},X,this,[[3,9]])})),function(){return Tt.apply(this,arguments)})},{key:"enableWebcam",value:(kl=(0,u.A)(d().mark(function X(){var B,V,$,G,se,ae,Be,we,gt,qe,ut,oe,Re,tt,rt,_e,Ue,pt,Bt,Wt,Dt,Ut,Ft,qt,nr,Lt,dt,en,Kr,ir,qr,jr,on,pn,$r,In,nt,mr,Vr,bn,ti,An,On,Pn,Si,Sn,Mn,wi,wn,ri,zn,Yi,Ui,dr,ni,Ln,Kn,ui,fn,Nn,Li,di,Di,ii,qn,rn,mn,ur=this,st=arguments;return d().wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:if(ae=st.length>0&&st[0]!==void 0?st[0]:void 0,Be=st.length>1&&st[1]!==void 0?st[1]:void 0,we=(B=this._openTelemetry)===null||B===void 0?void 0:B.trace({spanName:"enableWebcam() Calling ".concat(ae?"With Custom Video Track":"Without Custom Video Track "),attributes:{customVideoConfig:ae?JSON.stringify(ae):"Not Specify Custom Track"},span:Be||null}),Pe.debug("enableWebcam()"),this._webcamEnabled=!0,!this._webcamProducer){Xe.next=9;break}return(gt=this._openTelemetry)===null||gt===void 0||gt.completeSpan({span:we,status:2,message:"Error in enableWebcam() :: Webcam Producer found"}),(qe=this._videosdkLogs)===null||qe===void 0||qe.pushLogs({logText:"Attempted to call enableWebcam() multiple times",attributes:{error:"Error in enableWebcam() :: Webcam is already enabled"},logType:"ERROR",dashboardLog:!0}),Xe.abrupt("return");case 9:if(!this._mediasoupDevice){Xe.next=18;break}if(this._mediasoupDevice.canProduce("video")){Xe.next=16;break}return Re=this._deviceInfo.sdkType=="react-native"?Ke.q.ERROR_RN_CAMERA_ACCESS_UNAVAILABLE.message:Ke.q.ERROR_CAMERA_ACCESS_UNAVAILABLE.message,(ut=this._openTelemetry)===null||ut===void 0||ut.completeSpan({span:we,status:2,message:"Error in enableWebcam() :: ".concat(Re)}),(oe=this._videosdkLogs)===null||oe===void 0||oe.pushLogs({logText:Re,attributes:{error:"Error in enableWebcam() :: Camera access unavailable"},logType:"ERROR",dashboardLog:!0}),Pe.error("enableWebcam() | cannot produce video"),Xe.abrupt("return");case 16:Xe.next=21;break;case 18:return(tt=this._videosdkLogs)===null||tt===void 0||tt.pushLogs({logText:"Oops! Something went wrong, and we're unable to enable the webcam. Please try again.",logType:"ERROR",attributes:{error:"Error in enableWebcam(): Something went wrong."}}),(rt=this._openTelemetry)===null||rt===void 0||rt.completeSpan({span:we,status:2,message:"Error in enableWebcam() :: mediasoupDevice is undefined"}),Xe.abrupt("return");case 21:if(je.dispatch(ct(!0)),pt=this._webcam.resolution,Xe.prev=23,this._externalVideo){Xe.next=100;break}return Xe.next=27,this._updateWebcams(we);case 27:if(Ue=this._webcam.device){Xe.next=31;break}throw new Error("Whoops! No Webcam Found: We couldn't find your camera. Is it plugged in and turned on? If so, try restarting your computer or checking your device settings. If you need help, check out troubleshooter at https://test.8x8.vc/. Also, ensure you're on a secure website (https://).");case 31:Pe.debug("enableWebcam() | calling getUserMedia()");try{ae&&(_e=ae.getVideoTracks()[0]).readyState=="ended"&&(_e=null,qt=Ke.q.ERROR_CUSTOM_VIDEO_TRACK_ENDED,(Ft=this._videosdkLogs)===null||Ft===void 0||Ft.pushLogs({logText:qt.message,logType:"INFO",attributes:{error:"In enableWebcam() :: Invalid Custom Track Passed"},dashboardLog:!0}),this._emitError(qt))}catch(Rr){Lt=Ke.q.ERROR_INVALID_CUSTOM_VIDEO_TRACK,(nr=this._videosdkLogs)===null||nr===void 0||nr.pushLogs({logText:Lt.message,logType:"INFO",attributes:{error:"In enableWebcam() :: Invalid Custom Track Passed"}}),this._emitError(Lt),console.log("Invalid Custom Video Track Passed. Reverting to default Error: ".concat(Rr))}if(_e){Xe.next=98;break}if(en=(dt=this._openTelemetry)===null||dt===void 0?void 0:dt.trace({spanName:"Creating Track",span:we}),Kr=null,Xe.prev=36,this._webcam.resolution!="hd"){Xe.next=44;break}return Xe.next=40,this.createCameraVideoTrack({cameraId:Ue.deviceId,encoderConfig:"h720p_w1280p",multiStream:this._useSimulcast,facingMode:Ue.facing});case 40:ae=Xe.sent,Kr=JSON.stringify({encoderConfig:"h720p_w1280p",multiStream:this._useSimulcast}),Xe.next=48;break;case 44:return Xe.next=46,this.createCameraVideoTrack({cameraId:Ue.deviceId,encoderConfig:"h540p_w960p",multiStream:this._useSimulcast,facingMode:Ue.facing});case 46:ae=Xe.sent,Kr=JSON.stringify({encoderConfig:"h540p_w960p",multiStream:this._useSimulcast});case 48:_e=ae.getVideoTracks()[0],(ir=this._openTelemetry)===null||ir===void 0||ir.completeSpan({message:"Video Track Generated",span:en,attributes:{customVideoTrackConfig:Kr},status:1}),Xe.next=98;break;case 52:if(Xe.prev=52,Xe.t0=Xe.catch(36),(qr=this._openTelemetry)===null||qr===void 0||qr.completeSpan({message:"Error in enableWebcam() :: ".concat(Xe.t0.message),span:en,status:2}),Xe.t0.name!=="SecurityError"){Xe.next=63;break}pn=Ke.q.ERROR_RN_CAMERA_ACCESS_DENIED_OR_DISMISSED,$r=pn.message,this._emitError(pn),(jr=this._videosdkLogs)===null||jr===void 0||jr.pushLogs({logText:$r,logType:"ERROR",attributes:{error:"Error in enableWebcam() :: Camera Permission Denied or Dismissed"},dashboardLog:!0}),(on=this._openTelemetry)===null||on===void 0||on.completeSpan({message:"Error in enableWebcam() :: occurred in creating video track, ".concat($r),span:enableMicSpan,status:2}),Xe.next=97;break;case 63:if(Xe.t0.name!=="DOMException"){Xe.next=71;break}mr=Ke.q.ERROR_RN_CAMERA_NOT_FOUND,Vr=mr.message,this._emitError(mr),(In=this._videosdkLogs)===null||In===void 0||In.pushLogs({logText:Vr,logType:"ERROR",attributes:{error:"Error in enableWebcam() :: No Camra Device Found"},dashboardLog:!0}),(nt=this._openTelemetry)===null||nt===void 0||nt.completeSpan({message:"Error in enableWebcam() :: occurred in creating video track, ".concat(Vr),span:enableMicSpan,status:2}),Xe.next=97;break;case 71:if(!(Xe.t0 instanceof DOMException)){Xe.next=94;break}Xe.t1=Xe.t0.name,Xe.next=Xe.t1==="NotAllowedError"?75:Xe.t1==="NotReadableError"?78:Xe.t1==="NotFoundError"?81:88;break;case 75:return bn=this.handleNotAllowedError(Xe.t0,this._openTelemetry,this._videosdkLogs,we,"video"),this._emitError(bn),Xe.abrupt("break",92);case 78:return ti=this.handleNotReadableError(Xe.t0,this._openTelemetry,this._videosdkLogs,we,"video"),this._emitError(ti),Xe.abrupt("break",92);case 81:return An=Ke.q.ERROR_CAMERA_NOT_FOUND,navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Firefox")!=-1&&(An=Ke.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS),On=An.message,this._emitError(An),(V=this._videosdkLogs)===null||V===void 0||V.pushLogs({logText:On,logType:"ERROR",attributes:{error:"Error in enableWebcam() :: No Webcam Device Found"},dashboardLog:!0}),($=this._openTelemetry)===null||$===void 0||$.completeSpan({message:"Error in enableWebcam() :: occurred in creating video track, ".concat(On),span:we,status:2}),Xe.abrupt("break",92);case 88:return Pn="An error occurred in creating video track, ".concat(Xe.t0.message),(G=this._videosdkLogs)===null||G===void 0||G.pushLogs({logText:Xe.t0.message,logType:"ERROR",attributes:{error:"Error in enableWebcam() :: ".concat(Pn)},dashboardLog:!0}),(se=this._openTelemetry)===null||se===void 0||se.completeSpan({message:"Error in enableWebcam() :: ".concat(Pn),span:we,status:2}),Xe.abrupt("break",92);case 92:Xe.next=97;break;case 94:Mn="An error occurred in creating video track, ".concat(Xe.t0.message),(Si=this._videosdkLogs)===null||Si===void 0||Si.pushLogs({logText:Xe.t0.message,logType:"ERROR",attributes:{error:"Error in enableWebcam() :: ".concat(Mn)},dashboardLog:!0}),(Sn=this._openTelemetry)===null||Sn===void 0||Sn.completeSpan({message:"Error in enableWebcam() :: ".concat(Mn),span:we,status:2});case 97:return Xe.abrupt("return");case 98:Xe.next=105;break;case 100:return Ue={label:"external video"},Xe.next=103,this._getExternalVideoStream();case 103:wi=Xe.sent,_e=wi.getVideoTracks()[0].clone();case 105:if(wn=(Bt=this._openTelemetry)===null||Bt===void 0?void 0:Bt.trace({spanName:"Generating Producer Configuration",span:we}),Yi={videoGoogleStartBitrate:1e3},!this._forceH264){Xe.next=114;break}if(zn=this._mediasoupDevice.rtpCapabilities.codecs.find(function(Rr){return Rr.mimeType.toLowerCase()==="video/h264"})){Xe.next=112;break}throw new Error("The desired H.264 codec and configuration are not supported");case 112:Xe.next=119;break;case 114:if(!this._forceVP9){Xe.next=119;break}if(zn=this._mediasoupDevice.rtpCapabilities.codecs.find(function(Rr){return Rr.mimeType.toLowerCase()==="video/vp9"})){Xe.next=119;break}throw new Error("The desired VP9 codec and configuration are not supported");case 119:_e?(Ui=_e.getConstraints(),dr=this._deviceInfo.sdkType=="react-native"&&this._deviceInfo.platform=="ios",ri=yn(!1,Ui.width,Ui.height,{simulcast:ae.multiStream},dr)):this._useSimulcast&&(ni=this._mediasoupDevice.rtpCapabilities.codecs.find(function(Rr){return Rr.kind==="video"}),ri=this._forceVP9&&zn||ni.mimeType.toLowerCase()==="video/vp9"?va:$a[this._webcam.resolution]),Ln={};try{Ln={encodings:ri,width:ae?(Kn=_e)===null||Kn===void 0?void 0:Kn.getConstraints().width:Qs[pt].width.ideal,height:ae?(ui=_e)===null||ui===void 0?void 0:ui.getConstraints().height:Qs[pt].height.ideal}}catch(Rr){(fn=this._videosdkLogs)===null||fn===void 0||fn.pushLogs({logText:Rr.message,logType:"INFO",attributes:{error:"In enableWebcam() :: ".concat(Rr.message)},dashboardLog:!0}),console.log(Rr)}if((Wt=this._openTelemetry)===null||Wt===void 0||Wt.traceAutoComplete({spanName:"Track Generated with height ".concat(Ln.height," and width ").concat(Ln.width," with multiStream ").concat(this._useSimulcast),attributes:{appData:JSON.stringify(Ln)},span:we,status:1}),(Dt=this._openTelemetry)===null||Dt===void 0||Dt.completeSpan({span:wn,status:1,message:"Producer Configuration Generated"}),wn=(Ut=this._openTelemetry)===null||Ut===void 0?void 0:Ut.trace({spanName:"Creating Webcam Producer",span:we}),!this._sendTransport){Xe.next=131;break}return Xe.next=128,this._sendTransport.produce({track:_e,encodings:ri,codecOptions:Yi,codec:zn,appData:Ln});case 128:this._webcamProducer=Xe.sent,Xe.next=133;break;case 131:return this._emitError(Ke.q.ERROR_ACTION_PERFORMED_BEFORE_MEETING_JOINED),Xe.abrupt("return");case 133:_e.getConstraints().deviceId&&(this._webcam.device=this._webcams.get(_e.getConstraints().deviceId)),this._webcamProducer?(di=Z({id:this._webcamProducer.id,deviceLabel:Ue.label,type:this._getWebcamType(Ue),paused:this._webcamProducer.paused,track:this._webcamProducer.track,rtpParameters:this._webcamProducer.rtpParameters,codec:this._webcamProducer.rtpParameters.codecs[0].mimeType.split("/")[1],instance:this._webcamProducer}),je.dispatch(di),this._eventEmitter.emit(di.type,di.payload),this._webcamProducer.on("transportclose",function(){var Rr,Tr=le(ur._webcamProducer.id);je.dispatch(Tr),ur._eventEmitter.emit(Tr.type,Tr.payload),(Rr=ur._webcamProducer)===null||Rr===void 0||Rr.close(),ur._webcamProducer=null}),this._webcamProducer.on("trackended",function(){var Rr,Tr,ls=ur._deviceInfo.sdkType=="react-native"?Ke.q.ERROR_RN_CAMERA_TRACK_ENDED:Ke.q.ERROR_WEBCAM_TRACK_ENDED;(Rr=ur._videosdkLogs)===null||Rr===void 0||Rr.pushLogs({logText:message,logType:"ERROR",attributes:{error:"Error in enableWebcam() :: ".concat(ls.message)},dashboardLog:!0}),(Tr=ur._openTelemetry)===null||Tr===void 0||Tr.traceAutoComplete({spanName:"this._webcamProducer trackended or Webcam disconnected!",span:we,message:ls.message,status:2}),je.dispatch(yt({type:"error",text:"Webcam disconnected!"})),ur._emitError(ls),ur.disableWebcam(we).catch(function(){})}),(Nn=this._openTelemetry)===null||Nn===void 0||Nn.completeSpan({span:wn,status:1,message:"Webcam Producer Created"}),(Li=this._openTelemetry)===null||Li===void 0||Li.completeSpan({span:we,status:1,message:"Enable Webcam Successful"})):((Di=this._videosdkLogs)===null||Di===void 0||Di.pushLogs({logText:"Oops! Something went wrong, and we're unable to enable the webcam. Please try again.",logType:"ERROR",attributes:{error:"Error in enableWebcam(): Something went wrong."},dashboardLog:!0}),(ii=this._openTelemetry)===null||ii===void 0||ii.completeSpan({span:wn,status:2,message:"Error in enableWebcam() :: webcamProducer null"}),(qn=this._openTelemetry)===null||qn===void 0||qn.completeSpan({span:we,status:2,message:"Error in enableWebcam() :: webcamProducer null"})),Xe.next=145;break;case 137:return Xe.prev=137,Xe.t2=Xe.catch(23),(rn=this._videosdkLogs)===null||rn===void 0||rn.pushLogs({logText:Xe.t2.message,logType:"ERROR",attributes:{error:"Error in enableWebcam() :: ".concat(Xe.t2.message)},dashboardLog:!0}),(mn=this._openTelemetry)===null||mn===void 0||mn.completeSpan({span:we,status:2,message:"Error in enableWebcam() :: ".concat(Xe.t2.message)}),je.dispatch(yt({type:"error",text:"Error enabling webcam: ".concat(Xe.t2)})),Xe.next=144,this._protoo.request("produceError",{mediaType:"video",message:Xe.t2.message});case 144:_e&&_e.stop();case 145:je.dispatch(ct(!1));case 146:case"end":return Xe.stop()}},X,this,[[23,137],[36,52]])})),function(){return kl.apply(this,arguments)})},{key:"handleNotAllowedError",value:function(X,B,V,$,G){var se={};return se=X.message==="Permission denied"||X.message==="Permission dismissed"?G==="video"?Ke.q.ERROR_CAMERA_ACCESS_DENIED_OR_DISMISSED:Ke.q.ERROR_MICROPHONE_ACCESS_DENIED_OR_DISMISSED:X.message.includes("The request is not allowed by the user agent")?G==="video"?Ke.q.ERROR_CAMERA_PERMISSION_OR_AUTOPLAY_ISSUE:Ke.q.ERROR_MICROPHONE_ACCESS_DENIED_OR_DISMISSED:X.message==="Permission denied by system"?G==="video"?Ke.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS:Ke.q.ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS:G==="video"?Ke.q.ERROR_GET_VIDEO_MEDIA_PERMISSION_DENIED:Ke.q.ERROR_GET_AUDIO_MEDIA_PERMISSION_DENIED,V.pushLogs({logText:se.message,logType:"ERROR",attributes:{error:"Error in ".concat(G==="video"?"enableWebcam()":"enableMic()"," :: ").concat(X.message)},dashboardLog:!0}),B.completeSpan({message:G==="video"?"Error in enableWebcam() :: occurred in creating video track, ".concat(se.message):"Error in enableMic() :: occurred in creating audio track, ".concat(se.message),span:$,status:2}),se}},{key:"handleNotReadableError",value:function(X,B,V,$,G){var se={};return se=X.message==="Device in use"?G==="video"?Ke.q.ERROR_CAMERA_IN_USE:Ke.q.ERROR_MICROPHONE_IN_USE:G==="video"?Ke.q.ERROR_VIDEO_SOURCE_INITIATION_FAILED:Ke.q.ERROR_MICROPHONE_IN_USE,V.pushLogs({logText:se.message,logType:"ERROR",attributes:{error:"Error in ".concat(G==="video"?"enableWebcam()":"enableMic()"," :: ").concat(X.message)},dashboardLog:!0}),B.completeSpan({message:G==="video"?"Error in enableWebcam() :: occurred in creating video track, ".concat(se.message):"Error in enableMic() :: occurred in creating audio track, ".concat(se.message),span:$,status:2}),se}},{key:"createCameraVideoTrack",value:(Ht=(0,u.A)(d().mark(function X(B){var V,$,G,se,ae,Be,we,gt,qe,ut,oe,Re,tt;return d().wrap(function(rt){for(;;)switch(rt.prev=rt.next){case 0:return V=B.cameraId,$=V===void 0?void 0:V,G=B.encoderConfig,se=G===void 0?void 0:G,ae=B.facingMode,Be=ae===void 0?void 0:ae,we=B.optimizationMode,gt=we===void 0?void 0:we,qe=B.multiStream,ut=qe===void 0||qe,oe=se?Ae.$.videoProfiles[se]:Ae.$.videoProfiles.h360p_w640p,Re={video:{deviceId:$||void 0,facingMode:Be||void 0,width:oe.width,height:oe.height,frameRate:oe.frameRate}},rt.next=5,(0,Ua.lp)(Re);case 5:return tt=rt.sent,gt&&(tt.contentHint=gt),tt.encoderConfig=se||"h360p_w640p",tt.contentHint=gt||"",tt.multiStream=ut,tt.cameraId=$,rt.abrupt("return",tt);case 12:case"end":return rt.stop()}},X)})),function(X){return Ht.apply(this,arguments)})},{key:"disableWebcam",value:(xl=(0,u.A)(d().mark(function X(){var B,V,$,G,se,ae,Be,we,gt,qe,ut,oe,Re,tt=arguments;return d().wrap(function(rt){for(;;)switch(rt.prev=rt.next){case 0:if($=tt.length>0&&tt[0]!==void 0?tt[0]:void 0,G=(B=this._openTelemetry)===null||B===void 0?void 0:B.trace({spanName:"disableWebcam() Calling",status:1,span:$||null}),Pe.debug("disableWebcam()"),this._webcamEnabled=!1,this._webcamProducer){rt.next=8;break}return(se=this._openTelemetry)===null||se===void 0||se.completeSpan({span:G,status:2,message:"Error in disableWebcam() :: Webcam Producer Not found"}),(ae=this._videosdkLogs)===null||ae===void 0||ae.pushLogs({logText:"Attempted to call disableWebcam() multiple times",attributes:{error:"Error in disableWebcam() :: Webcam is already disabled"},logType:"ERROR",dashboardLog:!0}),rt.abrupt("return");case 8:return Be=(V=this._openTelemetry)===null||V===void 0?void 0:V.trace({spanName:"Closing Webcam Producer",span:G,status:1}),this._webcamProducer.close(),we=le(this._webcamProducer.id),je.dispatch(we),this._eventEmitter.emit(we.type,we.payload),rt.prev=13,rt.next=16,this._protoo.request("closeProducer",{producerId:this._webcamProducer.id});case 16:(gt=this._openTelemetry)===null||gt===void 0||gt.completeSpan({span:Be,status:1,message:"Requested Server to Close Producer"}),this._webcamProducer=null,(qe=this._openTelemetry)===null||qe===void 0||qe.completeSpan({span:G,status:1,message:"Webcam Disabled Successfully"}),rt.next=27;break;case 21:rt.prev=21,rt.t0=rt.catch(13),(ut=this._videosdkLogs)===null||ut===void 0||ut.pushLogs({logText:"Error in disableWebcam() :: Failed to close server-side webcam producer",logType:"ERROR",attributes:{error:rt.t0.message},dashboardLog:!0}),(oe=this._openTelemetry)===null||oe===void 0||oe.completeSpan({span:Be,status:2,message:"Error in disableWebcam() :: closing server-side webcam Producer: ".concat(rt.t0)}),(Re=this._openTelemetry)===null||Re===void 0||Re.completeSpan({span:G,status:2,message:"Error in disableWebcam() :: closing server-side webcam Producer: ".concat(rt.t0)}),je.dispatch(yt({type:"error",text:"Error closing server-side webcam Producer: ".concat(rt.t0)}));case 27:case"end":return rt.stop()}},X,this,[[13,21]])})),function(){return xl.apply(this,arguments)})},{key:"getMics",value:(Rt=(0,u.A)(d().mark(function X(){var B,V;return d().wrap(function($){for(;;)switch($.prev=$.next){case 0:return B=[],$.prev=1,$.next=4,this._updateMics();case 4:this._mics.forEach(function(G,se){B.push({deviceId:se,label:G.label})}),$.next=11;break;case 7:$.prev=7,$.t0=$.catch(1),Pe.error("getMics() | Error",$.t0),(V=this._videosdkLogs)===null||V===void 0||V.pushLogs({logText:$.t0.message,logType:"ERROR",attributes:{error:"Error in getMics() :: Not able to get Mic List"},dashboardLog:!0});case 11:return $.abrupt("return",B);case 12:case"end":return $.stop()}},X,this,[[1,7]])})),function(){return Rt.apply(this,arguments)})},{key:"changeMic",value:(me=(0,u.A)(d().mark(function X(B){var V,$,G,se,ae,Be,we,gt,qe,ut,oe,Re,tt,rt;return d().wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if($=(V=this._openTelemetry)===null||V===void 0?void 0:V.trace({spanName:"changeMic() Calling"}),_e.prev=1,(0,l.A)(B)!="object"){_e.next=9;break}return _e.next=5,this.disableMic(!0,$);case 5:return _e.next=7,this.enableMic(B,$);case 7:_e.next=27;break;case 9:return Be=B,_e.next=12,this._updateMics();case 12:if(we=Array.from(this._mics.keys()),gt=we.length,qe=this._mic.device?this._mic.device.deviceId:void 0,Be!=null&&Be!=null?ut=we.indexOf(Be):(ut=we.indexOf(qe))<gt-1?ut++:ut=0,this._mic.device=this._mics.get(we[ut]),oe=(G=this._openTelemetry)===null||G===void 0?void 0:G.trace({spanName:"Getting Selected Mic",span:$,attributes:{selectedWebcam:this._mic.device?JSON.stringify(this._mic.device):"No Mic devices"}}),this._mic.device){_e.next=21;break}throw(Re=this._videosdkLogs)===null||Re===void 0||Re.pushLogs({logText:"Error changeMic : No mic Found",logType:"ERROR"}),new Error("No mic Found");case 21:return _e.next=23,this.disableMic(!0,$);case 23:return _e.next=25,this.enableMic(void 0,$);case 25:(se=this._openTelemetry)===null||se===void 0||se.completeSpan({span:oe,status:1,message:"Done"}),(ae=this._openTelemetry)===null||ae===void 0||ae.completeSpan({span:$,status:1,message:"changeMic() Ending"});case 27:_e.next=33;break;case 29:_e.prev=29,_e.t0=_e.catch(1),(tt=this._openTelemetry)===null||tt===void 0||tt.completeSpan({span:$,status:2,message:"changeMic() | Error ".concat(_e.t0)}),(rt=this._videosdkLogs)===null||rt===void 0||rt.pushLogs({logText:"Error changeMic() | Error",logType:"ERROR",attributes:{error:_e.t0.message}});case 33:case"end":return _e.stop()}},X,this,[[1,29]])})),function(X){return me.apply(this,arguments)})},{key:"getWebcams",value:(Tl=(0,u.A)(d().mark(function X(){var B,V;return d().wrap(function($){for(;;)switch($.prev=$.next){case 0:return B=[],$.prev=1,$.next=4,this._updateWebcams();case 4:this._webcams.forEach(function(G,se){B.push({deviceId:se,label:G.label,facingMode:G.facing||"environment"})}),$.next=11;break;case 7:$.prev=7,$.t0=$.catch(1),Pe.error("getWebcams() | failed %o",$.t0),(V=this._videosdkLogs)===null||V===void 0||V.pushLogs({logText:$.t0.message,logType:"ERROR",attributes:{error:"Error in getWebcams() :: Not able to get Webcam List"},dashboardLog:!0});case 11:return $.abrupt("return",B);case 12:case"end":return $.stop()}},X,this,[[1,7]])})),function(){return Tl.apply(this,arguments)})},{key:"replaceWebcamStream",value:(gc=(0,u.A)(d().mark(function X(B){var V;return d().wrap(function($){for(;;)switch($.prev=$.next){case 0:if(!this._webcamProducer){$.next=7;break}return V=B.getVideoTracks()[0],$.next=4,this._webcamProducer.replaceTrack({track:V});case 4:this._eventEmitter.emit("UPDATE_PRODUCER",{producer:this._webcamProducer}),$.next=11;break;case 7:return $.next=9,this.disableWebcam();case 9:return $.next=11,this.enableWebcam(B);case 11:case"end":return $.stop()}},X,this)})),function(X){return gc.apply(this,arguments)})},{key:"changeWebcam",value:(Rl=(0,u.A)(d().mark(function X(B){var V,$,G,se,ae,Be,we,gt,qe,ut,oe,Re,tt,rt;return d().wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if($=(V=this._openTelemetry)===null||V===void 0?void 0:V.trace({spanName:"changeWebcam() Calling"}),je.dispatch(ct(!0)),(0,l.A)(B)!=="object"){_e.next=17;break}return _e.prev=3,_e.next=6,this.disableWebcam($);case 6:return _e.next=8,this.enableWebcam(B,$);case 8:_e.next=15;break;case 10:_e.prev=10,_e.t0=_e.catch(3),Pe.error("changeWebcam() | failed: %o",_e.t0),(G=this._videosdkLogs)===null||G===void 0||G.pushLogs({logText:"Error Could not change webcam",logType:"ERROR",attributes:{object:JSON.stringify(B),error:_e.t0.message}}),je.dispatch(yt({type:"error",text:"Could not change webcam: ".concat(_e.t0)}));case 15:_e.next=46;break;case 17:return _e.prev=17,_e.next=20,this._updateWebcams($);case 20:if(we=Array.from(this._webcams.keys()),gt=we.length,qe=this._webcam.device?this._webcam.device.deviceId:void 0,B!=null&&B!=null?ut=we.indexOf(B):(ut=we.indexOf(qe))<gt-1?ut++:ut=0,this._webcam.device=this._webcams.get(we[ut]),Pe.debug("changeWebcam() | new selected webcam [device:%o]",this._webcam.device),this._webcam.resolution=this._webcam.resolution||"hd",oe=(se=this._openTelemetry)===null||se===void 0?void 0:se.trace({spanName:"Getting Selected Webcam",span:$,attributes:{selectedWebcam:this._webcam.device?JSON.stringify(this._webcam.device):"No webcam devices"}}),this._webcam.device){_e.next=31;break}throw(Re=this._videosdkLogs)===null||Re===void 0||Re.pushLogs({logText:"Error changeWebcam : No webcam Found",logType:"ERROR"}),new Error("no webcam devices");case 31:return _e.next=33,this.disableWebcam($);case 33:return _e.next=35,this.enableWebcam(void 0,$);case 35:return(ae=this._openTelemetry)===null||ae===void 0||ae.completeSpan({span:oe,status:1,message:"Done"}),(Be=this._openTelemetry)===null||Be===void 0||Be.completeSpan({span:$,status:1,message:"changeWebcam() Ending"}),_e.abrupt("return");case 40:_e.prev=40,_e.t1=_e.catch(17),Pe.error("changeWebcam() | failed: %o",_e.t1),(tt=this._videosdkLogs)===null||tt===void 0||tt.pushLogs({logText:"Error Could not change webcam",logType:"ERROR",attributes:{object:JSON.stringify(B),error:_e.t1.message}}),(rt=this._openTelemetry)===null||rt===void 0||rt.completeSpan({span:$,status:2,message:"Could not change webcam ".concat(_e.t1)}),je.dispatch(yt({type:"error",text:"Could not change webcam: ".concat(_e.t1)}));case 46:je.dispatch(ct(!1));case 47:case"end":return _e.stop()}},X,this,[[3,10],[17,40]])})),function(X){return Rl.apply(this,arguments)})},{key:"changeWebcamResolution",value:(Ns=(0,u.A)(d().mark(function X(){var B,V,$,G;return d().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:Pe.debug("changeWebcamResolution()"),je.dispatch(ct(!0)),se.prev=2,se.t0=this._webcam.resolution,se.next=se.t0==="qvga"?6:se.t0==="vga"?8:se.t0==="hd"?10:12;break;case 6:return this._webcam.resolution="vga",se.abrupt("break",13);case 8:return this._webcam.resolution="hd",se.abrupt("break",13);case 10:return this._webcam.resolution="qvga",se.abrupt("break",13);case 12:this._webcam.resolution="hd";case 13:return Pe.debug("changeWebcamResolution() | calling getUserMedia()"),se.prev=14,se.next=17,navigator.mediaDevices.getUserMedia({video:$n({deviceId:{exact:this._webcam.device.deviceId}},Qs[this._webcam.resolution])});case 17:B=se.sent,se.next=25;break;case 20:return se.prev=20,se.t1=se.catch(14),(V=this._videosdkLogs)===null||V===void 0||V.pushLogs({logText:"Error in getUserMedia for changeWebcamResolution",logType:"ERROR",attributes:{error:JSON.stringify(se.t1)}}),se.t1.message==="Permission denied"||se.t1.name==="NotAllowedError"?this._emitError(Ke.q.ERROR_GET_VIDEO_MEDIA_PERMISSION_DENIED):this._emitError(Ke.q.ERROR_GET_VIDEO_MEDIA),se.abrupt("return");case 25:return $=B.getVideoTracks()[0],se.next=28,this._webcamProducer.replaceTrack({track:$});case 28:je.dispatch(ye(this._webcamProducer.id,$)),se.next=36;break;case 31:se.prev=31,se.t2=se.catch(2),Pe.error("changeWebcamResolution() | failed: %o",se.t2),(G=this._videosdkLogs)===null||G===void 0||G.pushLogs({logText:"Error Could not change webcam resolution",logType:"ERROR",attributes:{error:se.t2.message}}),je.dispatch(yt({type:"error",text:"Could not change webcam resolution: ".concat(se.t2)}));case 36:je.dispatch(ct(!1));case 37:case"end":return se.stop()}},X,this,[[2,31],[14,20]])})),function(){return Ns.apply(this,arguments)})},{key:"enableShare",value:(bi=(0,u.A)(d().mark(function X(){var B,V,$,G,se,ae,Be,we,gt,qe,ut,oe,Re,tt,rt,_e,Ue,pt,Bt,Wt,Dt,Ut,Ft,qt,nr,Lt,dt,en,Kr,ir,qr,jr,on,pn,$r=this,In=arguments;return d().wrap(function(nt){for(;;)switch(nt.prev=nt.next){case 0:if(V=In.length>0&&In[0]!==void 0?In[0]:void 0,$=(B=this._openTelemetry)===null||B===void 0?void 0:B.trace({spanName:"enableShare() Calling ".concat(V?"With Custom Video Track":"Without Custom Video Track "),attributes:{customShareConfig:V?JSON.stringify(V):"Not Specify Custom Track"}}),Pe.debug("enableShare()"),!this._shareProducer){nt.next=6;break}return(G=this._openTelemetry)===null||G===void 0||G.completeSpan({span:$,status:2,message:"Screen Share Producer found"}),nt.abrupt("return");case 6:if(this._mediasoupDevice.canProduce("video")){nt.next=10;break}return(se=this._openTelemetry)===null||se===void 0||se.completeSpan({span:$,status:2,message:"enableShare() | cannot produce video"}),Pe.error("enableShare() | cannot produce video"),nt.abrupt("return");case 10:if(je.dispatch(ht(!0)),nt.prev=11,Pe.debug("enableShare() | calling getUserMedia()"),tt=(we=this._openTelemetry)===null||we===void 0?void 0:we.trace({spanName:"Creating Track",span:$}),!V||!V.active){nt.next=19;break}ae=V.getVideoTracks()[0],Be=V.getAudioTracks()[0],nt.next=38;break;case 19:return nt.prev=19,nt.next=22,navigator.mediaDevices.getDisplayMedia({audio:!0,video:{width:{max:1920},height:{max:1080},frameRate:{max:10}}});case 22:_e=nt.sent,nt.next=31;break;case 25:return nt.prev=25,nt.t0=nt.catch(19),(Ue=this._videosdkLogs)===null||Ue===void 0||Ue.pushLogs({logText:"Error in getDisplayMedia for screen share",logType:"ERROR",attributes:{error:JSON.stringify(nt.t0)}}),(pt=this._openTelemetry)===null||pt===void 0||pt.completeSpan({span:$,status:2,message:"Error in getDisplayMedia for screen share ".concat(nt.t0)}),nt.t0.message==="Permission denied"||nt.t0.name==="NotAllowedError"?this._emitError(Ke.q.ERROR_GET_DISPLAY_MEDIA_PERMISSION_DENIED):this._emitError(Ke.q.ERROR_GET_DISPLAY_MEDIA),nt.abrupt("return");case 31:if(_e){nt.next=35;break}return je.dispatch(ht(!0)),(Bt=this._openTelemetry)===null||Bt===void 0||Bt.completeSpan({span:$,status:2,message:"Stream not found"}),nt.abrupt("return");case 35:ae=_e.getVideoTracks()[0],Be=_e.getAudioTracks()[0],(rt=this._openTelemetry)===null||rt===void 0||rt.completeSpan({message:"Track Generated with height ".concat(ae.getSettings().height," and width ").concat(ae.getSettings().width),span:tt,status:1});case 38:if(Wt=(gt=this._openTelemetry)===null||gt===void 0?void 0:gt.trace({spanName:"Generating Producer Configuration",span:$}),Ft={videoGoogleStartBitrate:1e3},!this._forceH264){nt.next=47;break}if(Ut=this._mediasoupDevice.rtpCapabilities.codecs.find(function(mr){return mr.mimeType.toLowerCase()==="video/h264"})){nt.next=45;break}throw(qt=this._videosdkLogs)===null||qt===void 0||qt.pushLogs({logText:"Error EnableShare : desired H264 codec+configuration is not supported",logType:"ERROR"}),new Error("desired H264 codec+configuration is not supported");case 45:nt.next=52;break;case 47:if(!this._forceVP9){nt.next=52;break}if(Ut=this._mediasoupDevice.rtpCapabilities.codecs.find(function(mr){return mr.mimeType.toLowerCase()==="video/vp9"})){nt.next=52;break}throw(nr=this._videosdkLogs)===null||nr===void 0||nr.pushLogs({logText:"Error EnableShare :desired VP9 codec+configuration is not supported",logType:"ERROR"}),new Error("desired VP9 codec+configuration is not supported");case 52:return this._useSharingSimulcast&&(Lt=this._mediasoupDevice.rtpCapabilities.codecs.find(function(mr){return mr.kind==="video"}),Dt=this._forceVP9&&Ut||Lt.mimeType.toLowerCase()==="video/vp9"?ya:Va.map(function(mr){return $n($n({},mr),{},{dtx:!0})})),(qe=this._openTelemetry)===null||qe===void 0||qe.completeSpan({span:Wt,status:1,message:"Producer Configuration Generated"}),Wt=(ut=this._openTelemetry)===null||ut===void 0?void 0:ut.trace({spanName:"Creating Share Producer",span:$}),nt.next=57,this._sendTransport.produce({track:ae,encodings:Dt,codecOptions:Ft,codec:Ut,appData:{share:!0}});case 57:if(this._shareProducer=nt.sent,dt=Z({id:this._shareProducer.id,type:"share",paused:this._shareProducer.paused,track:this._shareProducer.track,rtpParameters:this._shareProducer.rtpParameters,codec:this._shareProducer.rtpParameters.codecs[0].mimeType.split("/")[1],appData:{share:!0},instance:this._shareProducer}),je.dispatch(dt),this._eventEmitter.emit(dt.type,dt.payload),this._shareProducer.on("transportclose",function(){var mr,Vr=le($r._shareProducer.id);je.dispatch(Vr),$r._eventEmitter.emit(Vr.type,Vr.payload),(mr=$r._shareProducer)===null||mr===void 0||mr.close(),$r._shareProducer=null}),this._shareProducer.on("trackended",function(){var mr;(mr=$r._openTelemetry)===null||mr===void 0||mr.traceAutoComplete({spanName:"this._shareProducer trackended or Share disconnected!",span:$,status:2}),je.dispatch(yt({type:"error",text:"Share disconnected!"})),$r.disableShare().catch(function(){})}),(oe=this._openTelemetry)===null||oe===void 0||oe.completeSpan({span:Wt,status:1,message:"Share Producer Created"}),!Be){nt.next=84;break}return nt.prev=65,ir={opusStereo:1,opusDtx:1},Wt=(en=this._openTelemetry)===null||en===void 0?void 0:en.trace({spanName:"Creating Share Audio Producer",span:$}),nt.next=70,this._sendTransport.produce({track:Be,codecOptions:ir,appData:{share:!0}});case 70:this._shareAudioProducer=nt.sent,qr=Z({id:this._shareAudioProducer.id,type:"share",paused:this._shareAudioProducer.paused,track:this._shareAudioProducer.track,rtpParameters:this._shareAudioProducer.rtpParameters,codec:this._shareAudioProducer.rtpParameters.codecs[0].mimeType.split("/")[1],appData:{share:!0},instance:this._shareAudioProducer}),je.dispatch(qr),this._eventEmitter.emit(qr.type,qr.payload),this._shareAudioProducer.on("transportclose",function(){var mr,Vr=le($r._shareAudioProducer.id);je.dispatch(Vr),$r._eventEmitter.emit(Vr.type,Vr.payload),(mr=$r._shareAudioProducer)===null||mr===void 0||mr.close(),$r._shareAudioProducer=null}),this._shareAudioProducer.on("trackended",function(){var mr;(mr=$r._openTelemetry)===null||mr===void 0||mr.traceAutoComplete({spanName:"this._shareAudioProducer trackended",span:$,status:2}),je.dispatch(yt({type:"error",text:"Share disconnected!"}))}),(Kr=this._openTelemetry)===null||Kr===void 0||Kr.completeSpan({span:Wt,status:1,message:"Share Audio Producer Created"}),nt.next=84;break;case 79:return nt.prev=79,nt.t1=nt.catch(65),nt.next=83,this._protoo.request("produceError",{mediaType:"shareAudio",message:nt.t1.message});case 83:(jr=this._videosdkLogs)===null||jr===void 0||jr.pushLogs({logText:"Error in shareAudio produceError",logType:"ERROR",attributes:{error:nt.t1.message}});case 84:(Re=this._openTelemetry)===null||Re===void 0||Re.completeSpan({span:$,status:1,message:"Enable Share Successful"}),nt.next=98;break;case 87:return nt.prev=87,nt.t2=nt.catch(11),Pe.error("enableShare() | failed:%o",nt.t2),(on=this._openTelemetry)===null||on===void 0||on.completeSpan({span:$,status:2,attributes:{error:nt.t2.message},message:"Error in enableShare video produceError"}),console.log("screen share catch",nt.t2.message),(pn=this._videosdkLogs)===null||pn===void 0||pn.pushLogs({logText:"Error in enableShare video produceError",logType:"ERROR",attributes:{error:nt.t2.message}}),nt.t2.name!=="NotAllowedError"&&je.dispatch(yt({type:"error",text:"Error sharing: ".concat(nt.t2)})),nt.next=96,this._protoo.request("produceError",{mediaType:"share",message:nt.t2.message});case 96:ae&&ae.stop(),Be&&Be.stop();case 98:je.dispatch(ht(!1));case 99:case"end":return nt.stop()}},X,this,[[11,87],[19,25],[65,79]])})),function(){return bi.apply(this,arguments)})},{key:"disableShare",value:(Cn=(0,u.A)(d().mark(function X(){var B,V,$,G,se,ae,Be,we,gt,qe,ut,oe,Re;return d().wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:if(Pe.debug("disableShare()"),G=(B=this._openTelemetry)===null||B===void 0?void 0:B.trace({spanName:"disableShare() Calling",status:1}),this._shareProducer){tt.next=5;break}return(se=this._openTelemetry)===null||se===void 0||se.completeSpan({span:G,status:2,message:"Share Producer Not found"}),tt.abrupt("return");case 5:return ae=(V=this._openTelemetry)===null||V===void 0?void 0:V.trace({spanName:"Closing Share Producer",span:G,status:1}),this._shareProducer.close(),Be=le(this._shareProducer.id),je.dispatch(Be),this._eventEmitter.emit(Be.type,Be.payload),this._shareAudioProducer&&(qe=(we=this._openTelemetry)===null||we===void 0?void 0:we.trace({spanName:"Closing Share Audio Producer",span:G,status:1}),this._shareAudioProducer.close(),Be=le(this._shareAudioProducer.id),je.dispatch(Be),this._eventEmitter.emit(Be.type,Be.payload),(gt=this._openTelemetry)===null||gt===void 0||gt.completeSpan({span:qe,status:1,message:"Closed Share Audio Producer"})),tt.prev=11,tt.next=14,this._protoo.request("closeProducer",{producerId:this._shareProducer.id});case 14:if(!this._shareAudioProducer){tt.next=17;break}return tt.next=17,this._protoo.request("closeProducer",{producerId:this._shareAudioProducer.id});case 17:(ut=this._openTelemetry)===null||ut===void 0||ut.completeSpan({span:ae,status:1,message:"Requested Server to Close Producer"}),tt.next=25;break;case 20:tt.prev=20,tt.t0=tt.catch(11),je.dispatch(yt({type:"error",text:"Error closing server-side share Producer: ".concat(tt.t0)})),(oe=this._openTelemetry)===null||oe===void 0||oe.completeSpan({span:G,status:2,message:"Error closing server-side share Producer ".concat(tt.t0)}),(Re=this._videosdkLogs)===null||Re===void 0||Re.pushLogs({logText:"Error closing server-side share Producer",logType:"ERROR",attributes:{error:tt.t0.message}});case 25:this._shareProducer=null,this._shareAudioProducer=null,($=this._openTelemetry)===null||$===void 0||$.completeSpan({span:G,status:1,message:"Screen Share Disabled Successfully"});case 28:case"end":return tt.stop()}},X,this,[[11,20]])})),function(){return Cn.apply(this,arguments)})},{key:"enableAudioOnly",value:(mc=(0,u.A)(d().mark(function X(){var B,V,$;return d().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:Pe.debug("enableAudioOnly()"),je.dispatch(fe(!0)),this.disableWebcam(),B=as(this._consumers.values()),G.prev=4,B.s();case 6:if((V=B.n()).done){G.next=13;break}if(($=V.value).kind==="video"){G.next=10;break}return G.abrupt("continue",11);case 10:this._pauseConsumer($);case 11:G.next=6;break;case 13:G.next=18;break;case 15:G.prev=15,G.t0=G.catch(4),B.e(G.t0);case 18:return G.prev=18,B.f(),G.finish(18);case 21:je.dispatch(pe(!0)),je.dispatch(fe(!1));case 23:case"end":return G.stop()}},X,this,[[4,15,18,21]])})),function(){return mc.apply(this,arguments)})},{key:"disableAudioOnly",value:(fc=(0,u.A)(d().mark(function X(){var B,V,$;return d().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:Pe.debug("disableAudioOnly()"),je.dispatch(fe(!0)),!this._webcamProducer&&this._produce&&(N()||{}).webcamEnabled&&this.enableWebcam(),B=as(this._consumers.values()),G.prev=4,B.s();case 6:if((V=B.n()).done){G.next=13;break}if(($=V.value).kind==="video"){G.next=10;break}return G.abrupt("continue",11);case 10:this._resumeConsumer($);case 11:G.next=6;break;case 13:G.next=18;break;case 15:G.prev=15,G.t0=G.catch(4),B.e(G.t0);case 18:return G.prev=18,B.f(),G.finish(18);case 21:je.dispatch(pe(!1)),je.dispatch(fe(!1));case 23:case"end":return G.stop()}},X,this,[[4,15,18,21]])})),function(){return fc.apply(this,arguments)})},{key:"muteAudio",value:(El=(0,u.A)(d().mark(function X(){return d().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:Pe.debug("muteAudio()"),je.dispatch(ue(!0));case 2:case"end":return B.stop()}},X)})),function(){return El.apply(this,arguments)})},{key:"unmuteAudio",value:(Ao=(0,u.A)(d().mark(function X(){return d().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:Pe.debug("unmuteAudio()"),je.dispatch(ue(!1));case 2:case"end":return B.stop()}},X)})),function(){return Ao.apply(this,arguments)})},{key:"handleRemoteRestartIce",value:(_r=(0,u.A)(d().mark(function X(B){var V,$,G,se,ae,Be,we,gt;return d().wrap(function(qe){for(;;)switch(qe.prev=qe.next){case 0:return G=B.iceParameters,se=B.transportId,ae=B.internalSpan,se===((V=this._sendTransport)===null||V===void 0?void 0:V.id)&&this._sendTransport.restartIce({iceParameters:G}),se===(($=this._recvTransport)===null||$===void 0?void 0:$.id)&&this._recvTransport.restartIce({iceParameters:G}),qe.prev=3,qe.next=6,this._protoo.request("iceRestarted",{transportId:se});case 6:(Be=this._openTelemetry)===null||Be===void 0||Be.completeSpan({span:ae,status:1,message:"iceRestarted"}),qe.next=14;break;case 9:qe.prev=9,qe.t0=qe.catch(3),(we=this._openTelemetry)===null||we===void 0||we.completeSpan({span:ae,status:2,message:"handleRemoteRestartIce() ICE restart failed ".concat(qe.t0)}),(gt=this._videosdkLogs)===null||gt===void 0||gt.pushLogs({logText:"Error handleRemoteRestartIce() ICE restart failed",logType:"ERROR",attributes:{error:qe.t0.message}}),je.dispatch(yt({type:"error",text:"ICE restart failed: ".concat(qe.t0)}));case 14:case"end":return qe.stop()}},X,this,[[3,9]])})),function(X){return _r.apply(this,arguments)})},{key:"restartIce",value:(Ms=(0,u.A)(d().mark(function X(){var B,V,$;return d().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(Pe.debug("restartIce()"),je.dispatch(ee(!0)),G.prev=2,!this._sendTransport){G.next=9;break}return G.next=6,this._protoo.request("restartIce",{transportId:this._sendTransport.id});case 6:return B=G.sent,G.next=9,this._sendTransport.restartIce({iceParameters:B});case 9:if(!this._recvTransport){G.next=15;break}return G.next=12,this._protoo.request("restartIce",{transportId:this._recvTransport.id});case 12:return V=G.sent,G.next=15,this._recvTransport.restartIce({iceParameters:V});case 15:je.dispatch(yt({text:"ICE restarted"})),G.next=23;break;case 18:G.prev=18,G.t0=G.catch(2),Pe.error("restartIce() | failed:%o",G.t0),je.dispatch(yt({type:"error",text:"ICE restart failed: ".concat(G.t0)})),($=this._videosdkLogs)===null||$===void 0||$.pushLogs({logText:"Error restartIce() ICE restart failed",logType:"ERROR",attributes:{error:G.t0.message}});case 23:je.dispatch(ee(!1));case 24:case"end":return G.stop()}},X,this,[[2,18]])})),function(){return Ms.apply(this,arguments)})},{key:"setMaxSendingSpatialLayer",value:(pc=(0,u.A)(d().mark(function X(B){var V;return d().wrap(function($){for(;;)switch($.prev=$.next){case 0:if(Pe.debug("setMaxSendingSpatialLayer() [spatialLayer:%s]",B),$.prev=1,!this._webcamProducer){$.next=7;break}return $.next=5,this._webcamProducer.setMaxSpatialLayer(B);case 5:$.next=10;break;case 7:if(!this._shareProducer){$.next=10;break}return $.next=10,this._shareProducer.setMaxSpatialLayer(B);case 10:$.next=17;break;case 12:$.prev=12,$.t0=$.catch(1),Pe.error("setMaxSendingSpatialLayer() | failed:%o",$.t0),(V=this._videosdkLogs)===null||V===void 0||V.pushLogs({logText:"Error setting max sending video spatial layer",logType:"ERROR",attributes:{error:$.t0.message}}),je.dispatch(yt({type:"error",text:"Error setting max sending video spatial layer: ".concat($.t0)}));case 17:case"end":return $.stop()}},X,this,[[1,12]])})),function(X){return pc.apply(this,arguments)})},{key:"setWebcamQuality",value:(zr=(0,u.A)(d().mark(function X(B){var V,$;return d().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(this._webcamProducer){G.next=2;break}return G.abrupt("return");case 2:if(V=this._webcam.resolution,$=ga[V][B].s,this._webcamProducer.maxSpatialLayer!=$){G.next=6;break}return G.abrupt("return");case 6:return G.next=8,this._webcamProducer.setMaxSpatialLayer($);case 8:case"end":return G.stop()}},X,this)})),function(X){return zr.apply(this,arguments)})},{key:"setConsumerQuality",value:(Io=(0,u.A)(d().mark(function X(B,V){var $,G,se,ae,Be,we,gt;return d().wrap(function(qe){for(;;)switch(qe.prev=qe.next){case 0:return ae=this._webcam.resolution,Be=($=this._openTelemetry)===null||$===void 0?void 0:$.trace({spanName:'Setting "'.concat(V,'" Quality')}),we=ga[ae][V].s,gt=ga[ae][V].t,(G=this._openTelemetry)===null||G===void 0||G.traceAutoComplete({spanName:"Getting spatial & temporal layers",span:Be,attributes:{spatialLayers:JSON.parse(we),temporalLayers:JSON.parse(gt)},status:1}),qe.next=7,this.setConsumerPreferredLayers(B,we,gt);case 7:(se=this._openTelemetry)===null||se===void 0||se.completeSpan({message:"Done",span:Be,status:1});case 8:case"end":return qe.stop()}},X,this)})),function(X,B){return Io.apply(this,arguments)})},{key:"setViewPort",value:(Kt=(0,u.A)(d().mark(function X(B,V,$){var G,se,ae,Be;return d().wrap(function(we){for(;;)switch(we.prev=we.next){case 0:if(this._consumers.get(B.id)){we.next=2;break}return we.abrupt("return");case 2:if(G=xt(this._consumers.get(B.id),V,$),se=G.consumerId,ae=G.newPreferredSpatialLayer,Be=G.newPreferredTemporalLayer,!se){we.next=6;break}return we.next=6,this.setConsumerPreferredLayers(se,ae,Be);case 6:case"end":return we.stop()}},X,this)})),function(X,B,V){return Kt.apply(this,arguments)})},{key:"setConsumerPreferredLayers",value:(_i=(0,u.A)(d().mark(function X(B,V,$){var G,se;return d().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return Pe.debug("setConsumerPreferredLayers() [consumerId:%s, spatialLayer:%s, temporalLayer:%s]",B,V,$),ae.prev=1,(G=this._consumers.get(B)).spatialLayers>1&&(G.preferredSpatialLayer=V,G.preferredTemporalLayer=$),ae.next=6,this._protoo.request("setConsumerPreferredLayers",{consumerId:B,spatialLayer:V,temporalLayer:$});case 6:je.dispatch(Jr(B,V,$)),ae.next=14;break;case 9:ae.prev=9,ae.t0=ae.catch(1),Pe.error("setConsumerPreferredLayers() | failed:%o",ae.t0),(se=this._videosdkLogs)===null||se===void 0||se.pushLogs({logText:"Error setting Consumer preferred layers:",logType:"ERROR",attributes:{error:ae.t0.message}}),je.dispatch(yt({type:"error",text:"Error setting Consumer preferred layers: ".concat(ae.t0)}));case 14:case"end":return ae.stop()}},X,this,[[1,9]])})),function(X,B,V){return _i.apply(this,arguments)})},{key:"setConsumerPriority",value:(ju=(0,u.A)(d().mark(function X(B,V){var $;return d().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return Pe.debug("setConsumerPriority() [consumerId:%s, priority:%d]",B,V),G.prev=1,G.next=4,this._protoo.request("setConsumerPriority",{consumerId:B,priority:V});case 4:je.dispatch(Qt(B,V)),G.next=12;break;case 7:G.prev=7,G.t0=G.catch(1),Pe.error("setConsumerPriority() | failed:%o",G.t0),($=this._videosdkLogs)===null||$===void 0||$.pushLogs({logText:"Error setting Consumer priority",logType:"ERROR",attributes:{error:G.t0.message}}),je.dispatch(yt({type:"error",text:"Error setting Consumer priority: ".concat(G.t0)}));case 12:case"end":return G.stop()}},X,this,[[1,7]])})),function(X,B){return ju.apply(this,arguments)})},{key:"requestConsumerKeyFrame",value:(yi=(0,u.A)(d().mark(function X(B){var V;return d().wrap(function($){for(;;)switch($.prev=$.next){case 0:return Pe.debug("requestConsumerKeyFrame() [consumerId:%s]",B),$.prev=1,$.next=4,this._protoo.request("requestConsumerKeyFrame",{consumerId:B});case 4:je.dispatch(yt({text:"Keyframe requested for video consumer"})),$.next=12;break;case 7:$.prev=7,$.t0=$.catch(1),Pe.error("requestConsumerKeyFrame() | failed:%o",$.t0),(V=this._videosdkLogs)===null||V===void 0||V.pushLogs({logText:"Error requesting key frame for Consumer",logType:"ERROR",attributes:{error:$.t0.message}}),je.dispatch(yt({type:"error",text:"Error requesting key frame for Consumer: ".concat($.t0)}));case 12:case"end":return $.stop()}},X,this,[[1,7]])})),function(X){return yi.apply(this,arguments)})},{key:"enableChatDataProducer",value:(Hn=(0,u.A)(d().mark(function X(){var B,V=this;return d().wrap(function($){for(;;)switch($.prev=$.next){case 0:if(Pe.debug("enableChatDataProducer()"),this._useDataChannel){$.next=3;break}return $.abrupt("return");case 3:return $.prev=3,$.next=6,this._sendTransport.produceData({ordered:!1,maxRetransmits:1,label:"chat",priority:"medium",appData:{info:"my-chat-DataProducer"}});case 6:this._chatDataProducer=$.sent,je.dispatch(Ye({id:this._chatDataProducer.id,sctpStreamParameters:this._chatDataProducer.sctpStreamParameters,label:this._chatDataProducer.label,protocol:this._chatDataProducer.protocol})),this._chatDataProducer.on("transportclose",function(){V._chatDataProducer=null}),this._chatDataProducer.on("open",function(){Pe.debug('chat DataProducer "open" event')}),this._chatDataProducer.on("close",function(){Pe.error('chat DataProducer "close" event'),V._chatDataProducer=null,je.dispatch(yt({type:"error",text:"Chat DataProducer closed"}))}),this._chatDataProducer.on("error",function(G){Pe.error('chat DataProducer "error" event:%o',G),je.dispatch(yt({type:"error",text:"Chat DataProducer error: ".concat(G)}))}),this._chatDataProducer.on("bufferedamountlow",function(){Pe.debug('chat DataProducer "bufferedamountlow" event')}),$.next=21;break;case 15:throw $.prev=15,$.t0=$.catch(3),Pe.error("enableChatDataProducer() | failed:%o",$.t0),(B=this._videosdkLogs)===null||B===void 0||B.pushLogs({logText:"Error enabling chat DataProducer",logType:"ERROR",attributes:{error:$.t0.message}}),je.dispatch(yt({type:"error",text:"Error enabling chat DataProducer: ".concat($.t0)})),$.t0;case 21:case"end":return $.stop()}},X,this,[[3,15]])})),function(){return Hn.apply(this,arguments)})},{key:"enableBotDataProducer",value:(Gn=(0,u.A)(d().mark(function X(){var B,V=this;return d().wrap(function($){for(;;)switch($.prev=$.next){case 0:if(Pe.debug("enableBotDataProducer()"),this._useDataChannel){$.next=3;break}return $.abrupt("return");case 3:return $.prev=3,$.next=6,this._sendTransport.produceData({ordered:!1,maxPacketLifeTime:2e3,label:"bot",priority:"medium",appData:{info:"my-bot-DataProducer"}});case 6:this._botDataProducer=$.sent,je.dispatch(Ye({id:this._botDataProducer.id,sctpStreamParameters:this._botDataProducer.sctpStreamParameters,label:this._botDataProducer.label,protocol:this._botDataProducer.protocol})),this._botDataProducer.on("transportclose",function(){V._botDataProducer=null}),this._botDataProducer.on("open",function(){Pe.debug('bot DataProducer "open" event')}),this._botDataProducer.on("close",function(){Pe.error('bot DataProducer "close" event'),V._botDataProducer=null,je.dispatch(yt({type:"error",text:"Bot DataProducer closed"}))}),this._botDataProducer.on("error",function(G){Pe.error('bot DataProducer "error" event:%o',G),je.dispatch(yt({type:"error",text:"Bot DataProducer error: ".concat(G)}))}),this._botDataProducer.on("bufferedamountlow",function(){Pe.debug('bot DataProducer "bufferedamountlow" event')}),$.next=21;break;case 15:throw $.prev=15,$.t0=$.catch(3),Pe.error("enableBotDataProducer() | failed:%o",$.t0),(B=this._videosdkLogs)===null||B===void 0||B.pushLogs({logText:"Error enabling bot DataProducer",logType:"ERROR",attributes:{error:$.t0.message}}),je.dispatch(yt({type:"error",text:"Error enabling bot DataProducer: ".concat($.t0)})),$.t0;case 21:case"end":return $.stop()}},X,this,[[3,15]])})),function(){return Gn.apply(this,arguments)})},{key:"sendChatMessage",value:(an=(0,u.A)(d().mark(function X(B){return d().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(Pe.debug('sendChatMessage() [text:"%s]',B),this._chatDataProducer){V.next=4;break}return je.dispatch(yt({type:"error",text:"No chat DataProducer"})),V.abrupt("return");case 4:try{this._chatDataProducer.send(B)}catch($){Pe.error("chat DataProducer.send() failed:%o",$),je.dispatch(yt({type:"error",text:"chat DataProducer.send() failed: ".concat($)}))}case 5:case"end":return V.stop()}},X,this)})),function(X){return an.apply(this,arguments)})},{key:"sendBotMessage",value:(tr=(0,u.A)(d().mark(function X(B){return d().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(Pe.debug('sendBotMessage() [text:"%s]',B),this._botDataProducer){V.next=4;break}return je.dispatch(yt({type:"error",text:"No bot DataProducer"})),V.abrupt("return");case 4:try{this._botDataProducer.send(B)}catch($){Pe.error("bot DataProducer.send() failed:%o",$),je.dispatch(yt({type:"error",text:"bot DataProducer.send() failed: ".concat($)}))}case 5:case"end":return V.stop()}},X,this)})),function(X){return tr.apply(this,arguments)})},{key:"changeDisplayName",value:(it=(0,u.A)(d().mark(function X(B){return d().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return Pe.debug('changeDisplayName() [displayName:"%s"]',B),I({displayName:B}),V.prev=2,V.next=5,this._protoo.request("changeDisplayName",{displayName:B});case 5:this._displayName=B,je.dispatch(re(B)),je.dispatch(yt({text:"Display name changed"})),V.next=15;break;case 10:V.prev=10,V.t0=V.catch(2),Pe.error("changeDisplayName() | failed: %o",V.t0),je.dispatch(yt({type:"error",text:"Could not change display name: ".concat(V.t0)})),je.dispatch(re());case 15:case"end":return V.stop()}},X,this,[[2,10]])})),function(X){return it.apply(this,arguments)})},{key:"openConnection",value:(J=(0,u.A)(d().mark(function X(B){var V,$;return d().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return V=B.roomId,$=B.payload,G.next=3,this._protoo.request("openConnection",{roomId:V,payload:$}).catch(function(se){throw new Error(se)});case 3:case"end":return G.stop()}},X,this)})),function(X){return J.apply(this,arguments)})},{key:"closeConnection",value:(St=(0,u.A)(d().mark(function X(B){return d().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return V.next=2,this._protoo.request("closeConnection",{roomId:B});case 2:case"end":return V.stop()}},X,this)})),function(X){return St.apply(this,arguments)})},{key:"switchTo",value:(Do=(0,u.A)(d().mark(function X(B){var V,$,G;return d().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:return V=B.roomId,$=B.peerIds,G=B.payload,se.next=3,this._protoo.request("requestSwitchRoom",{roomId:V,peerIds:$,payload:G});case 3:case"end":return se.stop()}},X,this)})),function(X){return Do.apply(this,arguments)})},{key:"switchPeerRoom",value:(Lo=(0,u.A)(d().mark(function X(B){var V,$,G,se;return d().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return V=B.peerId,$=B.roomId,G=B.payload,se=B.token,ae.next=3,this._protoo.request("switchPeerRoom",{roomId:$,peerId:V,payload:G,token:se});case 3:case"end":return ae.stop()}},X,this)})),function(X){return Lo.apply(this,arguments)})},{key:"connectionSwitchPeerRoom",value:(hc=(0,u.A)(d().mark(function X(B){var V,$,G,se,ae;return d().wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:return V=B.roomId,$=B.connectionRoomId,G=B.peerId,se=B.payload,ae=B.token,Be.next=3,this._protoo.request("connectionSwitchPeerRoom",{roomId:V,connectionRoomId:$,peerId:G,payload:se,token:ae});case 3:case"end":return Be.stop()}},X,this)})),function(X){return hc.apply(this,arguments)})},{key:"connectionSendChatMessage",value:(Sa=(0,u.A)(d().mark(function X(B){var V,$;return d().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return V=B.roomId,$=B.message,G.next=3,this._protoo.request("connectionSendChatMessage",{roomId:V,message:$});case 3:case"end":return G.stop()}},X,this)})),function(X){return Sa.apply(this,arguments)})},{key:"connectionEndMeeting",value:(dc=(0,u.A)(d().mark(function X(B){var V;return d().wrap(function($){for(;;)switch($.prev=$.next){case 0:return V=B.roomId,$.next=3,this._protoo.request("connectionCloseRoom",{roomId:V});case 3:case"end":return $.stop()}},X,this)})),function(X){return dc.apply(this,arguments)})},{key:"pubsubPublish",value:(Vn=(0,u.A)(d().mark(function X(B,V,$,G){var se,ae,Be,we,gt,qe;return d().wrap(function(ut){for(;;)switch(ut.prev=ut.next){case 0:if(ut.prev=0,$!=null&&$.sendOnly){if(se=$.sendOnly,ae=[],se){Be=as(se);try{for(Be.s();!(we=Be.n()).done;)(gt=we.value)&&ae.push(gt.toString())}catch(oe){Be.e(oe)}finally{Be.f()}}$.sendOnly=ae}return ut.next=4,this._protoo.request("pubsubPublish",{topic:B,message:V,options:$,payload:G});case 4:ut.next=10;break;case 6:ut.prev=6,ut.t0=ut.catch(0),(qe=this._videosdkLogs)===null||qe===void 0||qe.pushLogs({logText:"Error pubsubPublish() | failed",logType:"ERROR",attributes:{error:ut.t0.message}}),Pe.error("pubsubPublish() | failed: %o",ut.t0);case 10:case"end":return ut.stop()}},X,this,[[0,6]])})),function(X,B,V,$){return Vn.apply(this,arguments)})},{key:"pubsubSubscribe",value:(Po=(0,u.A)(d().mark(function X(B){var V,$;return d().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(!this._closed){G.next=2;break}return G.abrupt("return");case 2:return G.prev=2,G.next=5,this._protoo.request("pubsubSubscribe",{topic:B});case 5:return V=G.sent,G.abrupt("return",V);case 9:G.prev=9,G.t0=G.catch(2),($=this._videosdkLogs)===null||$===void 0||$.pushLogs({logText:"Error pubsubSubscribe() | failed",logType:"ERROR",attributes:{error:G.t0.message}}),Pe.error("pubsubSubscribe() | failed: %o",G.t0);case 13:case"end":return G.stop()}},X,this,[[2,9]])})),function(X){return Po.apply(this,arguments)})},{key:"pubsubUnsubscribe",value:(Wa=(0,u.A)(d().mark(function X(B){var V,$;return d().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:if(!this._closed){G.next=2;break}return G.abrupt("return");case 2:return G.prev=2,G.next=5,this._protoo.request("pubsubUnsubscribe",{topic:B});case 5:(V=this._videosdkLogs)===null||V===void 0||V.pushLogs({logText:"Pubsub Unsubscribing Successfully for topic ".concat(B),logType:"INFO"}),G.next=12;break;case 8:G.prev=8,G.t0=G.catch(2),($=this._videosdkLogs)===null||$===void 0||$.pushLogs({logText:"Error pubsubUnsubscribe() | failed",logType:"ERROR",attributes:{error:G.t0.message}}),Pe.error("pubsubUnsubscribe() | failed: %o",G.t0);case 12:case"end":return G.stop()}},X,this,[[2,8]])})),function(X){return Wa.apply(this,arguments)})},{key:"closeRoom",value:(Ha=(0,u.A)(d().mark(function X(){return d().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,this._protoo.request("closeRoom",{});case 2:case"end":return B.stop()}},X,this)})),function(){return Ha.apply(this,arguments)})},{key:"removePeer",value:(Xs=(0,u.A)(d().mark(function X(B){var V;return d().wrap(function($){for(;;)switch($.prev=$.next){case 0:if((V=this._openTelemetry)===null||V===void 0||V.traceAutoComplete({spanName:"Removing peer ".concat(B),status:1}),B!=null){$.next=3;break}return $.abrupt("return");case 3:return $.next=5,this._protoo.request("removePeer",{peerId:B});case 5:case"end":return $.stop()}},X,this)})),function(X){return Xs.apply(this,arguments)})},{key:"startPingPong",value:(Co=(0,u.A)(d().mark(function X(){var B=this;return d().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:this._pingWebsocketInterval!=null&&clearInterval(this._pingWebsocketInterval),this._pingWebsocketInterval=setInterval(function(){B.pingWebSocket()},2e3);case 2:case"end":return V.stop()}},X,this)})),function(){return Co.apply(this,arguments)})},{key:"pingWebSocket",value:(ba=(0,u.A)(d().mark(function X(){var B,V=this;return d().wrap(function($){for(;;)switch($.prev=$.next){case 0:if(!this._closed){$.next=2;break}return $.abrupt("return");case 2:B=!1,this._protoo.request("ping").then(function(G){G&&(B=!0)}).catch(function(G){}),setTimeout(function(){B?(!V._isWebsocketAlive||V._pingWebsocketFailedCounter>1?(V._eventEmitter.emit("MEETING_STATE_CHANGED",{state:"CONNECTED"}),V._isWebsocketAlive=!0,V._pingWebsocketFailedCounter=0,V.restartIce()):V._transportState!="failed"&&V._transportState!="disconnected"||(console.log("Calling Restart Ice based on transport state",V._transportState),V.restartIce()),V._pingWebsocketFailedCounter=0):(V._isWebsocketAlive&&V._pingWebsocketFailedCounter>1&&(V._eventEmitter.emit("MEETING_STATE_CHANGED",{state:"DISCONNECTED"}),V._isWebsocketAlive=!1,V.startInternetPingPong()),V._pingWebsocketFailedCounter=V._pingWebsocketFailedCounter+1)},1e3);case 5:case"end":return $.stop()}},X,this)})),function(){return ba.apply(this,arguments)})},{key:"startInternetPingPong",value:(_a=(0,u.A)(d().mark(function X(){var B=this;return d().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:this._pingInternetInterval!=null&&clearInterval(this._pingInternetInterval),this._pingInternetInterval=setInterval(function(){B.pingInternet()},2e3);case 2:case"end":return V.stop()}},X,this)})),function(){return _a.apply(this,arguments)})},{key:"pingInternet",value:(Os=(0,u.A)(d().mark(function X(){var B,V,$,G,se,ae,Be=this;return d().wrap(function(we){for(;;)switch(we.prev=we.next){case 0:if(!this._closed){we.next=2;break}return we.abrupt("return");case 2:return(B=this._videosdkLogs)===null||B===void 0||B.pushLogs({logText:"pinging internet",logType:"INFO"}),V=new AbortController,$=V.signal,G=setTimeout(function(){V.abort()},1e3),we.next=8,fetch("https://".concat(this._signalingBaseUrl,"/ping"),{method:"GET",signal:$}).then(function(gt){return clearTimeout(G),gt.text()}).catch(function(gt){var qe;return(qe=Be._videosdkLogs)===null||qe===void 0||qe.pushLogs({logText:"Error pingInternet failed",logType:"ERROR",attributes:{error:gt.message}}),"failed"});case 8:if(we.sent!="pong"){we.next=19;break}if((se=this._videosdkLogs)===null||se===void 0||se.pushLogs({logText:"Pong",logType:"INFO"}),!(this._pingWebsocketFailedCounter>5&&this._pongInternetCounter>3)||this._isWebsocketAlive){we.next=17;break}return this._pongInternetCounter=0,this.close({sendLeft:!1}),(ae=this._videosdkLogs)===null||ae===void 0||ae.pushLogs({logText:"Re-join the meeting, after diconnect",logType:"INFO"}),we.next=17,this.join();case 17:this._pongInternetCounter=this._pongInternetCounter+1,this._isWebsocketAlive&&(this._pongInternetCounter=0,this._pingInternetInterval!=null&&(clearInterval(this._pingInternetInterval),this._pingInternetInterval=null));case 19:case"end":return we.stop()}},X,this)})),function(){return Os.apply(this,arguments)})},{key:"getSendTransportRemoteStats",value:(cs=(0,u.A)(d().mark(function X(){return d().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(Pe.debug("getSendTransportRemoteStats()"),this._sendTransport){B.next=3;break}return B.abrupt("return");case 3:return B.abrupt("return",this._protoo.request("getTransportStats",{transportId:this._sendTransport.id}));case 4:case"end":return B.stop()}},X,this)})),function(){return cs.apply(this,arguments)})},{key:"getRecvTransportRemoteStats",value:(os=(0,u.A)(d().mark(function X(){return d().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(Pe.debug("getRecvTransportRemoteStats()"),this._recvTransport){B.next=3;break}return B.abrupt("return");case 3:return B.abrupt("return",this._protoo.request("getTransportStats",{transportId:this._recvTransport.id}));case 4:case"end":return B.stop()}},X,this)})),function(){return os.apply(this,arguments)})},{key:"getAudioRemoteStats",value:(Pi=(0,u.A)(d().mark(function X(){return d().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(Pe.debug("getAudioRemoteStats()"),this._micProducer){B.next=3;break}return B.abrupt("return");case 3:return B.abrupt("return",this._latestStats[this._micProducer.id]);case 4:case"end":return B.stop()}},X,this)})),function(){return Pi.apply(this,arguments)})},{key:"getVideoRemoteStats",value:(qi=(0,u.A)(d().mark(function X(){var B;return d().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(Pe.debug("getVideoRemoteStats()"),B=this._webcamProducer){V.next=4;break}return V.abrupt("return");case 4:return V.abrupt("return",this._latestStats[B.id]);case 5:case"end":return V.stop()}},X,this)})),function(){return qi.apply(this,arguments)})},{key:"getShareRemoteStats",value:(ei=(0,u.A)(d().mark(function X(){var B;return d().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(Pe.debug("getVideoRemoteStats()"),B=this._shareProducer){V.next=4;break}return V.abrupt("return");case 4:return V.abrupt("return",this._latestStats[B.id]);case 5:case"end":return V.stop()}},X,this)})),function(){return ei.apply(this,arguments)})},{key:"getConsumerRemoteStats",value:(Bi=(0,u.A)(d().mark(function X(B){var V;return d().wrap(function($){for(;;)switch($.prev=$.next){case 0:if(Pe.debug("getConsumerRemoteStats()"),V=this._consumers.get(B)){$.next=4;break}return $.abrupt("return");case 4:return this._latestStats[B]&&(this._latestStats[B][0].currentSpatialLayer=V.currentSpatialLayer,this._latestStats[B][0].currentTemporalLayer=V.currentTemporalLayer,this._latestStats[B][0].preferredSpatialLayer=V.preferredSpatialLayer,this._latestStats[B][0].preferredTemporalLayer=V.preferredTemporalLayer),$.abrupt("return",this._latestStats[B]);case 6:case"end":return $.stop()}},X,this)})),function(X){return Bi.apply(this,arguments)})},{key:"getChatDataProducerRemoteStats",value:(er=(0,u.A)(d().mark(function X(){var B;return d().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(Pe.debug("getChatDataProducerRemoteStats()"),B=this._chatDataProducer){V.next=4;break}return V.abrupt("return");case 4:return V.abrupt("return",this._protoo.request("getDataProducerStats",{dataProducerId:B.id}));case 5:case"end":return V.stop()}},X,this)})),function(){return er.apply(this,arguments)})},{key:"getBotDataProducerRemoteStats",value:(vi=(0,u.A)(d().mark(function X(){var B;return d().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(Pe.debug("getBotDataProducerRemoteStats()"),B=this._botDataProducer){V.next=4;break}return V.abrupt("return");case 4:return V.abrupt("return",this._protoo.request("getDataProducerStats",{dataProducerId:B.id}));case 5:case"end":return V.stop()}},X,this)})),function(){return vi.apply(this,arguments)})},{key:"getDataConsumerRemoteStats",value:(kn=(0,u.A)(d().mark(function X(B){return d().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(Pe.debug("getDataConsumerRemoteStats()"),this._dataConsumers.get(B)){V.next=4;break}return V.abrupt("return");case 4:return V.abrupt("return",this._protoo.request("getDataConsumerStats",{dataConsumerId:B}));case 5:case"end":return V.stop()}},X,this)})),function(X){return kn.apply(this,arguments)})},{key:"getSendTransportLocalStats",value:(hn=(0,u.A)(d().mark(function X(){return d().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(Pe.debug("getSendTransportLocalStats()"),this._sendTransport){B.next=3;break}return B.abrupt("return");case 3:return B.abrupt("return",this._sendTransport.getStats());case 4:case"end":return B.stop()}},X,this)})),function(){return hn.apply(this,arguments)})},{key:"getRecvTransportLocalStats",value:(Nr=(0,u.A)(d().mark(function X(){return d().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(Pe.debug("getRecvTransportLocalStats()"),this._recvTransport){B.next=3;break}return B.abrupt("return");case 3:return B.abrupt("return",this._recvTransport.getStats());case 4:case"end":return B.stop()}},X,this)})),function(){return Nr.apply(this,arguments)})},{key:"getAudioLocalStats",value:(Er=(0,u.A)(d().mark(function X(){return d().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(Pe.debug("getAudioLocalStats()"),this._micProducer){B.next=3;break}return B.abrupt("return");case 3:return B.abrupt("return",this._micProducer.getStats());case 4:case"end":return B.stop()}},X,this)})),function(){return Er.apply(this,arguments)})},{key:"getVideoLocalStats",value:(pr=(0,u.A)(d().mark(function X(){var B;return d().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(Pe.debug("getVideoLocalStats()"),B=this._webcamProducer||this._shareProducer){V.next=4;break}return V.abrupt("return");case 4:return V.abrupt("return",B.getStats());case 5:case"end":return V.stop()}},X,this)})),function(){return pr.apply(this,arguments)})},{key:"getConsumerLocalStats",value:(Gt=(0,u.A)(d().mark(function X(B){var V;return d().wrap(function($){for(;;)switch($.prev=$.next){case 0:if(V=this._consumers.get(B)){$.next=3;break}return $.abrupt("return");case 3:return $.abrupt("return",V.getStats());case 4:case"end":return $.stop()}},X,this)})),function(X){return Gt.apply(this,arguments)})},{key:"applyNetworkThrottle",value:(Cr=(0,u.A)(d().mark(function X(B){var V,$,G,se;return d().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:return V=B.uplink,$=B.downlink,G=B.rtt,se=B.secret,Pe.debug("applyNetworkThrottle() [uplink:%s, downlink:%s, rtt:%s]",V,$,G),ae.prev=2,ae.next=5,this._protoo.request("applyNetworkThrottle",{uplink:V,downlink:$,rtt:G,secret:se});case 5:ae.next=11;break;case 7:ae.prev=7,ae.t0=ae.catch(2),Pe.error("applyNetworkThrottle() | failed:%o",ae.t0),je.dispatch(yt({type:"error",text:"Error applying network throttle: ".concat(ae.t0)}));case 11:case"end":return ae.stop()}},X,this,[[2,7]])})),function(X){return Cr.apply(this,arguments)})},{key:"resetNetworkThrottle",value:(Nt=(0,u.A)(d().mark(function X(B){var V,$,G;return d().wrap(function(se){for(;;)switch(se.prev=se.next){case 0:return V=B.silent,$=V!==void 0&&V,G=B.secret,Pe.debug("resetNetworkThrottle()"),se.prev=2,se.next=5,this._protoo.request("resetNetworkThrottle",{secret:G});case 5:se.next=10;break;case 7:se.prev=7,se.t0=se.catch(2),$||(Pe.error("resetNetworkThrottle() | failed:%o",se.t0),je.dispatch(yt({type:"error",text:"Error resetting network throttle: ".concat(se.t0)})));case 10:case"end":return se.stop()}},X,this,[[2,7]])})),function(X){return Nt.apply(this,arguments)})},{key:"createProducerTransport",value:(or=(0,u.A)(d().mark(function X(B,V){var $,G,se,ae,Be,we,gt,qe,ut,oe,Re=this;return d().wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:se=B.id,ae=B.iceParameters,Be=B.iceCandidates,we=B.dtlsParameters,gt=B.sctpParameters,qe=($=this._openTelemetry)===null||$===void 0?void 0:$.trace({spanName:"Creating Send Transport",span:V||null}),this._sendTransport=this._mediasoupDevice.createSendTransport({id:se,iceParameters:ae,iceCandidates:Be,dtlsParameters:we,sctpParameters:gt,iceServers:this._iceServers}),this._sendTransport.on("connect",function(rt,_e,Ue){var pt,Bt=rt.dtlsParameters;(pt=Re._openTelemetry)===null||pt===void 0||pt.traceAutoComplete({spanName:"this._sendTransport `connect` Event : Transport is about to establish the ICE+DTLS connection",span:qe,status:1}),Re._protoo.request("connectWebRtcTransport",{transportId:Re._sendTransport.id,dtlsParameters:Bt}).then(_e).catch(Ue)}),this._sendTransport.on("produce",function(){var rt=(0,u.A)(d().mark(function _e(Ue,pt,Bt){var Wt,Dt,Ut,Ft,qt,nr,Lt;return d().wrap(function(dt){for(;;)switch(dt.prev=dt.next){case 0:return Wt=Ue.kind,Dt=Ue.rtpParameters,Ut=Ue.appData,dt.prev=1,(Ft=Re._openTelemetry)===null||Ft===void 0||Ft.traceAutoComplete({spanName:"this._sendTransport `produce` Event : Transmit information about a new producer ",span:qe,status:1}),dt.next=5,Re._protoo.request("produce",{transportId:Re._sendTransport.id,kind:Wt,rtpParameters:Dt,appData:Ut});case 5:qt=dt.sent,nr=qt.id,pt({id:nr}),dt.next=14;break;case 10:dt.prev=10,dt.t0=dt.catch(1),(Lt=Re._videosdkLogs)===null||Lt===void 0||Lt.pushLogs({logText:'Error this._sendTransport "produce" Event catch',logType:"ERROR",attributes:{error:dt.t0.message}}),Bt(dt.t0);case 14:case"end":return dt.stop()}},_e,null,[[1,10]])}));return function(_e,Ue,pt){return rt.apply(this,arguments)}}()),this._sendTransport.on("producedata",function(){var rt=(0,u.A)(d().mark(function _e(Ue,pt,Bt){var Wt,Dt,Ut,Ft,qt,nr,Lt;return d().wrap(function(dt){for(;;)switch(dt.prev=dt.next){case 0:return Wt=Ue.sctpStreamParameters,Dt=Ue.label,Ut=Ue.protocol,Ft=Ue.appData,Pe.debug('"producedata" event: [sctpStreamParameters:%o, appData:%o]',Wt,Ft),dt.prev=2,dt.next=5,Re._protoo.request("produceData",{transportId:Re._sendTransport.id,sctpStreamParameters:Wt,label:Dt,protocol:Ut,appData:Ft});case 5:qt=dt.sent,nr=qt.id,pt({id:nr}),dt.next=14;break;case 10:dt.prev=10,dt.t0=dt.catch(2),(Lt=Re._videosdkLogs)===null||Lt===void 0||Lt.pushLogs({logText:"Error producedata event catch",logType:"ERROR",attributes:{error:dt.t0.message}}),Bt(dt.t0);case 14:case"end":return dt.stop()}},_e,null,[[2,10]])}));return function(_e,Ue,pt){return rt.apply(this,arguments)}}()),this._sendTransport.on("connectionstatechange",function(rt){var _e;(_e=Re._openTelemetry)===null||_e===void 0||_e.traceAutoComplete({spanName:"_sendTransport Event connectionstatechange ".concat(rt),span:qe,status:1}),rt==="failed"&&Re.restartIce(),Re._transportState=rt}),ut=0,(oe=this._metrics.addNewProbe(this._sendTransport,"sendTransport")).onStatsCollected=function(rt){try{var _e,Ue,pt,Bt;Re._stats.producerStats||(Re._stats.producerStats={}),Re._stats.producerStats.audio||(Re._stats.producerStats.audio=[]),Re._stats.producerStats.shareAudio||(Re._stats.producerStats.shareAudio=[]),Re._micProducer&&(Re._latestStats[(_e=Re._micProducer)===null||_e===void 0?void 0:_e.id]=[]),Re._shareAudioProducer&&(Re._latestStats[(Ue=Re._shareAudioProducer)===null||Ue===void 0?void 0:Ue.id]=[]),rt.audio.forEach(function(Dt){var Ut,Ft,qt;if(Re._micProducer&&Dt.trackId==((Ut=Re._micProducer)===null||Ut===void 0?void 0:Ut.track.id))Re._latestStats[(qt=Re._micProducer)===null||qt===void 0?void 0:qt.id].push(Dt),ut%5==0&&Re._stats.producerStats.audio.push(Dt);else if(Re._shareAudioProducer&&Dt.trackId==((Ft=Re._shareAudioProducer)===null||Ft===void 0?void 0:Ft.track.id)){var nr;Re._latestStats[(nr=Re._shareAudioProducer)===null||nr===void 0?void 0:nr.id].push(Dt),ut%5==0&&Re._stats.producerStats.shareAudio.push(Dt)}}),Re._stats.producerStats.video||(Re._stats.producerStats.video=[]),Re._stats.producerStats.share||(Re._stats.producerStats.share=[]),Re._webcamProducer&&(Re._latestStats[(pt=Re._webcamProducer)===null||pt===void 0?void 0:pt.id]=[]),Re._shareProducer&&(Re._latestStats[(Bt=Re._shareProducer)===null||Bt===void 0?void 0:Bt.id]=[]),rt.video.forEach(function(Dt){var Ut,Ft,qt;if(Re._webcamProducer&&Dt.trackId==((Ut=Re._webcamProducer)===null||Ut===void 0?void 0:Ut.track.id))Re._latestStats[(qt=Re._webcamProducer)===null||qt===void 0?void 0:qt.id].push(Dt);else if(Re._shareProducer&&Dt.trackId==((Ft=Re._shareProducer)===null||Ft===void 0?void 0:Ft.track.id)){var nr;Re._latestStats[(nr=Re._shareProducer)===null||nr===void 0?void 0:nr.id].push(Dt)}}),ut%5==0&&Re._webcamProducer!=null&&Re._stats.producerStats.video.push({timestamp:new Date,stats:Re._latestStats[Re._webcamProducer.id]}),ut%5==0&&Re._shareProducer!=null&&Re._stats.producerStats.share.push({timestamp:new Date,stats:Re._latestStats[Re._shareProducer.id]}),ut++}catch(Dt){var Wt;(Wt=Re._videosdkLogs)===null||Wt===void 0||Wt.pushLogs({logText:"Error PRODUCER Stats ERROR",logType:"ERROR",attributes:{error:Dt.message}}),console.log("PRODUCER ERROR",Dt)}},oe.start(),this._sendTransport.observer.on("close",function(){oe.stop(),Re._metrics.removeExistingProbe(oe)}),(G=this._openTelemetry)===null||G===void 0||G.completeSpan({span:qe,status:1,message:"Send Transport Created Successfully"});case 13:case"end":return tt.stop()}},X,this)})),function(X,B){return or.apply(this,arguments)})},{key:"createConsumerTransport",value:(hr=(0,u.A)(d().mark(function X(B,V){var $,G,se,ae,Be,we,gt,qe,ut,oe,Re=this;return d().wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:se=B.id,ae=B.iceParameters,Be=B.iceCandidates,we=B.dtlsParameters,gt=B.sctpParameters,qe=($=this._openTelemetry)===null||$===void 0?void 0:$.trace({spanName:"Creating Recieve Transport",span:V||null}),this._recvTransport=this._mediasoupDevice.createRecvTransport({id:se,iceParameters:ae,iceCandidates:Be,dtlsParameters:we,sctpParameters:gt,iceServers:this._iceServers}),this._recvTransport.on("connect",function(rt,_e,Ue){var pt,Bt=rt.dtlsParameters;(pt=Re._openTelemetry)===null||pt===void 0||pt.traceAutoComplete({spanName:"this._recvTransport `connect` Event : Recieve Transport is about to establish the ICE+DTLS connection",span:qe,status:1}),Re._protoo.request("connectWebRtcTransport",{transportId:Re._recvTransport.id,dtlsParameters:Bt}).then(_e).catch(Ue)}),this._recvTransport.on("connectionstatechange",function(rt){var _e;(_e=Re._openTelemetry)===null||_e===void 0||_e.traceAutoComplete({spanName:"_recvTransport Event connectionstatechange ".concat(rt),span:qe,status:1}),rt==="failed"&&Re.restartIce(),Re._transportState=rt}),ut=0,(oe=this._metrics.addNewProbe(this._recvTransport,"transport")).onStatsCollected=function(rt){try{rt.audio.forEach(function(Ue){var pt=Re._consumers.get(Ue.trackId);if(pt!=null){var Bt=pt.appData.share==1?pt.kind=="audio"?"shareAudio":"share":pt.kind;Re._stats.consumerStats||(Re._stats.consumerStats={}),Re._stats.consumerStats[pt.appData.peerId]||(Re._stats.consumerStats[pt.appData.peerId]={}),Re._stats.consumerStats[pt.appData.peerId][Bt]||(Re._stats.consumerStats[pt.appData.peerId][Bt]=[]),Ue.trackId==pt.id&&(Re._latestStats[pt.id]=[],Re._latestStats[pt.id].push(Ue),ut%5==0&&Re._stats.consumerStats[pt.appData.peerId][Bt].push(Ue))}}),rt.video.forEach(function(Ue){var pt=Re._consumers.get(Ue.trackId);if(pt!=null){var Bt=pt.appData.share==1?pt.kind=="audio"?"shareAudio":"share":pt.kind;Re._stats.consumerStats||(Re._stats.consumerStats={}),Re._stats.consumerStats[pt.appData.peerId]||(Re._stats.consumerStats[pt.appData.peerId]={}),Re._stats.consumerStats[pt.appData.peerId][Bt]||(Re._stats.consumerStats[pt.appData.peerId][Bt]=[]),Ue.trackId==pt.id&&(Re._latestStats[pt.id]=[],Re._latestStats[pt.id].push(Ue),ut%5==0&&Re._stats.consumerStats[pt.appData.peerId][Bt].push(Ue))}}),ut++}catch(Ue){var _e;(_e=Re._videosdkLogs)===null||_e===void 0||_e.pushLogs({logText:"Error CONSUMER Stats ERROR",logType:"ERROR",attributes:{error:Ue.message}}),console.log("CONSUMER CATCH",Ue)}},oe.start(),this._recvTransport.observer.on("close",function(){oe.stop(),Re._metrics.removeExistingProbe(oe)}),(G=this._openTelemetry)===null||G===void 0||G.completeSpan({span:qe,status:1,message:"Recieve Transport Created Successfully"});case 11:case"end":return tt.stop()}},X,this)})),function(X,B){return hr.apply(this,arguments)})},{key:"joinRoom",value:(Vt=(0,u.A)(d().mark(function X(){var B,V,$,G,se,ae,Be,we,gt,qe,ut,oe,Re,tt,rt,_e,Ue,pt,Bt,Wt,Dt,Ut,Ft,qt,nr;return d().wrap(function(Lt){for(;;)switch(Lt.prev=Lt.next){case 0:return Pe.debug("joinRoom()"),Lt.prev=1,Be=(B=this._openTelemetry)===null||B===void 0?void 0:B.trace({spanName:"Loading Router Capabilities",span:this._joinSpan}),this._mediasoupDevice=new E.Device({handlerName:this._handlerName}),Lt.next=6,this._protoo.request("getRouterRtpCapabilities");case 6:return we=Lt.sent,Lt.next=9,this._mediasoupDevice.load({routerRtpCapabilities:we});case 9:if((V=this._openTelemetry)===null||V===void 0||V.completeSpan({span:Be,status:1,attributes:{routerRtpCapabilities:JSON.stringify(we).toString()},message:"Router Capabilities Loaded"}),!this._produce){Lt.next=15;break}return Lt.next=13,this._protoo.request("createWebRtcTransport",{preferredProtocol:this._preferredProtocol,producing:!0,consuming:!1,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 13:gt=Lt.sent,this.createProducerTransport(gt,this._joinSpan);case 15:if(!this._consume){Lt.next=20;break}return Lt.next=18,this._protoo.request("createWebRtcTransport",{preferredProtocol:this._preferredProtocol,producing:!1,consuming:!0,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 18:qe=Lt.sent,this.createConsumerTransport(qe,this._joinSpan);case 20:return Lt.next=22,this._protoo.request("join",{displayName:this._displayName,device:this._device,secret:this._secret,rtpCapabilities:($=this._mediasoupDevice)===null||$===void 0?void 0:$.rtpCapabilities,sctpCapabilities:(G=this._mediasoupDevice)===null||G===void 0?void 0:G.sctpCapabilities,deviceInfo:this._deviceInfo,debugMode:this._debugMode,autoConsume:this._autoConsume,metaData:this._metaData});case 22:ut=Lt.sent,oe=ut.peers,Re=ut.poll,tt=ut.messages,je.dispatch(j("connected")),(se=this._openTelemetry)===null||se===void 0||se.traceAutoComplete({spanName:"Emitted `MEETING_JOINED` Event",span:this._joinSpan,status:1}),this._eventEmitter.emit("MEETING_JOINED",{peers:oe,poll:Re,messages:tt,baseUrl:this._baseUrl}),je.dispatch({type:"REMOVE_ALL_NOTIFICATIONS"}),je.dispatch(yt({text:"You are in the room!",timeout:3e3})),rt=as(oe);try{for(rt.s();!(_e=rt.n()).done;)Ue=_e.value,pt=kt($n($n({},Ue),{},{consumers:[],dataConsumers:[]})),je.dispatch(pt),this._eventEmitter.emit(pt.type,pt.payload)}catch(dt){rt.e(dt)}finally{rt.f()}this._produce&&(je.dispatch(he({canSendMic:this._mediasoupDevice.canProduce("audio"),canSendWebcam:this._mediasoupDevice.canProduce("video")})),this._micEnabled?this.enableMic(this.customMicrophoneAudioTrack,this._joinSpan):this.customMicrophoneAudioTrack&&((Bt=this._openTelemetry)===null||Bt===void 0||Bt.traceAutoComplete({spanName:"Disposing Audio Track",span:this._joinSpan,status:2}),this.customMicrophoneAudioTrack.getTracks().forEach(function(dt){dt.stop()})),Wt=N(),this._webcamEnabled&&(!Wt||Wt.webcamEnabled||this._externalVideo)?this.enableWebcam(this.customCameraVideoTrack,this._joinSpan):this.customCameraVideoTrack&&((Dt=this._openTelemetry)===null||Dt===void 0||Dt.traceAutoComplete({spanName:"Disposing Video Track",span:this._joinSpan,status:2}),this.customCameraVideoTrack.getTracks().forEach(function(dt){dt.stop()})),this.enableChatDataProducer()),window.SHOW_INFO&&(Ut=je.getState(),Ft=Ut.me,je.dispatch(Y(Ft.id))),(ae=this._openTelemetry)===null||ae===void 0||ae.completeSpan({span:this._joinSpan,status:1,message:"Room Joined"}),Lt.next=45;break;case 38:Lt.prev=38,Lt.t0=Lt.catch(1),Pe.error("joinRoom() failed:%o",Lt.t0),(qt=this._videosdkLogs)===null||qt===void 0||qt.pushLogs({logText:"Error Could not join the room",logType:"ERROR",attributes:{error:Lt.t0.message}}),(nr=this._openTelemetry)===null||nr===void 0||nr.completeSpan({span:this._joinSpan,status:2,message:"Could not join the room ".concat(Lt.t0)}),je.dispatch(yt({type:"error",text:"Could not join the room: ".concat(Lt.t0)})),this.close({sendLeft:!0});case 45:case"end":return Lt.stop()}},X,this,[[1,38]])})),function(){return Vt.apply(this,arguments)})},{key:"_updateMics",value:($t=(0,u.A)(d().mark(function X(){var B,V,$,G,se,ae,Be,we,gt,qe,ut,oe,Re,tt,rt,_e=arguments;return d().wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:return V=_e.length>0&&_e[0]!==void 0?_e[0]:void 0,this._mics=new Map,Pe.debug("_updateMics() |"),$=(B=this._openTelemetry)===null||B===void 0?void 0:B.trace({spanName:"_updateMics() Calling for Getting System Mic list",span:V||null}),Ue.prev=4,Ue.next=7,navigator.mediaDevices.enumerateDevices();case 7:ae=Ue.sent,(G=this._openTelemetry)===null||G===void 0||G.traceAutoComplete({spanName:"Getting System Mic list",span:$,status:1,attributes:{systemDevice:ae?JSON.stringify(ae):"Device not found"}}),Be=as(ae);try{for(Be.s();!(we=Be.n()).done;)(gt=we.value).kind=="audioinput"&&this._mics.set(gt.deviceId,gt)}catch(pt){Be.e(pt)}finally{Be.f()}qe=Array.from(this._mics.values()),ut=qe.length,oe=this._mic.device?this._mic.device.deviceId:void 0,ut===0?this._mic.device=null:this._mics.has(oe)||(this._mic.device=qe[0]),(se=this._openTelemetry)===null||se===void 0||se.completeSpan({span:$,status:1,message:"Update Mic"}),Ue.next=30;break;case 18:if(Ue.prev=18,Ue.t0=Ue.catch(4),!(Ue.t0 instanceof TypeError)){Ue.next=30;break}if(Ue.t0.name!=="TypeError"){Ue.next=28;break}throw tt=Ke.q.ERROR_MICROPHONE_ACCESS_UNAVAILABLE,this._emitError(tt),(Re=this._openTelemetry)===null||Re===void 0||Re.completeSpan({span:$,status:2,message:"Error in updateMics() :: ".concat(tt.message)}),new Error(tt.message);case 28:throw(rt=this._openTelemetry)===null||rt===void 0||rt.completeSpan({span:$,status:2,message:"Error in updateMics() :: ".concat(Ue.t0.message)}),new Error(Ue.t0.message);case 30:case"end":return Ue.stop()}},X,this,[[4,18]])})),function(){return $t.apply(this,arguments)})},{key:"_updateWebcams",value:(lt=(0,u.A)(d().mark(function X(){var B,V,$,G,se,ae,Be,we,gt,qe,ut,oe,Re,tt,rt,_e=arguments;return d().wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:return V=_e.length>0&&_e[0]!==void 0?_e[0]:void 0,Pe.debug("_updateWebcams()"),this._webcams=new Map,Pe.debug("_updateWebcams() | calling enumerateDevices()"),$=(B=this._openTelemetry)===null||B===void 0?void 0:B.trace({spanName:"_updateWebcams() Calling for Getting System Webcam list",span:V||null}),Ue.prev=5,Ue.next=8,navigator.mediaDevices.enumerateDevices();case 8:ae=Ue.sent,(G=this._openTelemetry)===null||G===void 0||G.traceAutoComplete({spanName:"Getting System Webcam list",span:$,status:1,attributes:{systemDevice:ae?JSON.stringify(ae):"Device not found"}}),Be=as(ae),Ue.prev=11,Be.s();case 13:if((we=Be.n()).done){Ue.next=20;break}if((gt=we.value).kind==="videoinput"){Ue.next=17;break}return Ue.abrupt("continue",18);case 17:this._webcams.set(gt.deviceId,gt);case 18:Ue.next=13;break;case 20:Ue.next=25;break;case 22:Ue.prev=22,Ue.t0=Ue.catch(11),Be.e(Ue.t0);case 25:return Ue.prev=25,Be.f(),Ue.finish(25);case 28:qe=Array.from(this._webcams.values()),ut=qe.length,(oe=this._webcam.device?this._webcam.device.deviceId:void 0)&&(this._defaultCameraIndex=oe),Pe.debug("_updateWebcams() [webcams:%o]",qe),ut===0?this._webcam.device=null:this._webcams.has(oe)||(this._webcam.device=qe[this._defaultCameraIndex]),(se=this._openTelemetry)===null||se===void 0||se.completeSpan({span:$,status:1,message:"Update Webcam"}),je.dispatch({type:"SET_CAN_CHANGE_WEBCAM",payload:this._webcams.size>1}),Ue.next=50;break;case 38:if(Ue.prev=38,Ue.t1=Ue.catch(5),!(Ue.t1 instanceof TypeError)){Ue.next=50;break}if(Ue.t1.name!=="TypeError"){Ue.next=48;break}throw tt=Ke.q.ERROR_CAMERA_ACCESS_UNAVAILABLE,this._emitError(tt),(Re=this._openTelemetry)===null||Re===void 0||Re.completeSpan({span:$,status:2,message:"Error in updateWebcams() :: ".concat(tt.message)}),new Error(tt.message);case 48:throw(rt=this._openTelemetry)===null||rt===void 0||rt.completeSpan({span:$,status:2,message:"Error in updateWebcams() :: ".concat(Ue.t1.message)}),new Error(Ue.t1.message);case 50:case"end":return Ue.stop()}},X,this,[[5,38],[11,22,25,28]])})),function(){return lt.apply(this,arguments)})},{key:"_getWebcamType",value:function(X){return/(back|rear)/i.test(X.label)?(Pe.debug("_getWebcamType() | it seems to be a back camera"),"back"):(Pe.debug("_getWebcamType() | it seems to be a front camera"),"front")}},{key:"_pauseConsumer",value:(He=(0,u.A)(d().mark(function X(B){var V;return d().wrap(function($){for(;;)switch($.prev=$.next){case 0:if(!B.paused){$.next=2;break}return $.abrupt("return");case 2:return $.prev=2,$.next=5,this._protoo.request("pauseConsumer",{consumerId:B.id});case 5:B.pause(),je.dispatch(Wr(B.id,"local")),$.next=14;break;case 9:$.prev=9,$.t0=$.catch(2),Pe.error("_pauseConsumer() | failed:%o",$.t0),(V=this._videosdkLogs)===null||V===void 0||V.pushLogs({logText:"Error pausing Consumer",logType:"ERROR",attributes:{error:$.t0.message}}),je.dispatch(yt({type:"error",text:"Error pausing Consumer: ".concat($.t0)}));case 14:case"end":return $.stop()}},X,this,[[2,9]])})),function(X){return He.apply(this,arguments)})},{key:"_resumeConsumer",value:(Ve=(0,u.A)(d().mark(function X(B){var V;return d().wrap(function($){for(;;)switch($.prev=$.next){case 0:if(B.paused){$.next=2;break}return $.abrupt("return");case 2:return $.prev=2,$.next=5,this._protoo.request("resumeConsumer",{consumerId:B.id});case 5:B.resume(),je.dispatch(br(B.id,"local")),$.next=14;break;case 9:$.prev=9,$.t0=$.catch(2),Pe.error("_resumeConsumer() | failed:%o",$.t0),(V=this._videosdkLogs)===null||V===void 0||V.pushLogs({logText:"Error resuming Consumer",logType:"ERROR",attributes:{error:$.t0.message}}),je.dispatch(yt({type:"error",text:"Error resuming Consumer: ".concat($.t0)}));case 14:case"end":return $.stop()}},X,this,[[2,9]])})),function(X){return Ve.apply(this,arguments)})},{key:"_getExternalVideoStream",value:(be=(0,u.A)(d().mark(function X(){var B=this;return d().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:if(!this._externalVideoStream){V.next=2;break}return V.abrupt("return",this._externalVideoStream);case 2:if(!(this._externalVideo.readyState<3)){V.next=5;break}return V.next=5,new Promise(function($){return B._externalVideo.addEventListener("canplay",$)});case 5:if(!this._externalVideo.captureStream){V.next=9;break}this._externalVideoStream=this._externalVideo.captureStream(),V.next=14;break;case 9:if(!this._externalVideo.mozCaptureStream){V.next=13;break}this._externalVideoStream=this._externalVideo.mozCaptureStream(),V.next=14;break;case 13:throw new Error("video.captureStream() not supported");case 14:return V.abrupt("return",this._externalVideoStream);case 15:case"end":return V.stop()}},X,this)})),function(){return be.apply(this,arguments)})},{key:"_emitError",value:function(X){this._eventEmitter.emit("ERROR",X)}}],[{key:"init",value:function(X){je=X.store}}]);var be,Ve,He,lt,$t,Vt,hr,or,Nt,Cr,Gt,pr,Er,Nr,hn,kn,vi,er,Bi,ei,qi,Pi,os,cs,Os,_a,ba,Co,Xs,Ha,Wa,Po,Vn,dc,Sa,hc,Lo,Do,St,J,it,tr,an,Gn,Hn,yi,ju,_i,Kt,Io,zr,pc,Ms,_r,Ao,El,fc,mc,Cn,bi,Ns,Rl,gc,Tl,me,Rt,xl,Ht,kl,Tt,Wn,Oo,Cl,Pl,Bu,Uu,$u,Vu,Gu,Hu,Wu,zu,Mo,No,Fo,vc,yc,_c,jo,bc,wa,Sc,wc,za,Ka,qa,Ss,Ea,Ya,Ra,Bo}()},4973:(a,c,o)=>{o.d(c,{Zu:()=>g,lp:()=>f});var l=o(467),u=o(4756),h=o.n(u),f=(o(9027),function(){var p=(0,l.A)(h().mark(function d(m){return h().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(S){var R=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return R?new Promise(function(k,C){R.call(navigator,S,k,C)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),E.next=4,navigator.mediaDevices.getUserMedia(m);case 4:return E.abrupt("return",E.sent);case 5:case"end":return E.stop()}},d)}));return function(d){return p.apply(this,arguments)}}()),g=function(){var p=(0,l.A)(h().mark(function d(m){return h().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getDisplayMedia===void 0&&(navigator.mediaDevices.getDisplayMedia=function(S){var R=navigator.webkitGetDisplayMedia||navigator.mozGetDisplayMedia;return R?new Promise(function(k,C){R.call(navigator,S,k,C)}):Promise.reject(new Error("getDisplayMedia is not implemented in this browser"))}),E.next=4,navigator.mediaDevices.getDisplayMedia(m);case 4:return E.abrupt("return",E.sent);case 5:case"end":return E.stop()}},d)}));return function(d){return p.apply(this,arguments)}}()},6880:function(a){a.exports=function(c){var o={};function l(u){if(o[u])return o[u].exports;var h=o[u]={i:u,l:!1,exports:{}};return c[u].call(h.exports,h,h.exports,l),h.l=!0,h.exports}return l.m=c,l.c=o,l.d=function(u,h,f){l.o(u,h)||Object.defineProperty(u,h,{enumerable:!0,get:f})},l.r=function(u){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})},l.t=function(u,h){if(1&h&&(u=l(u)),8&h||4&h&&typeof u=="object"&&u&&u.__esModule)return u;var f=Object.create(null);if(l.r(f),Object.defineProperty(f,"default",{enumerable:!0,value:u}),2&h&&typeof u!="string")for(var g in u)l.d(f,g,(function(p){return u[p]}).bind(null,g));return f},l.n=function(u){var h=u&&u.__esModule?function(){return u.default}:function(){return u};return l.d(h,"a",h),h},l.o=function(u,h){return Object.prototype.hasOwnProperty.call(u,h)},l.p="",l(l.s=90)}({17:function(c,o,l){o.__esModule=!0,o.default=void 0;var u=l(18),h=function(){function f(){}return f.getFirstMatch=function(g,p){var d=p.match(g);return d&&d.length>0&&d[1]||""},f.getSecondMatch=function(g,p){var d=p.match(g);return d&&d.length>1&&d[2]||""},f.matchAndReturnConst=function(g,p,d){if(g.test(p))return d},f.getWindowsVersionName=function(g){switch(g){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},f.getMacOSVersionName=function(g){var p=g.split(".").splice(0,2).map(function(d){return parseInt(d,10)||0});if(p.push(0),p[0]===10)switch(p[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},f.getAndroidVersionName=function(g){var p=g.split(".").splice(0,2).map(function(d){return parseInt(d,10)||0});if(p.push(0),!(p[0]===1&&p[1]<5))return p[0]===1&&p[1]<6?"Cupcake":p[0]===1&&p[1]>=6?"Donut":p[0]===2&&p[1]<2?"Eclair":p[0]===2&&p[1]===2?"Froyo":p[0]===2&&p[1]>2?"Gingerbread":p[0]===3?"Honeycomb":p[0]===4&&p[1]<1?"Ice Cream Sandwich":p[0]===4&&p[1]<4?"Jelly Bean":p[0]===4&&p[1]>=4?"KitKat":p[0]===5?"Lollipop":p[0]===6?"Marshmallow":p[0]===7?"Nougat":p[0]===8?"Oreo":p[0]===9?"Pie":void 0},f.getVersionPrecision=function(g){return g.split(".").length},f.compareVersions=function(g,p,d){d===void 0&&(d=!1);var m=f.getVersionPrecision(g),E=f.getVersionPrecision(p),S=Math.max(m,E),R=0,k=f.map([g,p],function(C){var x=S-f.getVersionPrecision(C),P=C+new Array(x+1).join(".0");return f.map(P.split("."),function(D){return new Array(20-D.length).join("0")+D}).reverse()});for(d&&(R=S-Math.min(m,E)),S-=1;S>=R;){if(k[0][S]>k[1][S])return 1;if(k[0][S]===k[1][S]){if(S===R)return 0;S-=1}else if(k[0][S]<k[1][S])return-1}},f.map=function(g,p){var d,m=[];if(Array.prototype.map)return Array.prototype.map.call(g,p);for(d=0;d<g.length;d+=1)m.push(p(g[d]));return m},f.find=function(g,p){var d,m;if(Array.prototype.find)return Array.prototype.find.call(g,p);for(d=0,m=g.length;d<m;d+=1){var E=g[d];if(p(E,d))return E}},f.assign=function(g){for(var p,d,m=g,E=arguments.length,S=new Array(E>1?E-1:0),R=1;R<E;R++)S[R-1]=arguments[R];if(Object.assign)return Object.assign.apply(Object,[g].concat(S));var k=function(){var C=S[p];typeof C=="object"&&C!==null&&Object.keys(C).forEach(function(x){m[x]=C[x]})};for(p=0,d=S.length;p<d;p+=1)k();return g},f.getBrowserAlias=function(g){return u.BROWSER_ALIASES_MAP[g]},f.getBrowserTypeByAlias=function(g){return u.BROWSER_MAP[g]||""},f}();o.default=h,c.exports=o.default},18:function(c,o,l){o.__esModule=!0,o.ENGINE_MAP=o.OS_MAP=o.PLATFORMS_MAP=o.BROWSER_MAP=o.BROWSER_ALIASES_MAP=void 0,o.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},o.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},o.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},o.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},o.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(c,o,l){o.__esModule=!0,o.default=void 0;var u,h=(u=l(91))&&u.__esModule?u:{default:u},f=l(18);function g(d,m){for(var E=0;E<m.length;E++){var S=m[E];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(d,S.key,S)}}var p=function(){function d(){}var m,E,S;return d.getParser=function(R,k){if(k===void 0&&(k=!1),typeof R!="string")throw new Error("UserAgent should be a string");return new h.default(R,k)},d.parse=function(R){return new h.default(R).getResult()},m=d,S=[{key:"BROWSER_MAP",get:function(){return f.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return f.ENGINE_MAP}},{key:"OS_MAP",get:function(){return f.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return f.PLATFORMS_MAP}}],(E=null)&&g(m.prototype,E),S&&g(m,S),d}();o.default=p,c.exports=o.default},91:function(c,o,l){o.__esModule=!0,o.default=void 0;var u=d(l(92)),h=d(l(93)),f=d(l(94)),g=d(l(95)),p=d(l(17));function d(E){return E&&E.__esModule?E:{default:E}}var m=function(){function E(R,k){if(k===void 0&&(k=!1),R==null||R==="")throw new Error("UserAgent parameter can't be empty");this._ua=R,this.parsedResult={},k!==!0&&this.parse()}var S=E.prototype;return S.getUA=function(){return this._ua},S.test=function(R){return R.test(this._ua)},S.parseBrowser=function(){var R=this;this.parsedResult.browser={};var k=p.default.find(u.default,function(C){if(typeof C.test=="function")return C.test(R);if(C.test instanceof Array)return C.test.some(function(x){return R.test(x)});throw new Error("Browser's test function is not valid")});return k&&(this.parsedResult.browser=k.describe(this.getUA())),this.parsedResult.browser},S.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},S.getBrowserName=function(R){return R?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},S.getBrowserVersion=function(){return this.getBrowser().version},S.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},S.parseOS=function(){var R=this;this.parsedResult.os={};var k=p.default.find(h.default,function(C){if(typeof C.test=="function")return C.test(R);if(C.test instanceof Array)return C.test.some(function(x){return R.test(x)});throw new Error("Browser's test function is not valid")});return k&&(this.parsedResult.os=k.describe(this.getUA())),this.parsedResult.os},S.getOSName=function(R){var k=this.getOS().name;return R?String(k).toLowerCase()||"":k||""},S.getOSVersion=function(){return this.getOS().version},S.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},S.getPlatformType=function(R){R===void 0&&(R=!1);var k=this.getPlatform().type;return R?String(k).toLowerCase()||"":k||""},S.parsePlatform=function(){var R=this;this.parsedResult.platform={};var k=p.default.find(f.default,function(C){if(typeof C.test=="function")return C.test(R);if(C.test instanceof Array)return C.test.some(function(x){return R.test(x)});throw new Error("Browser's test function is not valid")});return k&&(this.parsedResult.platform=k.describe(this.getUA())),this.parsedResult.platform},S.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},S.getEngineName=function(R){return R?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},S.parseEngine=function(){var R=this;this.parsedResult.engine={};var k=p.default.find(g.default,function(C){if(typeof C.test=="function")return C.test(R);if(C.test instanceof Array)return C.test.some(function(x){return R.test(x)});throw new Error("Browser's test function is not valid")});return k&&(this.parsedResult.engine=k.describe(this.getUA())),this.parsedResult.engine},S.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},S.getResult=function(){return p.default.assign({},this.parsedResult)},S.satisfies=function(R){var k=this,C={},x=0,P={},D=0;if(Object.keys(R).forEach(function(I){var N=R[I];typeof N=="string"?(P[I]=N,D+=1):typeof N=="object"&&(C[I]=N,x+=1)}),x>0){var b=Object.keys(C),w=p.default.find(b,function(I){return k.isOS(I)});if(w){var v=this.satisfies(C[w]);if(v!==void 0)return v}var _=p.default.find(b,function(I){return k.isPlatform(I)});if(_){var y=this.satisfies(C[_]);if(y!==void 0)return y}}if(D>0){var T=Object.keys(P),L=p.default.find(T,function(I){return k.isBrowser(I,!0)});if(L!==void 0)return this.compareVersion(P[L])}},S.isBrowser=function(R,k){k===void 0&&(k=!1);var C=this.getBrowserName().toLowerCase(),x=R.toLowerCase(),P=p.default.getBrowserTypeByAlias(x);return k&&P&&(x=P.toLowerCase()),x===C},S.compareVersion=function(R){var k=[0],C=R,x=!1,P=this.getBrowserVersion();if(typeof P=="string")return R[0]===">"||R[0]==="<"?(C=R.substr(1),R[1]==="="?(x=!0,C=R.substr(2)):k=[],R[0]===">"?k.push(1):k.push(-1)):R[0]==="="?C=R.substr(1):R[0]==="~"&&(x=!0,C=R.substr(1)),k.indexOf(p.default.compareVersions(P,C,x))>-1},S.isOS=function(R){return this.getOSName(!0)===String(R).toLowerCase()},S.isPlatform=function(R){return this.getPlatformType(!0)===String(R).toLowerCase()},S.isEngine=function(R){return this.getEngineName(!0)===String(R).toLowerCase()},S.is=function(R,k){return k===void 0&&(k=!1),this.isBrowser(R,k)||this.isOS(R)||this.isPlatform(R)},S.some=function(R){var k=this;return R===void 0&&(R=[]),R.some(function(C){return k.is(C)})},E}();o.default=m,c.exports=o.default},92:function(c,o,l){o.__esModule=!0,o.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},f=/version\/(\d+(\.?_?\d+)+)/i,g=[{test:[/googlebot/i],describe:function(p){var d={name:"Googlebot"},m=h.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,p)||h.default.getFirstMatch(f,p);return m&&(d.version=m),d}},{test:[/opera/i],describe:function(p){var d={name:"Opera"},m=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/opr\/|opios/i],describe:function(p){var d={name:"Opera"},m=h.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,p)||h.default.getFirstMatch(f,p);return m&&(d.version=m),d}},{test:[/SamsungBrowser/i],describe:function(p){var d={name:"Samsung Internet for Android"},m=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/Whale/i],describe:function(p){var d={name:"NAVER Whale Browser"},m=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/MZBrowser/i],describe:function(p){var d={name:"MZ Browser"},m=h.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,p)||h.default.getFirstMatch(f,p);return m&&(d.version=m),d}},{test:[/focus/i],describe:function(p){var d={name:"Focus"},m=h.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,p)||h.default.getFirstMatch(f,p);return m&&(d.version=m),d}},{test:[/swing/i],describe:function(p){var d={name:"Swing"},m=h.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,p)||h.default.getFirstMatch(f,p);return m&&(d.version=m),d}},{test:[/coast/i],describe:function(p){var d={name:"Opera Coast"},m=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(p){var d={name:"Opera Touch"},m=h.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return m&&(d.version=m),d}},{test:[/yabrowser/i],describe:function(p){var d={name:"Yandex Browser"},m=h.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return m&&(d.version=m),d}},{test:[/ucbrowser/i],describe:function(p){var d={name:"UC Browser"},m=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/Maxthon|mxios/i],describe:function(p){var d={name:"Maxthon"},m=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/epiphany/i],describe:function(p){var d={name:"Epiphany"},m=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/puffin/i],describe:function(p){var d={name:"Puffin"},m=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/sleipnir/i],describe:function(p){var d={name:"Sleipnir"},m=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/k-meleon/i],describe:function(p){var d={name:"K-Meleon"},m=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/micromessenger/i],describe:function(p){var d={name:"WeChat"},m=h.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return m&&(d.version=m),d}},{test:[/qqbrowser/i],describe:function(p){var d={name:/qqbrowserlite/i.test(p)?"QQ Browser Lite":"QQ Browser"},m=h.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return m&&(d.version=m),d}},{test:[/msie|trident/i],describe:function(p){var d={name:"Internet Explorer"},m=h.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/\sedg\//i],describe:function(p){var d={name:"Microsoft Edge"},m=h.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/edg([ea]|ios)/i],describe:function(p){var d={name:"Microsoft Edge"},m=h.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/vivaldi/i],describe:function(p){var d={name:"Vivaldi"},m=h.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/seamonkey/i],describe:function(p){var d={name:"SeaMonkey"},m=h.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/sailfish/i],describe:function(p){var d={name:"Sailfish"},m=h.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,p);return m&&(d.version=m),d}},{test:[/silk/i],describe:function(p){var d={name:"Amazon Silk"},m=h.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/phantom/i],describe:function(p){var d={name:"PhantomJS"},m=h.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/slimerjs/i],describe:function(p){var d={name:"SlimerJS"},m=h.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(p){var d={name:"BlackBerry"},m=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/(web|hpw)[o0]s/i],describe:function(p){var d={name:"WebOS Browser"},m=h.default.getFirstMatch(f,p)||h.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/bada/i],describe:function(p){var d={name:"Bada"},m=h.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/tizen/i],describe:function(p){var d={name:"Tizen"},m=h.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return m&&(d.version=m),d}},{test:[/qupzilla/i],describe:function(p){var d={name:"QupZilla"},m=h.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return m&&(d.version=m),d}},{test:[/firefox|iceweasel|fxios/i],describe:function(p){var d={name:"Firefox"},m=h.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/electron/i],describe:function(p){var d={name:"Electron"},m=h.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/MiuiBrowser/i],describe:function(p){var d={name:"Miui"},m=h.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/chromium/i],describe:function(p){var d={name:"Chromium"},m=h.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,p)||h.default.getFirstMatch(f,p);return m&&(d.version=m),d}},{test:[/chrome|crios|crmo/i],describe:function(p){var d={name:"Chrome"},m=h.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/GSA/i],describe:function(p){var d={name:"Google Search"},m=h.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:function(p){var d=!p.test(/like android/i),m=p.test(/android/i);return d&&m},describe:function(p){var d={name:"Android Browser"},m=h.default.getFirstMatch(f,p);return m&&(d.version=m),d}},{test:[/playstation 4/i],describe:function(p){var d={name:"PlayStation 4"},m=h.default.getFirstMatch(f,p);return m&&(d.version=m),d}},{test:[/safari|applewebkit/i],describe:function(p){var d={name:"Safari"},m=h.default.getFirstMatch(f,p);return m&&(d.version=m),d}},{test:[/.*/i],describe:function(p){var d=p.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:h.default.getFirstMatch(d,p),version:h.default.getSecondMatch(d,p)}}}];o.default=g,c.exports=o.default},93:function(c,o,l){o.__esModule=!0,o.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},f=l(18),g=[{test:[/Roku\/DVP/],describe:function(p){var d=h.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,p);return{name:f.OS_MAP.Roku,version:d}}},{test:[/windows phone/i],describe:function(p){var d=h.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,p);return{name:f.OS_MAP.WindowsPhone,version:d}}},{test:[/windows /i],describe:function(p){var d=h.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,p),m=h.default.getWindowsVersionName(d);return{name:f.OS_MAP.Windows,version:d,versionName:m}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(p){var d={name:f.OS_MAP.iOS},m=h.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,p);return m&&(d.version=m),d}},{test:[/macintosh/i],describe:function(p){var d=h.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,p).replace(/[_\s]/g,"."),m=h.default.getMacOSVersionName(d),E={name:f.OS_MAP.MacOS,version:d};return m&&(E.versionName=m),E}},{test:[/(ipod|iphone|ipad)/i],describe:function(p){var d=h.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,p).replace(/[_\s]/g,".");return{name:f.OS_MAP.iOS,version:d}}},{test:function(p){var d=!p.test(/like android/i),m=p.test(/android/i);return d&&m},describe:function(p){var d=h.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,p),m=h.default.getAndroidVersionName(d),E={name:f.OS_MAP.Android,version:d};return m&&(E.versionName=m),E}},{test:[/(web|hpw)[o0]s/i],describe:function(p){var d=h.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,p),m={name:f.OS_MAP.WebOS};return d&&d.length&&(m.version=d),m}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(p){var d=h.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,p)||h.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,p)||h.default.getFirstMatch(/\bbb(\d+)/i,p);return{name:f.OS_MAP.BlackBerry,version:d}}},{test:[/bada/i],describe:function(p){var d=h.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,p);return{name:f.OS_MAP.Bada,version:d}}},{test:[/tizen/i],describe:function(p){var d=h.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,p);return{name:f.OS_MAP.Tizen,version:d}}},{test:[/linux/i],describe:function(){return{name:f.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:f.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(p){var d=h.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,p);return{name:f.OS_MAP.PlayStation4,version:d}}}];o.default=g,c.exports=o.default},94:function(c,o,l){o.__esModule=!0,o.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},f=l(18),g=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(p){var d=h.default.getFirstMatch(/(can-l01)/i,p)&&"Nova",m={type:f.PLATFORMS_MAP.mobile,vendor:"Huawei"};return d&&(m.model=d),m}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:f.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:f.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:f.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:f.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:f.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:f.PLATFORMS_MAP.tablet}}},{test:function(p){var d=p.test(/ipod|iphone/i),m=p.test(/like (ipod|iphone)/i);return d&&!m},describe:function(p){var d=h.default.getFirstMatch(/(ipod|iphone)/i,p);return{type:f.PLATFORMS_MAP.mobile,vendor:"Apple",model:d}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:f.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:f.PLATFORMS_MAP.mobile}}},{test:function(p){return p.getBrowserName(!0)==="blackberry"},describe:function(){return{type:f.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(p){return p.getBrowserName(!0)==="bada"},describe:function(){return{type:f.PLATFORMS_MAP.mobile}}},{test:function(p){return p.getBrowserName()==="windows phone"},describe:function(){return{type:f.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(p){var d=Number(String(p.getOSVersion()).split(".")[0]);return p.getOSName(!0)==="android"&&d>=3},describe:function(){return{type:f.PLATFORMS_MAP.tablet}}},{test:function(p){return p.getOSName(!0)==="android"},describe:function(){return{type:f.PLATFORMS_MAP.mobile}}},{test:function(p){return p.getOSName(!0)==="macos"},describe:function(){return{type:f.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(p){return p.getOSName(!0)==="windows"},describe:function(){return{type:f.PLATFORMS_MAP.desktop}}},{test:function(p){return p.getOSName(!0)==="linux"},describe:function(){return{type:f.PLATFORMS_MAP.desktop}}},{test:function(p){return p.getOSName(!0)==="playstation 4"},describe:function(){return{type:f.PLATFORMS_MAP.tv}}},{test:function(p){return p.getOSName(!0)==="roku"},describe:function(){return{type:f.PLATFORMS_MAP.tv}}}];o.default=g,c.exports=o.default},95:function(c,o,l){o.__esModule=!0,o.default=void 0;var u,h=(u=l(17))&&u.__esModule?u:{default:u},f=l(18),g=[{test:function(p){return p.getBrowserName(!0)==="microsoft edge"},describe:function(p){if(/\sedg\//i.test(p))return{name:f.ENGINE_MAP.Blink};var d=h.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,p);return{name:f.ENGINE_MAP.EdgeHTML,version:d}}},{test:[/trident/i],describe:function(p){var d={name:f.ENGINE_MAP.Trident},m=h.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:function(p){return p.test(/presto/i)},describe:function(p){var d={name:f.ENGINE_MAP.Presto},m=h.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:function(p){var d=p.test(/gecko/i),m=p.test(/like gecko/i);return d&&!m},describe:function(p){var d={name:f.ENGINE_MAP.Gecko},m=h.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:f.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(p){var d={name:f.ENGINE_MAP.WebKit},m=h.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,p);return m&&(d.version=m),d}}];o.default=g,c.exports=o.default}})},955:function(a,c,o){var l;a.exports=(l=o(9021),o(754),o(4636),o(9506),o(7165),function(){var u=l,h=u.lib.BlockCipher,f=u.algo,g=[],p=[],d=[],m=[],E=[],S=[],R=[],k=[],C=[],x=[];(function(){for(var b=[],w=0;w<256;w++)b[w]=w<128?w<<1:w<<1^283;var v=0,_=0;for(w=0;w<256;w++){var y=_^_<<1^_<<2^_<<3^_<<4;y=y>>>8^255&y^99,g[v]=y,p[y]=v;var T=b[v],L=b[T],I=b[L],N=257*b[y]^16843008*y;d[v]=N<<24|N>>>8,m[v]=N<<16|N>>>16,E[v]=N<<8|N>>>24,S[v]=N,N=16843009*I^65537*L^257*T^16843008*v,R[y]=N<<24|N>>>8,k[y]=N<<16|N>>>16,C[y]=N<<8|N>>>24,x[y]=N,v?(v=T^b[b[b[I^T]]],_^=b[b[_]]):v=_=1}})();var P=[0,1,2,4,8,16,32,64,128,27,54],D=f.AES=h.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var b=this._keyPriorReset=this._key,w=b.words,v=b.sigBytes/4,_=4*((this._nRounds=v+6)+1),y=this._keySchedule=[],T=0;T<_;T++)T<v?y[T]=w[T]:(N=y[T-1],T%v?v>6&&T%v==4&&(N=g[N>>>24]<<24|g[N>>>16&255]<<16|g[N>>>8&255]<<8|g[255&N]):(N=g[(N=N<<8|N>>>24)>>>24]<<24|g[N>>>16&255]<<16|g[N>>>8&255]<<8|g[255&N],N^=P[T/v|0]<<24),y[T]=y[T-v]^N);for(var L=this._invKeySchedule=[],I=0;I<_;I++){if(T=_-I,I%4)var N=y[T];else N=y[T-4];L[I]=I<4||T<=4?N:R[g[N>>>24]]^k[g[N>>>16&255]]^C[g[N>>>8&255]]^x[g[255&N]]}}},encryptBlock:function(b,w){this._doCryptBlock(b,w,this._keySchedule,d,m,E,S,g)},decryptBlock:function(b,w){var v=b[w+1];b[w+1]=b[w+3],b[w+3]=v,this._doCryptBlock(b,w,this._invKeySchedule,R,k,C,x,p),v=b[w+1],b[w+1]=b[w+3],b[w+3]=v},_doCryptBlock:function(b,w,v,_,y,T,L,I){for(var N=this._nRounds,M=b[w]^v[0],U=b[w+1]^v[1],j=b[w+2]^v[2],Q=b[w+3]^v[3],Y=4,he=1;he<N;he++){var re=_[M>>>24]^y[U>>>16&255]^T[j>>>8&255]^L[255&Q]^v[Y++],pe=_[U>>>24]^y[j>>>16&255]^T[Q>>>8&255]^L[255&M]^v[Y++],fe=_[j>>>24]^y[Q>>>16&255]^T[M>>>8&255]^L[255&U]^v[Y++],ue=_[Q>>>24]^y[M>>>16&255]^T[U>>>8&255]^L[255&j]^v[Y++];M=re,U=pe,j=fe,Q=ue}re=(I[M>>>24]<<24|I[U>>>16&255]<<16|I[j>>>8&255]<<8|I[255&Q])^v[Y++],pe=(I[U>>>24]<<24|I[j>>>16&255]<<16|I[Q>>>8&255]<<8|I[255&M])^v[Y++],fe=(I[j>>>24]<<24|I[Q>>>16&255]<<16|I[M>>>8&255]<<8|I[255&U])^v[Y++],ue=(I[Q>>>24]<<24|I[M>>>16&255]<<16|I[U>>>8&255]<<8|I[255&j])^v[Y++],b[w]=re,b[w+1]=pe,b[w+2]=fe,b[w+3]=ue},keySize:8});u.AES=h._createHelper(D)}(),l.AES)},3128:function(a,c,o){var l;a.exports=(l=o(9021),o(754),o(4636),o(9506),o(7165),function(){var u=l,h=u.lib.BlockCipher,f=u.algo;const g=16,p=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],d=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var m={pbox:[],sbox:[]};function E(x,P){let D=P>>24&255,b=P>>16&255,w=P>>8&255,v=255&P,_=x.sbox[0][D]+x.sbox[1][b];return _^=x.sbox[2][w],_+=x.sbox[3][v],_}function S(x,P,D){let b,w=P,v=D;for(let _=0;_<g;++_)w^=x.pbox[_],v=E(x,w)^v,b=w,w=v,v=b;return b=w,w=v,v=b,v^=x.pbox[g],w^=x.pbox[g+1],{left:w,right:v}}function R(x,P,D){let b,w=P,v=D;for(let _=g+1;_>1;--_)w^=x.pbox[_],v=E(x,w)^v,b=w,w=v,v=b;return b=w,w=v,v=b,v^=x.pbox[1],w^=x.pbox[0],{left:w,right:v}}function k(x,P,D){for(let y=0;y<4;y++){x.sbox[y]=[];for(let T=0;T<256;T++)x.sbox[y][T]=d[y][T]}let b=0;for(let y=0;y<g+2;y++)x.pbox[y]=p[y]^P[b],b++,b>=D&&(b=0);let w=0,v=0,_=0;for(let y=0;y<g+2;y+=2)_=S(x,w,v),w=_.left,v=_.right,x.pbox[y]=w,x.pbox[y+1]=v;for(let y=0;y<4;y++)for(let T=0;T<256;T+=2)_=S(x,w,v),w=_.left,v=_.right,x.sbox[y][T]=w,x.sbox[y][T+1]=v;return!0}var C=f.Blowfish=h.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var x=this._keyPriorReset=this._key,P=x.words,D=x.sigBytes/4;k(m,P,D)}},encryptBlock:function(x,P){var D=S(m,x[P],x[P+1]);x[P]=D.left,x[P+1]=D.right},decryptBlock:function(x,P){var D=R(m,x[P],x[P+1]);x[P]=D.left,x[P+1]=D.right},blockSize:2,keySize:4,ivSize:2});u.Blowfish=h._createHelper(C)}(),l.Blowfish)},7165:function(a,c,o){var l;a.exports=(l=o(9021),o(9506),void(l.lib.Cipher||function(u){var h=l,f=h.lib,g=f.Base,p=f.WordArray,d=f.BufferedBlockAlgorithm,m=h.enc,E=(m.Utf8,m.Base64),S=h.algo.EvpKDF,R=f.Cipher=d.extend({cfg:g.extend(),createEncryptor:function(y,T){return this.create(this._ENC_XFORM_MODE,y,T)},createDecryptor:function(y,T){return this.create(this._DEC_XFORM_MODE,y,T)},init:function(y,T,L){this.cfg=this.cfg.extend(L),this._xformMode=y,this._key=T,this.reset()},reset:function(){d.reset.call(this),this._doReset()},process:function(y){return this._append(y),this._process()},finalize:function(y){return y&&this._append(y),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function y(T){return typeof T=="string"?_:w}return function(T){return{encrypt:function(L,I,N){return y(I).encrypt(T,L,I,N)},decrypt:function(L,I,N){return y(I).decrypt(T,L,I,N)}}}}()}),k=(f.StreamCipher=R.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),h.mode={}),C=f.BlockCipherMode=g.extend({createEncryptor:function(y,T){return this.Encryptor.create(y,T)},createDecryptor:function(y,T){return this.Decryptor.create(y,T)},init:function(y,T){this._cipher=y,this._iv=T}}),x=k.CBC=function(){var y=C.extend();function T(L,I,N){var M,U=this._iv;U?(M=U,this._iv=u):M=this._prevBlock;for(var j=0;j<N;j++)L[I+j]^=M[j]}return y.Encryptor=y.extend({processBlock:function(L,I){var N=this._cipher,M=N.blockSize;T.call(this,L,I,M),N.encryptBlock(L,I),this._prevBlock=L.slice(I,I+M)}}),y.Decryptor=y.extend({processBlock:function(L,I){var N=this._cipher,M=N.blockSize,U=L.slice(I,I+M);N.decryptBlock(L,I),T.call(this,L,I,M),this._prevBlock=U}}),y}(),P=(h.pad={}).Pkcs7={pad:function(y,T){for(var L=4*T,I=L-y.sigBytes%L,N=I<<24|I<<16|I<<8|I,M=[],U=0;U<I;U+=4)M.push(N);var j=p.create(M,I);y.concat(j)},unpad:function(y){var T=255&y.words[y.sigBytes-1>>>2];y.sigBytes-=T}},D=(f.BlockCipher=R.extend({cfg:R.cfg.extend({mode:x,padding:P}),reset:function(){var y;R.reset.call(this);var T=this.cfg,L=T.iv,I=T.mode;this._xformMode==this._ENC_XFORM_MODE?y=I.createEncryptor:(y=I.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==y?this._mode.init(this,L&&L.words):(this._mode=y.call(I,this,L&&L.words),this._mode.__creator=y)},_doProcessBlock:function(y,T){this._mode.processBlock(y,T)},_doFinalize:function(){var y,T=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(T.pad(this._data,this.blockSize),y=this._process(!0)):(y=this._process(!0),T.unpad(y)),y},blockSize:4}),f.CipherParams=g.extend({init:function(y){this.mixIn(y)},toString:function(y){return(y||this.formatter).stringify(this)}})),b=(h.format={}).OpenSSL={stringify:function(y){var T=y.ciphertext,L=y.salt;return(L?p.create([1398893684,1701076831]).concat(L).concat(T):T).toString(E)},parse:function(y){var T,L=E.parse(y),I=L.words;return I[0]==1398893684&&I[1]==1701076831&&(T=p.create(I.slice(2,4)),I.splice(0,4),L.sigBytes-=16),D.create({ciphertext:L,salt:T})}},w=f.SerializableCipher=g.extend({cfg:g.extend({format:b}),encrypt:function(y,T,L,I){I=this.cfg.extend(I);var N=y.createEncryptor(L,I),M=N.finalize(T),U=N.cfg;return D.create({ciphertext:M,key:L,iv:U.iv,algorithm:y,mode:U.mode,padding:U.padding,blockSize:y.blockSize,formatter:I.format})},decrypt:function(y,T,L,I){return I=this.cfg.extend(I),T=this._parse(T,I.format),y.createDecryptor(L,I).finalize(T.ciphertext)},_parse:function(y,T){return typeof y=="string"?T.parse(y,this):y}}),v=(h.kdf={}).OpenSSL={execute:function(y,T,L,I,N){if(I||(I=p.random(8)),N)M=S.create({keySize:T+L,hasher:N}).compute(y,I);else var M=S.create({keySize:T+L}).compute(y,I);var U=p.create(M.words.slice(T),4*L);return M.sigBytes=4*T,D.create({key:M,iv:U,salt:I})}},_=f.PasswordBasedCipher=w.extend({cfg:w.cfg.extend({kdf:v}),encrypt:function(y,T,L,I){var N=(I=this.cfg.extend(I)).kdf.execute(L,y.keySize,y.ivSize,I.salt,I.hasher);I.iv=N.iv;var M=w.encrypt.call(this,y,T,N.key,I);return M.mixIn(N),M},decrypt:function(y,T,L,I){I=this.cfg.extend(I),T=this._parse(T,I.format);var N=I.kdf.execute(L,y.keySize,y.ivSize,T.salt,I.hasher);return I.iv=N.iv,w.decrypt.call(this,y,T,N.key,I)}})}()))},9021:function(a,c,o){var l;a.exports=(l=l||function(u,h){var f;if(typeof window<"u"&&window.crypto&&(f=window.crypto),typeof self<"u"&&self.crypto&&(f=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(f=globalThis.crypto),!f&&typeof window<"u"&&window.msCrypto&&(f=window.msCrypto),!f&&o.g!==void 0&&o.g.crypto&&(f=o.g.crypto),!f)try{f=o(477)}catch{}var g=function(){if(f){if(typeof f.getRandomValues=="function")try{return f.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof f.randomBytes=="function")try{return f.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},p=Object.create||function(){function b(){}return function(w){var v;return b.prototype=w,v=new b,b.prototype=null,v}}(),d={},m=d.lib={},E=m.Base={extend:function(b){var w=p(this);return b&&w.mixIn(b),w.hasOwnProperty("init")&&this.init!==w.init||(w.init=function(){w.$super.init.apply(this,arguments)}),w.init.prototype=w,w.$super=this,w},create:function(){var b=this.extend();return b.init.apply(b,arguments),b},init:function(){},mixIn:function(b){for(var w in b)b.hasOwnProperty(w)&&(this[w]=b[w]);b.hasOwnProperty("toString")&&(this.toString=b.toString)},clone:function(){return this.init.prototype.extend(this)}},S=m.WordArray=E.extend({init:function(b,w){b=this.words=b||[],this.sigBytes=w!=h?w:4*b.length},toString:function(b){return(b||k).stringify(this)},concat:function(b){var w=this.words,v=b.words,_=this.sigBytes,y=b.sigBytes;if(this.clamp(),_%4)for(var T=0;T<y;T++){var L=v[T>>>2]>>>24-T%4*8&255;w[_+T>>>2]|=L<<24-(_+T)%4*8}else for(var I=0;I<y;I+=4)w[_+I>>>2]=v[I>>>2];return this.sigBytes+=y,this},clamp:function(){var b=this.words,w=this.sigBytes;b[w>>>2]&=4294967295<<32-w%4*8,b.length=u.ceil(w/4)},clone:function(){var b=E.clone.call(this);return b.words=this.words.slice(0),b},random:function(b){for(var w=[],v=0;v<b;v+=4)w.push(g());return new S.init(w,b)}}),R=d.enc={},k=R.Hex={stringify:function(b){for(var w=b.words,v=b.sigBytes,_=[],y=0;y<v;y++){var T=w[y>>>2]>>>24-y%4*8&255;_.push((T>>>4).toString(16)),_.push((15&T).toString(16))}return _.join("")},parse:function(b){for(var w=b.length,v=[],_=0;_<w;_+=2)v[_>>>3]|=parseInt(b.substr(_,2),16)<<24-_%8*4;return new S.init(v,w/2)}},C=R.Latin1={stringify:function(b){for(var w=b.words,v=b.sigBytes,_=[],y=0;y<v;y++){var T=w[y>>>2]>>>24-y%4*8&255;_.push(String.fromCharCode(T))}return _.join("")},parse:function(b){for(var w=b.length,v=[],_=0;_<w;_++)v[_>>>2]|=(255&b.charCodeAt(_))<<24-_%4*8;return new S.init(v,w)}},x=R.Utf8={stringify:function(b){try{return decodeURIComponent(escape(C.stringify(b)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(b){return C.parse(unescape(encodeURIComponent(b)))}},P=m.BufferedBlockAlgorithm=E.extend({reset:function(){this._data=new S.init,this._nDataBytes=0},_append:function(b){typeof b=="string"&&(b=x.parse(b)),this._data.concat(b),this._nDataBytes+=b.sigBytes},_process:function(b){var w,v=this._data,_=v.words,y=v.sigBytes,T=this.blockSize,L=y/(4*T),I=(L=b?u.ceil(L):u.max((0|L)-this._minBufferSize,0))*T,N=u.min(4*I,y);if(I){for(var M=0;M<I;M+=T)this._doProcessBlock(_,M);w=_.splice(0,I),v.sigBytes-=N}return new S.init(w,N)},clone:function(){var b=E.clone.call(this);return b._data=this._data.clone(),b},_minBufferSize:0}),D=(m.Hasher=P.extend({cfg:E.extend(),init:function(b){this.cfg=this.cfg.extend(b),this.reset()},reset:function(){P.reset.call(this),this._doReset()},update:function(b){return this._append(b),this._process(),this},finalize:function(b){return b&&this._append(b),this._doFinalize()},blockSize:16,_createHelper:function(b){return function(w,v){return new b.init(v).finalize(w)}},_createHmacHelper:function(b){return function(w,v){return new D.HMAC.init(b,v).finalize(w)}}}),d.algo={});return d}(Math),l)},754:function(a,c,o){var l;a.exports=(l=o(9021),function(){var u=l,h=u.lib.WordArray;function f(g,p,d){for(var m=[],E=0,S=0;S<p;S++)if(S%4){var R=d[g.charCodeAt(S-1)]<<S%4*2|d[g.charCodeAt(S)]>>>6-S%4*2;m[E>>>2]|=R<<24-E%4*8,E++}return h.create(m,E)}u.enc.Base64={stringify:function(g){var p=g.words,d=g.sigBytes,m=this._map;g.clamp();for(var E=[],S=0;S<d;S+=3)for(var R=(p[S>>>2]>>>24-S%4*8&255)<<16|(p[S+1>>>2]>>>24-(S+1)%4*8&255)<<8|p[S+2>>>2]>>>24-(S+2)%4*8&255,k=0;k<4&&S+.75*k<d;k++)E.push(m.charAt(R>>>6*(3-k)&63));var C=m.charAt(64);if(C)for(;E.length%4;)E.push(C);return E.join("")},parse:function(g){var p=g.length,d=this._map,m=this._reverseMap;if(!m){m=this._reverseMap=[];for(var E=0;E<d.length;E++)m[d.charCodeAt(E)]=E}var S=d.charAt(64);if(S){var R=g.indexOf(S);R!==-1&&(p=R)}return f(g,p,m)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),l.enc.Base64)},4725:function(a,c,o){var l;a.exports=(l=o(9021),function(){var u=l,h=u.lib.WordArray;function f(g,p,d){for(var m=[],E=0,S=0;S<p;S++)if(S%4){var R=d[g.charCodeAt(S-1)]<<S%4*2|d[g.charCodeAt(S)]>>>6-S%4*2;m[E>>>2]|=R<<24-E%4*8,E++}return h.create(m,E)}u.enc.Base64url={stringify:function(g,p){p===void 0&&(p=!0);var d=g.words,m=g.sigBytes,E=p?this._safe_map:this._map;g.clamp();for(var S=[],R=0;R<m;R+=3)for(var k=(d[R>>>2]>>>24-R%4*8&255)<<16|(d[R+1>>>2]>>>24-(R+1)%4*8&255)<<8|d[R+2>>>2]>>>24-(R+2)%4*8&255,C=0;C<4&&R+.75*C<m;C++)S.push(E.charAt(k>>>6*(3-C)&63));var x=E.charAt(64);if(x)for(;S.length%4;)S.push(x);return S.join("")},parse:function(g,p){p===void 0&&(p=!0);var d=g.length,m=p?this._safe_map:this._map,E=this._reverseMap;if(!E){E=this._reverseMap=[];for(var S=0;S<m.length;S++)E[m.charCodeAt(S)]=S}var R=m.charAt(64);if(R){var k=g.indexOf(R);k!==-1&&(d=k)}return f(g,d,E)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"}}(),l.enc.Base64url)},5503:function(a,c,o){var l;a.exports=(l=o(9021),function(){var u=l,h=u.lib.WordArray,f=u.enc;function g(p){return p<<8&4278255360|p>>>8&16711935}f.Utf16=f.Utf16BE={stringify:function(p){for(var d=p.words,m=p.sigBytes,E=[],S=0;S<m;S+=2){var R=d[S>>>2]>>>16-S%4*8&65535;E.push(String.fromCharCode(R))}return E.join("")},parse:function(p){for(var d=p.length,m=[],E=0;E<d;E++)m[E>>>1]|=p.charCodeAt(E)<<16-E%2*16;return h.create(m,2*d)}},f.Utf16LE={stringify:function(p){for(var d=p.words,m=p.sigBytes,E=[],S=0;S<m;S+=2){var R=g(d[S>>>2]>>>16-S%4*8&65535);E.push(String.fromCharCode(R))}return E.join("")},parse:function(p){for(var d=p.length,m=[],E=0;E<d;E++)m[E>>>1]|=g(p.charCodeAt(E)<<16-E%2*16);return h.create(m,2*d)}}}(),l.enc.Utf16)},9506:function(a,c,o){var l,u,h,f,g,p,d,m;a.exports=(m=o(9021),o(5471),o(1025),u=(l=m).lib,h=u.Base,f=u.WordArray,g=l.algo,p=g.MD5,d=g.EvpKDF=h.extend({cfg:h.extend({keySize:4,hasher:p,iterations:1}),init:function(E){this.cfg=this.cfg.extend(E)},compute:function(E,S){for(var R,k=this.cfg,C=k.hasher.create(),x=f.create(),P=x.words,D=k.keySize,b=k.iterations;P.length<D;){R&&C.update(R),R=C.update(E).finalize(S),C.reset();for(var w=1;w<b;w++)R=C.finalize(R),C.reset();x.concat(R)}return x.sigBytes=4*D,x}}),l.EvpKDF=function(E,S,R){return d.create(R).compute(E,S)},m.EvpKDF)},25:function(a,c,o){var l,u,h,f;a.exports=(f=o(9021),o(7165),u=(l=f).lib.CipherParams,h=l.enc.Hex,l.format.Hex={stringify:function(g){return g.ciphertext.toString(h)},parse:function(g){var p=h.parse(g);return u.create({ciphertext:p})}},f.format.Hex)},1025:function(a,c,o){var l,u,h,f;a.exports=(l=o(9021),h=(u=l).lib.Base,f=u.enc.Utf8,void(u.algo.HMAC=h.extend({init:function(g,p){g=this._hasher=new g.init,typeof p=="string"&&(p=f.parse(p));var d=g.blockSize,m=4*d;p.sigBytes>m&&(p=g.finalize(p)),p.clamp();for(var E=this._oKey=p.clone(),S=this._iKey=p.clone(),R=E.words,k=S.words,C=0;C<d;C++)R[C]^=1549556828,k[C]^=909522486;E.sigBytes=S.sigBytes=m,this.reset()},reset:function(){var g=this._hasher;g.reset(),g.update(this._iKey)},update:function(g){return this._hasher.update(g),this},finalize:function(g){var p=this._hasher,d=p.finalize(g);return p.reset(),p.finalize(this._oKey.clone().concat(d))}})))},1396:function(a,c,o){var l;a.exports=(l=o(9021),o(3240),o(6440),o(5503),o(754),o(4725),o(4636),o(5471),o(3009),o(6308),o(1380),o(9557),o(5953),o(8056),o(1025),o(19),o(9506),o(7165),o(2169),o(6939),o(6372),o(3797),o(8454),o(2073),o(4905),o(482),o(2155),o(8124),o(25),o(955),o(7628),o(7193),o(6298),o(2696),o(3128),l)},6440:function(a,c,o){var l;a.exports=(l=o(9021),function(){if(typeof ArrayBuffer=="function"){var u=l.lib.WordArray,h=u.init,f=u.init=function(g){if(g instanceof ArrayBuffer&&(g=new Uint8Array(g)),(g instanceof Int8Array||typeof Uint8ClampedArray<"u"&&g instanceof Uint8ClampedArray||g instanceof Int16Array||g instanceof Uint16Array||g instanceof Int32Array||g instanceof Uint32Array||g instanceof Float32Array||g instanceof Float64Array)&&(g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength)),g instanceof Uint8Array){for(var p=g.byteLength,d=[],m=0;m<p;m++)d[m>>>2]|=g[m]<<24-m%4*8;h.call(this,d,p)}else h.apply(this,arguments)};f.prototype=u}}(),l.lib.WordArray)},4636:function(a,c,o){var l;a.exports=(l=o(9021),function(u){var h=l,f=h.lib,g=f.WordArray,p=f.Hasher,d=h.algo,m=[];(function(){for(var x=0;x<64;x++)m[x]=4294967296*u.abs(u.sin(x+1))|0})();var E=d.MD5=p.extend({_doReset:function(){this._hash=new g.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(x,P){for(var D=0;D<16;D++){var b=P+D,w=x[b];x[b]=16711935&(w<<8|w>>>24)|4278255360&(w<<24|w>>>8)}var v=this._hash.words,_=x[P+0],y=x[P+1],T=x[P+2],L=x[P+3],I=x[P+4],N=x[P+5],M=x[P+6],U=x[P+7],j=x[P+8],Q=x[P+9],Y=x[P+10],he=x[P+11],re=x[P+12],pe=x[P+13],fe=x[P+14],ue=x[P+15],ee=v[0],Z=v[1],le=v[2],ye=v[3];ee=S(ee,Z,le,ye,_,7,m[0]),ye=S(ye,ee,Z,le,y,12,m[1]),le=S(le,ye,ee,Z,T,17,m[2]),Z=S(Z,le,ye,ee,L,22,m[3]),ee=S(ee,Z,le,ye,I,7,m[4]),ye=S(ye,ee,Z,le,N,12,m[5]),le=S(le,ye,ee,Z,M,17,m[6]),Z=S(Z,le,ye,ee,U,22,m[7]),ee=S(ee,Z,le,ye,j,7,m[8]),ye=S(ye,ee,Z,le,Q,12,m[9]),le=S(le,ye,ee,Z,Y,17,m[10]),Z=S(Z,le,ye,ee,he,22,m[11]),ee=S(ee,Z,le,ye,re,7,m[12]),ye=S(ye,ee,Z,le,pe,12,m[13]),le=S(le,ye,ee,Z,fe,17,m[14]),ee=R(ee,Z=S(Z,le,ye,ee,ue,22,m[15]),le,ye,y,5,m[16]),ye=R(ye,ee,Z,le,M,9,m[17]),le=R(le,ye,ee,Z,he,14,m[18]),Z=R(Z,le,ye,ee,_,20,m[19]),ee=R(ee,Z,le,ye,N,5,m[20]),ye=R(ye,ee,Z,le,Y,9,m[21]),le=R(le,ye,ee,Z,ue,14,m[22]),Z=R(Z,le,ye,ee,I,20,m[23]),ee=R(ee,Z,le,ye,Q,5,m[24]),ye=R(ye,ee,Z,le,fe,9,m[25]),le=R(le,ye,ee,Z,L,14,m[26]),Z=R(Z,le,ye,ee,j,20,m[27]),ee=R(ee,Z,le,ye,pe,5,m[28]),ye=R(ye,ee,Z,le,T,9,m[29]),le=R(le,ye,ee,Z,U,14,m[30]),ee=k(ee,Z=R(Z,le,ye,ee,re,20,m[31]),le,ye,N,4,m[32]),ye=k(ye,ee,Z,le,j,11,m[33]),le=k(le,ye,ee,Z,he,16,m[34]),Z=k(Z,le,ye,ee,fe,23,m[35]),ee=k(ee,Z,le,ye,y,4,m[36]),ye=k(ye,ee,Z,le,I,11,m[37]),le=k(le,ye,ee,Z,U,16,m[38]),Z=k(Z,le,ye,ee,Y,23,m[39]),ee=k(ee,Z,le,ye,pe,4,m[40]),ye=k(ye,ee,Z,le,_,11,m[41]),le=k(le,ye,ee,Z,L,16,m[42]),Z=k(Z,le,ye,ee,M,23,m[43]),ee=k(ee,Z,le,ye,Q,4,m[44]),ye=k(ye,ee,Z,le,re,11,m[45]),le=k(le,ye,ee,Z,ue,16,m[46]),ee=C(ee,Z=k(Z,le,ye,ee,T,23,m[47]),le,ye,_,6,m[48]),ye=C(ye,ee,Z,le,U,10,m[49]),le=C(le,ye,ee,Z,fe,15,m[50]),Z=C(Z,le,ye,ee,N,21,m[51]),ee=C(ee,Z,le,ye,re,6,m[52]),ye=C(ye,ee,Z,le,L,10,m[53]),le=C(le,ye,ee,Z,Y,15,m[54]),Z=C(Z,le,ye,ee,y,21,m[55]),ee=C(ee,Z,le,ye,j,6,m[56]),ye=C(ye,ee,Z,le,ue,10,m[57]),le=C(le,ye,ee,Z,M,15,m[58]),Z=C(Z,le,ye,ee,pe,21,m[59]),ee=C(ee,Z,le,ye,I,6,m[60]),ye=C(ye,ee,Z,le,he,10,m[61]),le=C(le,ye,ee,Z,T,15,m[62]),Z=C(Z,le,ye,ee,Q,21,m[63]),v[0]=v[0]+ee|0,v[1]=v[1]+Z|0,v[2]=v[2]+le|0,v[3]=v[3]+ye|0},_doFinalize:function(){var x=this._data,P=x.words,D=8*this._nDataBytes,b=8*x.sigBytes;P[b>>>5]|=128<<24-b%32;var w=u.floor(D/4294967296),v=D;P[15+(b+64>>>9<<4)]=16711935&(w<<8|w>>>24)|4278255360&(w<<24|w>>>8),P[14+(b+64>>>9<<4)]=16711935&(v<<8|v>>>24)|4278255360&(v<<24|v>>>8),x.sigBytes=4*(P.length+1),this._process();for(var _=this._hash,y=_.words,T=0;T<4;T++){var L=y[T];y[T]=16711935&(L<<8|L>>>24)|4278255360&(L<<24|L>>>8)}return _},clone:function(){var x=p.clone.call(this);return x._hash=this._hash.clone(),x}});function S(x,P,D,b,w,v,_){var y=x+(P&D|~P&b)+w+_;return(y<<v|y>>>32-v)+P}function R(x,P,D,b,w,v,_){var y=x+(P&b|D&~b)+w+_;return(y<<v|y>>>32-v)+P}function k(x,P,D,b,w,v,_){var y=x+(P^D^b)+w+_;return(y<<v|y>>>32-v)+P}function C(x,P,D,b,w,v,_){var y=x+(D^(P|~b))+w+_;return(y<<v|y>>>32-v)+P}h.MD5=p._createHelper(E),h.HmacMD5=p._createHmacHelper(E)}(Math),l.MD5)},2169:function(a,c,o){var l;a.exports=(l=o(9021),o(7165),l.mode.CFB=function(){var u=l.lib.BlockCipherMode.extend();function h(f,g,p,d){var m,E=this._iv;E?(m=E.slice(0),this._iv=void 0):m=this._prevBlock,d.encryptBlock(m,0);for(var S=0;S<p;S++)f[g+S]^=m[S]}return u.Encryptor=u.extend({processBlock:function(f,g){var p=this._cipher,d=p.blockSize;h.call(this,f,g,d,p),this._prevBlock=f.slice(g,g+d)}}),u.Decryptor=u.extend({processBlock:function(f,g){var p=this._cipher,d=p.blockSize,m=f.slice(g,g+d);h.call(this,f,g,d,p),this._prevBlock=m}}),u}(),l.mode.CFB)},6372:function(a,c,o){var l;a.exports=(l=o(9021),o(7165),l.mode.CTRGladman=function(){var u=l.lib.BlockCipherMode.extend();function h(p){if(255&~(p>>24))p+=16777216;else{var d=p>>16&255,m=p>>8&255,E=255&p;d===255?(d=0,m===255?(m=0,E===255?E=0:++E):++m):++d,p=0,p+=d<<16,p+=m<<8,p+=E}return p}function f(p){return(p[0]=h(p[0]))===0&&(p[1]=h(p[1])),p}var g=u.Encryptor=u.extend({processBlock:function(p,d){var m=this._cipher,E=m.blockSize,S=this._iv,R=this._counter;S&&(R=this._counter=S.slice(0),this._iv=void 0),f(R);var k=R.slice(0);m.encryptBlock(k,0);for(var C=0;C<E;C++)p[d+C]^=k[C]}});return u.Decryptor=g,u}(),l.mode.CTRGladman)},6939:function(a,c,o){var l,u,h;a.exports=(h=o(9021),o(7165),h.mode.CTR=(l=h.lib.BlockCipherMode.extend(),u=l.Encryptor=l.extend({processBlock:function(f,g){var p=this._cipher,d=p.blockSize,m=this._iv,E=this._counter;m&&(E=this._counter=m.slice(0),this._iv=void 0);var S=E.slice(0);p.encryptBlock(S,0),E[d-1]=E[d-1]+1|0;for(var R=0;R<d;R++)f[g+R]^=S[R]}}),l.Decryptor=u,l),h.mode.CTR)},8454:function(a,c,o){var l,u;a.exports=(u=o(9021),o(7165),u.mode.ECB=((l=u.lib.BlockCipherMode.extend()).Encryptor=l.extend({processBlock:function(h,f){this._cipher.encryptBlock(h,f)}}),l.Decryptor=l.extend({processBlock:function(h,f){this._cipher.decryptBlock(h,f)}}),l),u.mode.ECB)},3797:function(a,c,o){var l,u,h;a.exports=(h=o(9021),o(7165),h.mode.OFB=(l=h.lib.BlockCipherMode.extend(),u=l.Encryptor=l.extend({processBlock:function(f,g){var p=this._cipher,d=p.blockSize,m=this._iv,E=this._keystream;m&&(E=this._keystream=m.slice(0),this._iv=void 0),p.encryptBlock(E,0);for(var S=0;S<d;S++)f[g+S]^=E[S]}}),l.Decryptor=u,l),h.mode.OFB)},2073:function(a,c,o){var l;a.exports=(l=o(9021),o(7165),l.pad.AnsiX923={pad:function(u,h){var f=u.sigBytes,g=4*h,p=g-f%g,d=f+p-1;u.clamp(),u.words[d>>>2]|=p<<24-d%4*8,u.sigBytes+=p},unpad:function(u){var h=255&u.words[u.sigBytes-1>>>2];u.sigBytes-=h}},l.pad.Ansix923)},4905:function(a,c,o){var l;a.exports=(l=o(9021),o(7165),l.pad.Iso10126={pad:function(u,h){var f=4*h,g=f-u.sigBytes%f;u.concat(l.lib.WordArray.random(g-1)).concat(l.lib.WordArray.create([g<<24],1))},unpad:function(u){var h=255&u.words[u.sigBytes-1>>>2];u.sigBytes-=h}},l.pad.Iso10126)},482:function(a,c,o){var l;a.exports=(l=o(9021),o(7165),l.pad.Iso97971={pad:function(u,h){u.concat(l.lib.WordArray.create([2147483648],1)),l.pad.ZeroPadding.pad(u,h)},unpad:function(u){l.pad.ZeroPadding.unpad(u),u.sigBytes--}},l.pad.Iso97971)},8124:function(a,c,o){var l;a.exports=(l=o(9021),o(7165),l.pad.NoPadding={pad:function(){},unpad:function(){}},l.pad.NoPadding)},2155:function(a,c,o){var l;a.exports=(l=o(9021),o(7165),l.pad.ZeroPadding={pad:function(u,h){var f=4*h;u.clamp(),u.sigBytes+=f-(u.sigBytes%f||f)},unpad:function(u){var h=u.words,f=u.sigBytes-1;for(f=u.sigBytes-1;f>=0;f--)if(h[f>>>2]>>>24-f%4*8&255){u.sigBytes=f+1;break}}},l.pad.ZeroPadding)},19:function(a,c,o){var l,u,h,f,g,p,d,m,E;a.exports=(E=o(9021),o(3009),o(1025),u=(l=E).lib,h=u.Base,f=u.WordArray,g=l.algo,p=g.SHA256,d=g.HMAC,m=g.PBKDF2=h.extend({cfg:h.extend({keySize:4,hasher:p,iterations:25e4}),init:function(S){this.cfg=this.cfg.extend(S)},compute:function(S,R){for(var k=this.cfg,C=d.create(k.hasher,S),x=f.create(),P=f.create([1]),D=x.words,b=P.words,w=k.keySize,v=k.iterations;D.length<w;){var _=C.update(R).finalize(P);C.reset();for(var y=_.words,T=y.length,L=_,I=1;I<v;I++){L=C.finalize(L),C.reset();for(var N=L.words,M=0;M<T;M++)y[M]^=N[M]}x.concat(_),b[0]++}return x.sigBytes=4*w,x}}),l.PBKDF2=function(S,R,k){return m.create(k).compute(S,R)},E.PBKDF2)},2696:function(a,c,o){var l;a.exports=(l=o(9021),o(754),o(4636),o(9506),o(7165),function(){var u=l,h=u.lib.StreamCipher,f=u.algo,g=[],p=[],d=[],m=f.RabbitLegacy=h.extend({_doReset:function(){var S=this._key.words,R=this.cfg.iv,k=this._X=[S[0],S[3]<<16|S[2]>>>16,S[1],S[0]<<16|S[3]>>>16,S[2],S[1]<<16|S[0]>>>16,S[3],S[2]<<16|S[1]>>>16],C=this._C=[S[2]<<16|S[2]>>>16,4294901760&S[0]|65535&S[1],S[3]<<16|S[3]>>>16,4294901760&S[1]|65535&S[2],S[0]<<16|S[0]>>>16,4294901760&S[2]|65535&S[3],S[1]<<16|S[1]>>>16,4294901760&S[3]|65535&S[0]];this._b=0;for(var x=0;x<4;x++)E.call(this);for(x=0;x<8;x++)C[x]^=k[x+4&7];if(R){var P=R.words,D=P[0],b=P[1],w=16711935&(D<<8|D>>>24)|4278255360&(D<<24|D>>>8),v=16711935&(b<<8|b>>>24)|4278255360&(b<<24|b>>>8),_=w>>>16|4294901760&v,y=v<<16|65535&w;for(C[0]^=w,C[1]^=_,C[2]^=v,C[3]^=y,C[4]^=w,C[5]^=_,C[6]^=v,C[7]^=y,x=0;x<4;x++)E.call(this)}},_doProcessBlock:function(S,R){var k=this._X;E.call(this),g[0]=k[0]^k[5]>>>16^k[3]<<16,g[1]=k[2]^k[7]>>>16^k[5]<<16,g[2]=k[4]^k[1]>>>16^k[7]<<16,g[3]=k[6]^k[3]>>>16^k[1]<<16;for(var C=0;C<4;C++)g[C]=16711935&(g[C]<<8|g[C]>>>24)|4278255360&(g[C]<<24|g[C]>>>8),S[R+C]^=g[C]},blockSize:4,ivSize:2});function E(){for(var S=this._X,R=this._C,k=0;k<8;k++)p[k]=R[k];for(R[0]=R[0]+1295307597+this._b|0,R[1]=R[1]+3545052371+(R[0]>>>0<p[0]>>>0?1:0)|0,R[2]=R[2]+886263092+(R[1]>>>0<p[1]>>>0?1:0)|0,R[3]=R[3]+1295307597+(R[2]>>>0<p[2]>>>0?1:0)|0,R[4]=R[4]+3545052371+(R[3]>>>0<p[3]>>>0?1:0)|0,R[5]=R[5]+886263092+(R[4]>>>0<p[4]>>>0?1:0)|0,R[6]=R[6]+1295307597+(R[5]>>>0<p[5]>>>0?1:0)|0,R[7]=R[7]+3545052371+(R[6]>>>0<p[6]>>>0?1:0)|0,this._b=R[7]>>>0<p[7]>>>0?1:0,k=0;k<8;k++){var C=S[k]+R[k],x=65535&C,P=C>>>16,D=((x*x>>>17)+x*P>>>15)+P*P,b=((4294901760&C)*C|0)+((65535&C)*C|0);d[k]=D^b}S[0]=d[0]+(d[7]<<16|d[7]>>>16)+(d[6]<<16|d[6]>>>16)|0,S[1]=d[1]+(d[0]<<8|d[0]>>>24)+d[7]|0,S[2]=d[2]+(d[1]<<16|d[1]>>>16)+(d[0]<<16|d[0]>>>16)|0,S[3]=d[3]+(d[2]<<8|d[2]>>>24)+d[1]|0,S[4]=d[4]+(d[3]<<16|d[3]>>>16)+(d[2]<<16|d[2]>>>16)|0,S[5]=d[5]+(d[4]<<8|d[4]>>>24)+d[3]|0,S[6]=d[6]+(d[5]<<16|d[5]>>>16)+(d[4]<<16|d[4]>>>16)|0,S[7]=d[7]+(d[6]<<8|d[6]>>>24)+d[5]|0}u.RabbitLegacy=h._createHelper(m)}(),l.RabbitLegacy)},6298:function(a,c,o){var l;a.exports=(l=o(9021),o(754),o(4636),o(9506),o(7165),function(){var u=l,h=u.lib.StreamCipher,f=u.algo,g=[],p=[],d=[],m=f.Rabbit=h.extend({_doReset:function(){for(var S=this._key.words,R=this.cfg.iv,k=0;k<4;k++)S[k]=16711935&(S[k]<<8|S[k]>>>24)|4278255360&(S[k]<<24|S[k]>>>8);var C=this._X=[S[0],S[3]<<16|S[2]>>>16,S[1],S[0]<<16|S[3]>>>16,S[2],S[1]<<16|S[0]>>>16,S[3],S[2]<<16|S[1]>>>16],x=this._C=[S[2]<<16|S[2]>>>16,4294901760&S[0]|65535&S[1],S[3]<<16|S[3]>>>16,4294901760&S[1]|65535&S[2],S[0]<<16|S[0]>>>16,4294901760&S[2]|65535&S[3],S[1]<<16|S[1]>>>16,4294901760&S[3]|65535&S[0]];for(this._b=0,k=0;k<4;k++)E.call(this);for(k=0;k<8;k++)x[k]^=C[k+4&7];if(R){var P=R.words,D=P[0],b=P[1],w=16711935&(D<<8|D>>>24)|4278255360&(D<<24|D>>>8),v=16711935&(b<<8|b>>>24)|4278255360&(b<<24|b>>>8),_=w>>>16|4294901760&v,y=v<<16|65535&w;for(x[0]^=w,x[1]^=_,x[2]^=v,x[3]^=y,x[4]^=w,x[5]^=_,x[6]^=v,x[7]^=y,k=0;k<4;k++)E.call(this)}},_doProcessBlock:function(S,R){var k=this._X;E.call(this),g[0]=k[0]^k[5]>>>16^k[3]<<16,g[1]=k[2]^k[7]>>>16^k[5]<<16,g[2]=k[4]^k[1]>>>16^k[7]<<16,g[3]=k[6]^k[3]>>>16^k[1]<<16;for(var C=0;C<4;C++)g[C]=16711935&(g[C]<<8|g[C]>>>24)|4278255360&(g[C]<<24|g[C]>>>8),S[R+C]^=g[C]},blockSize:4,ivSize:2});function E(){for(var S=this._X,R=this._C,k=0;k<8;k++)p[k]=R[k];for(R[0]=R[0]+1295307597+this._b|0,R[1]=R[1]+3545052371+(R[0]>>>0<p[0]>>>0?1:0)|0,R[2]=R[2]+886263092+(R[1]>>>0<p[1]>>>0?1:0)|0,R[3]=R[3]+1295307597+(R[2]>>>0<p[2]>>>0?1:0)|0,R[4]=R[4]+3545052371+(R[3]>>>0<p[3]>>>0?1:0)|0,R[5]=R[5]+886263092+(R[4]>>>0<p[4]>>>0?1:0)|0,R[6]=R[6]+1295307597+(R[5]>>>0<p[5]>>>0?1:0)|0,R[7]=R[7]+3545052371+(R[6]>>>0<p[6]>>>0?1:0)|0,this._b=R[7]>>>0<p[7]>>>0?1:0,k=0;k<8;k++){var C=S[k]+R[k],x=65535&C,P=C>>>16,D=((x*x>>>17)+x*P>>>15)+P*P,b=((4294901760&C)*C|0)+((65535&C)*C|0);d[k]=D^b}S[0]=d[0]+(d[7]<<16|d[7]>>>16)+(d[6]<<16|d[6]>>>16)|0,S[1]=d[1]+(d[0]<<8|d[0]>>>24)+d[7]|0,S[2]=d[2]+(d[1]<<16|d[1]>>>16)+(d[0]<<16|d[0]>>>16)|0,S[3]=d[3]+(d[2]<<8|d[2]>>>24)+d[1]|0,S[4]=d[4]+(d[3]<<16|d[3]>>>16)+(d[2]<<16|d[2]>>>16)|0,S[5]=d[5]+(d[4]<<8|d[4]>>>24)+d[3]|0,S[6]=d[6]+(d[5]<<16|d[5]>>>16)+(d[4]<<16|d[4]>>>16)|0,S[7]=d[7]+(d[6]<<8|d[6]>>>24)+d[5]|0}u.Rabbit=h._createHelper(m)}(),l.Rabbit)},7193:function(a,c,o){var l;a.exports=(l=o(9021),o(754),o(4636),o(9506),o(7165),function(){var u=l,h=u.lib.StreamCipher,f=u.algo,g=f.RC4=h.extend({_doReset:function(){for(var m=this._key,E=m.words,S=m.sigBytes,R=this._S=[],k=0;k<256;k++)R[k]=k;k=0;for(var C=0;k<256;k++){var x=k%S,P=E[x>>>2]>>>24-x%4*8&255;C=(C+R[k]+P)%256;var D=R[k];R[k]=R[C],R[C]=D}this._i=this._j=0},_doProcessBlock:function(m,E){m[E]^=p.call(this)},keySize:8,ivSize:0});function p(){for(var m=this._S,E=this._i,S=this._j,R=0,k=0;k<4;k++){S=(S+m[E=(E+1)%256])%256;var C=m[E];m[E]=m[S],m[S]=C,R|=m[(m[E]+m[S])%256]<<24-8*k}return this._i=E,this._j=S,R}u.RC4=h._createHelper(g);var d=f.RC4Drop=g.extend({cfg:g.cfg.extend({drop:192}),_doReset:function(){g._doReset.call(this);for(var m=this.cfg.drop;m>0;m--)p.call(this)}});u.RC4Drop=h._createHelper(d)}(),l.RC4)},8056:function(a,c,o){var l;a.exports=(l=o(9021),function(u){var h=l,f=h.lib,g=f.WordArray,p=f.Hasher,d=h.algo,m=g.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),E=g.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),S=g.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),R=g.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),k=g.create([0,1518500249,1859775393,2400959708,2840853838]),C=g.create([1352829926,1548603684,1836072691,2053994217,0]),x=d.RIPEMD160=p.extend({_doReset:function(){this._hash=g.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(y,T){for(var L=0;L<16;L++){var I=T+L,N=y[I];y[I]=16711935&(N<<8|N>>>24)|4278255360&(N<<24|N>>>8)}var M,U,j,Q,Y,he,re,pe,fe,ue,ee,Z=this._hash.words,le=k.words,ye=C.words,mt=m.words,Ye=E.words,ct=S.words,ht=R.words;for(he=M=Z[0],re=U=Z[1],pe=j=Z[2],fe=Q=Z[3],ue=Y=Z[4],L=0;L<80;L+=1)ee=M+y[T+mt[L]]|0,ee+=L<16?P(U,j,Q)+le[0]:L<32?D(U,j,Q)+le[1]:L<48?b(U,j,Q)+le[2]:L<64?w(U,j,Q)+le[3]:v(U,j,Q)+le[4],ee=(ee=_(ee|=0,ct[L]))+Y|0,M=Y,Y=Q,Q=_(j,10),j=U,U=ee,ee=he+y[T+Ye[L]]|0,ee+=L<16?v(re,pe,fe)+ye[0]:L<32?w(re,pe,fe)+ye[1]:L<48?b(re,pe,fe)+ye[2]:L<64?D(re,pe,fe)+ye[3]:P(re,pe,fe)+ye[4],ee=(ee=_(ee|=0,ht[L]))+ue|0,he=ue,ue=fe,fe=_(pe,10),pe=re,re=ee;ee=Z[1]+j+fe|0,Z[1]=Z[2]+Q+ue|0,Z[2]=Z[3]+Y+he|0,Z[3]=Z[4]+M+re|0,Z[4]=Z[0]+U+pe|0,Z[0]=ee},_doFinalize:function(){var y=this._data,T=y.words,L=8*this._nDataBytes,I=8*y.sigBytes;T[I>>>5]|=128<<24-I%32,T[14+(I+64>>>9<<4)]=16711935&(L<<8|L>>>24)|4278255360&(L<<24|L>>>8),y.sigBytes=4*(T.length+1),this._process();for(var N=this._hash,M=N.words,U=0;U<5;U++){var j=M[U];M[U]=16711935&(j<<8|j>>>24)|4278255360&(j<<24|j>>>8)}return N},clone:function(){var y=p.clone.call(this);return y._hash=this._hash.clone(),y}});function P(y,T,L){return y^T^L}function D(y,T,L){return y&T|~y&L}function b(y,T,L){return(y|~T)^L}function w(y,T,L){return y&L|T&~L}function v(y,T,L){return y^(T|~L)}function _(y,T){return y<<T|y>>>32-T}h.RIPEMD160=p._createHelper(x),h.HmacRIPEMD160=p._createHmacHelper(x)}(),l.RIPEMD160)},5471:function(a,c,o){var l,u,h,f,g,p,d,m;a.exports=(m=o(9021),u=(l=m).lib,h=u.WordArray,f=u.Hasher,g=l.algo,p=[],d=g.SHA1=f.extend({_doReset:function(){this._hash=new h.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(E,S){for(var R=this._hash.words,k=R[0],C=R[1],x=R[2],P=R[3],D=R[4],b=0;b<80;b++){if(b<16)p[b]=0|E[S+b];else{var w=p[b-3]^p[b-8]^p[b-14]^p[b-16];p[b]=w<<1|w>>>31}var v=(k<<5|k>>>27)+D+p[b];v+=b<20?1518500249+(C&x|~C&P):b<40?1859775393+(C^x^P):b<60?(C&x|C&P|x&P)-1894007588:(C^x^P)-899497514,D=P,P=x,x=C<<30|C>>>2,C=k,k=v}R[0]=R[0]+k|0,R[1]=R[1]+C|0,R[2]=R[2]+x|0,R[3]=R[3]+P|0,R[4]=R[4]+D|0},_doFinalize:function(){var E=this._data,S=E.words,R=8*this._nDataBytes,k=8*E.sigBytes;return S[k>>>5]|=128<<24-k%32,S[14+(k+64>>>9<<4)]=Math.floor(R/4294967296),S[15+(k+64>>>9<<4)]=R,E.sigBytes=4*S.length,this._process(),this._hash},clone:function(){var E=f.clone.call(this);return E._hash=this._hash.clone(),E}}),l.SHA1=f._createHelper(d),l.HmacSHA1=f._createHmacHelper(d),m.SHA1)},6308:function(a,c,o){var l,u,h,f,g,p;a.exports=(p=o(9021),o(3009),u=(l=p).lib.WordArray,h=l.algo,f=h.SHA256,g=h.SHA224=f.extend({_doReset:function(){this._hash=new u.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var d=f._doFinalize.call(this);return d.sigBytes-=4,d}}),l.SHA224=f._createHelper(g),l.HmacSHA224=f._createHmacHelper(g),p.SHA224)},3009:function(a,c,o){var l;a.exports=(l=o(9021),function(u){var h=l,f=h.lib,g=f.WordArray,p=f.Hasher,d=h.algo,m=[],E=[];(function(){function k(D){for(var b=u.sqrt(D),w=2;w<=b;w++)if(!(D%w))return!1;return!0}function C(D){return 4294967296*(D-(0|D))|0}for(var x=2,P=0;P<64;)k(x)&&(P<8&&(m[P]=C(u.pow(x,.5))),E[P]=C(u.pow(x,.3333333333333333)),P++),x++})();var S=[],R=d.SHA256=p.extend({_doReset:function(){this._hash=new g.init(m.slice(0))},_doProcessBlock:function(k,C){for(var x=this._hash.words,P=x[0],D=x[1],b=x[2],w=x[3],v=x[4],_=x[5],y=x[6],T=x[7],L=0;L<64;L++){if(L<16)S[L]=0|k[C+L];else{var I=S[L-15],N=(I<<25|I>>>7)^(I<<14|I>>>18)^I>>>3,M=S[L-2],U=(M<<15|M>>>17)^(M<<13|M>>>19)^M>>>10;S[L]=N+S[L-7]+U+S[L-16]}var j=P&D^P&b^D&b,Q=(P<<30|P>>>2)^(P<<19|P>>>13)^(P<<10|P>>>22),Y=T+((v<<26|v>>>6)^(v<<21|v>>>11)^(v<<7|v>>>25))+(v&_^~v&y)+E[L]+S[L];T=y,y=_,_=v,v=w+Y|0,w=b,b=D,D=P,P=Y+(Q+j)|0}x[0]=x[0]+P|0,x[1]=x[1]+D|0,x[2]=x[2]+b|0,x[3]=x[3]+w|0,x[4]=x[4]+v|0,x[5]=x[5]+_|0,x[6]=x[6]+y|0,x[7]=x[7]+T|0},_doFinalize:function(){var k=this._data,C=k.words,x=8*this._nDataBytes,P=8*k.sigBytes;return C[P>>>5]|=128<<24-P%32,C[14+(P+64>>>9<<4)]=u.floor(x/4294967296),C[15+(P+64>>>9<<4)]=x,k.sigBytes=4*C.length,this._process(),this._hash},clone:function(){var k=p.clone.call(this);return k._hash=this._hash.clone(),k}});h.SHA256=p._createHelper(R),h.HmacSHA256=p._createHmacHelper(R)}(Math),l.SHA256)},5953:function(a,c,o){var l;a.exports=(l=o(9021),o(3240),function(u){var h=l,f=h.lib,g=f.WordArray,p=f.Hasher,d=h.x64.Word,m=h.algo,E=[],S=[],R=[];(function(){for(var x=1,P=0,D=0;D<24;D++){E[x+5*P]=(D+1)*(D+2)/2%64;var b=(2*x+3*P)%5;x=P%5,P=b}for(x=0;x<5;x++)for(P=0;P<5;P++)S[x+5*P]=P+(2*x+3*P)%5*5;for(var w=1,v=0;v<24;v++){for(var _=0,y=0,T=0;T<7;T++){if(1&w){var L=(1<<T)-1;L<32?y^=1<<L:_^=1<<L-32}128&w?w=w<<1^113:w<<=1}R[v]=d.create(_,y)}})();var k=[];(function(){for(var x=0;x<25;x++)k[x]=d.create()})();var C=m.SHA3=p.extend({cfg:p.cfg.extend({outputLength:512}),_doReset:function(){for(var x=this._state=[],P=0;P<25;P++)x[P]=new d.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(x,P){for(var D=this._state,b=this.blockSize/2,w=0;w<b;w++){var v=x[P+2*w],_=x[P+2*w+1];v=16711935&(v<<8|v>>>24)|4278255360&(v<<24|v>>>8),_=16711935&(_<<8|_>>>24)|4278255360&(_<<24|_>>>8),(le=D[w]).high^=_,le.low^=v}for(var y=0;y<24;y++){for(var T=0;T<5;T++){for(var L=0,I=0,N=0;N<5;N++)L^=(le=D[T+5*N]).high,I^=le.low;var M=k[T];M.high=L,M.low=I}for(T=0;T<5;T++){var U=k[(T+4)%5],j=k[(T+1)%5],Q=j.high,Y=j.low;for(L=U.high^(Q<<1|Y>>>31),I=U.low^(Y<<1|Q>>>31),N=0;N<5;N++)(le=D[T+5*N]).high^=L,le.low^=I}for(var he=1;he<25;he++){var re=(le=D[he]).high,pe=le.low,fe=E[he];fe<32?(L=re<<fe|pe>>>32-fe,I=pe<<fe|re>>>32-fe):(L=pe<<fe-32|re>>>64-fe,I=re<<fe-32|pe>>>64-fe);var ue=k[S[he]];ue.high=L,ue.low=I}var ee=k[0],Z=D[0];for(ee.high=Z.high,ee.low=Z.low,T=0;T<5;T++)for(N=0;N<5;N++){var le=D[he=T+5*N],ye=k[he],mt=k[(T+1)%5+5*N],Ye=k[(T+2)%5+5*N];le.high=ye.high^~mt.high&Ye.high,le.low=ye.low^~mt.low&Ye.low}le=D[0];var ct=R[y];le.high^=ct.high,le.low^=ct.low}},_doFinalize:function(){var x=this._data,P=x.words,D=(this._nDataBytes,8*x.sigBytes),b=32*this.blockSize;P[D>>>5]|=1<<24-D%32,P[(u.ceil((D+1)/b)*b>>>5)-1]|=128,x.sigBytes=4*P.length,this._process();for(var w=this._state,v=this.cfg.outputLength/8,_=v/8,y=[],T=0;T<_;T++){var L=w[T],I=L.high,N=L.low;I=16711935&(I<<8|I>>>24)|4278255360&(I<<24|I>>>8),N=16711935&(N<<8|N>>>24)|4278255360&(N<<24|N>>>8),y.push(N),y.push(I)}return new g.init(y,v)},clone:function(){for(var x=p.clone.call(this),P=x._state=this._state.slice(0),D=0;D<25;D++)P[D]=P[D].clone();return x}});h.SHA3=p._createHelper(C),h.HmacSHA3=p._createHmacHelper(C)}(Math),l.SHA3)},9557:function(a,c,o){var l,u,h,f,g,p,d,m;a.exports=(m=o(9021),o(3240),o(1380),u=(l=m).x64,h=u.Word,f=u.WordArray,g=l.algo,p=g.SHA512,d=g.SHA384=p.extend({_doReset:function(){this._hash=new f.init([new h.init(3418070365,3238371032),new h.init(1654270250,914150663),new h.init(2438529370,812702999),new h.init(355462360,4144912697),new h.init(1731405415,4290775857),new h.init(2394180231,1750603025),new h.init(3675008525,1694076839),new h.init(1203062813,3204075428)])},_doFinalize:function(){var E=p._doFinalize.call(this);return E.sigBytes-=16,E}}),l.SHA384=p._createHelper(d),l.HmacSHA384=p._createHmacHelper(d),m.SHA384)},1380:function(a,c,o){var l;a.exports=(l=o(9021),o(3240),function(){var u=l,h=u.lib.Hasher,f=u.x64,g=f.Word,p=f.WordArray,d=u.algo;function m(){return g.create.apply(g,arguments)}var E=[m(1116352408,3609767458),m(1899447441,602891725),m(3049323471,3964484399),m(3921009573,2173295548),m(961987163,4081628472),m(1508970993,3053834265),m(2453635748,2937671579),m(2870763221,3664609560),m(3624381080,2734883394),m(310598401,1164996542),m(607225278,1323610764),m(1426881987,3590304994),m(1925078388,4068182383),m(2162078206,991336113),m(2614888103,633803317),m(3248222580,3479774868),m(3835390401,2666613458),m(4022224774,944711139),m(264347078,2341262773),m(604807628,2007800933),m(770255983,1495990901),m(1249150122,1856431235),m(1555081692,3175218132),m(1996064986,2198950837),m(2554220882,3999719339),m(2821834349,766784016),m(2952996808,2566594879),m(3210313671,3203337956),m(3336571891,1034457026),m(3584528711,2466948901),m(113926993,3758326383),m(338241895,168717936),m(666307205,1188179964),m(773529912,1546045734),m(1294757372,1522805485),m(1396182291,2643833823),m(1695183700,2343527390),m(1986661051,1014477480),m(2177026350,1206759142),m(2456956037,344077627),m(2730485921,1290863460),m(2820302411,3158454273),m(3259730800,3505952657),m(3345764771,106217008),m(3516065817,3606008344),m(3600352804,1432725776),m(4094571909,1467031594),m(275423344,851169720),m(430227734,3100823752),m(506948616,1363258195),m(659060556,3750685593),m(883997877,3785050280),m(958139571,3318307427),m(1322822218,3812723403),m(1537002063,2003034995),m(1747873779,3602036899),m(1955562222,1575990012),m(2024104815,1125592928),m(2227730452,2716904306),m(2361852424,442776044),m(2428436474,593698344),m(2756734187,3733110249),m(3204031479,2999351573),m(3329325298,3815920427),m(3391569614,3928383900),m(3515267271,566280711),m(3940187606,3454069534),m(4118630271,4000239992),m(116418474,1914138554),m(174292421,2731055270),m(289380356,3203993006),m(460393269,320620315),m(685471733,587496836),m(852142971,1086792851),m(1017036298,365543100),m(1126000580,2618297676),m(1288033470,3409855158),m(1501505948,4234509866),m(1607167915,987167468),m(1816402316,1246189591)],S=[];(function(){for(var k=0;k<80;k++)S[k]=m()})();var R=d.SHA512=h.extend({_doReset:function(){this._hash=new p.init([new g.init(1779033703,4089235720),new g.init(3144134277,2227873595),new g.init(1013904242,4271175723),new g.init(2773480762,1595750129),new g.init(1359893119,2917565137),new g.init(2600822924,725511199),new g.init(528734635,4215389547),new g.init(1541459225,327033209)])},_doProcessBlock:function(k,C){for(var x=this._hash.words,P=x[0],D=x[1],b=x[2],w=x[3],v=x[4],_=x[5],y=x[6],T=x[7],L=P.high,I=P.low,N=D.high,M=D.low,U=b.high,j=b.low,Q=w.high,Y=w.low,he=v.high,re=v.low,pe=_.high,fe=_.low,ue=y.high,ee=y.low,Z=T.high,le=T.low,ye=L,mt=I,Ye=N,ct=M,ht=U,kt=j,Sr=Q,wt=Y,Zt=he,vr=re,Wr=pe,br=fe,Br=ue,Jr=ee,Qt=Z,zt=le,At=0;At<80;At++){var Lr,yt,Qe=S[At];if(At<16)yt=Qe.high=0|k[C+2*At],Lr=Qe.low=0|k[C+2*At+1];else{var Et=S[At-15],Ae=Et.high,Ne=Et.low,Ze=(Ae>>>1|Ne<<31)^(Ae>>>8|Ne<<24)^Ae>>>7,Oe=(Ne>>>1|Ae<<31)^(Ne>>>8|Ae<<24)^(Ne>>>7|Ae<<25),vt=S[At-2],Mt=vt.high,ke=vt.low,lr=(Mt>>>19|ke<<13)^(Mt<<3|ke>>>29)^Mt>>>6,yr=(ke>>>19|Mt<<13)^(ke<<3|Mt>>>29)^(ke>>>6|Mt<<26),wr=S[At-7],Ur=wr.high,yn=wr.low,Ge=S[At-16],Ot=Ge.high,xt=Ge.low;yt=(yt=(yt=Ze+Ur+((Lr=Oe+yn)>>>0<Oe>>>0?1:0))+lr+((Lr+=yr)>>>0<yr>>>0?1:0))+Ot+((Lr+=xt)>>>0<xt>>>0?1:0),Qe.high=yt,Qe.low=Lr}var Ke,Zr=Zt&Wr^~Zt&Br,kr=vr&br^~vr&Jr,Or=ye&Ye^ye&ht^Ye&ht,sr=mt&ct^mt&kt^ct&kt,ar=(ye>>>28|mt<<4)^(ye<<30|mt>>>2)^(ye<<25|mt>>>7),Mr=(mt>>>28|ye<<4)^(mt<<30|ye>>>2)^(mt<<25|ye>>>7),tn=(Zt>>>14|vr<<18)^(Zt>>>18|vr<<14)^(Zt<<23|vr>>>9),_n=(vr>>>14|Zt<<18)^(vr>>>18|Zt<<14)^(vr<<23|Zt>>>9),Jn=E[At],ss=Jn.high,li=Jn.low,Zn=Qt+tn+((Ke=zt+_n)>>>0<zt>>>0?1:0),As=Mr+sr;Qt=Br,zt=Jr,Br=Wr,Jr=br,Wr=Zt,br=vr,Zt=Sr+(Zn=(Zn=(Zn=Zn+Zr+((Ke+=kr)>>>0<kr>>>0?1:0))+ss+((Ke+=li)>>>0<li>>>0?1:0))+yt+((Ke+=Lr)>>>0<Lr>>>0?1:0))+((vr=wt+Ke|0)>>>0<wt>>>0?1:0)|0,Sr=ht,wt=kt,ht=Ye,kt=ct,Ye=ye,ct=mt,ye=Zn+(ar+Or+(As>>>0<Mr>>>0?1:0))+((mt=Ke+As|0)>>>0<Ke>>>0?1:0)|0}I=P.low=I+mt,P.high=L+ye+(I>>>0<mt>>>0?1:0),M=D.low=M+ct,D.high=N+Ye+(M>>>0<ct>>>0?1:0),j=b.low=j+kt,b.high=U+ht+(j>>>0<kt>>>0?1:0),Y=w.low=Y+wt,w.high=Q+Sr+(Y>>>0<wt>>>0?1:0),re=v.low=re+vr,v.high=he+Zt+(re>>>0<vr>>>0?1:0),fe=_.low=fe+br,_.high=pe+Wr+(fe>>>0<br>>>0?1:0),ee=y.low=ee+Jr,y.high=ue+Br+(ee>>>0<Jr>>>0?1:0),le=T.low=le+zt,T.high=Z+Qt+(le>>>0<zt>>>0?1:0)},_doFinalize:function(){var k=this._data,C=k.words,x=8*this._nDataBytes,P=8*k.sigBytes;return C[P>>>5]|=128<<24-P%32,C[30+(P+128>>>10<<5)]=Math.floor(x/4294967296),C[31+(P+128>>>10<<5)]=x,k.sigBytes=4*C.length,this._process(),this._hash.toX32()},clone:function(){var k=h.clone.call(this);return k._hash=this._hash.clone(),k},blockSize:32});u.SHA512=h._createHelper(R),u.HmacSHA512=h._createHmacHelper(R)}(),l.SHA512)},7628:function(a,c,o){var l;a.exports=(l=o(9021),o(754),o(4636),o(9506),o(7165),function(){var u=l,h=u.lib,f=h.WordArray,g=h.BlockCipher,p=u.algo,d=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],m=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],E=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],S=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],R=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],k=p.DES=g.extend({_doReset:function(){for(var D=this._key.words,b=[],w=0;w<56;w++){var v=d[w]-1;b[w]=D[v>>>5]>>>31-v%32&1}for(var _=this._subKeys=[],y=0;y<16;y++){var T=_[y]=[],L=E[y];for(w=0;w<24;w++)T[w/6|0]|=b[(m[w]-1+L)%28]<<31-w%6,T[4+(w/6|0)]|=b[28+(m[w+24]-1+L)%28]<<31-w%6;for(T[0]=T[0]<<1|T[0]>>>31,w=1;w<7;w++)T[w]=T[w]>>>4*(w-1)+3;T[7]=T[7]<<5|T[7]>>>27}var I=this._invSubKeys=[];for(w=0;w<16;w++)I[w]=_[15-w]},encryptBlock:function(D,b){this._doCryptBlock(D,b,this._subKeys)},decryptBlock:function(D,b){this._doCryptBlock(D,b,this._invSubKeys)},_doCryptBlock:function(D,b,w){this._lBlock=D[b],this._rBlock=D[b+1],C.call(this,4,252645135),C.call(this,16,65535),x.call(this,2,858993459),x.call(this,8,16711935),C.call(this,1,1431655765);for(var v=0;v<16;v++){for(var _=w[v],y=this._lBlock,T=this._rBlock,L=0,I=0;I<8;I++)L|=S[I][((T^_[I])&R[I])>>>0];this._lBlock=T,this._rBlock=y^L}var N=this._lBlock;this._lBlock=this._rBlock,this._rBlock=N,C.call(this,1,1431655765),x.call(this,8,16711935),x.call(this,2,858993459),C.call(this,16,65535),C.call(this,4,252645135),D[b]=this._lBlock,D[b+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function C(D,b){var w=(this._lBlock>>>D^this._rBlock)&b;this._rBlock^=w,this._lBlock^=w<<D}function x(D,b){var w=(this._rBlock>>>D^this._lBlock)&b;this._lBlock^=w,this._rBlock^=w<<D}u.DES=g._createHelper(k);var P=p.TripleDES=g.extend({_doReset:function(){var D=this._key.words;if(D.length!==2&&D.length!==4&&D.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var b=D.slice(0,2),w=D.length<4?D.slice(0,2):D.slice(2,4),v=D.length<6?D.slice(0,2):D.slice(4,6);this._des1=k.createEncryptor(f.create(b)),this._des2=k.createEncryptor(f.create(w)),this._des3=k.createEncryptor(f.create(v))},encryptBlock:function(D,b){this._des1.encryptBlock(D,b),this._des2.decryptBlock(D,b),this._des3.encryptBlock(D,b)},decryptBlock:function(D,b){this._des3.decryptBlock(D,b),this._des2.encryptBlock(D,b),this._des1.decryptBlock(D,b)},keySize:6,ivSize:2,blockSize:2});u.TripleDES=g._createHelper(P)}(),l.TripleDES)},3240:function(a,c,o){var l;a.exports=(l=o(9021),function(u){var h=l,f=h.lib,g=f.Base,p=f.WordArray,d=h.x64={};d.Word=g.extend({init:function(m,E){this.high=m,this.low=E}}),d.WordArray=g.extend({init:function(m,E){m=this.words=m||[],this.sigBytes=E!=u?E:8*m.length},toX32:function(){for(var m=this.words,E=m.length,S=[],R=0;R<E;R++){var k=m[R];S.push(k.high),S.push(k.low)}return p.create(S,this.sigBytes)},clone:function(){for(var m=g.clone.call(this),E=m.words=this.words.slice(0),S=E.length,R=0;R<S;R++)E[R]=E[R].clone();return m}})}(),l)},7833:(a,c,o)=>{c.formatArgs=function(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+a.exports.humanize(this.diff),!this.useColors)return;const h="color: "+this.color;u.splice(1,0,h,"color: inherit");let f=0,g=0;u[0].replace(/%[a-zA-Z%]/g,p=>{p!=="%%"&&(f++,p==="%c"&&(g=f))}),u.splice(g,0,h)},c.save=function(u){try{u?c.storage.setItem("debug",u):c.storage.removeItem("debug")}catch{}},c.load=function(){let u;try{u=c.storage.getItem("debug")}catch{}return!u&&typeof process<"u"&&"env"in process&&(u=t.DEBUG),u},c.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},c.storage=function(){try{return localStorage}catch{}}(),c.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),c.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],c.log=console.debug||console.log||(()=>{}),a.exports=o(736)(c);const{formatters:l}=a.exports;l.j=function(u){try{return JSON.stringify(u)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}},736:(a,c,o)=>{a.exports=function(l){function u(g){let p,d,m,E=null;function S(...R){if(!S.enabled)return;const k=S,C=Number(new Date),x=C-(p||C);k.diff=x,k.prev=p,k.curr=C,p=C,R[0]=u.coerce(R[0]),typeof R[0]!="string"&&R.unshift("%O");let P=0;R[0]=R[0].replace(/%([a-zA-Z%])/g,(D,b)=>{if(D==="%%")return"%";P++;const w=u.formatters[b];if(typeof w=="function"){const v=R[P];D=w.call(k,v),R.splice(P,1),P--}return D}),u.formatArgs.call(k,R),(k.log||u.log).apply(k,R)}return S.namespace=g,S.useColors=u.useColors(),S.color=u.selectColor(g),S.extend=h,S.destroy=u.destroy,Object.defineProperty(S,"enabled",{enumerable:!0,configurable:!1,get:()=>E!==null?E:(d!==u.namespaces&&(d=u.namespaces,m=u.enabled(g)),m),set:R=>{E=R}}),typeof u.init=="function"&&u.init(S),S}function h(g,p){const d=u(this.namespace+(p===void 0?":":p)+g);return d.log=this.log,d}function f(g){return g.toString().substring(2,g.toString().length-2).replace(/\.\*\?$/,"*")}return u.debug=u,u.default=u,u.coerce=function(g){return g instanceof Error?g.stack||g.message:g},u.disable=function(){const g=[...u.names.map(f),...u.skips.map(f).map(p=>"-"+p)].join(",");return u.enable(""),g},u.enable=function(g){let p;u.save(g),u.namespaces=g,u.names=[],u.skips=[];const d=(typeof g=="string"?g:"").split(/[\s,]+/),m=d.length;for(p=0;p<m;p++)d[p]&&((g=d[p].replace(/\*/g,".*?"))[0]==="-"?u.skips.push(new RegExp("^"+g.slice(1)+"$")):u.names.push(new RegExp("^"+g+"$")))},u.enabled=function(g){if(g[g.length-1]==="*")return!0;let p,d;for(p=0,d=u.skips.length;p<d;p++)if(u.skips[p].test(g))return!1;for(p=0,d=u.names.length;p<d;p++)if(u.names[p].test(g))return!0;return!1},u.humanize=o(6585),u.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(l).forEach(g=>{u[g]=l[g]}),u.names=[],u.skips=[],u.formatters={},u.selectColor=function(g){let p=0;for(let d=0;d<g.length;d++)p=(p<<5)-p+g.charCodeAt(d),p|=0;return u.colors[Math.abs(p)%u.colors.length]},u.enable(u.load()),u}},4903:a=>{var c=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};a.exports=function(){if(this)return this;if(typeof globalThis=="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return c()}try{return __global__||c()}finally{delete Object.prototype.__global__}}()},7007:a=>{var c,o=typeof Reflect=="object"?Reflect:null,l=o&&typeof o.apply=="function"?o.apply:function(x,P,D){return Function.prototype.apply.call(x,P,D)};c=o&&typeof o.ownKeys=="function"?o.ownKeys:Object.getOwnPropertySymbols?function(x){return Object.getOwnPropertyNames(x).concat(Object.getOwnPropertySymbols(x))}:function(x){return Object.getOwnPropertyNames(x)};var u=Number.isNaN||function(x){return x!=x};function h(){h.init.call(this)}a.exports=h,a.exports.once=function(x,P){return new Promise(function(D,b){function w(_){x.removeListener(P,v),b(_)}function v(){typeof x.removeListener=="function"&&x.removeListener("error",w),D([].slice.call(arguments))}C(x,P,v,{once:!0}),P!=="error"&&function(_,y,T){typeof _.on=="function"&&C(_,"error",y,T)}(x,w,{once:!0})})},h.EventEmitter=h,h.prototype._events=void 0,h.prototype._eventsCount=0,h.prototype._maxListeners=void 0;var f=10;function g(x){if(typeof x!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof x)}function p(x){return x._maxListeners===void 0?h.defaultMaxListeners:x._maxListeners}function d(x,P,D,b){var w,v,_,y;if(g(D),(v=x._events)===void 0?(v=x._events=Object.create(null),x._eventsCount=0):(v.newListener!==void 0&&(x.emit("newListener",P,D.listener?D.listener:D),v=x._events),_=v[P]),_===void 0)_=v[P]=D,++x._eventsCount;else if(typeof _=="function"?_=v[P]=b?[D,_]:[_,D]:b?_.unshift(D):_.push(D),(w=p(x))>0&&_.length>w&&!_.warned){_.warned=!0;var T=new Error("Possible EventEmitter memory leak detected. "+_.length+" "+String(P)+" listeners added. Use emitter.setMaxListeners() to increase limit");T.name="MaxListenersExceededWarning",T.emitter=x,T.type=P,T.count=_.length,y=T,console&&console.warn&&console.warn(y)}return x}function m(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function E(x,P,D){var b={fired:!1,wrapFn:void 0,target:x,type:P,listener:D},w=m.bind(b);return w.listener=D,b.wrapFn=w,w}function S(x,P,D){var b=x._events;if(b===void 0)return[];var w=b[P];return w===void 0?[]:typeof w=="function"?D?[w.listener||w]:[w]:D?function(v){for(var _=new Array(v.length),y=0;y<_.length;++y)_[y]=v[y].listener||v[y];return _}(w):k(w,w.length)}function R(x){var P=this._events;if(P!==void 0){var D=P[x];if(typeof D=="function")return 1;if(D!==void 0)return D.length}return 0}function k(x,P){for(var D=new Array(P),b=0;b<P;++b)D[b]=x[b];return D}function C(x,P,D,b){if(typeof x.on=="function")b.once?x.once(P,D):x.on(P,D);else{if(typeof x.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof x);x.addEventListener(P,function w(v){b.once&&x.removeEventListener(P,w),D(v)})}}Object.defineProperty(h,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(x){if(typeof x!="number"||x<0||u(x))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+x+".");f=x}}),h.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},h.prototype.setMaxListeners=function(x){if(typeof x!="number"||x<0||u(x))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+x+".");return this._maxListeners=x,this},h.prototype.getMaxListeners=function(){return p(this)},h.prototype.emit=function(x){for(var P=[],D=1;D<arguments.length;D++)P.push(arguments[D]);var b=x==="error",w=this._events;if(w!==void 0)b=b&&w.error===void 0;else if(!b)return!1;if(b){var v;if(P.length>0&&(v=P[0]),v instanceof Error)throw v;var _=new Error("Unhandled error."+(v?" ("+v.message+")":""));throw _.context=v,_}var y=w[x];if(y===void 0)return!1;if(typeof y=="function")l(y,this,P);else{var T=y.length,L=k(y,T);for(D=0;D<T;++D)l(L[D],this,P)}return!0},h.prototype.addListener=function(x,P){return d(this,x,P,!1)},h.prototype.on=h.prototype.addListener,h.prototype.prependListener=function(x,P){return d(this,x,P,!0)},h.prototype.once=function(x,P){return g(P),this.on(x,E(this,x,P)),this},h.prototype.prependOnceListener=function(x,P){return g(P),this.prependListener(x,E(this,x,P)),this},h.prototype.removeListener=function(x,P){var D,b,w,v,_;if(g(P),(b=this._events)===void 0)return this;if((D=b[x])===void 0)return this;if(D===P||D.listener===P)--this._eventsCount==0?this._events=Object.create(null):(delete b[x],b.removeListener&&this.emit("removeListener",x,D.listener||P));else if(typeof D!="function"){for(w=-1,v=D.length-1;v>=0;v--)if(D[v]===P||D[v].listener===P){_=D[v].listener,w=v;break}if(w<0)return this;w===0?D.shift():function(y,T){for(;T+1<y.length;T++)y[T]=y[T+1];y.pop()}(D,w),D.length===1&&(b[x]=D[0]),b.removeListener!==void 0&&this.emit("removeListener",x,_||P)}return this},h.prototype.off=h.prototype.removeListener,h.prototype.removeAllListeners=function(x){var P,D,b;if((D=this._events)===void 0)return this;if(D.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):D[x]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete D[x]),this;if(arguments.length===0){var w,v=Object.keys(D);for(b=0;b<v.length;++b)(w=v[b])!=="removeListener"&&this.removeAllListeners(w);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(P=D[x])=="function")this.removeListener(x,P);else if(P!==void 0)for(b=P.length-1;b>=0;b--)this.removeListener(x,P[b]);return this},h.prototype.listeners=function(x){return S(this,x,!0)},h.prototype.rawListeners=function(x){return S(this,x,!1)},h.listenerCount=function(x,P){return typeof x.listenerCount=="function"?x.listenerCount(P):R.call(x,P)},h.prototype.listenerCount=R,h.prototype.eventNames=function(){return this._eventsCount>0?c(this._events):[]}},3582:function(a,c,o){var l=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(c,"__esModule",{value:!0}),c.Logger=void 0;const u=l(o(7833)),h="h264-profile-level-id";c.Logger=class{constructor(f){f?(this._debug=(0,u.default)(`${h}:${f}`),this._warn=(0,u.default)(`${h}:WARN:${f}`),this._error=(0,u.default)(`${h}:ERROR:${f}`)):(this._debug=(0,u.default)(h),this._warn=(0,u.default)(`${h}:WARN`),this._error=(0,u.default)(`${h}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},3200:(a,c,o)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.generateProfileLevelIdStringForAnswer=c.isSameProfile=c.parseSdpProfileLevelId=c.levelToString=c.profileToString=c.profileLevelIdToString=c.parseProfileLevelId=c.ProfileLevelId=c.Level=c.Profile=void 0;const l=new(o(3582)).Logger;var u,h;(function(x){x[x.ConstrainedBaseline=1]="ConstrainedBaseline",x[x.Baseline=2]="Baseline",x[x.Main=3]="Main",x[x.ConstrainedHigh=4]="ConstrainedHigh",x[x.High=5]="High",x[x.PredictiveHigh444=6]="PredictiveHigh444"})(u||(c.Profile=u={})),function(x){x[x.L1_b=0]="L1_b",x[x.L1=10]="L1",x[x.L1_1=11]="L1_1",x[x.L1_2=12]="L1_2",x[x.L1_3=13]="L1_3",x[x.L2=20]="L2",x[x.L2_1=21]="L2_1",x[x.L2_2=22]="L2_2",x[x.L3=30]="L3",x[x.L3_1=31]="L3_1",x[x.L3_2=32]="L3_2",x[x.L4=40]="L4",x[x.L4_1=41]="L4_1",x[x.L4_2=42]="L4_2",x[x.L5=50]="L5",x[x.L5_1=51]="L5_1",x[x.L5_2=52]="L5_2"}(h||(c.Level=h={}));class f{constructor(P,D){this.profile=P,this.level=D}}c.ProfileLevelId=f;const g=new f(u.ConstrainedBaseline,h.L3_1);class p{constructor(P){this.mask=~k("x",P),this.masked_value=k("1",P)}isMatch(P){return this.masked_value===(P&this.mask)}}class d{constructor(P,D,b){this.profile_idc=P,this.profile_iop=D,this.profile=b}}const m=[new d(66,new p("x1xx0000"),u.ConstrainedBaseline),new d(77,new p("1xxx0000"),u.ConstrainedBaseline),new d(88,new p("11xx0000"),u.ConstrainedBaseline),new d(66,new p("x0xx0000"),u.Baseline),new d(88,new p("10xx0000"),u.Baseline),new d(77,new p("0x0x0000"),u.Main),new d(100,new p("00000000"),u.High),new d(100,new p("00001100"),u.ConstrainedHigh),new d(244,new p("00000000"),u.PredictiveHigh444)];function E(x){if(typeof x!="string"||x.length!==6)return;const P=parseInt(x,16);if(P===0)return;const D=255&P,b=P>>8&255,w=P>>16&255;let v;switch(D){case h.L1_1:v=16&b?h.L1_b:h.L1_1;break;case h.L1:case h.L1_2:case h.L1_3:case h.L2:case h.L2_1:case h.L2_2:case h.L3:case h.L3_1:case h.L3_2:case h.L4:case h.L4_1:case h.L4_2:case h.L5:case h.L5_1:case h.L5_2:v=D;break;default:return void l.warn(`parseProfileLevelId() | unrecognized level_idc [str:${x}, level_idc:${D}]`)}for(const _ of m)if(w===_.profile_idc&&_.profile_iop.isMatch(b))return new f(_.profile,v);l.warn(`parseProfileLevelId() | unrecognized profile_idc/profile_iop combination [str:${x}, profile_idc:${w}, profile_iop:${b}]`)}function S(x){if(x.level==h.L1_b)switch(x.profile){case u.ConstrainedBaseline:return"42f00b";case u.Baseline:return"42100b";case u.Main:return"4d100b";default:return void l.warn(`profileLevelIdToString() | Level 1_b not is allowed for profile ${x.profile}`)}let P;switch(x.profile){case u.ConstrainedBaseline:P="42e0";break;case u.Baseline:P="4200";break;case u.Main:P="4d00";break;case u.ConstrainedHigh:P="640c";break;case u.High:P="6400";break;case u.PredictiveHigh444:P="f400";break;default:return void l.warn(`profileLevelIdToString() | unrecognized profile ${x.profile}`)}let D=x.level.toString(16);return D.length===1&&(D=`0${D}`),`${P}${D}`}function R(x={}){const P=x["profile-level-id"];return P?E(P):g}function k(x,P){return+(P[0]===x)<<7|+(P[1]===x)<<6|+(P[2]===x)<<5|+(P[3]===x)<<4|+(P[4]===x)<<3|+(P[5]===x)<<2|+(P[6]===x)<<1|+(P[7]===x)}function C(x={}){const P=x["level-asymmetry-allowed"];return P===!0||P===1||P==="1"}c.parseProfileLevelId=E,c.profileLevelIdToString=S,c.profileToString=function(x){switch(x){case u.ConstrainedBaseline:return"ConstrainedBaseline";case u.Baseline:return"Baseline";case u.Main:return"Main";case u.ConstrainedHigh:return"ConstrainedHigh";case u.High:return"High";case u.PredictiveHigh444:return"PredictiveHigh444";default:return void l.warn(`profileToString() | unrecognized profile ${x}`)}},c.levelToString=function(x){switch(x){case h.L1_b:return"1b";case h.L1:return"1";case h.L1_1:return"1.1";case h.L1_2:return"1.2";case h.L1_3:return"1.3";case h.L2:return"2";case h.L2_1:return"2.1";case h.L2_2:return"2.2";case h.L3:return"3";case h.L3_1:return"3.1";case h.L3_2:return"3.2";case h.L4:return"4";case h.L4_1:return"4.1";case h.L4_2:return"4.2";case h.L5:return"5";case h.L5_1:return"5.1";case h.L5_2:return"5.2";default:return void l.warn(`levelToString() | unrecognized level ${x}`)}},c.parseSdpProfileLevelId=R,c.isSameProfile=function(x={},P={}){const D=R(x),b=R(P);return!!(D&&b&&D.profile===b.profile)},c.generateProfileLevelIdStringForAnswer=function(x={},P={}){if(!x["profile-level-id"]&&!P["profile-level-id"])return void l.warn("generateProfileLevelIdStringForAnswer() | profile-level-id missing in local and remote params");const D=R(x),b=R(P);if(!D)throw new TypeError("invalid local_profile_level_id");if(!b)throw new TypeError("invalid remote_profile_level_id");if(D.profile!==b.profile)throw new TypeError("H264 Profile mismatch");const w=C(x)&&C(P),v=D.level,_=b.level,y=function(N,M){return N===h.L1_b?M!==h.L1&&M!==h.L1_b:M===h.L1_b?N!==h.L1:N<M}(T=v,L=_)?T:L;var T,L;const I=w?v:y;return l.debug(`generateProfileLevelIdStringForAnswer() | result [profile:${D.profile}, level:${I}]`),S(new f(D.profile,I))}},328:(a,c,o)=>{o(8624),a.exports=self.fetch.bind(self)},2215:(a,c,o)=>{var l,u;(function(h){(u=typeof(l=h)=="function"?l.call(c,o,c,a):l)===void 0||(a.exports=u),a.exports=h()})(function(){function h(){for(var g=0,p={};g<arguments.length;g++){var d=arguments[g];for(var m in d)p[m]=d[m]}return p}function f(g){return g.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function g(p){function d(){}function m(S,R,k){if(typeof document<"u"){typeof(k=h({path:"/"},d.defaults,k)).expires=="number"&&(k.expires=new Date(1*new Date+864e5*k.expires)),k.expires=k.expires?k.expires.toUTCString():"";try{var C=JSON.stringify(R);/^[\{\[]/.test(C)&&(R=C)}catch{}R=p.write?p.write(R,S):encodeURIComponent(String(R)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),S=encodeURIComponent(String(S)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var x="";for(var P in k)k[P]&&(x+="; "+P,k[P]!==!0&&(x+="="+k[P].split(";")[0]));return document.cookie=S+"="+R+x}}function E(S,R){if(typeof document<"u"){for(var k={},C=document.cookie?document.cookie.split("; "):[],x=0;x<C.length;x++){var P=C[x].split("="),D=P.slice(1).join("=");R||D.charAt(0)!=='"'||(D=D.slice(1,-1));try{var b=f(P[0]);if(D=(p.read||p)(D,b)||f(D),R)try{D=JSON.parse(D)}catch{}if(k[b]=D,S===b)break}catch{}}return S?k[S]:k}}return d.set=m,d.get=function(S){return E(S,!1)},d.getJSON=function(S){return E(S,!0)},d.remove=function(S,R){m(S,"",h(R,{expires:-1}))},d.defaults={},d.withConverter=g,d}(function(){})})},7654:(a,c,o)=>{var l="__lodash_hash_undefined__",u="[object Function]",h="[object GeneratorFunction]",f=/^\[object .+?Constructor\]$/,g=typeof o.g=="object"&&o.g&&o.g.Object===Object&&o.g,p=typeof self=="object"&&self&&self.Object===Object&&self,d=g||p||Function("return this")(),m,E=Array.prototype,S=Function.prototype,R=Object.prototype,k=d["__core-js_shared__"],C=(m=/[^.]+$/.exec(k&&k.keys&&k.keys.IE_PROTO||""))?"Symbol(src)_1."+m:"",x=S.toString,P=R.hasOwnProperty,D=R.toString,b=RegExp("^"+x.call(P).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),w=E.splice,v=U(d,"Map"),_=U(Object,"create");function y(Y){var he=-1,re=Y?Y.length:0;for(this.clear();++he<re;){var pe=Y[he];this.set(pe[0],pe[1])}}function T(Y){var he=-1,re=Y?Y.length:0;for(this.clear();++he<re;){var pe=Y[he];this.set(pe[0],pe[1])}}function L(Y){var he=-1,re=Y?Y.length:0;for(this.clear();++he<re;){var pe=Y[he];this.set(pe[0],pe[1])}}function I(Y,he){for(var re,pe,fe=Y.length;fe--;)if((re=Y[fe][0])===(pe=he)||re!=re&&pe!=pe)return fe;return-1}function N(Y){if(!Q(Y)||(he=Y,C&&C in he))return!1;var he,re=function(pe){var fe=Q(pe)?D.call(pe):"";return fe==u||fe==h}(Y)||function(pe){var fe=!1;if(pe!=null&&typeof pe.toString!="function")try{fe=!!(pe+"")}catch{}return fe}(Y)?b:f;return re.test(function(pe){if(pe!=null){try{return x.call(pe)}catch{}try{return pe+""}catch{}}return""}(Y))}function M(Y,he){var re,pe,fe=Y.__data__;return((pe=typeof(re=he))=="string"||pe=="number"||pe=="symbol"||pe=="boolean"?re!=="__proto__":re===null)?fe[typeof he=="string"?"string":"hash"]:fe.map}function U(Y,he){var re=function(pe,fe){return pe==null?void 0:pe[fe]}(Y,he);return N(re)?re:void 0}function j(Y,he){if(typeof Y!="function"||he&&typeof he!="function")throw new TypeError("Expected a function");var re=function(){var pe=arguments,fe=he?he.apply(this,pe):pe[0],ue=re.cache;if(ue.has(fe))return ue.get(fe);var ee=Y.apply(this,pe);return re.cache=ue.set(fe,ee),ee};return re.cache=new(j.Cache||L),re}function Q(Y){var he=typeof Y;return!!Y&&(he=="object"||he=="function")}y.prototype.clear=function(){this.__data__=_?_(null):{}},y.prototype.delete=function(Y){return this.has(Y)&&delete this.__data__[Y]},y.prototype.get=function(Y){var he=this.__data__;if(_){var re=he[Y];return re===l?void 0:re}return P.call(he,Y)?he[Y]:void 0},y.prototype.has=function(Y){var he=this.__data__;return _?he[Y]!==void 0:P.call(he,Y)},y.prototype.set=function(Y,he){return this.__data__[Y]=_&&he===void 0?l:he,this},T.prototype.clear=function(){this.__data__=[]},T.prototype.delete=function(Y){var he=this.__data__,re=I(he,Y);return!(re<0)&&(re==he.length-1?he.pop():w.call(he,re,1),!0)},T.prototype.get=function(Y){var he=this.__data__,re=I(he,Y);return re<0?void 0:he[re][1]},T.prototype.has=function(Y){return I(this.__data__,Y)>-1},T.prototype.set=function(Y,he){var re=this.__data__,pe=I(re,Y);return pe<0?re.push([Y,he]):re[pe][1]=he,this},L.prototype.clear=function(){this.__data__={hash:new y,map:new(v||T),string:new y}},L.prototype.delete=function(Y){return M(this,Y).delete(Y)},L.prototype.get=function(Y){return M(this,Y).get(Y)},L.prototype.has=function(Y){return M(this,Y).has(Y)},L.prototype.set=function(Y,he){return M(this,Y).set(Y,he),this},j.Cache=L,a.exports=j},3518:(a,c,o)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.Consumer=void 0;const l=o(2994),u=o(2010),h=o(4893),f=new l.Logger("Consumer");class g extends u.EnhancedEventEmitter{constructor({id:d,localId:m,producerId:E,rtpReceiver:S,track:R,rtpParameters:k,appData:C}){super(),this._closed=!1,this._observer=new u.EnhancedEventEmitter,f.debug("constructor()"),this._id=d,this._localId=m,this._producerId=E,this._rtpReceiver=S,this._track=R,this._rtpParameters=k,this._paused=!R.enabled,this._appData=C||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(d){this._appData=d}get observer(){return this._observer}close(){this._closed||(f.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(f.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new h.InvalidStateError("closed");return new Promise((d,m)=>{this.safeEmit("@getstats",d,m)})}pause(){f.debug("pause()"),this._closed?f.error("pause() | Consumer closed"):this._paused?f.debug("pause() | Consumer is already paused"):(this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause"))}resume(){f.debug("resume()"),this._closed?f.error("resume() | Consumer closed"):this._paused?(this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")):f.debug("resume() | Consumer is already resumed")}onTrackEnded(){f.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch{}}}c.Consumer=g},9166:(a,c,o)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.DataConsumer=void 0;const l=o(2994),u=o(2010),h=new l.Logger("DataConsumer");class f extends u.EnhancedEventEmitter{constructor({id:p,dataProducerId:d,dataChannel:m,sctpStreamParameters:E,appData:S}){super(),this._closed=!1,this._observer=new u.EnhancedEventEmitter,h.debug("constructor()"),this._id=p,this._dataProducerId=d,this._dataChannel=m,this._sctpStreamParameters=E,this._appData=S||{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(p){this._dataChannel.binaryType=p}get appData(){return this._appData}set appData(p){this._appData=p}get observer(){return this._observer}close(){this._closed||(h.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(h.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(h.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",p=>{if(this._closed)return;let{error:d}=p;d||(d=new Error("unknown DataChannel error")),d.errorDetail==="sctp-failure"?h.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",d.sctpCauseCode,d.message):h.error('DataChannel "error" event: %o',d),this.safeEmit("error",d)}),this._dataChannel.addEventListener("close",()=>{this._closed||(h.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",p=>{this._closed||this.safeEmit("message",p.data)})}}c.DataConsumer=f},7504:(a,c,o)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.DataProducer=void 0;const l=o(2994),u=o(2010),h=o(4893),f=new l.Logger("DataProducer");class g extends u.EnhancedEventEmitter{constructor({id:d,dataChannel:m,sctpStreamParameters:E,appData:S}){super(),this._closed=!1,this._observer=new u.EnhancedEventEmitter,f.debug("constructor()"),this._id=d,this._dataChannel=m,this._sctpStreamParameters=E,this._appData=S||{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(d){this._dataChannel.bufferedAmountLowThreshold=d}get appData(){return this._appData}set appData(d){this._appData=d}get observer(){return this._observer}close(){this._closed||(f.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(f.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(d){if(f.debug("send()"),this._closed)throw new h.InvalidStateError("closed");this._dataChannel.send(d)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(f.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",d=>{if(this._closed)return;let{error:m}=d;m||(m=new Error("unknown DataChannel error")),m.errorDetail==="sctp-failure"?f.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",m.sctpCauseCode,m.message):f.error('DataChannel "error" event: %o',m),this.safeEmit("error",m)}),this._dataChannel.addEventListener("close",()=>{this._closed||(f.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||f.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}}c.DataProducer=g},6004:function(a,c,o){var l=this&&this.__createBinding||(Object.create?function(N,M,U,j){j===void 0&&(j=U);var Q=Object.getOwnPropertyDescriptor(M,U);Q&&!("get"in Q?!M.__esModule:Q.writable||Q.configurable)||(Q={enumerable:!0,get:function(){return M[U]}}),Object.defineProperty(N,j,Q)}:function(N,M,U,j){j===void 0&&(j=U),N[j]=M[U]}),u=this&&this.__setModuleDefault||(Object.create?function(N,M){Object.defineProperty(N,"default",{enumerable:!0,value:M})}:function(N,M){N.default=M}),h=this&&this.__importStar||function(N){if(N&&N.__esModule)return N;var M={};if(N!=null)for(var U in N)U!=="default"&&Object.prototype.hasOwnProperty.call(N,U)&&l(M,N,U);return u(M,N),M};Object.defineProperty(c,"__esModule",{value:!0}),c.Device=c.detectDevice=void 0;const f=o(7232),g=o(2994),p=o(2010),d=o(4893),m=h(o(1765)),E=h(o(8046)),S=o(5601),R=o(2183),k=o(11),C=o(5535),x=o(8155),P=o(7402),D=o(2292),b=o(1767),w=o(5765),v=o(9676),_=o(8633),y=o(4039),T=o(9352),L=new g.Logger("Device");function I(){var N,M,U,j;if(typeof navigator=="object"&&navigator.product==="ReactNative")return L.debug("detectDevice() | React-Native detected"),typeof RTCPeerConnection>"u"?void L.warn("detectDevice() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?"):typeof RTCRtpTransceiver<"u"?(L.debug("detectDevice() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(L.debug("detectDevice() | ReactNative PlanB handler chosen"),"ReactNative");if(typeof navigator!="object"||typeof navigator.userAgent!="string")L.warn("detectDevice() | unknown device");else{const Q=navigator.userAgent,Y=new f.UAParser(Q);L.debug("detectDevice() | browser detected [ua:%s, parsed:%o]",Q,Y.getResult());const he=Y.getBrowser(),re=(N=he.name)==null?void 0:N.toLowerCase(),pe=parseInt(he.major??"0"),fe=Y.getEngine(),ue=(M=fe.name)==null?void 0:M.toLowerCase(),ee=Y.getOS(),Z=(U=ee.name)==null?void 0:U.toLowerCase(),le=parseFloat(ee.version??"0"),ye=Y.getDevice(),mt=(j=ye.model)==null?void 0:j.toLowerCase(),Ye=Z==="ios"||mt==="ipad",ct=re&&["chrome","chromium","mobile chrome","chrome webview","chrome headless"].includes(re),ht=re&&["firefox","mobile firefox","mobile focus"].includes(re),kt=re&&["safari","mobile safari"].includes(re),Sr=re&&["edge"].includes(re);if((ct||Sr)&&!Ye&&pe>=111)return"Chrome111";if(ct&&!Ye&&pe>=74||Sr&&!Ye&&pe>=88)return"Chrome74";if(ct&&!Ye&&pe>=70)return"Chrome70";if(ct&&!Ye&&pe>=67)return"Chrome67";if(ct&&!Ye&&pe>=55)return"Chrome55";if(ht&&!Ye&&pe>=120)return"Firefox120";if(ht&&!Ye&&pe>=60)return"Firefox60";if(ht&&Ye&&le>=14.3||kt&&pe>=12&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(kt&&pe>=11)return"Safari11";if(Sr&&!Ye&&pe>=11&&pe<=18)return"Edge11";if(ue==="webkit"&&Ye&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(ue==="blink"){const wt=Q.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(wt){const Zt=Number(wt[1]);return Zt>=111?"Chrome111":Zt>=74?"Chrome74":Zt>=70?"Chrome70":Zt>=67?"Chrome67":"Chrome55"}return"Chrome111"}L.warn("detectDevice() | browser not supported [name:%s, version:%s]",re,pe)}}c.detectDevice=I,c.Device=class{constructor({handlerName:N,handlerFactory:M,Handler:U}={}){if(this._loaded=!1,this._observer=new p.EnhancedEventEmitter,L.debug("constructor()"),U){if(L.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),typeof U!="string")throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");N=U}if(N&&M)throw new TypeError("just one of handlerName or handlerInterface can be given");if(M)this._handlerFactory=M;else{if(N)L.debug("constructor() | handler given: %s",N);else{if(!(N=I()))throw new d.UnsupportedError("device not supported");L.debug("constructor() | detected handler: %s",N)}switch(N){case"Chrome111":this._handlerFactory=R.Chrome111.createFactory();break;case"Chrome74":this._handlerFactory=k.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=C.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=x.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=P.Chrome55.createFactory();break;case"Firefox120":this._handlerFactory=D.Firefox120.createFactory();break;case"Firefox60":this._handlerFactory=b.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=w.Safari12.createFactory();break;case"Safari11":this._handlerFactory=v.Safari11.createFactory();break;case"Edge11":this._handlerFactory=_.Edge11.createFactory();break;case"ReactNativeUnifiedPlan":this._handlerFactory=y.ReactNativeUnifiedPlan.createFactory();break;case"ReactNative":this._handlerFactory=T.ReactNative.createFactory();break;default:throw new TypeError(`unknown handlerName "${N}"`)}}const j=this._handlerFactory();this._handlerName=j.name,j.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new d.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new d.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:N}){let M;L.debug("load() [routerRtpCapabilities:%o]",N);try{if(this._loaded)throw new d.InvalidStateError("already loaded");const U=m.clone(N);E.validateRtpCapabilities(U),M=this._handlerFactory();const j=await M.getNativeRtpCapabilities();L.debug("load() | got native RTP capabilities:%o",j);const Q=m.clone(j);E.validateRtpCapabilities(Q),this._extendedRtpCapabilities=E.getExtendedRtpCapabilities(Q,U),L.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=E.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=E.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=E.getRecvRtpCapabilities(this._extendedRtpCapabilities),E.validateRtpCapabilities(this._recvRtpCapabilities),L.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await M.getNativeSctpCapabilities(),L.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),E.validateSctpCapabilities(this._sctpCapabilities),L.debug("load() succeeded"),this._loaded=!0,M.close()}catch(U){throw M&&M.close(),U}}canProduce(N){if(!this._loaded)throw new d.InvalidStateError("not loaded");if(N!=="audio"&&N!=="video")throw new TypeError(`invalid kind "${N}"`);return this._canProduceByKind[N]}createSendTransport({id:N,iceParameters:M,iceCandidates:U,dtlsParameters:j,sctpParameters:Q,iceServers:Y,iceTransportPolicy:he,additionalSettings:re,proprietaryConstraints:pe,appData:fe}){return L.debug("createSendTransport()"),this.createTransport({direction:"send",id:N,iceParameters:M,iceCandidates:U,dtlsParameters:j,sctpParameters:Q,iceServers:Y,iceTransportPolicy:he,additionalSettings:re,proprietaryConstraints:pe,appData:fe})}createRecvTransport({id:N,iceParameters:M,iceCandidates:U,dtlsParameters:j,sctpParameters:Q,iceServers:Y,iceTransportPolicy:he,additionalSettings:re,proprietaryConstraints:pe,appData:fe}){return L.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:N,iceParameters:M,iceCandidates:U,dtlsParameters:j,sctpParameters:Q,iceServers:Y,iceTransportPolicy:he,additionalSettings:re,proprietaryConstraints:pe,appData:fe})}createTransport({direction:N,id:M,iceParameters:U,iceCandidates:j,dtlsParameters:Q,sctpParameters:Y,iceServers:he,iceTransportPolicy:re,additionalSettings:pe,proprietaryConstraints:fe,appData:ue}){if(!this._loaded)throw new d.InvalidStateError("not loaded");if(typeof M!="string")throw new TypeError("missing id");if(typeof U!="object")throw new TypeError("missing iceParameters");if(!Array.isArray(j))throw new TypeError("missing iceCandidates");if(typeof Q!="object")throw new TypeError("missing dtlsParameters");if(Y&&typeof Y!="object")throw new TypeError("wrong sctpParameters");if(ue&&typeof ue!="object")throw new TypeError("if given, appData must be an object");const ee=new S.Transport({direction:N,id:M,iceParameters:U,iceCandidates:j,dtlsParameters:Q,sctpParameters:Y,iceServers:he,iceTransportPolicy:re,additionalSettings:pe,proprietaryConstraints:fe,appData:ue,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",ee),ee}}},2010:(a,c,o)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.EnhancedEventEmitter=void 0;const l=o(7007),u=new(o(2994)).Logger("EnhancedEventEmitter");class h extends l.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(g,...p){return super.emit(g,...p)}safeEmit(g,...p){const d=super.listenerCount(g);try{return super.emit(g,...p)}catch(m){return u.error("safeEmit() | event listener threw an error [eventName:%s]:%o",g,m),!!d}}on(g,p){return super.on(g,p),this}off(g,p){return super.off(g,p),this}addListener(g,p){return super.on(g,p),this}prependListener(g,p){return super.prependListener(g,p),this}once(g,p){return super.once(g,p),this}prependOnceListener(g,p){return super.prependOnceListener(g,p),this}removeListener(g,p){return super.off(g,p),this}removeAllListeners(g){return super.removeAllListeners(g),this}listenerCount(g){return super.listenerCount(g)}listeners(g){return super.listeners(g)}rawListeners(g){return super.rawListeners(g)}}c.EnhancedEventEmitter=h},2994:function(a,c,o){var l=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(c,"__esModule",{value:!0}),c.Logger=void 0;const u=l(o(7833)),h="mediasoup-client";c.Logger=class{constructor(f){f?(this._debug=(0,u.default)(`${h}:${f}`),this._warn=(0,u.default)(`${h}:WARN:${f}`),this._error=(0,u.default)(`${h}:ERROR:${f}`)):(this._debug=(0,u.default)(h),this._warn=(0,u.default)(`${h}:WARN`),this._error=(0,u.default)(`${h}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},9792:(a,c,o)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.Producer=void 0;const l=o(2994),u=o(2010),h=o(4893),f=new l.Logger("Producer");class g extends u.EnhancedEventEmitter{constructor({id:d,localId:m,rtpSender:E,track:S,rtpParameters:R,stopTracks:k,disableTrackOnPause:C,zeroRtpOnPause:x,appData:P}){super(),this._closed=!1,this._observer=new u.EnhancedEventEmitter,f.debug("constructor()"),this._id=d,this._localId=m,this._rtpSender=E,this._track=S,this._kind=S.kind,this._rtpParameters=R,this._paused=!!C&&!S.enabled,this._maxSpatialLayer=void 0,this._stopTracks=k,this._disableTrackOnPause=C,this._zeroRtpOnPause=x,this._appData=P||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(d){this._appData=d}get observer(){return this._observer}close(){this._closed||(f.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(f.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new h.InvalidStateError("closed");return new Promise((d,m)=>{this.safeEmit("@getstats",d,m)})}pause(){f.debug("pause()"),this._closed?f.error("pause() | Producer closed"):(this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((d,m)=>{this.safeEmit("@pause",d,m)}).catch(()=>{}),this._observer.safeEmit("pause"))}resume(){f.debug("resume()"),this._closed?f.error("resume() | Producer closed"):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((d,m)=>{this.safeEmit("@resume",d,m)}).catch(()=>{}),this._observer.safeEmit("resume"))}async replaceTrack({track:d}){if(f.debug("replaceTrack() [track:%o]",d),this._closed){if(d&&this._stopTracks)try{d.stop()}catch{}throw new h.InvalidStateError("closed")}if(d&&d.readyState==="ended")throw new h.InvalidStateError("track ended");d!==this._track?(await new Promise((m,E)=>{this.safeEmit("@replacetrack",d,m,E)}),this.destroyTrack(),this._track=d,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()):f.debug("replaceTrack() | same track, ignored")}async setMaxSpatialLayer(d){if(this._closed)throw new h.InvalidStateError("closed");if(this._kind!=="video")throw new h.UnsupportedError("not a video Producer");if(typeof d!="number")throw new TypeError("invalid spatialLayer");d!==this._maxSpatialLayer&&(await new Promise((m,E)=>{this.safeEmit("@setmaxspatiallayer",d,m,E)}).catch(()=>{}),this._maxSpatialLayer=d)}async setRtpEncodingParameters(d){if(this._closed)throw new h.InvalidStateError("closed");if(typeof d!="object")throw new TypeError("invalid params");await new Promise((m,E)=>{this.safeEmit("@setrtpencodingparameters",d,m,E)})}onTrackEnded(){f.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch{}}}c.Producer=g},5370:(a,c)=>{Object.defineProperty(c,"__esModule",{value:!0})},4160:(a,c)=>{Object.defineProperty(c,"__esModule",{value:!0})},5601:function(a,c,o){var l=this&&this.__createBinding||(Object.create?function(v,_,y,T){T===void 0&&(T=y);var L=Object.getOwnPropertyDescriptor(_,y);L&&!("get"in L?!_.__esModule:L.writable||L.configurable)||(L={enumerable:!0,get:function(){return _[y]}}),Object.defineProperty(v,T,L)}:function(v,_,y,T){T===void 0&&(T=y),v[T]=_[y]}),u=this&&this.__setModuleDefault||(Object.create?function(v,_){Object.defineProperty(v,"default",{enumerable:!0,value:_})}:function(v,_){v.default=_}),h=this&&this.__importStar||function(v){if(v&&v.__esModule)return v;var _={};if(v!=null)for(var y in v)y!=="default"&&Object.prototype.hasOwnProperty.call(v,y)&&l(_,v,y);return u(_,v),_},f=this&&this.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(c,"__esModule",{value:!0}),c.Transport=void 0;const g=o(8876),p=f(o(9596)),d=o(2994),m=o(2010),E=o(4893),S=h(o(1765)),R=h(o(8046)),k=o(9792),C=o(3518),x=o(7504),P=o(9166),D=new d.Logger("Transport");class b{constructor(_){this.consumerOptions=_,this.promise=new Promise((y,T)=>{this.resolve=y,this.reject=T})}}class w extends m.EnhancedEventEmitter{constructor({direction:_,id:y,iceParameters:T,iceCandidates:L,dtlsParameters:I,sctpParameters:N,iceServers:M,iceTransportPolicy:U,additionalSettings:j,proprietaryConstraints:Q,appData:Y,handlerFactory:he,extendedRtpCapabilities:re,canProduceByKind:pe}){super(),this._closed=!1,this._iceGatheringState="new",this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._dataProducers=new Map,this._dataConsumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new g.AwaitQueue,this._pendingConsumerTasks=[],this._consumerCreationInProgress=!1,this._pendingPauseConsumers=new Map,this._consumerPauseInProgress=!1,this._pendingResumeConsumers=new Map,this._consumerResumeInProgress=!1,this._pendingCloseConsumers=new Map,this._consumerCloseInProgress=!1,this._observer=new m.EnhancedEventEmitter,D.debug("constructor() [id:%s, direction:%s]",y,_),this._id=y,this._direction=_,this._extendedRtpCapabilities=re,this._canProduceByKind=pe,this._maxSctpMessageSize=N?N.maxMessageSize:null;const fe=S.clone(j)||{};delete fe.iceServers,delete fe.iceTransportPolicy,delete fe.bundlePolicy,delete fe.rtcpMuxPolicy,delete fe.sdpSemantics,this._handler=he(),this._handler.run({direction:_,iceParameters:T,iceCandidates:L,dtlsParameters:I,sctpParameters:N,iceServers:M,iceTransportPolicy:U,additionalSettings:fe,proprietaryConstraints:Q,extendedRtpCapabilities:re}),this._appData=Y||{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get iceGatheringState(){return this._iceGatheringState}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(_){this._appData=_}get observer(){return this._observer}close(){if(!this._closed){D.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";for(const _ of this._producers.values())_.transportClosed();this._producers.clear();for(const _ of this._consumers.values())_.transportClosed();this._consumers.clear();for(const _ of this._dataProducers.values())_.transportClosed();this._dataProducers.clear();for(const _ of this._dataConsumers.values())_.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new E.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:_}){if(D.debug("restartIce()"),this._closed)throw new E.InvalidStateError("closed");if(!_)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>await this._handler.restartIce(_),"transport.restartIce()")}async updateIceServers({iceServers:_}={}){if(D.debug("updateIceServers()"),this._closed)throw new E.InvalidStateError("closed");if(!Array.isArray(_))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(_),"transport.updateIceServers()")}async produce({track:_,encodings:y,codecOptions:T,codec:L,stopTracks:I=!0,disableTrackOnPause:N=!0,zeroRtpOnPause:M=!1,appData:U={}}={}){if(D.debug("produce() [track:%o]",_),this._closed)throw new E.InvalidStateError("closed");if(!_)throw new TypeError("missing track");if(this._direction!=="send")throw new E.UnsupportedError("not a sending Transport");if(!this._canProduceByKind[_.kind])throw new E.UnsupportedError(`cannot produce ${_.kind}`);if(_.readyState==="ended")throw new E.InvalidStateError("track ended");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(U&&typeof U!="object")throw new TypeError("if given, appData must be an object");return this._awaitQueue.push(async()=>{let j;if(y&&!Array.isArray(y))throw TypeError("encodings must be an array");y&&y.length===0?j=void 0:y&&(j=y.map(re=>{const pe={active:!0};return re.active===!1&&(pe.active=!1),typeof re.dtx=="boolean"&&(pe.dtx=re.dtx),typeof re.scalabilityMode=="string"&&(pe.scalabilityMode=re.scalabilityMode),typeof re.scaleResolutionDownBy=="number"&&(pe.scaleResolutionDownBy=re.scaleResolutionDownBy),typeof re.maxBitrate=="number"&&(pe.maxBitrate=re.maxBitrate),typeof re.maxFramerate=="number"&&(pe.maxFramerate=re.maxFramerate),typeof re.adaptivePtime=="boolean"&&(pe.adaptivePtime=re.adaptivePtime),typeof re.priority=="string"&&(pe.priority=re.priority),typeof re.networkPriority=="string"&&(pe.networkPriority=re.networkPriority),pe}));const{localId:Q,rtpParameters:Y,rtpSender:he}=await this._handler.send({track:_,encodings:j,codecOptions:T,codec:L});try{R.validateRtpParameters(Y);const{id:re}=await new Promise((fe,ue)=>{this.safeEmit("produce",{kind:_.kind,rtpParameters:Y,appData:U},fe,ue)}),pe=new k.Producer({id:re,localId:Q,rtpSender:he,track:_,rtpParameters:Y,stopTracks:I,disableTrackOnPause:N,zeroRtpOnPause:M,appData:U});return this._producers.set(pe.id,pe),this.handleProducer(pe),this._observer.safeEmit("newproducer",pe),pe}catch(re){throw this._handler.stopSending(Q).catch(()=>{}),re}},"transport.produce()").catch(j=>{if(I)try{_.stop()}catch{}throw j})}async consume({id:_,producerId:y,kind:T,rtpParameters:L,streamId:I,appData:N={}}){if(D.debug("consume()"),this._closed)throw new E.InvalidStateError("closed");if(this._direction!=="recv")throw new E.UnsupportedError("not a receiving Transport");if(typeof _!="string")throw new TypeError("missing id");if(typeof y!="string")throw new TypeError("missing producerId");if(T!=="audio"&&T!=="video")throw new TypeError(`invalid kind '${T}'`);if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(N&&typeof N!="object")throw new TypeError("if given, appData must be an object");const M=S.clone(L);if(!R.canReceive(M,this._extendedRtpCapabilities))throw new E.UnsupportedError("cannot consume this Producer");const U=new b({id:_,producerId:y,kind:T,rtpParameters:M,streamId:I,appData:N});return this._pendingConsumerTasks.push(U),(0,p.default)(()=>{this._closed||this._consumerCreationInProgress===!1&&this.createPendingConsumers()}),U.promise}async produceData({ordered:_=!0,maxPacketLifeTime:y,maxRetransmits:T,label:L="",protocol:I="",appData:N={}}={}){if(D.debug("produceData()"),this._closed)throw new E.InvalidStateError("closed");if(this._direction!=="send")throw new E.UnsupportedError("not a sending Transport");if(!this._maxSctpMessageSize)throw new E.UnsupportedError("SCTP not enabled by remote Transport");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');if(N&&typeof N!="object")throw new TypeError("if given, appData must be an object");return(y||T)&&(_=!1),this._awaitQueue.push(async()=>{const{dataChannel:M,sctpStreamParameters:U}=await this._handler.sendDataChannel({ordered:_,maxPacketLifeTime:y,maxRetransmits:T,label:L,protocol:I});R.validateSctpStreamParameters(U);const{id:j}=await new Promise((Y,he)=>{this.safeEmit("producedata",{sctpStreamParameters:U,label:L,protocol:I,appData:N},Y,he)}),Q=new x.DataProducer({id:j,dataChannel:M,sctpStreamParameters:U,appData:N});return this._dataProducers.set(Q.id,Q),this.handleDataProducer(Q),this._observer.safeEmit("newdataproducer",Q),Q},"transport.produceData()")}async consumeData({id:_,dataProducerId:y,sctpStreamParameters:T,label:L="",protocol:I="",appData:N={}}){if(D.debug("consumeData()"),this._closed)throw new E.InvalidStateError("closed");if(this._direction!=="recv")throw new E.UnsupportedError("not a receiving Transport");if(!this._maxSctpMessageSize)throw new E.UnsupportedError("SCTP not enabled by remote Transport");if(typeof _!="string")throw new TypeError("missing id");if(typeof y!="string")throw new TypeError("missing dataProducerId");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(N&&typeof N!="object")throw new TypeError("if given, appData must be an object");const M=S.clone(T);return R.validateSctpStreamParameters(M),this._awaitQueue.push(async()=>{const{dataChannel:U}=await this._handler.receiveDataChannel({sctpStreamParameters:M,label:L,protocol:I}),j=new P.DataConsumer({id:_,dataProducerId:y,dataChannel:U,sctpStreamParameters:M,appData:N});return this._dataConsumers.set(j.id,j),this.handleDataConsumer(j),this._observer.safeEmit("newdataconsumer",j),j},"transport.consumeData()")}async createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingConsumerTasks.length===0)return void D.debug("createPendingConsumers() | there is no Consumer to be created");const _=[...this._pendingConsumerTasks];let y;this._pendingConsumerTasks=[];const T=[];for(const L of _){const{id:I,kind:N,rtpParameters:M,streamId:U}=L.consumerOptions;T.push({trackId:I,kind:N,rtpParameters:M,streamId:U})}try{const L=await this._handler.receive(T);for(let I=0;I<L.length;++I){const N=_[I],M=L[I],{id:U,producerId:j,kind:Q,rtpParameters:Y,appData:he}=N.consumerOptions,{localId:re,rtpReceiver:pe,track:fe}=M,ue=new C.Consumer({id:U,localId:re,producerId:j,rtpReceiver:pe,track:fe,rtpParameters:Y,appData:he});this._consumers.set(ue.id,ue),this.handleConsumer(ue),this._probatorConsumerCreated||y||Q!=="video"||(y=ue),this._observer.safeEmit("newconsumer",ue),N.resolve(ue)}}catch(L){for(const I of _)I.reject(L)}if(y)try{const L=R.generateProbatorRtpParameters(y.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:L}]),D.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(L){D.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",L)}},"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingPauseConsumers.size===0)return void D.debug("pausePendingConsumers() | there is no Consumer to be paused");const _=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const y=_.map(T=>T.localId);await this._handler.pauseReceiving(y)}catch(y){D.error("pausePendingConsumers() | failed to pause Consumers:",y)}},"transport.pausePendingConsumers").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingResumeConsumers.size===0)return void D.debug("resumePendingConsumers() | there is no Consumer to be resumed");const _=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const y=_.map(T=>T.localId);await this._handler.resumeReceiving(y)}catch(y){D.error("resumePendingConsumers() | failed to resume Consumers:",y)}},"transport.resumePendingConsumers").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingCloseConsumers.size===0)return void D.debug("closePendingConsumers() | there is no Consumer to be closed");const _=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(_.map(y=>y.localId))}catch(y){D.error("closePendingConsumers() | failed to close Consumers:",y)}},"transport.closePendingConsumers").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){const _=this._handler;_.on("@connect",({dtlsParameters:y},T,L)=>{this._closed?L(new E.InvalidStateError("closed")):this.safeEmit("connect",{dtlsParameters:y},T,L)}),_.on("@icegatheringstatechange",y=>{y!==this._iceGatheringState&&(D.debug("ICE gathering state changed to %s",y),this._iceGatheringState=y,this._closed||this.safeEmit("icegatheringstatechange",y))}),_.on("@connectionstatechange",y=>{y!==this._connectionState&&(D.debug("connection state changed to %s",y),this._connectionState=y,this._closed||this.safeEmit("connectionstatechange",y))})}handleProducer(_){_.on("@close",()=>{this._producers.delete(_.id),this._closed||this._awaitQueue.push(async()=>await this._handler.stopSending(_.localId),"producer @close event").catch(y=>D.warn("producer.close() failed:%o",y))}),_.on("@pause",(y,T)=>{this._awaitQueue.push(async()=>await this._handler.pauseSending(_.localId),"producer @pause event").then(y).catch(T)}),_.on("@resume",(y,T)=>{this._awaitQueue.push(async()=>await this._handler.resumeSending(_.localId),"producer @resume event").then(y).catch(T)}),_.on("@replacetrack",(y,T,L)=>{this._awaitQueue.push(async()=>await this._handler.replaceTrack(_.localId,y),"producer @replacetrack event").then(T).catch(L)}),_.on("@setmaxspatiallayer",(y,T,L)=>{this._awaitQueue.push(async()=>await this._handler.setMaxSpatialLayer(_.localId,y),"producer @setmaxspatiallayer event").then(T).catch(L)}),_.on("@setrtpencodingparameters",(y,T,L)=>{this._awaitQueue.push(async()=>await this._handler.setRtpEncodingParameters(_.localId,y),"producer @setrtpencodingparameters event").then(T).catch(L)}),_.on("@getstats",(y,T)=>{if(this._closed)return T(new E.InvalidStateError("closed"));this._handler.getSenderStats(_.localId).then(y).catch(T)})}handleConsumer(_){_.on("@close",()=>{this._consumers.delete(_.id),this._pendingPauseConsumers.delete(_.id),this._pendingResumeConsumers.delete(_.id),this._closed||(this._pendingCloseConsumers.set(_.id,_),this._consumerCloseInProgress===!1&&this.closePendingConsumers())}),_.on("@pause",()=>{this._pendingResumeConsumers.has(_.id)&&this._pendingResumeConsumers.delete(_.id),this._pendingPauseConsumers.set(_.id,_),(0,p.default)(()=>{this._closed||this._consumerPauseInProgress===!1&&this.pausePendingConsumers()})}),_.on("@resume",()=>{this._pendingPauseConsumers.has(_.id)&&this._pendingPauseConsumers.delete(_.id),this._pendingResumeConsumers.set(_.id,_),(0,p.default)(()=>{this._closed||this._consumerResumeInProgress===!1&&this.resumePendingConsumers()})}),_.on("@getstats",(y,T)=>{if(this._closed)return T(new E.InvalidStateError("closed"));this._handler.getReceiverStats(_.localId).then(y).catch(T)})}handleDataProducer(_){_.on("@close",()=>{this._dataProducers.delete(_.id)})}handleDataConsumer(_){_.on("@close",()=>{this._dataConsumers.delete(_.id)})}}c.Transport=w},4893:(a,c)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.InvalidStateError=c.UnsupportedError=void 0;class o extends Error{constructor(h){super(h),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,o):this.stack=new Error(h).stack}}c.UnsupportedError=o;class l extends Error{constructor(h){super(h),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,l):this.stack=new Error(h).stack}}c.InvalidStateError=l},2183:function(a,c,o){var l=this&&this.__createBinding||(Object.create?function(w,v,_,y){y===void 0&&(y=_);var T=Object.getOwnPropertyDescriptor(v,_);T&&!("get"in T?!v.__esModule:T.writable||T.configurable)||(T={enumerable:!0,get:function(){return v[_]}}),Object.defineProperty(w,y,T)}:function(w,v,_,y){y===void 0&&(y=_),w[y]=v[_]}),u=this&&this.__setModuleDefault||(Object.create?function(w,v){Object.defineProperty(w,"default",{enumerable:!0,value:v})}:function(w,v){w.default=v}),h=this&&this.__importStar||function(w){if(w&&w.__esModule)return w;var v={};if(w!=null)for(var _ in w)_!=="default"&&Object.prototype.hasOwnProperty.call(w,_)&&l(v,w,_);return u(v,w),v};Object.defineProperty(c,"__esModule",{value:!0}),c.Chrome111=void 0;const f=h(o(7363)),g=o(2994),p=h(o(1765)),d=h(o(8046)),m=h(o(5544)),E=h(o(5938)),S=h(o(4256)),R=o(4893),k=o(521),C=o(1305),x=o(3303),P=new g.Logger("Chrome111"),D={OS:1024,MIS:1024};class b extends k.HandlerInterface{static createFactory(){return()=>new b}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome111"}close(){if(P.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){P.debug("getNativeRtpCapabilities()");const v=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{v.addTransceiver("audio"),v.addTransceiver("video");const _=await v.createOffer();try{v.close()}catch{}const y=f.parse(_.sdp),T=m.extractRtpCapabilities({sdpObject:y});return S.addNackSuppportForOpus(T),T}catch(_){try{v.close()}catch{}throw _}}async getNativeSctpCapabilities(){return P.debug("getNativeSctpCapabilities()"),{numStreams:D}}run({direction:v,iceParameters:_,iceCandidates:y,dtlsParameters:T,sctpParameters:L,iceServers:I,iceTransportPolicy:N,additionalSettings:M,proprietaryConstraints:U,extendedRtpCapabilities:j}){this.assertNotClosed(),P.debug("run()"),this._direction=v,this._remoteSdp=new C.RemoteSdp({iceParameters:_,iceCandidates:y,dtlsParameters:T,sctpParameters:L}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",j),video:d.getSendingRtpParameters("video",j)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",j),video:d.getSendingRemoteRtpParameters("video",j)},T.role&&T.role!=="auto"&&(this._forcedLocalDtlsRole=T.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:I||[],iceTransportPolicy:N||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...M},U),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(P.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(v){this.assertNotClosed(),P.debug("updateIceServers()");const _=this._pc.getConfiguration();_.iceServers=v,this._pc.setConfiguration(_)}async restartIce(v){if(this.assertNotClosed(),P.debug("restartIce()"),this._remoteSdp.updateIceParameters(v),this._transportReady)if(this._direction==="send"){const _=await this._pc.createOffer({iceRestart:!0});P.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",_),await this._pc.setLocalDescription(_);const y={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y)}else{const _={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",_),await this._pc.setRemoteDescription(_);const y=await this._pc.createAnswer();P.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:v,encodings:_,codecOptions:y,codec:T}){if(this.assertNotClosed(),this.assertSendDirection(),P.debug("send() [kind:%s, track.id:%s]",v.kind,v.id),_&&_.length>1){let re=1;for(const pe of _){const fe=pe.scalabilityMode?(0,x.parse)(pe.scalabilityMode).temporalLayers:3;fe>re&&(re=fe)}_.forEach((pe,fe)=>{pe.rid=`r${fe}`,pe.scalabilityMode=`L1T${re}`})}const L=p.clone(this._sendingRtpParametersByKind[v.kind]);L.codecs=d.reduceCodecs(L.codecs,T);const I=p.clone(this._sendingRemoteRtpParametersByKind[v.kind]);I.codecs=d.reduceCodecs(I.codecs,T);const N=this._remoteSdp.getNextMediaSectionIdx(),M=this._pc.addTransceiver(v,{direction:"sendonly",streams:[this._sendStream],sendEncodings:_}),U=await this._pc.createOffer();let j=f.parse(U.sdp);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j}),P.debug("send() | calling pc.setLocalDescription() [offer:%o]",U),await this._pc.setLocalDescription(U);const Q=M.mid;L.mid=Q,j=f.parse(this._pc.localDescription.sdp);const Y=j.media[N.idx];if(L.rtcp.cname=m.getCname({offerMediaObject:Y}),_)if(_.length===1){const re=E.getRtpEncodings({offerMediaObject:Y});Object.assign(re[0],_[0]),L.encodings=re}else L.encodings=_;else L.encodings=E.getRtpEncodings({offerMediaObject:Y});this._remoteSdp.send({offerMediaObject:Y,reuseMid:N.reuseMid,offerRtpParameters:L,answerRtpParameters:I,codecOptions:y,extmapAllowMixed:!0});const he={type:"answer",sdp:this._remoteSdp.getSdp()};return P.debug("send() | calling pc.setRemoteDescription() [answer:%o]",he),await this._pc.setRemoteDescription(he),this._mapMidTransceiver.set(Q,M),{localId:Q,rtpParameters:L,rtpSender:M.sender}}async stopSending(v){if(this.assertSendDirection(),P.debug("stopSending() [localId:%s]",v),this._closed)return;const _=this._mapMidTransceiver.get(v);if(!_)throw new Error("associated RTCRtpTransceiver not found");if(_.sender.replaceTrack(null),this._pc.removeTrack(_.sender),this._remoteSdp.closeMediaSection(_.mid))try{_.stop()}catch{}const y=await this._pc.createOffer();P.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const T={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T),this._mapMidTransceiver.delete(v)}async pauseSending(v){this.assertNotClosed(),this.assertSendDirection(),P.debug("pauseSending() [localId:%s]",v);const _=this._mapMidTransceiver.get(v);if(!_)throw new Error("associated RTCRtpTransceiver not found");_.direction="inactive",this._remoteSdp.pauseMediaSection(v);const y=await this._pc.createOffer();P.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const T={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T)}async resumeSending(v){this.assertNotClosed(),this.assertSendDirection(),P.debug("resumeSending() [localId:%s]",v);const _=this._mapMidTransceiver.get(v);if(this._remoteSdp.resumeSendingMediaSection(v),!_)throw new Error("associated RTCRtpTransceiver not found");_.direction="sendonly";const y=await this._pc.createOffer();P.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const T={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T)}async replaceTrack(v,_){this.assertNotClosed(),this.assertSendDirection(),_?P.debug("replaceTrack() [localId:%s, track.id:%s]",v,_.id):P.debug("replaceTrack() [localId:%s, no track]",v);const y=this._mapMidTransceiver.get(v);if(!y)throw new Error("associated RTCRtpTransceiver not found");await y.sender.replaceTrack(_)}async setMaxSpatialLayer(v,_){this.assertNotClosed(),this.assertSendDirection(),P.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",v,_);const y=this._mapMidTransceiver.get(v);if(!y)throw new Error("associated RTCRtpTransceiver not found");const T=y.sender.getParameters();T.encodings.forEach((N,M)=>{N.active=M<=_}),await y.sender.setParameters(T),this._remoteSdp.muxMediaSectionSimulcast(v,T.encodings);const L=await this._pc.createOffer();P.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",L),await this._pc.setLocalDescription(L);const I={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",I),await this._pc.setRemoteDescription(I)}async setRtpEncodingParameters(v,_){this.assertNotClosed(),this.assertSendDirection(),P.debug("setRtpEncodingParameters() [localId:%s, params:%o]",v,_);const y=this._mapMidTransceiver.get(v);if(!y)throw new Error("associated RTCRtpTransceiver not found");const T=y.sender.getParameters();T.encodings.forEach((N,M)=>{T.encodings[M]={...N,..._}}),await y.sender.setParameters(T),this._remoteSdp.muxMediaSectionSimulcast(v,T.encodings);const L=await this._pc.createOffer();P.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",L),await this._pc.setLocalDescription(L);const I={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",I),await this._pc.setRemoteDescription(I)}async getSenderStats(v){this.assertNotClosed(),this.assertSendDirection();const _=this._mapMidTransceiver.get(v);if(!_)throw new Error("associated RTCRtpTransceiver not found");return _.sender.getStats()}async sendDataChannel({ordered:v,maxPacketLifeTime:_,maxRetransmits:y,label:T,protocol:L}){this.assertNotClosed(),this.assertSendDirection();const I={negotiated:!0,id:this._nextSendSctpStreamId,ordered:v,maxPacketLifeTime:_,maxRetransmits:y,protocol:L};P.debug("sendDataChannel() [options:%o]",I);const N=this._pc.createDataChannel(T,I);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%D.MIS,!this._hasDataChannelMediaSection){const M=await this._pc.createOffer(),U=f.parse(M.sdp),j=U.media.find(Y=>Y.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:U}),P.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",M),await this._pc.setLocalDescription(M),this._remoteSdp.sendSctpAssociation({offerMediaObject:j});const Q={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",Q),await this._pc.setRemoteDescription(Q),this._hasDataChannelMediaSection=!0}return{dataChannel:N,sctpStreamParameters:{streamId:I.id,ordered:I.ordered,maxPacketLifeTime:I.maxPacketLifeTime,maxRetransmits:I.maxRetransmits}}}async receive(v){this.assertNotClosed(),this.assertRecvDirection();const _=[],y=new Map;for(const N of v){const{trackId:M,kind:U,rtpParameters:j,streamId:Q}=N;P.debug("receive() [trackId:%s, kind:%s]",M,U);const Y=j.mid||String(this._mapMidTransceiver.size);y.set(M,Y),this._remoteSdp.receive({mid:Y,kind:U,offerRtpParameters:j,streamId:Q||j.rtcp.cname,trackId:M})}const T={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",T),await this._pc.setRemoteDescription(T);let L=await this._pc.createAnswer();const I=f.parse(L.sdp);for(const N of v){const{trackId:M,rtpParameters:U}=N,j=y.get(M),Q=I.media.find(Y=>String(Y.mid)===j);m.applyCodecParameters({offerRtpParameters:U,answerMediaObject:Q})}L={type:"answer",sdp:f.write(I)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:I}),P.debug("receive() | calling pc.setLocalDescription() [answer:%o]",L),await this._pc.setLocalDescription(L);for(const N of v){const{trackId:M}=N,U=y.get(M),j=this._pc.getTransceivers().find(Q=>Q.mid===U);if(!j)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(U,j),_.push({localId:U,track:j.receiver.track,rtpReceiver:j.receiver})}return _}async stopReceiving(v){if(this.assertRecvDirection(),this._closed)return;for(const T of v){P.debug("stopReceiving() [localId:%s]",T);const L=this._mapMidTransceiver.get(T);if(!L)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(L.mid)}const _={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",_),await this._pc.setRemoteDescription(_);const y=await this._pc.createAnswer();P.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y);for(const T of v)this._mapMidTransceiver.delete(T)}async pauseReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const T of v){P.debug("pauseReceiving() [localId:%s]",T);const L=this._mapMidTransceiver.get(T);if(!L)throw new Error("associated RTCRtpTransceiver not found");L.direction="inactive",this._remoteSdp.pauseMediaSection(T)}const _={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",_),await this._pc.setRemoteDescription(_);const y=await this._pc.createAnswer();P.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y)}async resumeReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const T of v){P.debug("resumeReceiving() [localId:%s]",T);const L=this._mapMidTransceiver.get(T);if(!L)throw new Error("associated RTCRtpTransceiver not found");L.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(T)}const _={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",_),await this._pc.setRemoteDescription(_);const y=await this._pc.createAnswer();P.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y)}async getReceiverStats(v){this.assertNotClosed(),this.assertRecvDirection();const _=this._mapMidTransceiver.get(v);if(!_)throw new Error("associated RTCRtpTransceiver not found");return _.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:v,label:_,protocol:y}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:T,ordered:L,maxPacketLifeTime:I,maxRetransmits:N}=v,M={negotiated:!0,id:T,ordered:L,maxPacketLifeTime:I,maxRetransmits:N,protocol:y};P.debug("receiveDataChannel() [options:%o]",M);const U=this._pc.createDataChannel(_,M);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const j={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",j),await this._pc.setRemoteDescription(j);const Q=await this._pc.createAnswer();if(!this._transportReady){const Y=f.parse(Q.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:Y})}P.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",Q),await this._pc.setLocalDescription(Q),this._hasDataChannelMediaSection=!0}return{dataChannel:U}}async setupTransport({localDtlsRole:v,localSdpObject:_}){_||(_=f.parse(this._pc.localDescription.sdp));const y=m.extractDtlsParameters({sdpObject:_});y.role=v,this._remoteSdp.updateDtlsRole(v==="client"?"server":"client"),await new Promise((T,L)=>{this.safeEmit("@connect",{dtlsParameters:y},T,L)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new R.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}c.Chrome111=b},7402:function(a,c,o){var l=this&&this.__createBinding||(Object.create?function(D,b,w,v){v===void 0&&(v=w);var _=Object.getOwnPropertyDescriptor(b,w);_&&!("get"in _?!b.__esModule:_.writable||_.configurable)||(_={enumerable:!0,get:function(){return b[w]}}),Object.defineProperty(D,v,_)}:function(D,b,w,v){v===void 0&&(v=w),D[v]=b[w]}),u=this&&this.__setModuleDefault||(Object.create?function(D,b){Object.defineProperty(D,"default",{enumerable:!0,value:b})}:function(D,b){D.default=b}),h=this&&this.__importStar||function(D){if(D&&D.__esModule)return D;var b={};if(D!=null)for(var w in D)w!=="default"&&Object.prototype.hasOwnProperty.call(D,w)&&l(b,D,w);return u(b,D),b};Object.defineProperty(c,"__esModule",{value:!0}),c.Chrome55=void 0;const f=h(o(7363)),g=o(2994),p=o(4893),d=h(o(1765)),m=h(o(8046)),E=h(o(5544)),S=h(o(4496)),R=o(521),k=o(1305),C=new g.Logger("Chrome55"),x={OS:1024,MIS:1024};class P extends R.HandlerInterface{static createFactory(){return()=>new P}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome55"}close(){if(C.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){C.debug("getNativeRtpCapabilities()");const b=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const w=await b.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{b.close()}catch{}const v=f.parse(w.sdp);return E.extractRtpCapabilities({sdpObject:v})}catch(w){try{b.close()}catch{}throw w}}async getNativeSctpCapabilities(){return C.debug("getNativeSctpCapabilities()"),{numStreams:x}}run({direction:b,iceParameters:w,iceCandidates:v,dtlsParameters:_,sctpParameters:y,iceServers:T,iceTransportPolicy:L,additionalSettings:I,proprietaryConstraints:N,extendedRtpCapabilities:M}){C.debug("run()"),this._direction=b,this._remoteSdp=new k.RemoteSdp({iceParameters:w,iceCandidates:v,dtlsParameters:_,sctpParameters:y,planB:!0}),this._sendingRtpParametersByKind={audio:m.getSendingRtpParameters("audio",M),video:m.getSendingRtpParameters("video",M)},this._sendingRemoteRtpParametersByKind={audio:m.getSendingRemoteRtpParameters("audio",M),video:m.getSendingRemoteRtpParameters("video",M)},_.role&&_.role!=="auto"&&(this._forcedLocalDtlsRole=_.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:T||[],iceTransportPolicy:L||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...I},N),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(C.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(b){C.debug("updateIceServers()");const w=this._pc.getConfiguration();w.iceServers=b,this._pc.setConfiguration(w)}async restartIce(b){if(C.debug("restartIce()"),this._remoteSdp.updateIceParameters(b),this._transportReady)if(this._direction==="send"){const w=await this._pc.createOffer({iceRestart:!0});C.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",w),await this._pc.setLocalDescription(w);const v={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}else{const w={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",w),await this._pc.setRemoteDescription(w);const v=await this._pc.createAnswer();C.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",v),await this._pc.setLocalDescription(v)}}async getTransportStats(){return this._pc.getStats()}async send({track:b,encodings:w,codecOptions:v,codec:_}){this.assertSendDirection(),C.debug("send() [kind:%s, track.id:%s]",b.kind,b.id),_&&C.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(b),this._pc.addStream(this._sendStream);let y,T=await this._pc.createOffer(),L=f.parse(T.sdp);const I=d.clone(this._sendingRtpParametersByKind[b.kind]);I.codecs=m.reduceCodecs(I.codecs);const N=d.clone(this._sendingRemoteRtpParametersByKind[b.kind]);if(N.codecs=m.reduceCodecs(N.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:L}),b.kind==="video"&&w&&w.length>1&&(C.debug("send() | enabling simulcast"),L=f.parse(T.sdp),y=L.media.find(j=>j.type==="video"),S.addLegacySimulcast({offerMediaObject:y,track:b,numStreams:w.length}),T={type:"offer",sdp:f.write(L)}),C.debug("send() | calling pc.setLocalDescription() [offer:%o]",T),await this._pc.setLocalDescription(T),L=f.parse(this._pc.localDescription.sdp),y=L.media.find(j=>j.type===b.kind),I.rtcp.cname=E.getCname({offerMediaObject:y}),I.encodings=S.getRtpEncodings({offerMediaObject:y,track:b}),w)for(let j=0;j<I.encodings.length;++j)w[j]&&Object.assign(I.encodings[j],w[j]);if(I.encodings.length>1&&I.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const j of I.encodings)j.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:y,offerRtpParameters:I,answerRtpParameters:N,codecOptions:v});const M={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("send() | calling pc.setRemoteDescription() [answer:%o]",M),await this._pc.setRemoteDescription(M);const U=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(U,b),{localId:U,rtpParameters:I}}async stopSending(b){this.assertSendDirection(),C.debug("stopSending() [localId:%s]",b);const w=this._mapSendLocalIdTrack.get(b);if(!w)throw new Error("track not found");this._mapSendLocalIdTrack.delete(b),this._sendStream.removeTrack(w),this._pc.addStream(this._sendStream);const v=await this._pc.createOffer();C.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",v);try{await this._pc.setLocalDescription(v)}catch(y){if(this._sendStream.getTracks().length===0)return void C.warn("stopSending() | ignoring expected error due no sending tracks: %s",y.toString());throw y}if(this._pc.signalingState==="stable")return;const _={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_)}async pauseSending(b){}async resumeSending(b){}async replaceTrack(b,w){throw new p.UnsupportedError("not implemented")}async setMaxSpatialLayer(b,w){throw new p.UnsupportedError(" not implemented")}async setRtpEncodingParameters(b,w){throw new p.UnsupportedError("not supported")}async getSenderStats(b){throw new p.UnsupportedError("not implemented")}async sendDataChannel({ordered:b,maxPacketLifeTime:w,maxRetransmits:v,label:_,protocol:y}){this.assertSendDirection();const T={negotiated:!0,id:this._nextSendSctpStreamId,ordered:b,maxPacketLifeTime:w,maxRetransmitTime:w,maxRetransmits:v,protocol:y};C.debug("sendDataChannel() [options:%o]",T);const L=this._pc.createDataChannel(_,T);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%x.MIS,!this._hasDataChannelMediaSection){const I=await this._pc.createOffer(),N=f.parse(I.sdp),M=N.media.find(j=>j.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:N}),C.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",I),await this._pc.setLocalDescription(I),this._remoteSdp.sendSctpAssociation({offerMediaObject:M});const U={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",U),await this._pc.setRemoteDescription(U),this._hasDataChannelMediaSection=!0}return{dataChannel:L,sctpStreamParameters:{streamId:T.id,ordered:T.ordered,maxPacketLifeTime:T.maxPacketLifeTime,maxRetransmits:T.maxRetransmits}}}async receive(b){this.assertRecvDirection();const w=[];for(const T of b){const{trackId:L,kind:I,rtpParameters:N,streamId:M}=T;C.debug("receive() [trackId:%s, kind:%s]",L,I);const U=I;this._remoteSdp.receive({mid:U,kind:I,offerRtpParameters:N,streamId:M||N.rtcp.cname,trackId:L})}const v={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",v),await this._pc.setRemoteDescription(v);let _=await this._pc.createAnswer();const y=f.parse(_.sdp);for(const T of b){const{kind:L,rtpParameters:I}=T,N=L,M=y.media.find(U=>String(U.mid)===N);E.applyCodecParameters({offerRtpParameters:I,answerMediaObject:M})}_={type:"answer",sdp:f.write(y)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:y}),C.debug("receive() | calling pc.setLocalDescription() [answer:%o]",_),await this._pc.setLocalDescription(_);for(const T of b){const{kind:L,trackId:I,rtpParameters:N}=T,M=L,U=I,j=T.streamId||N.rtcp.cname,Q=this._pc.getRemoteStreams().find(Y=>Y.id===j).getTrackById(U);if(!Q)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(U,{mid:M,rtpParameters:N}),w.push({localId:U,track:Q})}return w}async stopReceiving(b){this.assertRecvDirection();for(const _ of b){C.debug("stopReceiving() [localId:%s]",_);const{mid:y,rtpParameters:T}=this._mapRecvLocalIdInfo.get(_)||{};this._mapRecvLocalIdInfo.delete(_),this._remoteSdp.planBStopReceiving({mid:y,offerRtpParameters:T})}const w={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",w),await this._pc.setRemoteDescription(w);const v=await this._pc.createAnswer();C.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",v),await this._pc.setLocalDescription(v)}async pauseReceiving(b){}async resumeReceiving(b){}async getReceiverStats(b){throw new p.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:b,label:w,protocol:v}){this.assertRecvDirection();const{streamId:_,ordered:y,maxPacketLifeTime:T,maxRetransmits:L}=b,I={negotiated:!0,id:_,ordered:y,maxPacketLifeTime:T,maxRetransmitTime:T,maxRetransmits:L,protocol:v};C.debug("receiveDataChannel() [options:%o]",I);const N=this._pc.createDataChannel(w,I);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const M={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",M),await this._pc.setRemoteDescription(M);const U=await this._pc.createAnswer();if(!this._transportReady){const j=f.parse(U.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j})}C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",U),await this._pc.setLocalDescription(U),this._hasDataChannelMediaSection=!0}return{dataChannel:N}}async setupTransport({localDtlsRole:b,localSdpObject:w}){w||(w=f.parse(this._pc.localDescription.sdp));const v=E.extractDtlsParameters({sdpObject:w});v.role=b,this._remoteSdp.updateDtlsRole(b==="client"?"server":"client"),await new Promise((_,y)=>{this.safeEmit("@connect",{dtlsParameters:v},_,y)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}c.Chrome55=P},8155:function(a,c,o){var l=this&&this.__createBinding||(Object.create?function(P,D,b,w){w===void 0&&(w=b);var v=Object.getOwnPropertyDescriptor(D,b);v&&!("get"in v?!D.__esModule:v.writable||v.configurable)||(v={enumerable:!0,get:function(){return D[b]}}),Object.defineProperty(P,w,v)}:function(P,D,b,w){w===void 0&&(w=b),P[w]=D[b]}),u=this&&this.__setModuleDefault||(Object.create?function(P,D){Object.defineProperty(P,"default",{enumerable:!0,value:D})}:function(P,D){P.default=D}),h=this&&this.__importStar||function(P){if(P&&P.__esModule)return P;var D={};if(P!=null)for(var b in P)b!=="default"&&Object.prototype.hasOwnProperty.call(P,b)&&l(D,P,b);return u(D,P),D};Object.defineProperty(c,"__esModule",{value:!0}),c.Chrome67=void 0;const f=h(o(7363)),g=o(2994),p=h(o(1765)),d=h(o(8046)),m=h(o(5544)),E=h(o(4496)),S=o(521),R=o(1305),k=new g.Logger("Chrome67"),C={OS:1024,MIS:1024};class x extends S.HandlerInterface{static createFactory(){return()=>new x}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome67"}close(){if(k.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){k.debug("getNativeRtpCapabilities()");const D=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const b=await D.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{D.close()}catch{}const w=f.parse(b.sdp);return m.extractRtpCapabilities({sdpObject:w})}catch(b){try{D.close()}catch{}throw b}}async getNativeSctpCapabilities(){return k.debug("getNativeSctpCapabilities()"),{numStreams:C}}run({direction:D,iceParameters:b,iceCandidates:w,dtlsParameters:v,sctpParameters:_,iceServers:y,iceTransportPolicy:T,additionalSettings:L,proprietaryConstraints:I,extendedRtpCapabilities:N}){k.debug("run()"),this._direction=D,this._remoteSdp=new R.RemoteSdp({iceParameters:b,iceCandidates:w,dtlsParameters:v,sctpParameters:_,planB:!0}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",N),video:d.getSendingRtpParameters("video",N)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",N),video:d.getSendingRemoteRtpParameters("video",N)},v.role&&v.role!=="auto"&&(this._forcedLocalDtlsRole=v.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:y||[],iceTransportPolicy:T||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...L},I),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(k.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(D){k.debug("updateIceServers()");const b=this._pc.getConfiguration();b.iceServers=D,this._pc.setConfiguration(b)}async restartIce(D){if(k.debug("restartIce()"),this._remoteSdp.updateIceParameters(D),this._transportReady)if(this._direction==="send"){const b=await this._pc.createOffer({iceRestart:!0});k.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",b),await this._pc.setLocalDescription(b);const w={type:"answer",sdp:this._remoteSdp.getSdp()};k.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",w),await this._pc.setRemoteDescription(w)}else{const b={type:"offer",sdp:this._remoteSdp.getSdp()};k.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",b),await this._pc.setRemoteDescription(b);const w=await this._pc.createAnswer();k.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",w),await this._pc.setLocalDescription(w)}}async getTransportStats(){return this._pc.getStats()}async send({track:D,encodings:b,codecOptions:w,codec:v}){this.assertSendDirection(),k.debug("send() [kind:%s, track.id:%s]",D.kind,D.id),v&&k.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(D),this._pc.addTrack(D,this._sendStream);let _,y=await this._pc.createOffer(),T=f.parse(y.sdp);const L=p.clone(this._sendingRtpParametersByKind[D.kind]);L.codecs=d.reduceCodecs(L.codecs);const I=p.clone(this._sendingRemoteRtpParametersByKind[D.kind]);if(I.codecs=d.reduceCodecs(I.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:T}),D.kind==="video"&&b&&b.length>1&&(k.debug("send() | enabling simulcast"),T=f.parse(y.sdp),_=T.media.find(j=>j.type==="video"),E.addLegacySimulcast({offerMediaObject:_,track:D,numStreams:b.length}),y={type:"offer",sdp:f.write(T)}),k.debug("send() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y),T=f.parse(this._pc.localDescription.sdp),_=T.media.find(j=>j.type===D.kind),L.rtcp.cname=m.getCname({offerMediaObject:_}),L.encodings=E.getRtpEncodings({offerMediaObject:_,track:D}),b)for(let j=0;j<L.encodings.length;++j)b[j]&&Object.assign(L.encodings[j],b[j]);if(L.encodings.length>1&&L.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const j of L.encodings)j.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:_,offerRtpParameters:L,answerRtpParameters:I,codecOptions:w});const N={type:"answer",sdp:this._remoteSdp.getSdp()};k.debug("send() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N);const M=String(this._nextSendLocalId);this._nextSendLocalId++;const U=this._pc.getSenders().find(j=>j.track===D);return this._mapSendLocalIdRtpSender.set(M,U),{localId:M,rtpParameters:L,rtpSender:U}}async stopSending(D){this.assertSendDirection(),k.debug("stopSending() [localId:%s]",D);const b=this._mapSendLocalIdRtpSender.get(D);if(!b)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(b),b.track&&this._sendStream.removeTrack(b.track),this._mapSendLocalIdRtpSender.delete(D);const w=await this._pc.createOffer();k.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",w);try{await this._pc.setLocalDescription(w)}catch(_){if(this._sendStream.getTracks().length===0)return void k.warn("stopSending() | ignoring expected error due no sending tracks: %s",_.toString());throw _}if(this._pc.signalingState==="stable")return;const v={type:"answer",sdp:this._remoteSdp.getSdp()};k.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async pauseSending(D){}async resumeSending(D){}async replaceTrack(D,b){this.assertSendDirection(),b?k.debug("replaceTrack() [localId:%s, track.id:%s]",D,b.id):k.debug("replaceTrack() [localId:%s, no track]",D);const w=this._mapSendLocalIdRtpSender.get(D);if(!w)throw new Error("associated RTCRtpSender not found");const v=w.track;await w.replaceTrack(b),v&&this._sendStream.removeTrack(v),b&&this._sendStream.addTrack(b)}async setMaxSpatialLayer(D,b){this.assertSendDirection(),k.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",D,b);const w=this._mapSendLocalIdRtpSender.get(D);if(!w)throw new Error("associated RTCRtpSender not found");const v=w.getParameters();v.encodings.forEach((_,y)=>{_.active=y<=b}),await w.setParameters(v)}async setRtpEncodingParameters(D,b){this.assertSendDirection(),k.debug("setRtpEncodingParameters() [localId:%s, params:%o]",D,b);const w=this._mapSendLocalIdRtpSender.get(D);if(!w)throw new Error("associated RTCRtpSender not found");const v=w.getParameters();v.encodings.forEach((_,y)=>{v.encodings[y]={..._,...b}}),await w.setParameters(v)}async getSenderStats(D){this.assertSendDirection();const b=this._mapSendLocalIdRtpSender.get(D);if(!b)throw new Error("associated RTCRtpSender not found");return b.getStats()}async sendDataChannel({ordered:D,maxPacketLifeTime:b,maxRetransmits:w,label:v,protocol:_}){this.assertSendDirection();const y={negotiated:!0,id:this._nextSendSctpStreamId,ordered:D,maxPacketLifeTime:b,maxRetransmitTime:b,maxRetransmits:w,protocol:_};k.debug("sendDataChannel() [options:%o]",y);const T=this._pc.createDataChannel(v,y);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%C.MIS,!this._hasDataChannelMediaSection){const L=await this._pc.createOffer(),I=f.parse(L.sdp),N=I.media.find(U=>U.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:I}),k.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",L),await this._pc.setLocalDescription(L),this._remoteSdp.sendSctpAssociation({offerMediaObject:N});const M={type:"answer",sdp:this._remoteSdp.getSdp()};k.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",M),await this._pc.setRemoteDescription(M),this._hasDataChannelMediaSection=!0}return{dataChannel:T,sctpStreamParameters:{streamId:y.id,ordered:y.ordered,maxPacketLifeTime:y.maxPacketLifeTime,maxRetransmits:y.maxRetransmits}}}async receive(D){this.assertRecvDirection();const b=[];for(const y of D){const{trackId:T,kind:L,rtpParameters:I,streamId:N}=y;k.debug("receive() [trackId:%s, kind:%s]",T,L);const M=L;this._remoteSdp.receive({mid:M,kind:L,offerRtpParameters:I,streamId:N||I.rtcp.cname,trackId:T})}const w={type:"offer",sdp:this._remoteSdp.getSdp()};k.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",w),await this._pc.setRemoteDescription(w);let v=await this._pc.createAnswer();const _=f.parse(v.sdp);for(const y of D){const{kind:T,rtpParameters:L}=y,I=T,N=_.media.find(M=>String(M.mid)===I);m.applyCodecParameters({offerRtpParameters:L,answerMediaObject:N})}v={type:"answer",sdp:f.write(_)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:_}),k.debug("receive() | calling pc.setLocalDescription() [answer:%o]",v),await this._pc.setLocalDescription(v);for(const y of D){const{kind:T,trackId:L,rtpParameters:I}=y,N=L,M=T,U=this._pc.getReceivers().find(j=>j.track&&j.track.id===N);if(!U)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(N,{mid:M,rtpParameters:I,rtpReceiver:U}),b.push({localId:N,track:U.track,rtpReceiver:U})}return b}async stopReceiving(D){this.assertRecvDirection();for(const v of D){k.debug("stopReceiving() [localId:%s]",v);const{mid:_,rtpParameters:y}=this._mapRecvLocalIdInfo.get(v)||{};this._mapRecvLocalIdInfo.delete(v),this._remoteSdp.planBStopReceiving({mid:_,offerRtpParameters:y})}const b={type:"offer",sdp:this._remoteSdp.getSdp()};k.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",b),await this._pc.setRemoteDescription(b);const w=await this._pc.createAnswer();k.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",w),await this._pc.setLocalDescription(w)}async pauseReceiving(D){}async resumeReceiving(D){}async getReceiverStats(D){this.assertRecvDirection();const{rtpReceiver:b}=this._mapRecvLocalIdInfo.get(D)||{};if(!b)throw new Error("associated RTCRtpReceiver not found");return b.getStats()}async receiveDataChannel({sctpStreamParameters:D,label:b,protocol:w}){this.assertRecvDirection();const{streamId:v,ordered:_,maxPacketLifeTime:y,maxRetransmits:T}=D,L={negotiated:!0,id:v,ordered:_,maxPacketLifeTime:y,maxRetransmitTime:y,maxRetransmits:T,protocol:w};k.debug("receiveDataChannel() [options:%o]",L);const I=this._pc.createDataChannel(b,L);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const N={type:"offer",sdp:this._remoteSdp.getSdp()};k.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",N),await this._pc.setRemoteDescription(N);const M=await this._pc.createAnswer();if(!this._transportReady){const U=f.parse(M.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:U})}k.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",M),await this._pc.setLocalDescription(M),this._hasDataChannelMediaSection=!0}return{dataChannel:I}}async setupTransport({localDtlsRole:D,localSdpObject:b}){b||(b=f.parse(this._pc.localDescription.sdp));const w=m.extractDtlsParameters({sdpObject:b});w.role=D,this._remoteSdp.updateDtlsRole(D==="client"?"server":"client"),await new Promise((v,_)=>{this.safeEmit("@connect",{dtlsParameters:w},v,_)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}c.Chrome67=x},5535:function(a,c,o){var l=this&&this.__createBinding||(Object.create?function(D,b,w,v){v===void 0&&(v=w);var _=Object.getOwnPropertyDescriptor(b,w);_&&!("get"in _?!b.__esModule:_.writable||_.configurable)||(_={enumerable:!0,get:function(){return b[w]}}),Object.defineProperty(D,v,_)}:function(D,b,w,v){v===void 0&&(v=w),D[v]=b[w]}),u=this&&this.__setModuleDefault||(Object.create?function(D,b){Object.defineProperty(D,"default",{enumerable:!0,value:b})}:function(D,b){D.default=b}),h=this&&this.__importStar||function(D){if(D&&D.__esModule)return D;var b={};if(D!=null)for(var w in D)w!=="default"&&Object.prototype.hasOwnProperty.call(D,w)&&l(b,D,w);return u(b,D),b};Object.defineProperty(c,"__esModule",{value:!0}),c.Chrome70=void 0;const f=h(o(7363)),g=o(2994),p=h(o(1765)),d=h(o(8046)),m=h(o(5544)),E=h(o(5938)),S=o(521),R=o(1305),k=o(3303),C=new g.Logger("Chrome70"),x={OS:1024,MIS:1024};class P extends S.HandlerInterface{static createFactory(){return()=>new P}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome70"}close(){if(C.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){C.debug("getNativeRtpCapabilities()");const b=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{b.addTransceiver("audio"),b.addTransceiver("video");const w=await b.createOffer();try{b.close()}catch{}const v=f.parse(w.sdp);return m.extractRtpCapabilities({sdpObject:v})}catch(w){try{b.close()}catch{}throw w}}async getNativeSctpCapabilities(){return C.debug("getNativeSctpCapabilities()"),{numStreams:x}}run({direction:b,iceParameters:w,iceCandidates:v,dtlsParameters:_,sctpParameters:y,iceServers:T,iceTransportPolicy:L,additionalSettings:I,proprietaryConstraints:N,extendedRtpCapabilities:M}){C.debug("run()"),this._direction=b,this._remoteSdp=new R.RemoteSdp({iceParameters:w,iceCandidates:v,dtlsParameters:_,sctpParameters:y}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",M),video:d.getSendingRtpParameters("video",M)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",M),video:d.getSendingRemoteRtpParameters("video",M)},_.role&&_.role!=="auto"&&(this._forcedLocalDtlsRole=_.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:T||[],iceTransportPolicy:L||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...I},N),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(C.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(b){C.debug("updateIceServers()");const w=this._pc.getConfiguration();w.iceServers=b,this._pc.setConfiguration(w)}async restartIce(b){if(C.debug("restartIce()"),this._remoteSdp.updateIceParameters(b),this._transportReady)if(this._direction==="send"){const w=await this._pc.createOffer({iceRestart:!0});C.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",w),await this._pc.setLocalDescription(w);const v={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}else{const w={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",w),await this._pc.setRemoteDescription(w);const v=await this._pc.createAnswer();C.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",v),await this._pc.setLocalDescription(v)}}async getTransportStats(){return this._pc.getStats()}async send({track:b,encodings:w,codecOptions:v,codec:_}){this.assertSendDirection(),C.debug("send() [kind:%s, track.id:%s]",b.kind,b.id);const y=p.clone(this._sendingRtpParametersByKind[b.kind]);y.codecs=d.reduceCodecs(y.codecs,_);const T=p.clone(this._sendingRemoteRtpParametersByKind[b.kind]);T.codecs=d.reduceCodecs(T.codecs,_);const L=this._remoteSdp.getNextMediaSectionIdx(),I=this._pc.addTransceiver(b,{direction:"sendonly",streams:[this._sendStream]});let N,M=await this._pc.createOffer(),U=f.parse(M.sdp);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:U}),w&&w.length>1&&(C.debug("send() | enabling legacy simulcast"),U=f.parse(M.sdp),N=U.media[L.idx],E.addLegacySimulcast({offerMediaObject:N,numStreams:w.length}),M={type:"offer",sdp:f.write(U)});let j=!1;const Q=(0,k.parse)((w||[{}])[0].scalabilityMode);if(w&&w.length===1&&Q.spatialLayers>1&&y.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(C.debug("send() | enabling legacy simulcast for VP9 SVC"),j=!0,U=f.parse(M.sdp),N=U.media[L.idx],E.addLegacySimulcast({offerMediaObject:N,numStreams:Q.spatialLayers}),M={type:"offer",sdp:f.write(U)}),C.debug("send() | calling pc.setLocalDescription() [offer:%o]",M),await this._pc.setLocalDescription(M),w){C.debug("send() | applying given encodings");const re=I.sender.getParameters();for(let pe=0;pe<(re.encodings||[]).length;++pe){const fe=re.encodings[pe],ue=w[pe];if(!ue)break;re.encodings[pe]=Object.assign(fe,ue)}await I.sender.setParameters(re)}const Y=I.mid;if(y.mid=Y,U=f.parse(this._pc.localDescription.sdp),N=U.media[L.idx],y.rtcp.cname=m.getCname({offerMediaObject:N}),y.encodings=E.getRtpEncodings({offerMediaObject:N}),w)for(let re=0;re<y.encodings.length;++re)w[re]&&Object.assign(y.encodings[re],w[re]);if(j&&(y.encodings=[y.encodings[0]]),y.encodings.length>1&&(y.codecs[0].mimeType.toLowerCase()==="video/vp8"||y.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const re of y.encodings)re.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:N,reuseMid:L.reuseMid,offerRtpParameters:y,answerRtpParameters:T,codecOptions:v});const he={type:"answer",sdp:this._remoteSdp.getSdp()};return C.debug("send() | calling pc.setRemoteDescription() [answer:%o]",he),await this._pc.setRemoteDescription(he),this._mapMidTransceiver.set(Y,I),{localId:Y,rtpParameters:y,rtpSender:I.sender}}async stopSending(b){this.assertSendDirection(),C.debug("stopSending() [localId:%s]",b);const w=this._mapMidTransceiver.get(b);if(!w)throw new Error("associated RTCRtpTransceiver not found");if(w.sender.replaceTrack(null),this._pc.removeTrack(w.sender),this._remoteSdp.closeMediaSection(w.mid))try{w.stop()}catch{}const v=await this._pc.createOffer();C.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",v),await this._pc.setLocalDescription(v);const _={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_),this._mapMidTransceiver.delete(b)}async pauseSending(b){}async resumeSending(b){}async replaceTrack(b,w){this.assertSendDirection(),w?C.debug("replaceTrack() [localId:%s, track.id:%s]",b,w.id):C.debug("replaceTrack() [localId:%s, no track]",b);const v=this._mapMidTransceiver.get(b);if(!v)throw new Error("associated RTCRtpTransceiver not found");await v.sender.replaceTrack(w)}async setMaxSpatialLayer(b,w){this.assertSendDirection(),C.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",b,w);const v=this._mapMidTransceiver.get(b);if(!v)throw new Error("associated RTCRtpTransceiver not found");const _=v.sender.getParameters();_.encodings.forEach((L,I)=>{L.active=I<=w}),await v.sender.setParameters(_),this._remoteSdp.muxMediaSectionSimulcast(b,_.encodings);const y=await this._pc.createOffer();C.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const T={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T)}async setRtpEncodingParameters(b,w){this.assertSendDirection(),C.debug("setRtpEncodingParameters() [localId:%s, params:%o]",b,w);const v=this._mapMidTransceiver.get(b);if(!v)throw new Error("associated RTCRtpTransceiver not found");const _=v.sender.getParameters();_.encodings.forEach((L,I)=>{_.encodings[I]={...L,...w}}),await v.sender.setParameters(_),this._remoteSdp.muxMediaSectionSimulcast(b,_.encodings);const y=await this._pc.createOffer();C.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const T={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T)}async getSenderStats(b){this.assertSendDirection();const w=this._mapMidTransceiver.get(b);if(!w)throw new Error("associated RTCRtpTransceiver not found");return w.sender.getStats()}async sendDataChannel({ordered:b,maxPacketLifeTime:w,maxRetransmits:v,label:_,protocol:y}){this.assertSendDirection();const T={negotiated:!0,id:this._nextSendSctpStreamId,ordered:b,maxPacketLifeTime:w,maxRetransmitTime:w,maxRetransmits:v,protocol:y};C.debug("sendDataChannel() [options:%o]",T);const L=this._pc.createDataChannel(_,T);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%x.MIS,!this._hasDataChannelMediaSection){const I=await this._pc.createOffer(),N=f.parse(I.sdp),M=N.media.find(j=>j.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:N}),C.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",I),await this._pc.setLocalDescription(I),this._remoteSdp.sendSctpAssociation({offerMediaObject:M});const U={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",U),await this._pc.setRemoteDescription(U),this._hasDataChannelMediaSection=!0}return{dataChannel:L,sctpStreamParameters:{streamId:T.id,ordered:T.ordered,maxPacketLifeTime:T.maxPacketLifeTime,maxRetransmits:T.maxRetransmits}}}async receive(b){this.assertRecvDirection();const w=[],v=new Map;for(const L of b){const{trackId:I,kind:N,rtpParameters:M,streamId:U}=L;C.debug("receive() [trackId:%s, kind:%s]",I,N);const j=M.mid||String(this._mapMidTransceiver.size);v.set(I,j),this._remoteSdp.receive({mid:j,kind:N,offerRtpParameters:M,streamId:U||M.rtcp.cname,trackId:I})}const _={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",_),await this._pc.setRemoteDescription(_);let y=await this._pc.createAnswer();const T=f.parse(y.sdp);for(const L of b){const{trackId:I,rtpParameters:N}=L,M=v.get(I),U=T.media.find(j=>String(j.mid)===M);m.applyCodecParameters({offerRtpParameters:N,answerMediaObject:U})}y={type:"answer",sdp:f.write(T)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:T}),C.debug("receive() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y);for(const L of b){const{trackId:I}=L,N=v.get(I),M=this._pc.getTransceivers().find(U=>U.mid===N);if(!M)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(N,M),w.push({localId:N,track:M.receiver.track,rtpReceiver:M.receiver})}return w}async stopReceiving(b){this.assertRecvDirection();for(const _ of b){C.debug("stopReceiving() [localId:%s]",_);const y=this._mapMidTransceiver.get(_);if(!y)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(y.mid)}const w={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",w),await this._pc.setRemoteDescription(w);const v=await this._pc.createAnswer();C.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",v),await this._pc.setLocalDescription(v);for(const _ of b)this._mapMidTransceiver.delete(_)}async pauseReceiving(b){}async resumeReceiving(b){}async getReceiverStats(b){this.assertRecvDirection();const w=this._mapMidTransceiver.get(b);if(!w)throw new Error("associated RTCRtpTransceiver not found");return w.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:b,label:w,protocol:v}){this.assertRecvDirection();const{streamId:_,ordered:y,maxPacketLifeTime:T,maxRetransmits:L}=b,I={negotiated:!0,id:_,ordered:y,maxPacketLifeTime:T,maxRetransmitTime:T,maxRetransmits:L,protocol:v};C.debug("receiveDataChannel() [options:%o]",I);const N=this._pc.createDataChannel(w,I);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const M={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",M),await this._pc.setRemoteDescription(M);const U=await this._pc.createAnswer();if(!this._transportReady){const j=f.parse(U.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j})}C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",U),await this._pc.setLocalDescription(U),this._hasDataChannelMediaSection=!0}return{dataChannel:N}}async setupTransport({localDtlsRole:b,localSdpObject:w}){w||(w=f.parse(this._pc.localDescription.sdp));const v=m.extractDtlsParameters({sdpObject:w});v.role=b,this._remoteSdp.updateDtlsRole(b==="client"?"server":"client"),await new Promise((_,y)=>{this.safeEmit("@connect",{dtlsParameters:v},_,y)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}c.Chrome70=P},11:function(a,c,o){var l=this&&this.__createBinding||(Object.create?function(w,v,_,y){y===void 0&&(y=_);var T=Object.getOwnPropertyDescriptor(v,_);T&&!("get"in T?!v.__esModule:T.writable||T.configurable)||(T={enumerable:!0,get:function(){return v[_]}}),Object.defineProperty(w,y,T)}:function(w,v,_,y){y===void 0&&(y=_),w[y]=v[_]}),u=this&&this.__setModuleDefault||(Object.create?function(w,v){Object.defineProperty(w,"default",{enumerable:!0,value:v})}:function(w,v){w.default=v}),h=this&&this.__importStar||function(w){if(w&&w.__esModule)return w;var v={};if(w!=null)for(var _ in w)_!=="default"&&Object.prototype.hasOwnProperty.call(w,_)&&l(v,w,_);return u(v,w),v};Object.defineProperty(c,"__esModule",{value:!0}),c.Chrome74=void 0;const f=h(o(7363)),g=o(2994),p=h(o(1765)),d=h(o(8046)),m=h(o(5544)),E=h(o(5938)),S=h(o(4256)),R=o(4893),k=o(521),C=o(1305),x=o(3303),P=new g.Logger("Chrome74"),D={OS:1024,MIS:1024};class b extends k.HandlerInterface{static createFactory(){return()=>new b}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome74"}close(){if(P.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){P.debug("getNativeRtpCapabilities()");const v=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{v.addTransceiver("audio"),v.addTransceiver("video");const _=await v.createOffer();try{v.close()}catch{}const y=f.parse(_.sdp),T=m.extractRtpCapabilities({sdpObject:y});return S.addNackSuppportForOpus(T),T}catch(_){try{v.close()}catch{}throw _}}async getNativeSctpCapabilities(){return P.debug("getNativeSctpCapabilities()"),{numStreams:D}}run({direction:v,iceParameters:_,iceCandidates:y,dtlsParameters:T,sctpParameters:L,iceServers:I,iceTransportPolicy:N,additionalSettings:M,proprietaryConstraints:U,extendedRtpCapabilities:j}){P.debug("run()"),this._direction=v,this._remoteSdp=new C.RemoteSdp({iceParameters:_,iceCandidates:y,dtlsParameters:T,sctpParameters:L}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",j),video:d.getSendingRtpParameters("video",j)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",j),video:d.getSendingRemoteRtpParameters("video",j)},T.role&&T.role!=="auto"&&(this._forcedLocalDtlsRole=T.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:I||[],iceTransportPolicy:N||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...M},U),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(P.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(v){this.assertNotClosed(),P.debug("updateIceServers()");const _=this._pc.getConfiguration();_.iceServers=v,this._pc.setConfiguration(_)}async restartIce(v){if(this.assertNotClosed(),P.debug("restartIce()"),this._remoteSdp.updateIceParameters(v),this._transportReady)if(this._direction==="send"){const _=await this._pc.createOffer({iceRestart:!0});P.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",_),await this._pc.setLocalDescription(_);const y={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y)}else{const _={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",_),await this._pc.setRemoteDescription(_);const y=await this._pc.createAnswer();P.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:v,encodings:_,codecOptions:y,codec:T}){this.assertNotClosed(),this.assertSendDirection(),P.debug("send() [kind:%s, track.id:%s]",v.kind,v.id),_&&_.length>1&&_.forEach((fe,ue)=>{fe.rid=`r${ue}`});const L=p.clone(this._sendingRtpParametersByKind[v.kind]);L.codecs=d.reduceCodecs(L.codecs,T);const I=p.clone(this._sendingRemoteRtpParametersByKind[v.kind]);I.codecs=d.reduceCodecs(I.codecs,T);const N=this._remoteSdp.getNextMediaSectionIdx(),M=this._pc.addTransceiver(v,{direction:"sendonly",streams:[this._sendStream],sendEncodings:_});let U,j=await this._pc.createOffer(),Q=f.parse(j.sdp);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:Q});let Y=!1;const he=(0,x.parse)((_||[{}])[0].scalabilityMode);_&&_.length===1&&he.spatialLayers>1&&L.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(P.debug("send() | enabling legacy simulcast for VP9 SVC"),Y=!0,Q=f.parse(j.sdp),U=Q.media[N.idx],E.addLegacySimulcast({offerMediaObject:U,numStreams:he.spatialLayers}),j={type:"offer",sdp:f.write(Q)}),P.debug("send() | calling pc.setLocalDescription() [offer:%o]",j),await this._pc.setLocalDescription(j);const re=M.mid;if(L.mid=re,Q=f.parse(this._pc.localDescription.sdp),U=Q.media[N.idx],L.rtcp.cname=m.getCname({offerMediaObject:U}),_)if(_.length===1){let fe=E.getRtpEncodings({offerMediaObject:U});Object.assign(fe[0],_[0]),Y&&(fe=[fe[0]]),L.encodings=fe}else L.encodings=_;else L.encodings=E.getRtpEncodings({offerMediaObject:U});if(L.encodings.length>1&&(L.codecs[0].mimeType.toLowerCase()==="video/vp8"||L.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const fe of L.encodings)fe.scalabilityMode?fe.scalabilityMode=`L1T${he.temporalLayers}`:fe.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:U,reuseMid:N.reuseMid,offerRtpParameters:L,answerRtpParameters:I,codecOptions:y,extmapAllowMixed:!0});const pe={type:"answer",sdp:this._remoteSdp.getSdp()};return P.debug("send() | calling pc.setRemoteDescription() [answer:%o]",pe),await this._pc.setRemoteDescription(pe),this._mapMidTransceiver.set(re,M),{localId:re,rtpParameters:L,rtpSender:M.sender}}async stopSending(v){if(this.assertSendDirection(),P.debug("stopSending() [localId:%s]",v),this._closed)return;const _=this._mapMidTransceiver.get(v);if(!_)throw new Error("associated RTCRtpTransceiver not found");if(_.sender.replaceTrack(null),this._pc.removeTrack(_.sender),this._remoteSdp.closeMediaSection(_.mid))try{_.stop()}catch{}const y=await this._pc.createOffer();P.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const T={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T),this._mapMidTransceiver.delete(v)}async pauseSending(v){this.assertNotClosed(),this.assertSendDirection(),P.debug("pauseSending() [localId:%s]",v);const _=this._mapMidTransceiver.get(v);if(!_)throw new Error("associated RTCRtpTransceiver not found");_.direction="inactive",this._remoteSdp.pauseMediaSection(v);const y=await this._pc.createOffer();P.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const T={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T)}async resumeSending(v){this.assertNotClosed(),this.assertSendDirection(),P.debug("resumeSending() [localId:%s]",v);const _=this._mapMidTransceiver.get(v);if(this._remoteSdp.resumeSendingMediaSection(v),!_)throw new Error("associated RTCRtpTransceiver not found");_.direction="sendonly";const y=await this._pc.createOffer();P.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const T={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T)}async replaceTrack(v,_){this.assertNotClosed(),this.assertSendDirection(),_?P.debug("replaceTrack() [localId:%s, track.id:%s]",v,_.id):P.debug("replaceTrack() [localId:%s, no track]",v);const y=this._mapMidTransceiver.get(v);if(!y)throw new Error("associated RTCRtpTransceiver not found");await y.sender.replaceTrack(_)}async setMaxSpatialLayer(v,_){this.assertNotClosed(),this.assertSendDirection(),P.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",v,_);const y=this._mapMidTransceiver.get(v);if(!y)throw new Error("associated RTCRtpTransceiver not found");const T=y.sender.getParameters();T.encodings.forEach((N,M)=>{N.active=M<=_}),await y.sender.setParameters(T),this._remoteSdp.muxMediaSectionSimulcast(v,T.encodings);const L=await this._pc.createOffer();P.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",L),await this._pc.setLocalDescription(L);const I={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",I),await this._pc.setRemoteDescription(I)}async setRtpEncodingParameters(v,_){this.assertNotClosed(),this.assertSendDirection(),P.debug("setRtpEncodingParameters() [localId:%s, params:%o]",v,_);const y=this._mapMidTransceiver.get(v);if(!y)throw new Error("associated RTCRtpTransceiver not found");const T=y.sender.getParameters();T.encodings.forEach((N,M)=>{T.encodings[M]={...N,..._}}),await y.sender.setParameters(T),this._remoteSdp.muxMediaSectionSimulcast(v,T.encodings);const L=await this._pc.createOffer();P.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",L),await this._pc.setLocalDescription(L);const I={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",I),await this._pc.setRemoteDescription(I)}async getSenderStats(v){this.assertNotClosed(),this.assertSendDirection();const _=this._mapMidTransceiver.get(v);if(!_)throw new Error("associated RTCRtpTransceiver not found");return _.sender.getStats()}async sendDataChannel({ordered:v,maxPacketLifeTime:_,maxRetransmits:y,label:T,protocol:L}){this.assertNotClosed(),this.assertSendDirection();const I={negotiated:!0,id:this._nextSendSctpStreamId,ordered:v,maxPacketLifeTime:_,maxRetransmits:y,protocol:L};P.debug("sendDataChannel() [options:%o]",I);const N=this._pc.createDataChannel(T,I);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%D.MIS,!this._hasDataChannelMediaSection){const M=await this._pc.createOffer(),U=f.parse(M.sdp),j=U.media.find(Y=>Y.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:U}),P.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",M),await this._pc.setLocalDescription(M),this._remoteSdp.sendSctpAssociation({offerMediaObject:j});const Q={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",Q),await this._pc.setRemoteDescription(Q),this._hasDataChannelMediaSection=!0}return{dataChannel:N,sctpStreamParameters:{streamId:I.id,ordered:I.ordered,maxPacketLifeTime:I.maxPacketLifeTime,maxRetransmits:I.maxRetransmits}}}async receive(v){this.assertNotClosed(),this.assertRecvDirection();const _=[],y=new Map;for(const N of v){const{trackId:M,kind:U,rtpParameters:j,streamId:Q}=N;P.debug("receive() [trackId:%s, kind:%s]",M,U);const Y=j.mid||String(this._mapMidTransceiver.size);y.set(M,Y),this._remoteSdp.receive({mid:Y,kind:U,offerRtpParameters:j,streamId:Q||j.rtcp.cname,trackId:M})}const T={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",T),await this._pc.setRemoteDescription(T);let L=await this._pc.createAnswer();const I=f.parse(L.sdp);for(const N of v){const{trackId:M,rtpParameters:U}=N,j=y.get(M),Q=I.media.find(Y=>String(Y.mid)===j);m.applyCodecParameters({offerRtpParameters:U,answerMediaObject:Q})}L={type:"answer",sdp:f.write(I)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:I}),P.debug("receive() | calling pc.setLocalDescription() [answer:%o]",L),await this._pc.setLocalDescription(L);for(const N of v){const{trackId:M}=N,U=y.get(M),j=this._pc.getTransceivers().find(Q=>Q.mid===U);if(!j)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(U,j),_.push({localId:U,track:j.receiver.track,rtpReceiver:j.receiver})}return _}async stopReceiving(v){if(this.assertRecvDirection(),this._closed)return;for(const T of v){P.debug("stopReceiving() [localId:%s]",T);const L=this._mapMidTransceiver.get(T);if(!L)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(L.mid)}const _={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",_),await this._pc.setRemoteDescription(_);const y=await this._pc.createAnswer();P.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y);for(const T of v)this._mapMidTransceiver.delete(T)}async pauseReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const T of v){P.debug("pauseReceiving() [localId:%s]",T);const L=this._mapMidTransceiver.get(T);if(!L)throw new Error("associated RTCRtpTransceiver not found");L.direction="inactive",this._remoteSdp.pauseMediaSection(T)}const _={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",_),await this._pc.setRemoteDescription(_);const y=await this._pc.createAnswer();P.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y)}async resumeReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const T of v){P.debug("resumeReceiving() [localId:%s]",T);const L=this._mapMidTransceiver.get(T);if(!L)throw new Error("associated RTCRtpTransceiver not found");L.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(T)}const _={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",_),await this._pc.setRemoteDescription(_);const y=await this._pc.createAnswer();P.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y)}async getReceiverStats(v){this.assertNotClosed(),this.assertRecvDirection();const _=this._mapMidTransceiver.get(v);if(!_)throw new Error("associated RTCRtpTransceiver not found");return _.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:v,label:_,protocol:y}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:T,ordered:L,maxPacketLifeTime:I,maxRetransmits:N}=v,M={negotiated:!0,id:T,ordered:L,maxPacketLifeTime:I,maxRetransmits:N,protocol:y};P.debug("receiveDataChannel() [options:%o]",M);const U=this._pc.createDataChannel(_,M);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const j={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",j),await this._pc.setRemoteDescription(j);const Q=await this._pc.createAnswer();if(!this._transportReady){const Y=f.parse(Q.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:Y})}P.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",Q),await this._pc.setLocalDescription(Q),this._hasDataChannelMediaSection=!0}return{dataChannel:U}}async setupTransport({localDtlsRole:v,localSdpObject:_}){_||(_=f.parse(this._pc.localDescription.sdp));const y=m.extractDtlsParameters({sdpObject:_});y.role=v,this._remoteSdp.updateDtlsRole(v==="client"?"server":"client"),await new Promise((T,L)=>{this.safeEmit("@connect",{dtlsParameters:y},T,L)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new R.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}c.Chrome74=b},8633:function(a,c,o){var l=this&&this.__createBinding||(Object.create?function(k,C,x,P){P===void 0&&(P=x);var D=Object.getOwnPropertyDescriptor(C,x);D&&!("get"in D?!C.__esModule:D.writable||D.configurable)||(D={enumerable:!0,get:function(){return C[x]}}),Object.defineProperty(k,P,D)}:function(k,C,x,P){P===void 0&&(P=x),k[P]=C[x]}),u=this&&this.__setModuleDefault||(Object.create?function(k,C){Object.defineProperty(k,"default",{enumerable:!0,value:C})}:function(k,C){k.default=C}),h=this&&this.__importStar||function(k){if(k&&k.__esModule)return k;var C={};if(k!=null)for(var x in k)x!=="default"&&Object.prototype.hasOwnProperty.call(k,x)&&l(C,k,x);return u(C,k),C};Object.defineProperty(c,"__esModule",{value:!0}),c.Edge11=void 0;const f=o(2994),g=o(4893),p=h(o(1765)),d=h(o(8046)),m=h(o(8751)),E=o(521),S=new f.Logger("Edge11");class R extends E.HandlerInterface{static createFactory(){return()=>new R}constructor(){super(),this._rtpSenders=new Map,this._rtpReceivers=new Map,this._nextSendLocalId=0,this._transportReady=!1}get name(){return"Edge11"}close(){S.debug("close()");try{this._iceGatherer.close()}catch{}try{this._iceTransport.stop()}catch{}try{this._dtlsTransport.stop()}catch{}for(const C of this._rtpSenders.values())try{C.stop()}catch{}for(const C of this._rtpReceivers.values())try{C.stop()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){return S.debug("getNativeRtpCapabilities()"),m.getCapabilities()}async getNativeSctpCapabilities(){return S.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({direction:C,iceParameters:x,iceCandidates:P,dtlsParameters:D,sctpParameters:b,iceServers:w,iceTransportPolicy:v,additionalSettings:_,proprietaryConstraints:y,extendedRtpCapabilities:T}){S.debug("run()"),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",T),video:d.getSendingRtpParameters("video",T)},this._remoteIceParameters=x,this._remoteIceCandidates=P,this._remoteDtlsParameters=D,this._cname=`CNAME-${p.generateRandomNumber()}`,this.setIceGatherer({iceServers:w,iceTransportPolicy:v}),this.setIceTransport(),this.setDtlsTransport()}async updateIceServers(C){throw new g.UnsupportedError("not supported")}async restartIce(C){if(S.debug("restartIce()"),this._remoteIceParameters=C,this._transportReady){S.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,C,"controlling");for(const x of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(x);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:C,encodings:x,codecOptions:P,codec:D}){S.debug("send() [kind:%s, track.id:%s]",C.kind,C.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),S.debug("send() | calling new RTCRtpSender()");const b=new RTCRtpSender(C,this._dtlsTransport),w=p.clone(this._sendingRtpParametersByKind[C.kind]);w.codecs=d.reduceCodecs(w.codecs,D);const v=w.codecs.some(T=>/.+\/rtx$/i.test(T.mimeType));x||(x=[{}]);for(const T of x)T.ssrc=p.generateRandomNumber(),v&&(T.rtx={ssrc:p.generateRandomNumber()});w.encodings=x,w.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const _=m.mangleRtpParameters(w);S.debug("send() | calling rtpSender.send() [params:%o]",_),await b.send(_);const y=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(y,b),{localId:y,rtpParameters:w,rtpSender:b}}async stopSending(C){S.debug("stopSending() [localId:%s]",C);const x=this._rtpSenders.get(C);if(!x)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(C);try{S.debug("stopSending() | calling rtpSender.stop()"),x.stop()}catch(P){throw S.warn("stopSending() | rtpSender.stop() failed:%o",P),P}}async pauseSending(C){}async resumeSending(C){}async replaceTrack(C,x){x?S.debug("replaceTrack() [localId:%s, track.id:%s]",C,x.id):S.debug("replaceTrack() [localId:%s, no track]",C);const P=this._rtpSenders.get(C);if(!P)throw new Error("RTCRtpSender not found");P.setTrack(x)}async setMaxSpatialLayer(C,x){S.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",C,x);const P=this._rtpSenders.get(C);if(!P)throw new Error("RTCRtpSender not found");const D=P.getParameters();D.encodings.forEach((b,w)=>{b.active=w<=x}),await P.setParameters(D)}async setRtpEncodingParameters(C,x){S.debug("setRtpEncodingParameters() [localId:%s, params:%o]",C,x);const P=this._rtpSenders.get(C);if(!P)throw new Error("RTCRtpSender not found");const D=P.getParameters();D.encodings.forEach((b,w)=>{D.encodings[w]={...b,...x}}),await P.setParameters(D)}async getSenderStats(C){const x=this._rtpSenders.get(C);if(!x)throw new Error("RTCRtpSender not found");return x.getStats()}async sendDataChannel(C){throw new g.UnsupportedError("not implemented")}async receive(C){const x=[];for(const P of C){const{trackId:D,kind:b}=P;S.debug("receive() [trackId:%s, kind:%s]",D,b)}this._transportReady||await this.setupTransport({localDtlsRole:"server"});for(const P of C){const{trackId:D,kind:b,rtpParameters:w}=P;S.debug("receive() | calling new RTCRtpReceiver()");const v=new RTCRtpReceiver(this._dtlsTransport,b);v.addEventListener("error",T=>{S.error('rtpReceiver "error" event [event:%o]',T)});const _=m.mangleRtpParameters(w);S.debug("receive() | calling rtpReceiver.receive() [params:%o]",_),await v.receive(_);const y=D;this._rtpReceivers.set(y,v),x.push({localId:y,track:v.track,rtpReceiver:v})}return x}async stopReceiving(C){for(const x of C){S.debug("stopReceiving() [localId:%s]",x);const P=this._rtpReceivers.get(x);if(!P)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(x);try{S.debug("stopReceiving() | calling rtpReceiver.stop()"),P.stop()}catch(D){S.warn("stopReceiving() | rtpReceiver.stop() failed:%o",D)}}}async pauseReceiving(C){}async resumeReceiving(C){}async getReceiverStats(C){const x=this._rtpReceivers.get(C);if(!x)throw new Error("RTCRtpReceiver not found");return x.getStats()}async receiveDataChannel(C){throw new g.UnsupportedError("not implemented")}setIceGatherer({iceServers:C,iceTransportPolicy:x}){const P=new RTCIceGatherer({iceServers:C||[],gatherPolicy:x||"all"});P.addEventListener("error",D=>{S.error('iceGatherer "error" event [event:%o]',D)});try{P.gather()}catch(D){S.debug("setIceGatherer() | iceGatherer.gather() failed: %s",D.toString())}this._iceGatherer=P}setIceTransport(){const C=new RTCIceTransport(this._iceGatherer);C.addEventListener("statechange",()=>{switch(C.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}),C.addEventListener("icestatechange",()=>{switch(C.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}),C.addEventListener("candidatepairchange",x=>{S.debug('iceTransport "candidatepairchange" event [pair:%o]',x.pair)}),this._iceTransport=C}setDtlsTransport(){const C=new RTCDtlsTransport(this._iceTransport);C.addEventListener("statechange",()=>{S.debug('dtlsTransport "statechange" event [state:%s]',C.state)}),C.addEventListener("dtlsstatechange",()=>{S.debug('dtlsTransport "dtlsstatechange" event [state:%s]',C.state),C.state==="closed"&&this.emit("@connectionstatechange","closed")}),C.addEventListener("error",x=>{S.error('dtlsTransport "error" event [event:%o]',x)}),this._dtlsTransport=C}async setupTransport({localDtlsRole:C}){S.debug("setupTransport()");const x=this._dtlsTransport.getLocalParameters();x.role=C,await new Promise((P,D)=>{this.safeEmit("@connect",{dtlsParameters:x},P,D)}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const P of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(P);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(P=>P.algorithm==="sha-256"||P.algorithm==="sha-384"||P.algorithm==="sha-512"),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}}c.Edge11=R},2292:function(a,c,o){var l=this&&this.__createBinding||(Object.create?function(b,w,v,_){_===void 0&&(_=v);var y=Object.getOwnPropertyDescriptor(w,v);y&&!("get"in y?!w.__esModule:y.writable||y.configurable)||(y={enumerable:!0,get:function(){return w[v]}}),Object.defineProperty(b,_,y)}:function(b,w,v,_){_===void 0&&(_=v),b[_]=w[v]}),u=this&&this.__setModuleDefault||(Object.create?function(b,w){Object.defineProperty(b,"default",{enumerable:!0,value:w})}:function(b,w){b.default=w}),h=this&&this.__importStar||function(b){if(b&&b.__esModule)return b;var w={};if(b!=null)for(var v in b)v!=="default"&&Object.prototype.hasOwnProperty.call(b,v)&&l(w,b,v);return u(w,b),w};Object.defineProperty(c,"__esModule",{value:!0}),c.Firefox120=void 0;const f=h(o(7363)),g=o(2994),p=o(4893),d=h(o(1765)),m=h(o(8046)),E=h(o(5544)),S=h(o(5938)),R=o(521),k=o(1305),C=o(3303),x=new g.Logger("Firefox120"),P={OS:16,MIS:2048};class D extends R.HandlerInterface{static createFactory(){return()=>new D}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Firefox120"}close(){if(x.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){x.debug("getNativeRtpCapabilities()");const w=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),v=document.createElement("canvas");v.getContext("2d");const _=v.captureStream().getVideoTracks()[0];try{w.addTransceiver("audio",{direction:"sendrecv"}),w.addTransceiver(_,{direction:"sendrecv",sendEncodings:[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}]});const y=await w.createOffer();try{v.remove()}catch{}try{_.stop()}catch{}try{w.close()}catch{}const T=f.parse(y.sdp);return E.extractRtpCapabilities({sdpObject:T})}catch(y){try{v.remove()}catch{}try{_.stop()}catch{}try{w.close()}catch{}throw y}}async getNativeSctpCapabilities(){return x.debug("getNativeSctpCapabilities()"),{numStreams:P}}run({direction:w,iceParameters:v,iceCandidates:_,dtlsParameters:y,sctpParameters:T,iceServers:L,iceTransportPolicy:I,additionalSettings:N,proprietaryConstraints:M,extendedRtpCapabilities:U}){this.assertNotClosed(),x.debug("run()"),this._direction=w,this._remoteSdp=new k.RemoteSdp({iceParameters:v,iceCandidates:_,dtlsParameters:y,sctpParameters:T}),this._sendingRtpParametersByKind={audio:m.getSendingRtpParameters("audio",U),video:m.getSendingRtpParameters("video",U)},this._sendingRemoteRtpParametersByKind={audio:m.getSendingRemoteRtpParameters("audio",U),video:m.getSendingRemoteRtpParameters("video",U)},this._pc=new RTCPeerConnection({iceServers:L||[],iceTransportPolicy:I||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...N},M),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(x.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(w){throw this.assertNotClosed(),new p.UnsupportedError("not supported")}async restartIce(w){if(this.assertNotClosed(),x.debug("restartIce()"),this._remoteSdp.updateIceParameters(w),this._transportReady)if(this._direction==="send"){const v=await this._pc.createOffer({iceRestart:!0});x.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",v),await this._pc.setLocalDescription(v);const _={type:"answer",sdp:this._remoteSdp.getSdp()};x.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_)}else{const v={type:"offer",sdp:this._remoteSdp.getSdp()};x.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",v),await this._pc.setRemoteDescription(v);const _=await this._pc.createAnswer();x.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",_),await this._pc.setLocalDescription(_)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:w,encodings:v,codecOptions:_,codec:y}){this.assertNotClosed(),this.assertSendDirection(),x.debug("send() [kind:%s, track.id:%s]",w.kind,w.id),v&&v.length>1&&v.forEach((he,re)=>{he.rid=`r${re}`});const T=d.clone(this._sendingRtpParametersByKind[w.kind]);T.codecs=m.reduceCodecs(T.codecs,y);const L=d.clone(this._sendingRemoteRtpParametersByKind[w.kind]);L.codecs=m.reduceCodecs(L.codecs,y);const I=this._pc.addTransceiver(w,{direction:"sendonly",streams:[this._sendStream],sendEncodings:v}),N=await this._pc.createOffer();let M=f.parse(N.sdp);this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:M});const U=(0,C.parse)((v||[{}])[0].scalabilityMode);x.debug("send() | calling pc.setLocalDescription() [offer:%o]",N),await this._pc.setLocalDescription(N);const j=I.mid;T.mid=j,M=f.parse(this._pc.localDescription.sdp);const Q=M.media[M.media.length-1];if(T.rtcp.cname=E.getCname({offerMediaObject:Q}),v)if(v.length===1){const he=S.getRtpEncodings({offerMediaObject:Q});Object.assign(he[0],v[0]),T.encodings=he}else T.encodings=v;else T.encodings=S.getRtpEncodings({offerMediaObject:Q});if(T.encodings.length>1&&(T.codecs[0].mimeType.toLowerCase()==="video/vp8"||T.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const he of T.encodings)he.scalabilityMode?he.scalabilityMode=`L1T${U.temporalLayers}`:he.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:Q,offerRtpParameters:T,answerRtpParameters:L,codecOptions:_,extmapAllowMixed:!0});const Y={type:"answer",sdp:this._remoteSdp.getSdp()};return x.debug("send() | calling pc.setRemoteDescription() [answer:%o]",Y),await this._pc.setRemoteDescription(Y),this._mapMidTransceiver.set(j,I),{localId:j,rtpParameters:T,rtpSender:I.sender}}async stopSending(w){if(this.assertSendDirection(),x.debug("stopSending() [localId:%s]",w),this._closed)return;const v=this._mapMidTransceiver.get(w);if(!v)throw new Error("associated transceiver not found");v.sender.replaceTrack(null),this._pc.removeTrack(v.sender),this._remoteSdp.disableMediaSection(v.mid);const _=await this._pc.createOffer();x.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",_),await this._pc.setLocalDescription(_);const y={type:"answer",sdp:this._remoteSdp.getSdp()};x.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y),this._mapMidTransceiver.delete(w)}async pauseSending(w){this.assertNotClosed(),this.assertSendDirection(),x.debug("pauseSending() [localId:%s]",w);const v=this._mapMidTransceiver.get(w);if(!v)throw new Error("associated RTCRtpTransceiver not found");v.direction="inactive",this._remoteSdp.pauseMediaSection(w);const _=await this._pc.createOffer();x.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",_),await this._pc.setLocalDescription(_);const y={type:"answer",sdp:this._remoteSdp.getSdp()};x.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y)}async resumeSending(w){this.assertNotClosed(),this.assertSendDirection(),x.debug("resumeSending() [localId:%s]",w);const v=this._mapMidTransceiver.get(w);if(!v)throw new Error("associated RTCRtpTransceiver not found");v.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(w);const _=await this._pc.createOffer();x.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",_),await this._pc.setLocalDescription(_);const y={type:"answer",sdp:this._remoteSdp.getSdp()};x.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y)}async replaceTrack(w,v){this.assertNotClosed(),this.assertSendDirection(),v?x.debug("replaceTrack() [localId:%s, track.id:%s]",w,v.id):x.debug("replaceTrack() [localId:%s, no track]",w);const _=this._mapMidTransceiver.get(w);if(!_)throw new Error("associated RTCRtpTransceiver not found");await _.sender.replaceTrack(v)}async setMaxSpatialLayer(w,v){this.assertNotClosed(),this.assertSendDirection(),x.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",w,v);const _=this._mapMidTransceiver.get(w);if(!_)throw new Error("associated transceiver not found");const y=_.sender.getParameters();y.encodings.forEach((I,N)=>{I.active=N<=v}),await _.sender.setParameters(y),this._remoteSdp.muxMediaSectionSimulcast(w,y.encodings);const T=await this._pc.createOffer();x.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",T),await this._pc.setLocalDescription(T);const L={type:"answer",sdp:this._remoteSdp.getSdp()};x.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",L),await this._pc.setRemoteDescription(L)}async setRtpEncodingParameters(w,v){this.assertNotClosed(),this.assertSendDirection(),x.debug("setRtpEncodingParameters() [localId:%s, params:%o]",w,v);const _=this._mapMidTransceiver.get(w);if(!_)throw new Error("associated RTCRtpTransceiver not found");const y=_.sender.getParameters();y.encodings.forEach((I,N)=>{y.encodings[N]={...I,...v}}),await _.sender.setParameters(y),this._remoteSdp.muxMediaSectionSimulcast(w,y.encodings);const T=await this._pc.createOffer();x.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",T),await this._pc.setLocalDescription(T);const L={type:"answer",sdp:this._remoteSdp.getSdp()};x.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",L),await this._pc.setRemoteDescription(L)}async getSenderStats(w){this.assertNotClosed(),this.assertSendDirection();const v=this._mapMidTransceiver.get(w);if(!v)throw new Error("associated RTCRtpTransceiver not found");return v.sender.getStats()}async sendDataChannel({ordered:w,maxPacketLifeTime:v,maxRetransmits:_,label:y,protocol:T}){this.assertNotClosed(),this.assertSendDirection();const L={negotiated:!0,id:this._nextSendSctpStreamId,ordered:w,maxPacketLifeTime:v,maxRetransmits:_,protocol:T};x.debug("sendDataChannel() [options:%o]",L);const I=this._pc.createDataChannel(y,L);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%P.MIS,!this._hasDataChannelMediaSection){const N=await this._pc.createOffer(),M=f.parse(N.sdp),U=M.media.find(Q=>Q.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:M}),x.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",N),await this._pc.setLocalDescription(N),this._remoteSdp.sendSctpAssociation({offerMediaObject:U});const j={type:"answer",sdp:this._remoteSdp.getSdp()};x.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j),this._hasDataChannelMediaSection=!0}return{dataChannel:I,sctpStreamParameters:{streamId:L.id,ordered:L.ordered,maxPacketLifeTime:L.maxPacketLifeTime,maxRetransmits:L.maxRetransmits}}}async receive(w){this.assertNotClosed(),this.assertRecvDirection();const v=[],_=new Map;for(const I of w){const{trackId:N,kind:M,rtpParameters:U,streamId:j}=I;x.debug("receive() [trackId:%s, kind:%s]",N,M);const Q=U.mid||String(this._mapMidTransceiver.size);_.set(N,Q),this._remoteSdp.receive({mid:Q,kind:M,offerRtpParameters:U,streamId:j||U.rtcp.cname,trackId:N})}const y={type:"offer",sdp:this._remoteSdp.getSdp()};x.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",y),await this._pc.setRemoteDescription(y);let T=await this._pc.createAnswer();const L=f.parse(T.sdp);for(const I of w){const{trackId:N,rtpParameters:M}=I,U=_.get(N),j=L.media.find(Q=>String(Q.mid)===U);E.applyCodecParameters({offerRtpParameters:M,answerMediaObject:j}),T={type:"answer",sdp:f.write(L)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:L}),x.debug("receive() | calling pc.setLocalDescription() [answer:%o]",T),await this._pc.setLocalDescription(T);for(const I of w){const{trackId:N}=I,M=_.get(N),U=this._pc.getTransceivers().find(j=>j.mid===M);if(!U)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(M,U),v.push({localId:M,track:U.receiver.track,rtpReceiver:U.receiver})}return v}async stopReceiving(w){if(this.assertRecvDirection(),this._closed)return;for(const y of w){x.debug("stopReceiving() [localId:%s]",y);const T=this._mapMidTransceiver.get(y);if(!T)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(T.mid)}const v={type:"offer",sdp:this._remoteSdp.getSdp()};x.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",v),await this._pc.setRemoteDescription(v);const _=await this._pc.createAnswer();x.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",_),await this._pc.setLocalDescription(_);for(const y of w)this._mapMidTransceiver.delete(y)}async pauseReceiving(w){this.assertNotClosed(),this.assertRecvDirection();for(const y of w){x.debug("pauseReceiving() [localId:%s]",y);const T=this._mapMidTransceiver.get(y);if(!T)throw new Error("associated RTCRtpTransceiver not found");T.direction="inactive",this._remoteSdp.pauseMediaSection(y)}const v={type:"offer",sdp:this._remoteSdp.getSdp()};x.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",v),await this._pc.setRemoteDescription(v);const _=await this._pc.createAnswer();x.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",_),await this._pc.setLocalDescription(_)}async resumeReceiving(w){this.assertNotClosed(),this.assertRecvDirection();for(const y of w){x.debug("resumeReceiving() [localId:%s]",y);const T=this._mapMidTransceiver.get(y);if(!T)throw new Error("associated RTCRtpTransceiver not found");T.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(y)}const v={type:"offer",sdp:this._remoteSdp.getSdp()};x.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",v),await this._pc.setRemoteDescription(v);const _=await this._pc.createAnswer();x.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",_),await this._pc.setLocalDescription(_)}async getReceiverStats(w){this.assertRecvDirection();const v=this._mapMidTransceiver.get(w);if(!v)throw new Error("associated RTCRtpTransceiver not found");return v.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:w,label:v,protocol:_}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:y,ordered:T,maxPacketLifeTime:L,maxRetransmits:I}=w,N={negotiated:!0,id:y,ordered:T,maxPacketLifeTime:L,maxRetransmits:I,protocol:_};x.debug("receiveDataChannel() [options:%o]",N);const M=this._pc.createDataChannel(v,N);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const U={type:"offer",sdp:this._remoteSdp.getSdp()};x.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",U),await this._pc.setRemoteDescription(U);const j=await this._pc.createAnswer();if(!this._transportReady){const Q=f.parse(j.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:Q})}x.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setLocalDescription(j),this._hasDataChannelMediaSection=!0}return{dataChannel:M}}async setupTransport({localDtlsRole:w,localSdpObject:v}){v||(v=f.parse(this._pc.localDescription.sdp));const _=E.extractDtlsParameters({sdpObject:v});_.role=w,this._remoteSdp.updateDtlsRole(w==="client"?"server":"client"),await new Promise((y,T)=>{this.safeEmit("@connect",{dtlsParameters:_},y,T)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new p.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}c.Firefox120=D},1767:function(a,c,o){var l=this&&this.__createBinding||(Object.create?function(b,w,v,_){_===void 0&&(_=v);var y=Object.getOwnPropertyDescriptor(w,v);y&&!("get"in y?!w.__esModule:y.writable||y.configurable)||(y={enumerable:!0,get:function(){return w[v]}}),Object.defineProperty(b,_,y)}:function(b,w,v,_){_===void 0&&(_=v),b[_]=w[v]}),u=this&&this.__setModuleDefault||(Object.create?function(b,w){Object.defineProperty(b,"default",{enumerable:!0,value:w})}:function(b,w){b.default=w}),h=this&&this.__importStar||function(b){if(b&&b.__esModule)return b;var w={};if(b!=null)for(var v in b)v!=="default"&&Object.prototype.hasOwnProperty.call(b,v)&&l(w,b,v);return u(w,b),w};Object.defineProperty(c,"__esModule",{value:!0}),c.Firefox60=void 0;const f=h(o(7363)),g=o(2994),p=o(4893),d=h(o(1765)),m=h(o(8046)),E=h(o(5544)),S=h(o(5938)),R=o(521),k=o(1305),C=o(3303),x=new g.Logger("Firefox60"),P={OS:16,MIS:2048};class D extends R.HandlerInterface{static createFactory(){return()=>new D}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Firefox60"}close(){if(x.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){x.debug("getNativeRtpCapabilities()");const w=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),v=document.createElement("canvas");v.getContext("2d");const _=v.captureStream().getVideoTracks()[0];try{w.addTransceiver("audio",{direction:"sendrecv"});const y=w.addTransceiver(_,{direction:"sendrecv"}),T=y.sender.getParameters(),L=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];T.encodings=L,await y.sender.setParameters(T);const I=await w.createOffer();try{v.remove()}catch{}try{_.stop()}catch{}try{w.close()}catch{}const N=f.parse(I.sdp);return E.extractRtpCapabilities({sdpObject:N})}catch(y){try{v.remove()}catch{}try{_.stop()}catch{}try{w.close()}catch{}throw y}}async getNativeSctpCapabilities(){return x.debug("getNativeSctpCapabilities()"),{numStreams:P}}run({direction:w,iceParameters:v,iceCandidates:_,dtlsParameters:y,sctpParameters:T,iceServers:L,iceTransportPolicy:I,additionalSettings:N,proprietaryConstraints:M,extendedRtpCapabilities:U}){this.assertNotClosed(),x.debug("run()"),this._direction=w,this._remoteSdp=new k.RemoteSdp({iceParameters:v,iceCandidates:_,dtlsParameters:y,sctpParameters:T}),this._sendingRtpParametersByKind={audio:m.getSendingRtpParameters("audio",U),video:m.getSendingRtpParameters("video",U)},this._sendingRemoteRtpParametersByKind={audio:m.getSendingRemoteRtpParameters("audio",U),video:m.getSendingRemoteRtpParameters("video",U)},this._pc=new RTCPeerConnection({iceServers:L||[],iceTransportPolicy:I||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...N},M),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(x.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(w){throw this.assertNotClosed(),new p.UnsupportedError("not supported")}async restartIce(w){if(this.assertNotClosed(),x.debug("restartIce()"),this._remoteSdp.updateIceParameters(w),this._transportReady)if(this._direction==="send"){const v=await this._pc.createOffer({iceRestart:!0});x.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",v),await this._pc.setLocalDescription(v);const _={type:"answer",sdp:this._remoteSdp.getSdp()};x.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_)}else{const v={type:"offer",sdp:this._remoteSdp.getSdp()};x.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",v),await this._pc.setRemoteDescription(v);const _=await this._pc.createAnswer();x.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",_),await this._pc.setLocalDescription(_)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:w,encodings:v,codecOptions:_,codec:y}){this.assertNotClosed(),this.assertSendDirection(),x.debug("send() [kind:%s, track.id:%s]",w.kind,w.id),v&&(v=d.clone(v)).length>1&&(v.forEach((he,re)=>{he.rid=`r${re}`}),v.reverse());const T=d.clone(this._sendingRtpParametersByKind[w.kind]);T.codecs=m.reduceCodecs(T.codecs,y);const L=d.clone(this._sendingRemoteRtpParametersByKind[w.kind]);L.codecs=m.reduceCodecs(L.codecs,y);const I=this._pc.addTransceiver(w,{direction:"sendonly",streams:[this._sendStream]});if(v){const he=I.sender.getParameters();he.encodings=v,await I.sender.setParameters(he)}const N=await this._pc.createOffer();let M=f.parse(N.sdp);this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:M});const U=(0,C.parse)((v||[{}])[0].scalabilityMode);x.debug("send() | calling pc.setLocalDescription() [offer:%o]",N),await this._pc.setLocalDescription(N);const j=I.mid;T.mid=j,M=f.parse(this._pc.localDescription.sdp);const Q=M.media[M.media.length-1];if(T.rtcp.cname=E.getCname({offerMediaObject:Q}),v)if(v.length===1){const he=S.getRtpEncodings({offerMediaObject:Q});Object.assign(he[0],v[0]),T.encodings=he}else T.encodings=v.reverse();else T.encodings=S.getRtpEncodings({offerMediaObject:Q});if(T.encodings.length>1&&(T.codecs[0].mimeType.toLowerCase()==="video/vp8"||T.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const he of T.encodings)he.scalabilityMode?he.scalabilityMode=`L1T${U.temporalLayers}`:he.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:Q,offerRtpParameters:T,answerRtpParameters:L,codecOptions:_,extmapAllowMixed:!0});const Y={type:"answer",sdp:this._remoteSdp.getSdp()};return x.debug("send() | calling pc.setRemoteDescription() [answer:%o]",Y),await this._pc.setRemoteDescription(Y),this._mapMidTransceiver.set(j,I),{localId:j,rtpParameters:T,rtpSender:I.sender}}async stopSending(w){if(this.assertSendDirection(),x.debug("stopSending() [localId:%s]",w),this._closed)return;const v=this._mapMidTransceiver.get(w);if(!v)throw new Error("associated transceiver not found");v.sender.replaceTrack(null),this._pc.removeTrack(v.sender),this._remoteSdp.disableMediaSection(v.mid);const _=await this._pc.createOffer();x.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",_),await this._pc.setLocalDescription(_);const y={type:"answer",sdp:this._remoteSdp.getSdp()};x.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y),this._mapMidTransceiver.delete(w)}async pauseSending(w){this.assertNotClosed(),this.assertSendDirection(),x.debug("pauseSending() [localId:%s]",w);const v=this._mapMidTransceiver.get(w);if(!v)throw new Error("associated RTCRtpTransceiver not found");v.direction="inactive",this._remoteSdp.pauseMediaSection(w);const _=await this._pc.createOffer();x.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",_),await this._pc.setLocalDescription(_);const y={type:"answer",sdp:this._remoteSdp.getSdp()};x.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y)}async resumeSending(w){this.assertNotClosed(),this.assertSendDirection(),x.debug("resumeSending() [localId:%s]",w);const v=this._mapMidTransceiver.get(w);if(!v)throw new Error("associated RTCRtpTransceiver not found");v.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(w);const _=await this._pc.createOffer();x.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",_),await this._pc.setLocalDescription(_);const y={type:"answer",sdp:this._remoteSdp.getSdp()};x.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y)}async replaceTrack(w,v){this.assertNotClosed(),this.assertSendDirection(),v?x.debug("replaceTrack() [localId:%s, track.id:%s]",w,v.id):x.debug("replaceTrack() [localId:%s, no track]",w);const _=this._mapMidTransceiver.get(w);if(!_)throw new Error("associated RTCRtpTransceiver not found");await _.sender.replaceTrack(v)}async setMaxSpatialLayer(w,v){this.assertNotClosed(),this.assertSendDirection(),x.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",w,v);const _=this._mapMidTransceiver.get(w);if(!_)throw new Error("associated transceiver not found");const y=_.sender.getParameters();v=y.encodings.length-1-v,y.encodings.forEach((I,N)=>{I.active=N>=v}),await _.sender.setParameters(y),this._remoteSdp.muxMediaSectionSimulcast(w,y.encodings);const T=await this._pc.createOffer();x.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",T),await this._pc.setLocalDescription(T);const L={type:"answer",sdp:this._remoteSdp.getSdp()};x.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",L),await this._pc.setRemoteDescription(L)}async setRtpEncodingParameters(w,v){this.assertNotClosed(),this.assertSendDirection(),x.debug("setRtpEncodingParameters() [localId:%s, params:%o]",w,v);const _=this._mapMidTransceiver.get(w);if(!_)throw new Error("associated RTCRtpTransceiver not found");const y=_.sender.getParameters();y.encodings.forEach((I,N)=>{y.encodings[N]={...I,...v}}),await _.sender.setParameters(y),this._remoteSdp.muxMediaSectionSimulcast(w,y.encodings);const T=await this._pc.createOffer();x.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",T),await this._pc.setLocalDescription(T);const L={type:"answer",sdp:this._remoteSdp.getSdp()};x.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",L),await this._pc.setRemoteDescription(L)}async getSenderStats(w){this.assertNotClosed(),this.assertSendDirection();const v=this._mapMidTransceiver.get(w);if(!v)throw new Error("associated RTCRtpTransceiver not found");return v.sender.getStats()}async sendDataChannel({ordered:w,maxPacketLifeTime:v,maxRetransmits:_,label:y,protocol:T}){this.assertNotClosed(),this.assertSendDirection();const L={negotiated:!0,id:this._nextSendSctpStreamId,ordered:w,maxPacketLifeTime:v,maxRetransmits:_,protocol:T};x.debug("sendDataChannel() [options:%o]",L);const I=this._pc.createDataChannel(y,L);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%P.MIS,!this._hasDataChannelMediaSection){const N=await this._pc.createOffer(),M=f.parse(N.sdp),U=M.media.find(Q=>Q.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:M}),x.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",N),await this._pc.setLocalDescription(N),this._remoteSdp.sendSctpAssociation({offerMediaObject:U});const j={type:"answer",sdp:this._remoteSdp.getSdp()};x.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j),this._hasDataChannelMediaSection=!0}return{dataChannel:I,sctpStreamParameters:{streamId:L.id,ordered:L.ordered,maxPacketLifeTime:L.maxPacketLifeTime,maxRetransmits:L.maxRetransmits}}}async receive(w){this.assertNotClosed(),this.assertRecvDirection();const v=[],_=new Map;for(const I of w){const{trackId:N,kind:M,rtpParameters:U,streamId:j}=I;x.debug("receive() [trackId:%s, kind:%s]",N,M);const Q=U.mid||String(this._mapMidTransceiver.size);_.set(N,Q),this._remoteSdp.receive({mid:Q,kind:M,offerRtpParameters:U,streamId:j||U.rtcp.cname,trackId:N})}const y={type:"offer",sdp:this._remoteSdp.getSdp()};x.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",y),await this._pc.setRemoteDescription(y);let T=await this._pc.createAnswer();const L=f.parse(T.sdp);for(const I of w){const{trackId:N,rtpParameters:M}=I,U=_.get(N),j=L.media.find(Q=>String(Q.mid)===U);E.applyCodecParameters({offerRtpParameters:M,answerMediaObject:j}),T={type:"answer",sdp:f.write(L)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:L}),x.debug("receive() | calling pc.setLocalDescription() [answer:%o]",T),await this._pc.setLocalDescription(T);for(const I of w){const{trackId:N}=I,M=_.get(N),U=this._pc.getTransceivers().find(j=>j.mid===M);if(!U)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(M,U),v.push({localId:M,track:U.receiver.track,rtpReceiver:U.receiver})}return v}async stopReceiving(w){if(this.assertRecvDirection(),this._closed)return;for(const y of w){x.debug("stopReceiving() [localId:%s]",y);const T=this._mapMidTransceiver.get(y);if(!T)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(T.mid)}const v={type:"offer",sdp:this._remoteSdp.getSdp()};x.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",v),await this._pc.setRemoteDescription(v);const _=await this._pc.createAnswer();x.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",_),await this._pc.setLocalDescription(_);for(const y of w)this._mapMidTransceiver.delete(y)}async pauseReceiving(w){this.assertNotClosed(),this.assertRecvDirection();for(const y of w){x.debug("pauseReceiving() [localId:%s]",y);const T=this._mapMidTransceiver.get(y);if(!T)throw new Error("associated RTCRtpTransceiver not found");T.direction="inactive",this._remoteSdp.pauseMediaSection(y)}const v={type:"offer",sdp:this._remoteSdp.getSdp()};x.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",v),await this._pc.setRemoteDescription(v);const _=await this._pc.createAnswer();x.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",_),await this._pc.setLocalDescription(_)}async resumeReceiving(w){this.assertNotClosed(),this.assertRecvDirection();for(const y of w){x.debug("resumeReceiving() [localId:%s]",y);const T=this._mapMidTransceiver.get(y);if(!T)throw new Error("associated RTCRtpTransceiver not found");T.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(y)}const v={type:"offer",sdp:this._remoteSdp.getSdp()};x.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",v),await this._pc.setRemoteDescription(v);const _=await this._pc.createAnswer();x.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",_),await this._pc.setLocalDescription(_)}async getReceiverStats(w){this.assertRecvDirection();const v=this._mapMidTransceiver.get(w);if(!v)throw new Error("associated RTCRtpTransceiver not found");return v.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:w,label:v,protocol:_}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:y,ordered:T,maxPacketLifeTime:L,maxRetransmits:I}=w,N={negotiated:!0,id:y,ordered:T,maxPacketLifeTime:L,maxRetransmits:I,protocol:_};x.debug("receiveDataChannel() [options:%o]",N);const M=this._pc.createDataChannel(v,N);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const U={type:"offer",sdp:this._remoteSdp.getSdp()};x.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",U),await this._pc.setRemoteDescription(U);const j=await this._pc.createAnswer();if(!this._transportReady){const Q=f.parse(j.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:Q})}x.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setLocalDescription(j),this._hasDataChannelMediaSection=!0}return{dataChannel:M}}async setupTransport({localDtlsRole:w,localSdpObject:v}){v||(v=f.parse(this._pc.localDescription.sdp));const _=E.extractDtlsParameters({sdpObject:v});_.role=w,this._remoteSdp.updateDtlsRole(w==="client"?"server":"client"),await new Promise((y,T)=>{this.safeEmit("@connect",{dtlsParameters:_},y,T)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new p.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}c.Firefox60=D},521:(a,c,o)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.HandlerInterface=void 0;const l=o(2010);class u extends l.EnhancedEventEmitter{constructor(){super()}}c.HandlerInterface=u},9352:function(a,c,o){var l=this&&this.__createBinding||(Object.create?function(D,b,w,v){v===void 0&&(v=w);var _=Object.getOwnPropertyDescriptor(b,w);_&&!("get"in _?!b.__esModule:_.writable||_.configurable)||(_={enumerable:!0,get:function(){return b[w]}}),Object.defineProperty(D,v,_)}:function(D,b,w,v){v===void 0&&(v=w),D[v]=b[w]}),u=this&&this.__setModuleDefault||(Object.create?function(D,b){Object.defineProperty(D,"default",{enumerable:!0,value:b})}:function(D,b){D.default=b}),h=this&&this.__importStar||function(D){if(D&&D.__esModule)return D;var b={};if(D!=null)for(var w in D)w!=="default"&&Object.prototype.hasOwnProperty.call(D,w)&&l(b,D,w);return u(b,D),b};Object.defineProperty(c,"__esModule",{value:!0}),c.ReactNative=void 0;const f=h(o(7363)),g=o(2994),p=o(4893),d=h(o(1765)),m=h(o(8046)),E=h(o(5544)),S=h(o(4496)),R=o(521),k=o(1305),C=new g.Logger("ReactNative"),x={OS:1024,MIS:1024};class P extends R.HandlerInterface{static createFactory(){return()=>new P}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"ReactNative"}close(){if(C.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){C.debug("getNativeRtpCapabilities()");const b=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const w=await b.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{b.close()}catch{}const v=f.parse(w.sdp);return E.extractRtpCapabilities({sdpObject:v})}catch(w){try{b.close()}catch{}throw w}}async getNativeSctpCapabilities(){return C.debug("getNativeSctpCapabilities()"),{numStreams:x}}run({direction:b,iceParameters:w,iceCandidates:v,dtlsParameters:_,sctpParameters:y,iceServers:T,iceTransportPolicy:L,additionalSettings:I,proprietaryConstraints:N,extendedRtpCapabilities:M}){C.debug("run()"),this._direction=b,this._remoteSdp=new k.RemoteSdp({iceParameters:w,iceCandidates:v,dtlsParameters:_,sctpParameters:y,planB:!0}),this._sendingRtpParametersByKind={audio:m.getSendingRtpParameters("audio",M),video:m.getSendingRtpParameters("video",M)},this._sendingRemoteRtpParametersByKind={audio:m.getSendingRemoteRtpParameters("audio",M),video:m.getSendingRemoteRtpParameters("video",M)},_.role&&_.role!=="auto"&&(this._forcedLocalDtlsRole=_.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:T||[],iceTransportPolicy:L||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...I},N),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(C.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(b){C.debug("updateIceServers()");const w=this._pc.getConfiguration();w.iceServers=b,this._pc.setConfiguration(w)}async restartIce(b){if(C.debug("restartIce()"),this._remoteSdp.updateIceParameters(b),this._transportReady)if(this._direction==="send"){const w=await this._pc.createOffer({iceRestart:!0});C.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",w),await this._pc.setLocalDescription(w);const v={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}else{const w={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",w),await this._pc.setRemoteDescription(w);const v=await this._pc.createAnswer();C.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",v),await this._pc.setLocalDescription(v)}}async getTransportStats(){return this._pc.getStats()}async send({track:b,encodings:w,codecOptions:v,codec:_}){this.assertSendDirection(),C.debug("send() [kind:%s, track.id:%s]",b.kind,b.id),_&&C.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(b),this._pc.addStream(this._sendStream);let y,T=await this._pc.createOffer(),L=f.parse(T.sdp);const I=d.clone(this._sendingRtpParametersByKind[b.kind]);I.codecs=m.reduceCodecs(I.codecs);const N=d.clone(this._sendingRemoteRtpParametersByKind[b.kind]);if(N.codecs=m.reduceCodecs(N.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:L}),b.kind==="video"&&w&&w.length>1&&(C.debug("send() | enabling simulcast"),L=f.parse(T.sdp),y=L.media.find(j=>j.type==="video"),S.addLegacySimulcast({offerMediaObject:y,track:b,numStreams:w.length}),T={type:"offer",sdp:f.write(L)}),C.debug("send() | calling pc.setLocalDescription() [offer:%o]",T),await this._pc.setLocalDescription(T),L=f.parse(this._pc.localDescription.sdp),y=L.media.find(j=>j.type===b.kind),I.rtcp.cname=E.getCname({offerMediaObject:y}),I.encodings=S.getRtpEncodings({offerMediaObject:y,track:b}),w)for(let j=0;j<I.encodings.length;++j)w[j]&&Object.assign(I.encodings[j],w[j]);if(I.encodings.length>1&&(I.codecs[0].mimeType.toLowerCase()==="video/vp8"||I.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const j of I.encodings)j.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:y,offerRtpParameters:I,answerRtpParameters:N,codecOptions:v});const M={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("send() | calling pc.setRemoteDescription() [answer:%o]",M),await this._pc.setRemoteDescription(M);const U=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(U,b),{localId:U,rtpParameters:I}}async stopSending(b){this.assertSendDirection(),C.debug("stopSending() [localId:%s]",b);const w=this._mapSendLocalIdTrack.get(b);if(!w)throw new Error("track not found");this._mapSendLocalIdTrack.delete(b),this._sendStream.removeTrack(w),this._pc.addStream(this._sendStream);const v=await this._pc.createOffer();C.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",v);try{await this._pc.setLocalDescription(v)}catch(y){if(this._sendStream.getTracks().length===0)return void C.warn("stopSending() | ignoring expected error due no sending tracks: %s",y.toString());throw y}if(this._pc.signalingState==="stable")return;const _={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",_),await this._pc.setRemoteDescription(_)}async pauseSending(b){}async resumeSending(b){}async replaceTrack(b,w){throw new p.UnsupportedError("not implemented")}async setMaxSpatialLayer(b,w){throw new p.UnsupportedError("not implemented")}async setRtpEncodingParameters(b,w){throw new p.UnsupportedError("not implemented")}async getSenderStats(b){throw new p.UnsupportedError("not implemented")}async sendDataChannel({ordered:b,maxPacketLifeTime:w,maxRetransmits:v,label:_,protocol:y}){this.assertSendDirection();const T={negotiated:!0,id:this._nextSendSctpStreamId,ordered:b,maxPacketLifeTime:w,maxRetransmitTime:w,maxRetransmits:v,protocol:y};C.debug("sendDataChannel() [options:%o]",T);const L=this._pc.createDataChannel(_,T);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%x.MIS,!this._hasDataChannelMediaSection){const I=await this._pc.createOffer(),N=f.parse(I.sdp),M=N.media.find(j=>j.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:N}),C.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",I),await this._pc.setLocalDescription(I),this._remoteSdp.sendSctpAssociation({offerMediaObject:M});const U={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",U),await this._pc.setRemoteDescription(U),this._hasDataChannelMediaSection=!0}return{dataChannel:L,sctpStreamParameters:{streamId:T.id,ordered:T.ordered,maxPacketLifeTime:T.maxPacketLifeTime,maxRetransmits:T.maxRetransmits}}}async receive(b){this.assertRecvDirection();const w=[],v=new Map;for(const L of b){const{trackId:I,kind:N,rtpParameters:M}=L;C.debug("receive() [trackId:%s, kind:%s]",I,N);const U=N;let j=L.streamId||M.rtcp.cname;C.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),j+=`-hack-${d.generateRandomNumber()}`,v.set(I,j),this._remoteSdp.receive({mid:U,kind:N,offerRtpParameters:M,streamId:j,trackId:I})}const _={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",_),await this._pc.setRemoteDescription(_);let y=await this._pc.createAnswer();const T=f.parse(y.sdp);for(const L of b){const{kind:I,rtpParameters:N}=L,M=I,U=T.media.find(j=>String(j.mid)===M);E.applyCodecParameters({offerRtpParameters:N,answerMediaObject:U})}y={type:"answer",sdp:f.write(T)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:T}),C.debug("receive() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y);for(const L of b){const{kind:I,trackId:N,rtpParameters:M}=L,U=N,j=I,Q=v.get(N),Y=this._pc.getRemoteStreams().find(he=>he.id===Q).getTrackById(U);if(!Y)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(U,{mid:j,rtpParameters:M}),w.push({localId:U,track:Y})}return w}async stopReceiving(b){this.assertRecvDirection();for(const _ of b){C.debug("stopReceiving() [localId:%s]",_);const{mid:y,rtpParameters:T}=this._mapRecvLocalIdInfo.get(_)||{};this._mapRecvLocalIdInfo.delete(_),this._remoteSdp.planBStopReceiving({mid:y,offerRtpParameters:T})}const w={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",w),await this._pc.setRemoteDescription(w);const v=await this._pc.createAnswer();C.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",v),await this._pc.setLocalDescription(v)}async pauseReceiving(b){}async resumeReceiving(b){}async getReceiverStats(b){throw new p.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:b,label:w,protocol:v}){this.assertRecvDirection();const{streamId:_,ordered:y,maxPacketLifeTime:T,maxRetransmits:L}=b,I={negotiated:!0,id:_,ordered:y,maxPacketLifeTime:T,maxRetransmitTime:T,maxRetransmits:L,protocol:v};C.debug("receiveDataChannel() [options:%o]",I);const N=this._pc.createDataChannel(w,I);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const M={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",M),await this._pc.setRemoteDescription(M);const U=await this._pc.createAnswer();if(!this._transportReady){const j=f.parse(U.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j})}C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",U),await this._pc.setLocalDescription(U),this._hasDataChannelMediaSection=!0}return{dataChannel:N}}async setupTransport({localDtlsRole:b,localSdpObject:w}){w||(w=f.parse(this._pc.localDescription.sdp));const v=E.extractDtlsParameters({sdpObject:w});v.role=b,this._remoteSdp.updateDtlsRole(b==="client"?"server":"client"),await new Promise((_,y)=>{this.safeEmit("@connect",{dtlsParameters:v},_,y)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}c.ReactNative=P},4039:function(a,c,o){var l=this&&this.__createBinding||(Object.create?function(w,v,_,y){y===void 0&&(y=_);var T=Object.getOwnPropertyDescriptor(v,_);T&&!("get"in T?!v.__esModule:T.writable||T.configurable)||(T={enumerable:!0,get:function(){return v[_]}}),Object.defineProperty(w,y,T)}:function(w,v,_,y){y===void 0&&(y=_),w[y]=v[_]}),u=this&&this.__setModuleDefault||(Object.create?function(w,v){Object.defineProperty(w,"default",{enumerable:!0,value:v})}:function(w,v){w.default=v}),h=this&&this.__importStar||function(w){if(w&&w.__esModule)return w;var v={};if(w!=null)for(var _ in w)_!=="default"&&Object.prototype.hasOwnProperty.call(w,_)&&l(v,w,_);return u(v,w),v};Object.defineProperty(c,"__esModule",{value:!0}),c.ReactNativeUnifiedPlan=void 0;const f=h(o(7363)),g=o(2994),p=h(o(1765)),d=h(o(8046)),m=h(o(5544)),E=h(o(5938)),S=h(o(4256)),R=o(4893),k=o(521),C=o(1305),x=o(3303),P=new g.Logger("ReactNativeUnifiedPlan"),D={OS:1024,MIS:1024};class b extends k.HandlerInterface{static createFactory(){return()=>new b}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"ReactNativeUnifiedPlan"}close(){if(P.debug("close()"),!this._closed){if(this._closed=!0,this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){P.debug("getNativeRtpCapabilities()");const v=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{v.addTransceiver("audio"),v.addTransceiver("video");const _=await v.createOffer();try{v.close()}catch{}const y=f.parse(_.sdp),T=m.extractRtpCapabilities({sdpObject:y});return S.addNackSuppportForOpus(T),T}catch(_){try{v.close()}catch{}throw _}}async getNativeSctpCapabilities(){return P.debug("getNativeSctpCapabilities()"),{numStreams:D}}run({direction:v,iceParameters:_,iceCandidates:y,dtlsParameters:T,sctpParameters:L,iceServers:I,iceTransportPolicy:N,additionalSettings:M,proprietaryConstraints:U,extendedRtpCapabilities:j}){this.assertNotClosed(),P.debug("run()"),this._direction=v,this._remoteSdp=new C.RemoteSdp({iceParameters:_,iceCandidates:y,dtlsParameters:T,sctpParameters:L}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",j),video:d.getSendingRtpParameters("video",j)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",j),video:d.getSendingRemoteRtpParameters("video",j)},T.role&&T.role!=="auto"&&(this._forcedLocalDtlsRole=T.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:I||[],iceTransportPolicy:N||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...M},U),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(P.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(v){this.assertNotClosed(),P.debug("updateIceServers()");const _=this._pc.getConfiguration();_.iceServers=v,this._pc.setConfiguration(_)}async restartIce(v){if(this.assertNotClosed(),P.debug("restartIce()"),this._remoteSdp.updateIceParameters(v),this._transportReady)if(this._direction==="send"){const _=await this._pc.createOffer({iceRestart:!0});P.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",_),await this._pc.setLocalDescription(_);const y={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y)}else{const _={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",_),await this._pc.setRemoteDescription(_);const y=await this._pc.createAnswer();P.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:v,encodings:_,codecOptions:y,codec:T}){this.assertNotClosed(),this.assertSendDirection(),P.debug("send() [kind:%s, track.id:%s]",v.kind,v.id),_&&_.length>1&&_.forEach((fe,ue)=>{fe.rid=`r${ue}`});const L=p.clone(this._sendingRtpParametersByKind[v.kind]);L.codecs=d.reduceCodecs(L.codecs,T);const I=p.clone(this._sendingRemoteRtpParametersByKind[v.kind]);I.codecs=d.reduceCodecs(I.codecs,T);const N=this._remoteSdp.getNextMediaSectionIdx(),M=this._pc.addTransceiver(v,{direction:"sendonly",streams:[this._sendStream],sendEncodings:_});let U,j=await this._pc.createOffer(),Q=f.parse(j.sdp);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:Q});let Y=!1;const he=(0,x.parse)((_||[{}])[0].scalabilityMode);_&&_.length===1&&he.spatialLayers>1&&L.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(P.debug("send() | enabling legacy simulcast for VP9 SVC"),Y=!0,Q=f.parse(j.sdp),U=Q.media[N.idx],E.addLegacySimulcast({offerMediaObject:U,numStreams:he.spatialLayers}),j={type:"offer",sdp:f.write(Q)}),P.debug("send() | calling pc.setLocalDescription() [offer:%o]",j),await this._pc.setLocalDescription(j);let re=M.mid??void 0;if(re||P.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),L.mid=re,Q=f.parse(this._pc.localDescription.sdp),U=Q.media[N.idx],L.rtcp.cname=m.getCname({offerMediaObject:U}),_)if(_.length===1){let fe=E.getRtpEncodings({offerMediaObject:U});Object.assign(fe[0],_[0]),Y&&(fe=[fe[0]]),L.encodings=fe}else L.encodings=_;else L.encodings=E.getRtpEncodings({offerMediaObject:U});if(L.encodings.length>1&&(L.codecs[0].mimeType.toLowerCase()==="video/vp8"||L.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const fe of L.encodings)fe.scalabilityMode?fe.scalabilityMode=`L1T${he.temporalLayers}`:fe.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:U,reuseMid:N.reuseMid,offerRtpParameters:L,answerRtpParameters:I,codecOptions:y,extmapAllowMixed:!0});const pe={type:"answer",sdp:this._remoteSdp.getSdp()};return P.debug("send() | calling pc.setRemoteDescription() [answer:%o]",pe),await this._pc.setRemoteDescription(pe),re||(re=M.mid,L.mid=re),this._mapMidTransceiver.set(re,M),{localId:re,rtpParameters:L,rtpSender:M.sender}}async stopSending(v){if(this.assertSendDirection(),this._closed)return;P.debug("stopSending() [localId:%s]",v);const _=this._mapMidTransceiver.get(v);if(!_)throw new Error("associated RTCRtpTransceiver not found");if(_.sender.replaceTrack(null),this._pc.removeTrack(_.sender),this._remoteSdp.closeMediaSection(_.mid))try{_.stop()}catch{}const y=await this._pc.createOffer();P.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const T={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T),this._mapMidTransceiver.delete(v)}async pauseSending(v){this.assertNotClosed(),this.assertSendDirection(),P.debug("pauseSending() [localId:%s]",v);const _=this._mapMidTransceiver.get(v);if(!_)throw new Error("associated RTCRtpTransceiver not found");_.direction="inactive",this._remoteSdp.pauseMediaSection(v);const y=await this._pc.createOffer();P.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const T={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T)}async resumeSending(v){this.assertNotClosed(),this.assertSendDirection(),P.debug("resumeSending() [localId:%s]",v);const _=this._mapMidTransceiver.get(v);if(this._remoteSdp.resumeSendingMediaSection(v),!_)throw new Error("associated RTCRtpTransceiver not found");_.direction="sendonly";const y=await this._pc.createOffer();P.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const T={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T)}async replaceTrack(v,_){this.assertNotClosed(),this.assertSendDirection(),_?P.debug("replaceTrack() [localId:%s, track.id:%s]",v,_.id):P.debug("replaceTrack() [localId:%s, no track]",v);const y=this._mapMidTransceiver.get(v);if(!y)throw new Error("associated RTCRtpTransceiver not found");await y.sender.replaceTrack(_)}async setMaxSpatialLayer(v,_){this.assertNotClosed(),this.assertSendDirection(),P.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",v,_);const y=this._mapMidTransceiver.get(v);if(!y)throw new Error("associated RTCRtpTransceiver not found");const T=y.sender.getParameters();T.encodings.forEach((N,M)=>{N.active=M<=_}),await y.sender.setParameters(T),this._remoteSdp.muxMediaSectionSimulcast(v,T.encodings);const L=await this._pc.createOffer();P.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",L),await this._pc.setLocalDescription(L);const I={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",I),await this._pc.setRemoteDescription(I)}async setRtpEncodingParameters(v,_){this.assertNotClosed(),this.assertSendDirection(),P.debug("setRtpEncodingParameters() [localId:%s, params:%o]",v,_);const y=this._mapMidTransceiver.get(v);if(!y)throw new Error("associated RTCRtpTransceiver not found");const T=y.sender.getParameters();T.encodings.forEach((N,M)=>{T.encodings[M]={...N,..._}}),await y.sender.setParameters(T),this._remoteSdp.muxMediaSectionSimulcast(v,T.encodings);const L=await this._pc.createOffer();P.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",L),await this._pc.setLocalDescription(L);const I={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",I),await this._pc.setRemoteDescription(I)}async getSenderStats(v){this.assertNotClosed(),this.assertSendDirection();const _=this._mapMidTransceiver.get(v);if(!_)throw new Error("associated RTCRtpTransceiver not found");return _.sender.getStats()}async sendDataChannel({ordered:v,maxPacketLifeTime:_,maxRetransmits:y,label:T,protocol:L}){this.assertNotClosed(),this.assertSendDirection();const I={negotiated:!0,id:this._nextSendSctpStreamId,ordered:v,maxPacketLifeTime:_,maxRetransmits:y,protocol:L};P.debug("sendDataChannel() [options:%o]",I);const N=this._pc.createDataChannel(T,I);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%D.MIS,!this._hasDataChannelMediaSection){const M=await this._pc.createOffer(),U=f.parse(M.sdp),j=U.media.find(Y=>Y.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:U}),P.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",M),await this._pc.setLocalDescription(M),this._remoteSdp.sendSctpAssociation({offerMediaObject:j});const Q={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",Q),await this._pc.setRemoteDescription(Q),this._hasDataChannelMediaSection=!0}return{dataChannel:N,sctpStreamParameters:{streamId:I.id,ordered:I.ordered,maxPacketLifeTime:I.maxPacketLifeTime,maxRetransmits:I.maxRetransmits}}}async receive(v){this.assertNotClosed(),this.assertRecvDirection();const _=[],y=new Map;for(const N of v){const{trackId:M,kind:U,rtpParameters:j,streamId:Q}=N;P.debug("receive() [trackId:%s, kind:%s]",M,U);const Y=j.mid||String(this._mapMidTransceiver.size);y.set(M,Y),this._remoteSdp.receive({mid:Y,kind:U,offerRtpParameters:j,streamId:Q||j.rtcp.cname,trackId:M})}const T={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",T),await this._pc.setRemoteDescription(T);let L=await this._pc.createAnswer();const I=f.parse(L.sdp);for(const N of v){const{trackId:M,rtpParameters:U}=N,j=y.get(M),Q=I.media.find(Y=>String(Y.mid)===j);m.applyCodecParameters({offerRtpParameters:U,answerMediaObject:Q})}L={type:"answer",sdp:f.write(I)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:I}),P.debug("receive() | calling pc.setLocalDescription() [answer:%o]",L),await this._pc.setLocalDescription(L);for(const N of v){const{trackId:M}=N,U=y.get(M),j=this._pc.getTransceivers().find(Q=>Q.mid===U);if(!j)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(U,j),_.push({localId:U,track:j.receiver.track,rtpReceiver:j.receiver})}return _}async stopReceiving(v){if(this.assertRecvDirection(),this._closed)return;for(const T of v){P.debug("stopReceiving() [localId:%s]",T);const L=this._mapMidTransceiver.get(T);if(!L)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(L.mid)}const _={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",_),await this._pc.setRemoteDescription(_);const y=await this._pc.createAnswer();P.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y);for(const T of v)this._mapMidTransceiver.delete(T)}async pauseReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const T of v){P.debug("pauseReceiving() [localId:%s]",T);const L=this._mapMidTransceiver.get(T);if(!L)throw new Error("associated RTCRtpTransceiver not found");L.direction="inactive",this._remoteSdp.pauseMediaSection(T)}const _={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",_),await this._pc.setRemoteDescription(_);const y=await this._pc.createAnswer();P.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y)}async resumeReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const T of v){P.debug("resumeReceiving() [localId:%s]",T);const L=this._mapMidTransceiver.get(T);if(!L)throw new Error("associated RTCRtpTransceiver not found");L.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(T)}const _={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",_),await this._pc.setRemoteDescription(_);const y=await this._pc.createAnswer();P.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y)}async getReceiverStats(v){this.assertNotClosed(),this.assertRecvDirection();const _=this._mapMidTransceiver.get(v);if(!_)throw new Error("associated RTCRtpTransceiver not found");return _.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:v,label:_,protocol:y}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:T,ordered:L,maxPacketLifeTime:I,maxRetransmits:N}=v,M={negotiated:!0,id:T,ordered:L,maxPacketLifeTime:I,maxRetransmits:N,protocol:y};P.debug("receiveDataChannel() [options:%o]",M);const U=this._pc.createDataChannel(_,M);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const j={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",j),await this._pc.setRemoteDescription(j);const Q=await this._pc.createAnswer();if(!this._transportReady){const Y=f.parse(Q.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:Y})}P.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",Q),await this._pc.setLocalDescription(Q),this._hasDataChannelMediaSection=!0}return{dataChannel:U}}async setupTransport({localDtlsRole:v,localSdpObject:_}){_||(_=f.parse(this._pc.localDescription.sdp));const y=m.extractDtlsParameters({sdpObject:_});y.role=v,this._remoteSdp.updateDtlsRole(v==="client"?"server":"client"),await new Promise((T,L)=>{this.safeEmit("@connect",{dtlsParameters:y},T,L)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new R.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}c.ReactNativeUnifiedPlan=b},9676:function(a,c,o){var l=this&&this.__createBinding||(Object.create?function(P,D,b,w){w===void 0&&(w=b);var v=Object.getOwnPropertyDescriptor(D,b);v&&!("get"in v?!D.__esModule:v.writable||v.configurable)||(v={enumerable:!0,get:function(){return D[b]}}),Object.defineProperty(P,w,v)}:function(P,D,b,w){w===void 0&&(w=b),P[w]=D[b]}),u=this&&this.__setModuleDefault||(Object.create?function(P,D){Object.defineProperty(P,"default",{enumerable:!0,value:D})}:function(P,D){P.default=D}),h=this&&this.__importStar||function(P){if(P&&P.__esModule)return P;var D={};if(P!=null)for(var b in P)b!=="default"&&Object.prototype.hasOwnProperty.call(P,b)&&l(D,P,b);return u(D,P),D};Object.defineProperty(c,"__esModule",{value:!0}),c.Safari11=void 0;const f=h(o(7363)),g=o(2994),p=h(o(1765)),d=h(o(8046)),m=h(o(5544)),E=h(o(4496)),S=o(521),R=o(1305),k=new g.Logger("Safari11"),C={OS:1024,MIS:1024};class x extends S.HandlerInterface{static createFactory(){return()=>new x}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari11"}close(){if(k.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){k.debug("getNativeRtpCapabilities()");const D=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const b=await D.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{D.close()}catch{}const w=f.parse(b.sdp);return m.extractRtpCapabilities({sdpObject:w})}catch(b){try{D.close()}catch{}throw b}}async getNativeSctpCapabilities(){return k.debug("getNativeSctpCapabilities()"),{numStreams:C}}run({direction:D,iceParameters:b,iceCandidates:w,dtlsParameters:v,sctpParameters:_,iceServers:y,iceTransportPolicy:T,additionalSettings:L,proprietaryConstraints:I,extendedRtpCapabilities:N}){k.debug("run()"),this._direction=D,this._remoteSdp=new R.RemoteSdp({iceParameters:b,iceCandidates:w,dtlsParameters:v,sctpParameters:_,planB:!0}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",N),video:d.getSendingRtpParameters("video",N)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",N),video:d.getSendingRemoteRtpParameters("video",N)},v.role&&v.role!=="auto"&&(this._forcedLocalDtlsRole=v.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:y||[],iceTransportPolicy:T||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...L},I),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(k.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(D){k.debug("updateIceServers()");const b=this._pc.getConfiguration();b.iceServers=D,this._pc.setConfiguration(b)}async restartIce(D){if(k.debug("restartIce()"),this._remoteSdp.updateIceParameters(D),this._transportReady)if(this._direction==="send"){const b=await this._pc.createOffer({iceRestart:!0});k.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",b),await this._pc.setLocalDescription(b);const w={type:"answer",sdp:this._remoteSdp.getSdp()};k.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",w),await this._pc.setRemoteDescription(w)}else{const b={type:"offer",sdp:this._remoteSdp.getSdp()};k.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",b),await this._pc.setRemoteDescription(b);const w=await this._pc.createAnswer();k.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",w),await this._pc.setLocalDescription(w)}}async getTransportStats(){return this._pc.getStats()}async send({track:D,encodings:b,codecOptions:w,codec:v}){this.assertSendDirection(),k.debug("send() [kind:%s, track.id:%s]",D.kind,D.id),v&&k.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(D),this._pc.addTrack(D,this._sendStream);let _,y=await this._pc.createOffer(),T=f.parse(y.sdp);const L=p.clone(this._sendingRtpParametersByKind[D.kind]);L.codecs=d.reduceCodecs(L.codecs);const I=p.clone(this._sendingRemoteRtpParametersByKind[D.kind]);if(I.codecs=d.reduceCodecs(I.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:T}),D.kind==="video"&&b&&b.length>1&&(k.debug("send() | enabling simulcast"),T=f.parse(y.sdp),_=T.media.find(j=>j.type==="video"),E.addLegacySimulcast({offerMediaObject:_,track:D,numStreams:b.length}),y={type:"offer",sdp:f.write(T)}),k.debug("send() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y),T=f.parse(this._pc.localDescription.sdp),_=T.media.find(j=>j.type===D.kind),L.rtcp.cname=m.getCname({offerMediaObject:_}),L.encodings=E.getRtpEncodings({offerMediaObject:_,track:D}),b)for(let j=0;j<L.encodings.length;++j)b[j]&&Object.assign(L.encodings[j],b[j]);if(L.encodings.length>1&&L.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const j of L.encodings)j.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:_,offerRtpParameters:L,answerRtpParameters:I,codecOptions:w});const N={type:"answer",sdp:this._remoteSdp.getSdp()};k.debug("send() | calling pc.setRemoteDescription() [answer:%o]",N),await this._pc.setRemoteDescription(N);const M=String(this._nextSendLocalId);this._nextSendLocalId++;const U=this._pc.getSenders().find(j=>j.track===D);return this._mapSendLocalIdRtpSender.set(M,U),{localId:M,rtpParameters:L,rtpSender:U}}async stopSending(D){this.assertSendDirection();const b=this._mapSendLocalIdRtpSender.get(D);if(!b)throw new Error("associated RTCRtpSender not found");b.track&&this._sendStream.removeTrack(b.track),this._mapSendLocalIdRtpSender.delete(D);const w=await this._pc.createOffer();k.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",w);try{await this._pc.setLocalDescription(w)}catch(_){if(this._sendStream.getTracks().length===0)return void k.warn("stopSending() | ignoring expected error due no sending tracks: %s",_.toString());throw _}if(this._pc.signalingState==="stable")return;const v={type:"answer",sdp:this._remoteSdp.getSdp()};k.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",v),await this._pc.setRemoteDescription(v)}async pauseSending(D){}async resumeSending(D){}async replaceTrack(D,b){this.assertSendDirection(),b?k.debug("replaceTrack() [localId:%s, track.id:%s]",D,b.id):k.debug("replaceTrack() [localId:%s, no track]",D);const w=this._mapSendLocalIdRtpSender.get(D);if(!w)throw new Error("associated RTCRtpSender not found");const v=w.track;await w.replaceTrack(b),v&&this._sendStream.removeTrack(v),b&&this._sendStream.addTrack(b)}async setMaxSpatialLayer(D,b){this.assertSendDirection(),k.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",D,b);const w=this._mapSendLocalIdRtpSender.get(D);if(!w)throw new Error("associated RTCRtpSender not found");const v=w.getParameters();v.encodings.forEach((_,y)=>{_.active=y<=b}),await w.setParameters(v)}async setRtpEncodingParameters(D,b){this.assertSendDirection(),k.debug("setRtpEncodingParameters() [localId:%s, params:%o]",D,b);const w=this._mapSendLocalIdRtpSender.get(D);if(!w)throw new Error("associated RTCRtpSender not found");const v=w.getParameters();v.encodings.forEach((_,y)=>{v.encodings[y]={..._,...b}}),await w.setParameters(v)}async getSenderStats(D){this.assertSendDirection();const b=this._mapSendLocalIdRtpSender.get(D);if(!b)throw new Error("associated RTCRtpSender not found");return b.getStats()}async sendDataChannel({ordered:D,maxPacketLifeTime:b,maxRetransmits:w,label:v,protocol:_}){this.assertSendDirection();const y={negotiated:!0,id:this._nextSendSctpStreamId,ordered:D,maxPacketLifeTime:b,maxRetransmits:w,protocol:_};k.debug("sendDataChannel() [options:%o]",y);const T=this._pc.createDataChannel(v,y);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%C.MIS,!this._hasDataChannelMediaSection){const L=await this._pc.createOffer(),I=f.parse(L.sdp),N=I.media.find(U=>U.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:I}),k.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",L),await this._pc.setLocalDescription(L),this._remoteSdp.sendSctpAssociation({offerMediaObject:N});const M={type:"answer",sdp:this._remoteSdp.getSdp()};k.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",M),await this._pc.setRemoteDescription(M),this._hasDataChannelMediaSection=!0}return{dataChannel:T,sctpStreamParameters:{streamId:y.id,ordered:y.ordered,maxPacketLifeTime:y.maxPacketLifeTime,maxRetransmits:y.maxRetransmits}}}async receive(D){this.assertRecvDirection();const b=[];for(const y of D){const{trackId:T,kind:L,rtpParameters:I,streamId:N}=y;k.debug("receive() [trackId:%s, kind:%s]",T,L);const M=L;this._remoteSdp.receive({mid:M,kind:L,offerRtpParameters:I,streamId:N||I.rtcp.cname,trackId:T})}const w={type:"offer",sdp:this._remoteSdp.getSdp()};k.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",w),await this._pc.setRemoteDescription(w);let v=await this._pc.createAnswer();const _=f.parse(v.sdp);for(const y of D){const{kind:T,rtpParameters:L}=y,I=T,N=_.media.find(M=>String(M.mid)===I);m.applyCodecParameters({offerRtpParameters:L,answerMediaObject:N})}v={type:"answer",sdp:f.write(_)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:_}),k.debug("receive() | calling pc.setLocalDescription() [answer:%o]",v),await this._pc.setLocalDescription(v);for(const y of D){const{kind:T,trackId:L,rtpParameters:I}=y,N=T,M=L,U=this._pc.getReceivers().find(j=>j.track&&j.track.id===M);if(!U)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(M,{mid:N,rtpParameters:I,rtpReceiver:U}),b.push({localId:M,track:U.track,rtpReceiver:U})}return b}async stopReceiving(D){this.assertRecvDirection();for(const v of D){k.debug("stopReceiving() [localId:%s]",v);const{mid:_,rtpParameters:y}=this._mapRecvLocalIdInfo.get(v)||{};this._mapRecvLocalIdInfo.delete(v),this._remoteSdp.planBStopReceiving({mid:_,offerRtpParameters:y})}const b={type:"offer",sdp:this._remoteSdp.getSdp()};k.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",b),await this._pc.setRemoteDescription(b);const w=await this._pc.createAnswer();k.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",w),await this._pc.setLocalDescription(w)}async getReceiverStats(D){this.assertRecvDirection();const{rtpReceiver:b}=this._mapRecvLocalIdInfo.get(D)||{};if(!b)throw new Error("associated RTCRtpReceiver not found");return b.getStats()}async pauseReceiving(D){}async resumeReceiving(D){}async receiveDataChannel({sctpStreamParameters:D,label:b,protocol:w}){this.assertRecvDirection();const{streamId:v,ordered:_,maxPacketLifeTime:y,maxRetransmits:T}=D,L={negotiated:!0,id:v,ordered:_,maxPacketLifeTime:y,maxRetransmits:T,protocol:w};k.debug("receiveDataChannel() [options:%o]",L);const I=this._pc.createDataChannel(b,L);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const N={type:"offer",sdp:this._remoteSdp.getSdp()};k.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",N),await this._pc.setRemoteDescription(N);const M=await this._pc.createAnswer();if(!this._transportReady){const U=f.parse(M.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:U})}k.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",M),await this._pc.setLocalDescription(M),this._hasDataChannelMediaSection=!0}return{dataChannel:I}}async setupTransport({localDtlsRole:D,localSdpObject:b}){b||(b=f.parse(this._pc.localDescription.sdp));const w=m.extractDtlsParameters({sdpObject:b});w.role=D,this._remoteSdp.updateDtlsRole(D==="client"?"server":"client"),await new Promise((v,_)=>{this.safeEmit("@connect",{dtlsParameters:w},v,_)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}c.Safari11=x},5765:function(a,c,o){var l=this&&this.__createBinding||(Object.create?function(w,v,_,y){y===void 0&&(y=_);var T=Object.getOwnPropertyDescriptor(v,_);T&&!("get"in T?!v.__esModule:T.writable||T.configurable)||(T={enumerable:!0,get:function(){return v[_]}}),Object.defineProperty(w,y,T)}:function(w,v,_,y){y===void 0&&(y=_),w[y]=v[_]}),u=this&&this.__setModuleDefault||(Object.create?function(w,v){Object.defineProperty(w,"default",{enumerable:!0,value:v})}:function(w,v){w.default=v}),h=this&&this.__importStar||function(w){if(w&&w.__esModule)return w;var v={};if(w!=null)for(var _ in w)_!=="default"&&Object.prototype.hasOwnProperty.call(w,_)&&l(v,w,_);return u(v,w),v};Object.defineProperty(c,"__esModule",{value:!0}),c.Safari12=void 0;const f=h(o(7363)),g=o(2994),p=h(o(1765)),d=h(o(8046)),m=h(o(5544)),E=h(o(5938)),S=h(o(4256)),R=o(4893),k=o(521),C=o(1305),x=o(3303),P=new g.Logger("Safari12"),D={OS:1024,MIS:1024};class b extends k.HandlerInterface{static createFactory(){return()=>new b}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari12"}close(){if(P.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){P.debug("getNativeRtpCapabilities()");const v=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{v.addTransceiver("audio"),v.addTransceiver("video");const _=await v.createOffer();try{v.close()}catch{}const y=f.parse(_.sdp),T=m.extractRtpCapabilities({sdpObject:y});return S.addNackSuppportForOpus(T),T}catch(_){try{v.close()}catch{}throw _}}async getNativeSctpCapabilities(){return P.debug("getNativeSctpCapabilities()"),{numStreams:D}}run({direction:v,iceParameters:_,iceCandidates:y,dtlsParameters:T,sctpParameters:L,iceServers:I,iceTransportPolicy:N,additionalSettings:M,proprietaryConstraints:U,extendedRtpCapabilities:j}){this.assertNotClosed(),P.debug("run()"),this._direction=v,this._remoteSdp=new C.RemoteSdp({iceParameters:_,iceCandidates:y,dtlsParameters:T,sctpParameters:L}),this._sendingRtpParametersByKind={audio:d.getSendingRtpParameters("audio",j),video:d.getSendingRtpParameters("video",j)},this._sendingRemoteRtpParametersByKind={audio:d.getSendingRemoteRtpParameters("audio",j),video:d.getSendingRemoteRtpParameters("video",j)},T.role&&T.role!=="auto"&&(this._forcedLocalDtlsRole=T.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:I||[],iceTransportPolicy:N||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...M},U),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(P.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(v){this.assertNotClosed(),P.debug("updateIceServers()");const _=this._pc.getConfiguration();_.iceServers=v,this._pc.setConfiguration(_)}async restartIce(v){if(this.assertNotClosed(),P.debug("restartIce()"),this._remoteSdp.updateIceParameters(v),this._transportReady)if(this._direction==="send"){const _=await this._pc.createOffer({iceRestart:!0});P.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",_),await this._pc.setLocalDescription(_);const y={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y)}else{const _={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",_),await this._pc.setRemoteDescription(_);const y=await this._pc.createAnswer();P.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:v,encodings:_,codecOptions:y,codec:T}){this.assertNotClosed(),this.assertSendDirection(),P.debug("send() [kind:%s, track.id:%s]",v.kind,v.id);const L=p.clone(this._sendingRtpParametersByKind[v.kind]);L.codecs=d.reduceCodecs(L.codecs,T);const I=p.clone(this._sendingRemoteRtpParametersByKind[v.kind]);I.codecs=d.reduceCodecs(I.codecs,T);const N=this._remoteSdp.getNextMediaSectionIdx(),M=this._pc.addTransceiver(v,{direction:"sendonly",streams:[this._sendStream]});let U,j=await this._pc.createOffer(),Q=f.parse(j.sdp);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:Q});const Y=(0,x.parse)((_||[{}])[0].scalabilityMode);_&&_.length>1&&(P.debug("send() | enabling legacy simulcast"),Q=f.parse(j.sdp),U=Q.media[N.idx],E.addLegacySimulcast({offerMediaObject:U,numStreams:_.length}),j={type:"offer",sdp:f.write(Q)}),P.debug("send() | calling pc.setLocalDescription() [offer:%o]",j),await this._pc.setLocalDescription(j);const he=M.mid;if(L.mid=he,Q=f.parse(this._pc.localDescription.sdp),U=Q.media[N.idx],L.rtcp.cname=m.getCname({offerMediaObject:U}),L.encodings=E.getRtpEncodings({offerMediaObject:U}),_)for(let pe=0;pe<L.encodings.length;++pe)_[pe]&&Object.assign(L.encodings[pe],_[pe]);if(L.encodings.length>1&&(L.codecs[0].mimeType.toLowerCase()==="video/vp8"||L.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const pe of L.encodings)pe.scalabilityMode?pe.scalabilityMode=`L1T${Y.temporalLayers}`:pe.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:U,reuseMid:N.reuseMid,offerRtpParameters:L,answerRtpParameters:I,codecOptions:y});const re={type:"answer",sdp:this._remoteSdp.getSdp()};return P.debug("send() | calling pc.setRemoteDescription() [answer:%o]",re),await this._pc.setRemoteDescription(re),this._mapMidTransceiver.set(he,M),{localId:he,rtpParameters:L,rtpSender:M.sender}}async stopSending(v){if(this.assertSendDirection(),this._closed)return;P.debug("stopSending() [localId:%s]",v);const _=this._mapMidTransceiver.get(v);if(!_)throw new Error("associated RTCRtpTransceiver not found");if(_.sender.replaceTrack(null),this._pc.removeTrack(_.sender),this._remoteSdp.closeMediaSection(_.mid))try{_.stop()}catch{}const y=await this._pc.createOffer();P.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const T={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T),this._mapMidTransceiver.delete(v)}async pauseSending(v){this.assertNotClosed(),this.assertSendDirection(),P.debug("pauseSending() [localId:%s]",v);const _=this._mapMidTransceiver.get(v);if(!_)throw new Error("associated RTCRtpTransceiver not found");_.direction="inactive",this._remoteSdp.pauseMediaSection(v);const y=await this._pc.createOffer();P.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const T={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T)}async resumeSending(v){this.assertNotClosed(),this.assertSendDirection(),P.debug("resumeSending() [localId:%s]",v);const _=this._mapMidTransceiver.get(v);if(!_)throw new Error("associated RTCRtpTransceiver not found");_.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(v);const y=await this._pc.createOffer();P.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const T={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T)}async replaceTrack(v,_){this.assertNotClosed(),this.assertSendDirection(),_?P.debug("replaceTrack() [localId:%s, track.id:%s]",v,_.id):P.debug("replaceTrack() [localId:%s, no track]",v);const y=this._mapMidTransceiver.get(v);if(!y)throw new Error("associated RTCRtpTransceiver not found");await y.sender.replaceTrack(_)}async setMaxSpatialLayer(v,_){this.assertNotClosed(),this.assertSendDirection(),P.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",v,_);const y=this._mapMidTransceiver.get(v);if(!y)throw new Error("associated RTCRtpTransceiver not found");const T=y.sender.getParameters();T.encodings.forEach((N,M)=>{N.active=M<=_}),await y.sender.setParameters(T),this._remoteSdp.muxMediaSectionSimulcast(v,T.encodings);const L=await this._pc.createOffer();P.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",L),await this._pc.setLocalDescription(L);const I={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",I),await this._pc.setRemoteDescription(I)}async setRtpEncodingParameters(v,_){this.assertNotClosed(),this.assertSendDirection(),P.debug("setRtpEncodingParameters() [localId:%s, params:%o]",v,_);const y=this._mapMidTransceiver.get(v);if(!y)throw new Error("associated RTCRtpTransceiver not found");const T=y.sender.getParameters();T.encodings.forEach((N,M)=>{T.encodings[M]={...N,..._}}),await y.sender.setParameters(T),this._remoteSdp.muxMediaSectionSimulcast(v,T.encodings);const L=await this._pc.createOffer();P.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",L),await this._pc.setLocalDescription(L);const I={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",I),await this._pc.setRemoteDescription(I)}async getSenderStats(v){this.assertNotClosed(),this.assertSendDirection();const _=this._mapMidTransceiver.get(v);if(!_)throw new Error("associated RTCRtpTransceiver not found");return _.sender.getStats()}async sendDataChannel({ordered:v,maxPacketLifeTime:_,maxRetransmits:y,label:T,protocol:L}){this.assertNotClosed(),this.assertSendDirection();const I={negotiated:!0,id:this._nextSendSctpStreamId,ordered:v,maxPacketLifeTime:_,maxRetransmits:y,protocol:L};P.debug("sendDataChannel() [options:%o]",I);const N=this._pc.createDataChannel(T,I);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%D.MIS,!this._hasDataChannelMediaSection){const M=await this._pc.createOffer(),U=f.parse(M.sdp),j=U.media.find(Y=>Y.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:U}),P.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",M),await this._pc.setLocalDescription(M),this._remoteSdp.sendSctpAssociation({offerMediaObject:j});const Q={type:"answer",sdp:this._remoteSdp.getSdp()};P.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",Q),await this._pc.setRemoteDescription(Q),this._hasDataChannelMediaSection=!0}return{dataChannel:N,sctpStreamParameters:{streamId:I.id,ordered:I.ordered,maxPacketLifeTime:I.maxPacketLifeTime,maxRetransmits:I.maxRetransmits}}}async receive(v){this.assertNotClosed(),this.assertRecvDirection();const _=[],y=new Map;for(const N of v){const{trackId:M,kind:U,rtpParameters:j,streamId:Q}=N;P.debug("receive() [trackId:%s, kind:%s]",M,U);const Y=j.mid||String(this._mapMidTransceiver.size);y.set(M,Y),this._remoteSdp.receive({mid:Y,kind:U,offerRtpParameters:j,streamId:Q||j.rtcp.cname,trackId:M})}const T={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",T),await this._pc.setRemoteDescription(T);let L=await this._pc.createAnswer();const I=f.parse(L.sdp);for(const N of v){const{trackId:M,rtpParameters:U}=N,j=y.get(M),Q=I.media.find(Y=>String(Y.mid)===j);m.applyCodecParameters({offerRtpParameters:U,answerMediaObject:Q})}L={type:"answer",sdp:f.write(I)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:I}),P.debug("receive() | calling pc.setLocalDescription() [answer:%o]",L),await this._pc.setLocalDescription(L);for(const N of v){const{trackId:M}=N,U=y.get(M),j=this._pc.getTransceivers().find(Q=>Q.mid===U);if(!j)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(U,j),_.push({localId:U,track:j.receiver.track,rtpReceiver:j.receiver})}return _}async stopReceiving(v){if(this.assertRecvDirection(),this._closed)return;for(const T of v){P.debug("stopReceiving() [localId:%s]",T);const L=this._mapMidTransceiver.get(T);if(!L)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(L.mid)}const _={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",_),await this._pc.setRemoteDescription(_);const y=await this._pc.createAnswer();P.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y);for(const T of v)this._mapMidTransceiver.delete(T)}async pauseReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const T of v){P.debug("pauseReceiving() [localId:%s]",T);const L=this._mapMidTransceiver.get(T);if(!L)throw new Error("associated RTCRtpTransceiver not found");L.direction="inactive",this._remoteSdp.pauseMediaSection(T)}const _={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",_),await this._pc.setRemoteDescription(_);const y=await this._pc.createAnswer();P.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y)}async resumeReceiving(v){this.assertNotClosed(),this.assertRecvDirection();for(const T of v){P.debug("resumeReceiving() [localId:%s]",T);const L=this._mapMidTransceiver.get(T);if(!L)throw new Error("associated RTCRtpTransceiver not found");L.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(T)}const _={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",_),await this._pc.setRemoteDescription(_);const y=await this._pc.createAnswer();P.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y)}async getReceiverStats(v){this.assertNotClosed(),this.assertRecvDirection();const _=this._mapMidTransceiver.get(v);if(!_)throw new Error("associated RTCRtpTransceiver not found");return _.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:v,label:_,protocol:y}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:T,ordered:L,maxPacketLifeTime:I,maxRetransmits:N}=v,M={negotiated:!0,id:T,ordered:L,maxPacketLifeTime:I,maxRetransmits:N,protocol:y};P.debug("receiveDataChannel() [options:%o]",M);const U=this._pc.createDataChannel(_,M);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const j={type:"offer",sdp:this._remoteSdp.getSdp()};P.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",j),await this._pc.setRemoteDescription(j);const Q=await this._pc.createAnswer();if(!this._transportReady){const Y=f.parse(Q.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:Y})}P.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",Q),await this._pc.setLocalDescription(Q),this._hasDataChannelMediaSection=!0}return{dataChannel:U}}async setupTransport({localDtlsRole:v,localSdpObject:_}){_||(_=f.parse(this._pc.localDescription.sdp));const y=m.extractDtlsParameters({sdpObject:_});y.role=v,this._remoteSdp.updateDtlsRole(v==="client"?"server":"client"),await new Promise((T,L)=>{this.safeEmit("@connect",{dtlsParameters:y},T,L)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new R.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}c.Safari12=b},8751:function(a,c,o){var l=this&&this.__createBinding||(Object.create?function(g,p,d,m){m===void 0&&(m=d);var E=Object.getOwnPropertyDescriptor(p,d);E&&!("get"in E?!p.__esModule:E.writable||E.configurable)||(E={enumerable:!0,get:function(){return p[d]}}),Object.defineProperty(g,m,E)}:function(g,p,d,m){m===void 0&&(m=d),g[m]=p[d]}),u=this&&this.__setModuleDefault||(Object.create?function(g,p){Object.defineProperty(g,"default",{enumerable:!0,value:p})}:function(g,p){g.default=p}),h=this&&this.__importStar||function(g){if(g&&g.__esModule)return g;var p={};if(g!=null)for(var d in g)d!=="default"&&Object.prototype.hasOwnProperty.call(g,d)&&l(p,g,d);return u(p,g),p};Object.defineProperty(c,"__esModule",{value:!0}),c.mangleRtpParameters=c.getCapabilities=void 0;const f=h(o(1765));c.getCapabilities=function(){const g=RTCRtpReceiver.getCapabilities(),p=f.clone(g);for(const d of p.codecs??[]){if(d.channels=d.numChannels,delete d.numChannels,d.mimeType=d.mimeType||`${d.kind}/${d.name}`,d.parameters){const m=d.parameters;m.apt&&(m.apt=Number(m.apt)),m["packetization-mode"]&&(m["packetization-mode"]=Number(m["packetization-mode"]))}for(const m of d.rtcpFeedback||[])m.parameter||(m.parameter="")}return p},c.mangleRtpParameters=function(g){const p=f.clone(g);p.mid&&(p.muxId=p.mid,delete p.mid);for(const d of p.codecs)d.channels&&(d.numChannels=d.channels,delete d.channels),d.mimeType&&!d.name&&(d.name=d.mimeType.split("/")[1]),delete d.mimeType;return p}},4256:(a,c)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.addNackSuppportForOpus=void 0,c.addNackSuppportForOpus=function(o){var l;for(const u of o.codecs||[])u.mimeType.toLowerCase()!=="audio/opus"&&u.mimeType.toLowerCase()!=="audio/multiopus"||(l=u.rtcpFeedback)!=null&&l.some(h=>h.type==="nack"&&!h.parameter)||(u.rtcpFeedback||(u.rtcpFeedback=[]),u.rtcpFeedback.push({type:"nack"}))}},3471:function(a,c,o){var l=this&&this.__createBinding||(Object.create?function(m,E,S,R){R===void 0&&(R=S);var k=Object.getOwnPropertyDescriptor(E,S);k&&!("get"in k?!E.__esModule:k.writable||k.configurable)||(k={enumerable:!0,get:function(){return E[S]}}),Object.defineProperty(m,R,k)}:function(m,E,S,R){R===void 0&&(R=S),m[R]=E[S]}),u=this&&this.__setModuleDefault||(Object.create?function(m,E){Object.defineProperty(m,"default",{enumerable:!0,value:E})}:function(m,E){m.default=E}),h=this&&this.__importStar||function(m){if(m&&m.__esModule)return m;var E={};if(m!=null)for(var S in m)S!=="default"&&Object.prototype.hasOwnProperty.call(m,S)&&l(E,m,S);return u(E,m),E};Object.defineProperty(c,"__esModule",{value:!0}),c.OfferMediaSection=c.AnswerMediaSection=c.MediaSection=void 0;const f=h(o(7363)),g=h(o(1765));class p{constructor({iceParameters:E,iceCandidates:S,dtlsParameters:R,planB:k=!1}){if(this._mediaObject={},this._planB=k,E&&this.setIceParameters(E),S){this._mediaObject.candidates=[];for(const C of S){const x={component:1};x.foundation=C.foundation,x.ip=C.address??C.ip,x.port=C.port,x.priority=C.priority,x.transport=C.protocol,x.type=C.type,C.tcpType&&(x.tcptype=C.tcpType),this._mediaObject.candidates.push(x)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}R&&this.setDtlsRole(R.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(E){this._mediaObject.iceUfrag=E.usernameFragment,this._mediaObject.icePwd=E.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}}c.MediaSection=p,c.AnswerMediaSection=class extends p{constructor({iceParameters:m,iceCandidates:E,dtlsParameters:S,sctpParameters:R,plainRtpParameters:k,planB:C=!1,offerMediaObject:x,offerRtpParameters:P,answerRtpParameters:D,codecOptions:b,extmapAllowMixed:w=!1}){switch(super({iceParameters:m,iceCandidates:E,dtlsParameters:S,planB:C}),this._mediaObject.mid=String(x.mid),this._mediaObject.type=x.type,this._mediaObject.protocol=x.protocol,k?(this._mediaObject.connection={ip:k.ip,version:k.ipVersion},this._mediaObject.port=k.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),x.type){case"audio":case"video":this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const v of D.codecs){const _={payload:v.payloadType,codec:d(v),rate:v.clockRate};v.channels>1&&(_.encoding=v.channels),this._mediaObject.rtp.push(_);const y=g.clone(v.parameters)??{};let T=g.clone(v.rtcpFeedback)??[];if(b){const{opusStereo:I,opusFec:N,opusDtx:M,opusMaxPlaybackRate:U,opusMaxAverageBitrate:j,opusPtime:Q,opusNack:Y,videoGoogleStartBitrate:he,videoGoogleMaxBitrate:re,videoGoogleMinBitrate:pe}=b,fe=P.codecs.find(ue=>ue.payloadType===v.payloadType);switch(v.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":I!==void 0&&(fe.parameters["sprop-stereo"]=I?1:0,y.stereo=I?1:0),N!==void 0&&(fe.parameters.useinbandfec=N?1:0,y.useinbandfec=N?1:0),M!==void 0&&(fe.parameters.usedtx=M?1:0,y.usedtx=M?1:0),U!==void 0&&(y.maxplaybackrate=U),j!==void 0&&(y.maxaveragebitrate=j),Q!==void 0&&(fe.parameters.ptime=Q,y.ptime=Q),Y||(fe.rtcpFeedback=fe.rtcpFeedback.filter(ue=>ue.type!=="nack"||ue.parameter),T=T.filter(ue=>ue.type!=="nack"||ue.parameter));break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":he!==void 0&&(y["x-google-start-bitrate"]=he),re!==void 0&&(y["x-google-max-bitrate"]=re),pe!==void 0&&(y["x-google-min-bitrate"]=pe)}}const L={payload:v.payloadType,config:""};for(const I of Object.keys(y))L.config&&(L.config+=";"),L.config+=`${I}=${y[I]}`;L.config&&this._mediaObject.fmtp.push(L);for(const I of T)this._mediaObject.rtcpFb.push({payload:v.payloadType,type:I.type,subtype:I.parameter})}this._mediaObject.payloads=D.codecs.map(v=>v.payloadType).join(" "),this._mediaObject.ext=[];for(const v of D.headerExtensions)(x.ext||[]).some(_=>_.uri===v.uri)&&this._mediaObject.ext.push({uri:v.uri,value:v.id});if(w&&x.extmapAllowMixed==="extmap-allow-mixed"&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),x.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:x.simulcast.list1},this._mediaObject.rids=[];for(const v of x.rids||[])v.direction==="send"&&this._mediaObject.rids.push({id:v.id,direction:"recv"})}else if(x.simulcast_03){this._mediaObject.simulcast_03={value:x.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const v of x.rids||[])v.direction==="send"&&this._mediaObject.rids.push({id:v.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&this._mediaObject.type==="video"&&(this._mediaObject.xGoogleFlag="conference");break;case"application":typeof x.sctpPort=="number"?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=R.port,this._mediaObject.maxMessageSize=R.maxMessageSize):x.sctpmap&&(this._mediaObject.payloads=R.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:R.port,maxMessageSize:R.maxMessageSize})}}setDtlsRole(m){switch(m){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(m){var k;if(!this._mediaObject.simulcast||!this._mediaObject.simulcast.list1)return;const E={};for(const C of m)C.rid&&(E[C.rid]=C);const S=this._mediaObject.simulcast.list1,R=f.parseSimulcastStreamList(S);for(const C of R)for(const x of C)x.paused=!((k=E[x.scid])!=null&&k.active);this._mediaObject.simulcast.list1=R.map(C=>C.map(x=>`${x.paused?"~":""}${x.scid}`).join(",")).join(";")}};function d(m){const E=new RegExp("^(audio|video)/(.+)","i").exec(m.mimeType);if(!E)throw new TypeError("invalid codec.mimeType");return E[2]}c.OfferMediaSection=class extends p{constructor({iceParameters:m,iceCandidates:E,dtlsParameters:S,sctpParameters:R,plainRtpParameters:k,planB:C=!1,mid:x,kind:P,offerRtpParameters:D,streamId:b,trackId:w,oldDataChannelSpec:v=!1}){switch(super({iceParameters:m,iceCandidates:E,dtlsParameters:S,planB:C}),this._mediaObject.mid=String(x),this._mediaObject.type=P,k?(this._mediaObject.connection={ip:k.ip,version:k.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=k.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.protocol=R?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),P){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${b||"-"} ${w}`);for(const L of D.codecs){const I={payload:L.payloadType,codec:d(L),rate:L.clockRate};L.channels>1&&(I.encoding=L.channels),this._mediaObject.rtp.push(I);const N={payload:L.payloadType,config:""};for(const M of Object.keys(L.parameters))N.config&&(N.config+=";"),N.config+=`${M}=${L.parameters[M]}`;N.config&&this._mediaObject.fmtp.push(N);for(const M of L.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:L.payloadType,type:M.type,subtype:M.parameter})}this._mediaObject.payloads=D.codecs.map(L=>L.payloadType).join(" "),this._mediaObject.ext=[];for(const L of D.headerExtensions)this._mediaObject.ext.push({uri:L.uri,value:L.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const _=D.encodings[0],y=_.ssrc,T=_.rtx&&_.rtx.ssrc?_.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],D.rtcp.cname&&this._mediaObject.ssrcs.push({id:y,attribute:"cname",value:D.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:y,attribute:"msid",value:`${b||"-"} ${w}`}),T&&(D.rtcp.cname&&this._mediaObject.ssrcs.push({id:T,attribute:"cname",value:D.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:T,attribute:"msid",value:`${b||"-"} ${w}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${y} ${T}`}));break}case"application":v?(this._mediaObject.payloads=R.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:R.port,maxMessageSize:R.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=R.port,this._mediaObject.maxMessageSize=R.maxMessageSize)}}setDtlsRole(m){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}planBReceive({offerRtpParameters:m,streamId:E,trackId:S}){const R=m.encodings[0],k=R.ssrc,C=R.rtx&&R.rtx.ssrc?R.rtx.ssrc:void 0,x=this._mediaObject.payloads.split(" ");for(const P of m.codecs){if(x.includes(String(P.payloadType)))continue;const D={payload:P.payloadType,codec:d(P),rate:P.clockRate};P.channels>1&&(D.encoding=P.channels),this._mediaObject.rtp.push(D);const b={payload:P.payloadType,config:""};for(const w of Object.keys(P.parameters))b.config&&(b.config+=";"),b.config+=`${w}=${P.parameters[w]}`;b.config&&this._mediaObject.fmtp.push(b);for(const w of P.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:P.payloadType,type:w.type,subtype:w.parameter})}this._mediaObject.payloads+=` ${m.codecs.filter(P=>!this._mediaObject.payloads.includes(P.payloadType)).map(P=>P.payloadType).join(" ")}`,this._mediaObject.payloads=this._mediaObject.payloads.trim(),m.rtcp.cname&&this._mediaObject.ssrcs.push({id:k,attribute:"cname",value:m.rtcp.cname}),this._mediaObject.ssrcs.push({id:k,attribute:"msid",value:`${E||"-"} ${S}`}),C&&(m.rtcp.cname&&this._mediaObject.ssrcs.push({id:C,attribute:"cname",value:m.rtcp.cname}),this._mediaObject.ssrcs.push({id:C,attribute:"msid",value:`${E||"-"} ${S}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${k} ${C}`}))}planBStopReceiving({offerRtpParameters:m}){const E=m.encodings[0],S=E.ssrc,R=E.rtx&&E.rtx.ssrc?E.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(k=>k.id!==S&&k.id!==R),R&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(k=>k.ssrcs!==`${S} ${R}`))}}},1305:function(a,c,o){var l=this&&this.__createBinding||(Object.create?function(m,E,S,R){R===void 0&&(R=S);var k=Object.getOwnPropertyDescriptor(E,S);k&&!("get"in k?!E.__esModule:k.writable||k.configurable)||(k={enumerable:!0,get:function(){return E[S]}}),Object.defineProperty(m,R,k)}:function(m,E,S,R){R===void 0&&(R=S),m[R]=E[S]}),u=this&&this.__setModuleDefault||(Object.create?function(m,E){Object.defineProperty(m,"default",{enumerable:!0,value:E})}:function(m,E){m.default=E}),h=this&&this.__importStar||function(m){if(m&&m.__esModule)return m;var E={};if(m!=null)for(var S in m)S!=="default"&&Object.prototype.hasOwnProperty.call(m,S)&&l(E,m,S);return u(E,m),E};Object.defineProperty(c,"__esModule",{value:!0}),c.RemoteSdp=void 0;const f=h(o(7363)),g=o(2994),p=o(3471),d=new g.Logger("RemoteSdp");c.RemoteSdp=class{constructor({iceParameters:m,iceCandidates:E,dtlsParameters:S,sctpParameters:R,plainRtpParameters:k,planB:C=!1}){if(this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=m,this._iceCandidates=E,this._dtlsParameters=S,this._sctpParameters=R,this._plainRtpParameters=k,this._planB=C,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},m&&m.iceLite&&(this._sdpObject.icelite="ice-lite"),S){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const x=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:S.fingerprints[x-1].algorithm,hash:S.fingerprints[x-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}k&&(this._sdpObject.origin.address=k.ip,this._sdpObject.origin.ipVer=k.ipVersion)}updateIceParameters(m){d.debug("updateIceParameters() [iceParameters:%o]",m),this._iceParameters=m,this._sdpObject.icelite=m.iceLite?"ice-lite":void 0;for(const E of this._mediaSections)E.setIceParameters(m)}updateDtlsRole(m){d.debug("updateDtlsRole() [role:%s]",m),this._dtlsParameters.role=m;for(const E of this._mediaSections)E.setDtlsRole(m)}getNextMediaSectionIdx(){for(let m=0;m<this._mediaSections.length;++m){const E=this._mediaSections[m];if(E.closed)return{idx:m,reuseMid:E.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:m,reuseMid:E,offerRtpParameters:S,answerRtpParameters:R,codecOptions:k,extmapAllowMixed:C=!1}){const x=new p.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:m,offerRtpParameters:S,answerRtpParameters:R,codecOptions:k,extmapAllowMixed:C});E?this._replaceMediaSection(x,E):this._midToIndex.has(x.mid)?this._replaceMediaSection(x):this._addMediaSection(x)}receive({mid:m,kind:E,offerRtpParameters:S,streamId:R,trackId:k}){const C=this._midToIndex.get(m);let x;if(C!==void 0&&(x=this._mediaSections[C]),x)x.planBReceive({offerRtpParameters:S,streamId:R,trackId:k}),this._replaceMediaSection(x);else{x=new p.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:m,kind:E,offerRtpParameters:S,streamId:R,trackId:k});const P=this._mediaSections.find(D=>D.closed);P?this._replaceMediaSection(x,P.mid):this._addMediaSection(x)}}pauseMediaSection(m){this._findMediaSection(m).pause()}resumeSendingMediaSection(m){this._findMediaSection(m).resume()}resumeReceivingMediaSection(m){this._findMediaSection(m).resume()}disableMediaSection(m){this._findMediaSection(m).disable()}closeMediaSection(m){const E=this._findMediaSection(m);return m===this._firstMid?(d.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",m),this.disableMediaSection(m),!1):(E.close(),this._regenerateBundleMids(),!0)}muxMediaSectionSimulcast(m,E){const S=this._findMediaSection(m);S.muxSimulcastStreams(E),this._replaceMediaSection(S)}planBStopReceiving({mid:m,offerRtpParameters:E}){const S=this._findMediaSection(m);S.planBStopReceiving({offerRtpParameters:E}),this._replaceMediaSection(S)}sendSctpAssociation({offerMediaObject:m}){const E=new p.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:m});this._addMediaSection(E)}receiveSctpAssociation({oldDataChannelSpec:m=!1}={}){const E=new p.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:m});this._addMediaSection(E)}getSdp(){return this._sdpObject.origin.sessionVersion++,f.write(this._sdpObject)}_addMediaSection(m){this._firstMid||(this._firstMid=m.mid),this._mediaSections.push(m),this._midToIndex.set(m.mid,this._mediaSections.length-1),this._sdpObject.media.push(m.getObject()),this._regenerateBundleMids()}_replaceMediaSection(m,E){if(typeof E=="string"){const S=this._midToIndex.get(E);if(S===void 0)throw new Error(`no media section found for reuseMid '${E}'`);const R=this._mediaSections[S];this._mediaSections[S]=m,this._midToIndex.delete(R.mid),this._midToIndex.set(m.mid,S),this._sdpObject.media[S]=m.getObject(),this._regenerateBundleMids()}else{const S=this._midToIndex.get(m.mid);if(S===void 0)throw new Error(`no media section found with mid '${m.mid}'`);this._mediaSections[S]=m,this._sdpObject.media[S]=m.getObject()}}_findMediaSection(m){const E=this._midToIndex.get(m);if(E===void 0)throw new Error(`no media section found with mid '${m}'`);return this._mediaSections[E]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(m=>!m.closed).map(m=>m.mid).join(" "))}}},5544:function(a,c,o){var l=this&&this.__createBinding||(Object.create?function(g,p,d,m){m===void 0&&(m=d);var E=Object.getOwnPropertyDescriptor(p,d);E&&!("get"in E?!p.__esModule:E.writable||E.configurable)||(E={enumerable:!0,get:function(){return p[d]}}),Object.defineProperty(g,m,E)}:function(g,p,d,m){m===void 0&&(m=d),g[m]=p[d]}),u=this&&this.__setModuleDefault||(Object.create?function(g,p){Object.defineProperty(g,"default",{enumerable:!0,value:p})}:function(g,p){g.default=p}),h=this&&this.__importStar||function(g){if(g&&g.__esModule)return g;var p={};if(g!=null)for(var d in g)d!=="default"&&Object.prototype.hasOwnProperty.call(g,d)&&l(p,g,d);return u(p,g),p};Object.defineProperty(c,"__esModule",{value:!0}),c.applyCodecParameters=c.getCname=c.extractDtlsParameters=c.extractRtpCapabilities=void 0;const f=h(o(7363));c.extractRtpCapabilities=function({sdpObject:g}){const p=new Map,d=[];let m=!1,E=!1;for(const S of g.media){const R=S.type;switch(R){case"audio":if(m)continue;m=!0;break;case"video":if(E)continue;E=!0;break;default:continue}for(const k of S.rtp){const C={kind:R,mimeType:`${R}/${k.codec}`,preferredPayloadType:k.payload,clockRate:k.rate,channels:k.encoding,parameters:{},rtcpFeedback:[]};p.set(C.preferredPayloadType,C)}for(const k of S.fmtp||[]){const C=f.parseParams(k.config),x=p.get(k.payload);x&&(C&&C.hasOwnProperty("profile-level-id")&&(C["profile-level-id"]=String(C["profile-level-id"])),x.parameters=C)}for(const k of S.rtcpFb||[]){const C={type:k.type,parameter:k.subtype};if(C.parameter||delete C.parameter,k.payload!=="*"){const x=p.get(k.payload);if(!x)continue;x.rtcpFeedback.push(C)}else for(const x of p.values())x.kind!==R||/.+\/rtx$/i.test(x.mimeType)||x.rtcpFeedback.push(C)}for(const k of S.ext||[]){if(k["encrypt-uri"])continue;const C={kind:R,uri:k.uri,preferredId:k.value};d.push(C)}}return{codecs:Array.from(p.values()),headerExtensions:d}},c.extractDtlsParameters=function({sdpObject:g}){let p,d=g.setup,m=g.fingerprint;if(!d||!m){const E=(g.media||[]).find(S=>S.port!==0);E&&(d??(d=E.setup),m??(m=E.fingerprint))}if(!d)throw new Error("no a=setup found at SDP session or media level");if(!m)throw new Error("no a=fingerprint found at SDP session or media level");switch(d){case"active":p="client";break;case"passive":p="server";break;case"actpass":p="auto"}return{role:p,fingerprints:[{algorithm:m.type,value:m.hash}]}},c.getCname=function({offerMediaObject:g}){const p=(g.ssrcs||[]).find(d=>d.attribute==="cname");return p?p.value:""},c.applyCodecParameters=function({offerRtpParameters:g,answerMediaObject:p}){for(const d of g.codecs){const m=d.mimeType.toLowerCase();if(m!=="audio/opus"||!(p.rtp||[]).find(R=>R.payload===d.payloadType))continue;p.fmtp=p.fmtp||[];let E=p.fmtp.find(R=>R.payload===d.payloadType);E||(E={payload:d.payloadType,config:""},p.fmtp.push(E));const S=f.parseParams(E.config);switch(m){case"audio/opus":{const R=d.parameters["sprop-stereo"];R!==void 0&&(S.stereo=R?1:0);break}}E.config="";for(const R of Object.keys(S))E.config&&(E.config+=";"),E.config+=`${R}=${S[R]}`}}},4496:(a,c)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.addLegacySimulcast=c.getRtpEncodings=void 0,c.getRtpEncodings=function({offerMediaObject:o,track:l}){const u=new Set;for(const g of o.ssrcs||[])if(g.attribute==="msid"&&g.value.split(" ")[1]===l.id){const p=g.id;u.add(p)}if(u.size===0)throw new Error(`a=ssrc line with msid information not found [track.id:${l.id}]`);const h=new Map;for(const g of o.ssrcGroups||[]){if(g.semantics!=="FID")continue;let[p,d]=g.ssrcs.split(/\s+/);p=Number(p),d=Number(d),u.has(p)&&(u.delete(p),u.delete(d),h.set(p,d))}for(const g of u)h.set(g,null);const f=[];for(const[g,p]of h){const d={ssrc:g};p&&(d.rtx={ssrc:p}),f.push(d)}return f},c.addLegacySimulcast=function({offerMediaObject:o,track:l,numStreams:u}){if(u<=1)throw new TypeError("numStreams must be greater than 1");let h,f,g;if(!(o.ssrcs||[]).find(S=>S.attribute!=="msid"?!1:S.value.split(" ")[1]===l.id&&(h=S.id,g=S.value.split(" ")[0],!0)))throw new Error(`a=ssrc line with msid information not found [track.id:${l.id}]`);(o.ssrcGroups||[]).some(S=>{if(S.semantics!=="FID")return!1;const R=S.ssrcs.split(/\s+/);return Number(R[0])===h&&(f=Number(R[1]),!0)});const p=o.ssrcs.find(S=>S.attribute==="cname"&&S.id===h);if(!p)throw new Error(`a=ssrc line with cname information not found [track.id:${l.id}]`);const d=p.value,m=[],E=[];for(let S=0;S<u;++S)m.push(h+S),f&&E.push(f+S);o.ssrcGroups=o.ssrcGroups||[],o.ssrcs=o.ssrcs||[],o.ssrcGroups.push({semantics:"SIM",ssrcs:m.join(" ")});for(let S=0;S<m.length;++S){const R=m[S];o.ssrcs.push({id:R,attribute:"cname",value:d}),o.ssrcs.push({id:R,attribute:"msid",value:`${g} ${l.id}`})}for(let S=0;S<E.length;++S){const R=m[S],k=E[S];o.ssrcs.push({id:k,attribute:"cname",value:d}),o.ssrcs.push({id:k,attribute:"msid",value:`${g} ${l.id}`}),o.ssrcGroups.push({semantics:"FID",ssrcs:`${R} ${k}`})}}},5938:(a,c)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.addLegacySimulcast=c.getRtpEncodings=void 0,c.getRtpEncodings=function({offerMediaObject:o}){const l=new Set;for(const f of o.ssrcs||[]){const g=f.id;l.add(g)}if(l.size===0)throw new Error("no a=ssrc lines found");const u=new Map;for(const f of o.ssrcGroups||[]){if(f.semantics!=="FID")continue;let[g,p]=f.ssrcs.split(/\s+/);g=Number(g),p=Number(p),l.has(g)&&(l.delete(g),l.delete(p),u.set(g,p))}for(const f of l)u.set(f,null);const h=[];for(const[f,g]of u){const p={ssrc:f};g&&(p.rtx={ssrc:g}),h.push(p)}return h},c.addLegacySimulcast=function({offerMediaObject:o,numStreams:l}){if(l<=1)throw new TypeError("numStreams must be greater than 1");const u=(o.ssrcs||[]).find(R=>R.attribute==="msid");if(!u)throw new Error("a=ssrc line with msid information not found");const[h,f]=u.value.split(" "),g=u.id;let p;(o.ssrcGroups||[]).some(R=>{if(R.semantics!=="FID")return!1;const k=R.ssrcs.split(/\s+/);return Number(k[0])===g&&(p=Number(k[1]),!0)});const d=o.ssrcs.find(R=>R.attribute==="cname");if(!d)throw new Error("a=ssrc line with cname information not found");const m=d.value,E=[],S=[];for(let R=0;R<l;++R)E.push(g+R),p&&S.push(p+R);o.ssrcGroups=[],o.ssrcs=[],o.ssrcGroups.push({semantics:"SIM",ssrcs:E.join(" ")});for(let R=0;R<E.length;++R){const k=E[R];o.ssrcs.push({id:k,attribute:"cname",value:m}),o.ssrcs.push({id:k,attribute:"msid",value:`${h} ${f}`})}for(let R=0;R<S.length;++R){const k=E[R],C=S[R];o.ssrcs.push({id:C,attribute:"cname",value:m}),o.ssrcs.push({id:C,attribute:"msid",value:`${h} ${f}`}),o.ssrcGroups.push({semantics:"FID",ssrcs:`${k} ${C}`})}}},76:function(a,c,o){var l=this&&this.__createBinding||(Object.create?function(E,S,R,k){k===void 0&&(k=R);var C=Object.getOwnPropertyDescriptor(S,R);C&&!("get"in C?!S.__esModule:C.writable||C.configurable)||(C={enumerable:!0,get:function(){return S[R]}}),Object.defineProperty(E,k,C)}:function(E,S,R,k){k===void 0&&(k=R),E[k]=S[R]}),u=this&&this.__setModuleDefault||(Object.create?function(E,S){Object.defineProperty(E,"default",{enumerable:!0,value:S})}:function(E,S){E.default=S}),h=this&&this.__importStar||function(E){if(E&&E.__esModule)return E;var S={};if(E!=null)for(var R in E)R!=="default"&&Object.prototype.hasOwnProperty.call(E,R)&&l(S,E,R);return u(S,E),S},f=this&&this.__importDefault||function(E){return E&&E.__esModule?E:{default:E}};Object.defineProperty(c,"__esModule",{value:!0}),c.debug=c.parseScalabilityMode=c.detectDevice=c.Device=c.version=c.types=void 0;const g=f(o(7833));c.debug=g.default;const p=o(6004);Object.defineProperty(c,"Device",{enumerable:!0,get:function(){return p.Device}}),Object.defineProperty(c,"detectDevice",{enumerable:!0,get:function(){return p.detectDevice}});const d=h(o(8057));c.types=d,c.version="3.7.7";var m=o(3303);Object.defineProperty(c,"parseScalabilityMode",{enumerable:!0,get:function(){return m.parse}})},8046:function(a,c,o){var l=this&&this.__createBinding||(Object.create?function(b,w,v,_){_===void 0&&(_=v);var y=Object.getOwnPropertyDescriptor(w,v);y&&!("get"in y?!w.__esModule:y.writable||y.configurable)||(y={enumerable:!0,get:function(){return w[v]}}),Object.defineProperty(b,_,y)}:function(b,w,v,_){_===void 0&&(_=v),b[_]=w[v]}),u=this&&this.__setModuleDefault||(Object.create?function(b,w){Object.defineProperty(b,"default",{enumerable:!0,value:w})}:function(b,w){b.default=w}),h=this&&this.__importStar||function(b){if(b&&b.__esModule)return b;var w={};if(b!=null)for(var v in b)v!=="default"&&Object.prototype.hasOwnProperty.call(b,v)&&l(w,b,v);return u(w,b),w};Object.defineProperty(c,"__esModule",{value:!0}),c.canReceive=c.canSend=c.generateProbatorRtpParameters=c.reduceCodecs=c.getSendingRemoteRtpParameters=c.getSendingRtpParameters=c.getRecvRtpCapabilities=c.getExtendedRtpCapabilities=c.validateSctpCapabilities=c.validateSctpStreamParameters=c.validateRtpParameters=c.validateRtpCapabilities=void 0;const f=h(o(3200)),g=h(o(1765));function p(b){if(typeof b!="object")throw new TypeError("params is not an object");if(b.mid&&typeof b.mid!="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(b.codecs))throw new TypeError("missing params.codecs");for(const w of b.codecs)S(w);if(b.headerExtensions&&!Array.isArray(b.headerExtensions))throw new TypeError("params.headerExtensions is not an array");b.headerExtensions||(b.headerExtensions=[]);for(const w of b.headerExtensions)R(w);if(b.encodings&&!Array.isArray(b.encodings))throw new TypeError("params.encodings is not an array");b.encodings||(b.encodings=[]);for(const w of b.encodings)k(w);if(b.rtcp&&typeof b.rtcp!="object")throw new TypeError("params.rtcp is not an object");b.rtcp||(b.rtcp={}),function(w){if(typeof w!="object")throw new TypeError("rtcp is not an object");if(w.cname&&typeof w.cname!="string")throw new TypeError("invalid rtcp.cname");w.reducedSize&&typeof w.reducedSize=="boolean"||(w.reducedSize=!0)}(b.rtcp)}function d(b){const w=new RegExp("^(audio|video)/(.+)","i");if(typeof b!="object")throw new TypeError("codec is not an object");if(!b.mimeType||typeof b.mimeType!="string")throw new TypeError("missing codec.mimeType");const v=w.exec(b.mimeType);if(!v)throw new TypeError("invalid codec.mimeType");if(b.kind=v[1].toLowerCase(),b.preferredPayloadType&&typeof b.preferredPayloadType!="number")throw new TypeError("invalid codec.preferredPayloadType");if(typeof b.clockRate!="number")throw new TypeError("missing codec.clockRate");b.kind==="audio"?typeof b.channels!="number"&&(b.channels=1):delete b.channels,b.parameters&&typeof b.parameters=="object"||(b.parameters={});for(const _ of Object.keys(b.parameters)){let y=b.parameters[_];if(y===void 0&&(b.parameters[_]="",y=""),typeof y!="string"&&typeof y!="number")throw new TypeError(`invalid codec parameter [key:${_}s, value:${y}]`);if(_==="apt"&&typeof y!="number")throw new TypeError("invalid codec apt parameter")}b.rtcpFeedback&&Array.isArray(b.rtcpFeedback)||(b.rtcpFeedback=[]);for(const _ of b.rtcpFeedback)m(_)}function m(b){if(typeof b!="object")throw new TypeError("fb is not an object");if(!b.type||typeof b.type!="string")throw new TypeError("missing fb.type");b.parameter&&typeof b.parameter=="string"||(b.parameter="")}function E(b){if(typeof b!="object")throw new TypeError("ext is not an object");if(b.kind!=="audio"&&b.kind!=="video")throw new TypeError("invalid ext.kind");if(!b.uri||typeof b.uri!="string")throw new TypeError("missing ext.uri");if(typeof b.preferredId!="number")throw new TypeError("missing ext.preferredId");if(b.preferredEncrypt&&typeof b.preferredEncrypt!="boolean")throw new TypeError("invalid ext.preferredEncrypt");if(b.preferredEncrypt||(b.preferredEncrypt=!1),b.direction&&typeof b.direction!="string")throw new TypeError("invalid ext.direction");b.direction||(b.direction="sendrecv")}function S(b){const w=new RegExp("^(audio|video)/(.+)","i");if(typeof b!="object")throw new TypeError("codec is not an object");if(!b.mimeType||typeof b.mimeType!="string")throw new TypeError("missing codec.mimeType");const v=w.exec(b.mimeType);if(!v)throw new TypeError("invalid codec.mimeType");if(typeof b.payloadType!="number")throw new TypeError("missing codec.payloadType");if(typeof b.clockRate!="number")throw new TypeError("missing codec.clockRate");v[1].toLowerCase()==="audio"?typeof b.channels!="number"&&(b.channels=1):delete b.channels,b.parameters&&typeof b.parameters=="object"||(b.parameters={});for(const _ of Object.keys(b.parameters)){let y=b.parameters[_];if(y===void 0&&(b.parameters[_]="",y=""),typeof y!="string"&&typeof y!="number")throw new TypeError(`invalid codec parameter [key:${_}s, value:${y}]`);if(_==="apt"&&typeof y!="number")throw new TypeError("invalid codec apt parameter")}b.rtcpFeedback&&Array.isArray(b.rtcpFeedback)||(b.rtcpFeedback=[]);for(const _ of b.rtcpFeedback)m(_)}function R(b){if(typeof b!="object")throw new TypeError("ext is not an object");if(!b.uri||typeof b.uri!="string")throw new TypeError("missing ext.uri");if(typeof b.id!="number")throw new TypeError("missing ext.id");if(b.encrypt&&typeof b.encrypt!="boolean")throw new TypeError("invalid ext.encrypt");b.encrypt||(b.encrypt=!1),b.parameters&&typeof b.parameters=="object"||(b.parameters={});for(const w of Object.keys(b.parameters)){let v=b.parameters[w];if(v===void 0&&(b.parameters[w]="",v=""),typeof v!="string"&&typeof v!="number")throw new TypeError("invalid header extension parameter")}}function k(b){if(typeof b!="object")throw new TypeError("encoding is not an object");if(b.ssrc&&typeof b.ssrc!="number")throw new TypeError("invalid encoding.ssrc");if(b.rid&&typeof b.rid!="string")throw new TypeError("invalid encoding.rid");if(b.rtx&&typeof b.rtx!="object")throw new TypeError("invalid encoding.rtx");if(b.rtx&&typeof b.rtx.ssrc!="number")throw new TypeError("missing encoding.rtx.ssrc");if(b.dtx&&typeof b.dtx=="boolean"||(b.dtx=!1),b.scalabilityMode&&typeof b.scalabilityMode!="string")throw new TypeError("invalid encoding.scalabilityMode")}function C(b){return!!b&&/.+\/rtx$/i.test(b.mimeType)}function x(b,w,{strict:v=!1,modify:_=!1}={}){const y=b.mimeType.toLowerCase();if(y!==w.mimeType.toLowerCase()||b.clockRate!==w.clockRate||b.channels!==w.channels)return!1;switch(y){case"video/h264":if(v){if((b.parameters["packetization-mode"]||0)!==(w.parameters["packetization-mode"]||0)||!f.isSameProfile(b.parameters,w.parameters))return!1;let T;try{T=f.generateProfileLevelIdStringForAnswer(b.parameters,w.parameters)}catch{return!1}_&&(T?(b.parameters["profile-level-id"]=T,w.parameters["profile-level-id"]=T):(delete b.parameters["profile-level-id"],delete w.parameters["profile-level-id"]))}break;case"video/vp9":if(v&&(b.parameters["profile-id"]||0)!==(w.parameters["profile-id"]||0))return!1}return!0}function P(b,w){return(!b.kind||!w.kind||b.kind===w.kind)&&b.uri===w.uri}function D(b,w){const v=[];for(const _ of b.rtcpFeedback||[]){const y=(w.rtcpFeedback||[]).find(T=>T.type===_.type&&(T.parameter===_.parameter||!T.parameter&&!_.parameter));y&&v.push(y)}return v}c.validateRtpCapabilities=function(b){if(typeof b!="object")throw new TypeError("caps is not an object");if(b.codecs&&!Array.isArray(b.codecs))throw new TypeError("caps.codecs is not an array");b.codecs||(b.codecs=[]);for(const w of b.codecs)d(w);if(b.headerExtensions&&!Array.isArray(b.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");b.headerExtensions||(b.headerExtensions=[]);for(const w of b.headerExtensions)E(w)},c.validateRtpParameters=p,c.validateSctpStreamParameters=function(b){if(typeof b!="object")throw new TypeError("params is not an object");if(typeof b.streamId!="number")throw new TypeError("missing params.streamId");let w=!1;if(typeof b.ordered=="boolean"?w=!0:b.ordered=!0,b.maxPacketLifeTime&&typeof b.maxPacketLifeTime!="number")throw new TypeError("invalid params.maxPacketLifeTime");if(b.maxRetransmits&&typeof b.maxRetransmits!="number")throw new TypeError("invalid params.maxRetransmits");if(b.maxPacketLifeTime&&b.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(w&&b.ordered&&(b.maxPacketLifeTime||b.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(w||!b.maxPacketLifeTime&&!b.maxRetransmits||(b.ordered=!1),b.label&&typeof b.label!="string")throw new TypeError("invalid params.label");if(b.protocol&&typeof b.protocol!="string")throw new TypeError("invalid params.protocol")},c.validateSctpCapabilities=function(b){if(typeof b!="object")throw new TypeError("caps is not an object");if(!b.numStreams||typeof b.numStreams!="object")throw new TypeError("missing caps.numStreams");(function(w){if(typeof w!="object")throw new TypeError("numStreams is not an object");if(typeof w.OS!="number")throw new TypeError("missing numStreams.OS");if(typeof w.MIS!="number")throw new TypeError("missing numStreams.MIS")})(b.numStreams)},c.getExtendedRtpCapabilities=function(b,w){const v={codecs:[],headerExtensions:[]};for(const _ of w.codecs||[]){if(C(_))continue;const y=(b.codecs||[]).find(L=>x(L,_,{strict:!0,modify:!0}));if(!y)continue;const T={mimeType:y.mimeType,kind:y.kind,clockRate:y.clockRate,channels:y.channels,localPayloadType:y.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:_.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:y.parameters,remoteParameters:_.parameters,rtcpFeedback:D(y,_)};v.codecs.push(T)}for(const _ of v.codecs){const y=b.codecs.find(L=>C(L)&&L.parameters.apt===_.localPayloadType),T=w.codecs.find(L=>C(L)&&L.parameters.apt===_.remotePayloadType);y&&T&&(_.localRtxPayloadType=y.preferredPayloadType,_.remoteRtxPayloadType=T.preferredPayloadType)}for(const _ of w.headerExtensions){const y=b.headerExtensions.find(L=>P(L,_));if(!y)continue;const T={kind:_.kind,uri:_.uri,sendId:y.preferredId,recvId:_.preferredId,encrypt:y.preferredEncrypt,direction:"sendrecv"};switch(_.direction){case"sendrecv":T.direction="sendrecv";break;case"recvonly":T.direction="sendonly";break;case"sendonly":T.direction="recvonly";break;case"inactive":T.direction="inactive"}v.headerExtensions.push(T)}return v},c.getRecvRtpCapabilities=function(b){const w={codecs:[],headerExtensions:[]};for(const v of b.codecs){const _={mimeType:v.mimeType,kind:v.kind,preferredPayloadType:v.remotePayloadType,clockRate:v.clockRate,channels:v.channels,parameters:v.localParameters,rtcpFeedback:v.rtcpFeedback};if(w.codecs.push(_),!v.remoteRtxPayloadType)continue;const y={mimeType:`${v.kind}/rtx`,kind:v.kind,preferredPayloadType:v.remoteRtxPayloadType,clockRate:v.clockRate,parameters:{apt:v.remotePayloadType},rtcpFeedback:[]};w.codecs.push(y)}for(const v of b.headerExtensions){if(v.direction!=="sendrecv"&&v.direction!=="recvonly")continue;const _={kind:v.kind,uri:v.uri,preferredId:v.recvId,preferredEncrypt:v.encrypt,direction:v.direction};w.headerExtensions.push(_)}return w},c.getSendingRtpParameters=function(b,w){const v={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const _ of w.codecs){if(_.kind!==b)continue;const y={mimeType:_.mimeType,payloadType:_.localPayloadType,clockRate:_.clockRate,channels:_.channels,parameters:_.localParameters,rtcpFeedback:_.rtcpFeedback};if(v.codecs.push(y),_.localRtxPayloadType){const T={mimeType:`${_.kind}/rtx`,payloadType:_.localRtxPayloadType,clockRate:_.clockRate,parameters:{apt:_.localPayloadType},rtcpFeedback:[]};v.codecs.push(T)}}for(const _ of w.headerExtensions){if(_.kind&&_.kind!==b||_.direction!=="sendrecv"&&_.direction!=="sendonly")continue;const y={uri:_.uri,id:_.sendId,encrypt:_.encrypt,parameters:{}};v.headerExtensions.push(y)}return v},c.getSendingRemoteRtpParameters=function(b,w){const v={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const _ of w.codecs){if(_.kind!==b)continue;const y={mimeType:_.mimeType,payloadType:_.localPayloadType,clockRate:_.clockRate,channels:_.channels,parameters:_.remoteParameters,rtcpFeedback:_.rtcpFeedback};if(v.codecs.push(y),_.localRtxPayloadType){const T={mimeType:`${_.kind}/rtx`,payloadType:_.localRtxPayloadType,clockRate:_.clockRate,parameters:{apt:_.localPayloadType},rtcpFeedback:[]};v.codecs.push(T)}}for(const _ of w.headerExtensions){if(_.kind&&_.kind!==b||_.direction!=="sendrecv"&&_.direction!=="sendonly")continue;const y={uri:_.uri,id:_.sendId,encrypt:_.encrypt,parameters:{}};v.headerExtensions.push(y)}if(v.headerExtensions.some(_=>_.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"))for(const _ of v.codecs)_.rtcpFeedback=(_.rtcpFeedback||[]).filter(y=>y.type!=="goog-remb");else if(v.headerExtensions.some(_=>_.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"))for(const _ of v.codecs)_.rtcpFeedback=(_.rtcpFeedback||[]).filter(y=>y.type!=="transport-cc");else for(const _ of v.codecs)_.rtcpFeedback=(_.rtcpFeedback||[]).filter(y=>y.type!=="transport-cc"&&y.type!=="goog-remb");return v},c.reduceCodecs=function(b,w){const v=[];if(w){for(let _=0;_<b.length;++_)if(x(b[_],w,{strict:!0})){v.push(b[_]),C(b[_+1])&&v.push(b[_+1]);break}if(v.length===0)throw new TypeError("no matching codec found")}else v.push(b[0]),C(b[1])&&v.push(b[1]);return v},c.generateProbatorRtpParameters=function(b){p(b=g.clone(b));const w={mid:"probator",codecs:[],headerExtensions:[],encodings:[{ssrc:1234}],rtcp:{cname:"probator"}};return w.codecs.push(b.codecs[0]),w.codecs[0].payloadType=127,w.headerExtensions=b.headerExtensions,w},c.canSend=function(b,w){return w.codecs.some(v=>v.kind===b)},c.canReceive=function(b,w){if(p(b),b.codecs.length===0)return!1;const v=b.codecs[0];return w.codecs.some(_=>_.remotePayloadType===v.payloadType)}},3303:(a,c)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.parse=void 0;const o=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");c.parse=function(l){const u=o.exec(l||"");return u?{spatialLayers:Number(u[1]),temporalLayers:Number(u[2])}:{spatialLayers:1,temporalLayers:1}}},8057:function(a,c,o){var l=this&&this.__createBinding||(Object.create?function(h,f,g,p){p===void 0&&(p=g);var d=Object.getOwnPropertyDescriptor(f,g);d&&!("get"in d?!f.__esModule:d.writable||d.configurable)||(d={enumerable:!0,get:function(){return f[g]}}),Object.defineProperty(h,p,d)}:function(h,f,g,p){p===void 0&&(p=g),h[p]=f[g]}),u=this&&this.__exportStar||function(h,f){for(var g in h)g==="default"||Object.prototype.hasOwnProperty.call(f,g)||l(f,h,g)};Object.defineProperty(c,"__esModule",{value:!0}),u(o(6004),c),u(o(5601),c),u(o(9792),c),u(o(3518),c),u(o(7504),c),u(o(9166),c),u(o(5370),c),u(o(4160),c),u(o(521),c),u(o(4893),c)},1765:(a,c)=>{Object.defineProperty(c,"__esModule",{value:!0}),c.deepFreeze=c.generateRandomNumber=c.clone=void 0,c.clone=function(o){return o===void 0?void 0:Number.isNaN(o)?NaN:typeof structuredClone=="function"?structuredClone(o):JSON.parse(JSON.stringify(o))},c.generateRandomNumber=function(){return Math.round(1e7*Math.random())},c.deepFreeze=function o(l){const u=Reflect.ownKeys(l);for(const h of u){const f=l[h];(f&&typeof f=="object"||typeof f=="function")&&o(f)}return Object.freeze(l)}},6585:a=>{var c=1e3,o=60*c,l=60*o,u=24*l,h=7*u,f=365.25*u;function g(p,d,m,E){var S=d>=1.5*m;return Math.round(p/m)+" "+E+(S?"s":"")}a.exports=function(p,d){d=d||{};var m=typeof p;if(m==="string"&&p.length>0)return function(E){if(!((E=String(E)).length>100)){var S=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(E);if(S){var R=parseFloat(S[1]);switch((S[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return R*f;case"weeks":case"week":case"w":return R*h;case"days":case"day":case"d":return R*u;case"hours":case"hour":case"hrs":case"hr":case"h":return R*l;case"minutes":case"minute":case"mins":case"min":case"m":return R*o;case"seconds":case"second":case"secs":case"sec":case"s":return R*c;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return R;default:return}}}}(p);if(m==="number"&&isFinite(p))return d.long?function(E){var S=Math.abs(E);return S>=u?g(E,S,u,"day"):S>=l?g(E,S,l,"hour"):S>=o?g(E,S,o,"minute"):S>=c?g(E,S,c,"second"):E+" ms"}(p):function(E){var S=Math.abs(E);return S>=u?Math.round(E/u)+"d":S>=l?Math.round(E/l)+"h":S>=o?Math.round(E/o)+"m":S>=c?Math.round(E/c)+"s":E+"ms"}(p);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(p))}},4252:(a,c,o)=>{const{EventEmitter:l}=o(7007),u=o(3612);a.exports=class extends l{constructor(h){super(),this.setMaxListeners(1/0),this._logger=h||new u("EnhancedEventEmitter")}safeEmit(h,...f){try{this.emit(h,...f)}catch(g){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",h,g)}}async safeEmitAsPromise(h,...f){return new Promise((g,p)=>{this.safeEmit(h,...f,g,p)})}}},3612:(a,c,o)=>{const l=o(7833),u="protoo-client";a.exports=class{constructor(h){h?(this._debug=l(`${u}:${h}`),this._warn=l(`${u}:WARN:${h}`),this._error=l(`${u}:ERROR:${h}`)):(this._debug=l(u),this._warn=l(`${u}:WARN`),this._error=l(`${u}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},3241:(a,c,o)=>{const l=o(3612),{generateRandomNumber:u}=o(9007),h=new l("Message");a.exports=class{static parse(f){let g;const p={};try{g=JSON.parse(f)}catch(d){return void h.error("parse() | invalid JSON: %s",d)}if(typeof g=="object"&&!Array.isArray(g)){if(g.request){if(p.request=!0,typeof g.method!="string")return void h.error("parse() | missing/invalid method field");if(typeof g.id!="number")return void h.error("parse() | missing/invalid id field");p.id=g.id,p.method=g.method,p.data=g.data||{}}else if(g.response){if(p.response=!0,typeof g.id!="number")return void h.error("parse() | missing/invalid id field");p.id=g.id,g.ok?(p.ok=!0,p.data=g.data||{}):(p.ok=!1,p.errorCode=g.errorCode,p.errorReason=g.errorReason)}else{if(!g.notification)return void h.error("parse() | missing request/response field");if(p.notification=!0,typeof g.method!="string")return void h.error("parse() | missing/invalid method field");p.method=g.method,p.data=g.data||{}}return p}h.error("parse() | not an object")}static createRequest(f,g){return{request:!0,id:u(),method:f,data:g||{}}}static createSuccessResponse(f,g){return{response:!0,id:f.id,ok:!0,data:g||{}}}static createErrorResponse(f,g,p){return{response:!0,id:f.id,ok:!1,errorCode:g,errorReason:p}}static createNotification(f,g){return{notification:!0,method:f,data:g||{}}}}},7204:(a,c,o)=>{const l=o(3612),u=o(4252),h=o(3241),f=new l("Peer");a.exports=class extends u{constructor(g){super(f),f.debug("constructor()"),this._closed=!1,this._transport=g,this._connected=!1,this._data={},this._sents=new Map,this._handleTransport()}get closed(){return this._closed}get connected(){return this._connected}get data(){return this._data}set data(g){throw new Error("cannot override data object")}close(){if(!this._closed){f.debug("close()"),this._closed=!0,this._connected=!1,this._transport.close();for(const g of this._sents.values())g.close();this.safeEmit("close")}}async request(g,p=void 0){const d=h.createRequest(g,p);return this._logger.debug("request() [method:%s, id:%s]",g,d.id),await this._transport.send(d),new Promise((m,E)=>{const S=1500*(15+.1*this._sents.size),R={id:d.id,method:d.method,resolve:k=>{this._sents.delete(d.id)&&(clearTimeout(R.timer),m(k))},reject:k=>{this._sents.delete(d.id)&&(clearTimeout(R.timer),E(k))},timer:setTimeout(()=>{this._sents.delete(d.id)&&E(new Error("request timeout"))},S),close:()=>{clearTimeout(R.timer),E(new Error("peer closed"))}};this._sents.set(d.id,R)})}async notify(g,p=void 0){const d=h.createNotification(g,p);this._logger.debug("notify() [method:%s]",g),await this._transport.send(d)}_handleTransport(){if(this._transport.closed)return this._closed=!0,void setTimeout(()=>{this._closed||(this._connected=!1,this.safeEmit("close"))});this._transport.on("open",()=>{this._closed||(f.debug('emit "open"'),this._connected=!0,this.safeEmit("open"))}),this._transport.on("disconnected",()=>{this._closed||(f.debug('emit "disconnected"'),this._connected=!1,this.safeEmit("disconnected"))}),this._transport.on("failed",g=>{this._closed||(f.debug('emit "failed" [currentAttempt:%s]',g),this._connected=!1,this.safeEmit("failed",g))}),this._transport.on("close",()=>{this._closed||(this._closed=!0,f.debug('emit "close"'),this._connected=!1,this.safeEmit("close"))}),this._transport.on("message",g=>{g.request?this._handleRequest(g):g.response?this._handleResponse(g):g.notification&&this._handleNotification(g)})}_handleRequest(g){try{this.emit("request",g,p=>{const d=h.createSuccessResponse(g,p);this._transport.send(d).catch(()=>{})},(p,d)=>{p instanceof Error?(d=p.message,p=500):typeof p=="number"&&d instanceof Error&&(d=d.message);const m=h.createErrorResponse(g,p,d);this._transport.send(m).catch(()=>{})})}catch(p){const d=h.createErrorResponse(g,500,String(p));this._transport.send(d).catch(()=>{})}}_handleResponse(g){const p=this._sents.get(g.id);if(p)if(g.ok)p.resolve(g.data);else{const d=new Error(g.errorReason);d.code=g.errorCode,p.reject(d)}else f.error("received response does not match any sent request [id:%s]",g.id)}_handleNotification(g){this.safeEmit("notification",g)}}},9566:(a,c,o)=>{o(7949);const l=o(7204),u=o(3545);c.xM=l,c.TJ=u},3545:(a,c,o)=>{const l=o(952).w3cwebsocket,u=o(5617),h=o(3612),f=o(4252),g=o(3241),p={retries:10,factor:2,minTimeout:1e3,maxTimeout:8e3},d=new h("WebSocketTransport");a.exports=class extends f{constructor(m,E){super(d),d.debug("constructor() [url:%s, options:%o]",m,E),this._closed=!1,this._url=m,this._options=E||{},this._ws=null,this._runWebSocket()}get closed(){return this._closed}close(){if(!this._closed){d.debug("close()"),this._closed=!0,this.safeEmit("close");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(m){d.error("close() | error closing the WebSocket: %o",m)}}}async send(m){if(this._closed)throw new Error("transport closed");try{this._ws.send(JSON.stringify(m))}catch(E){throw d.warn("send() failed:%o",E),E}}_runWebSocket(){const m=u.operation(this._options.retry||p);let E=!1;m.attempt(S=>{this._closed?m.stop():(d.debug("_runWebSocket() [currentAttempt:%s]",S),this._ws=new l(this._url,"protoo",this._options.origin,this._options.headers,this._options.requestOptions,this._options.clientConfig),this._ws.onopen=()=>{this._closed||(E=!0,this.safeEmit("open"))},this._ws.onclose=R=>{if(!this._closed){if(d.warn('WebSocket "close" event [wasClean:%s, code:%s, reason:"%s"]',R.wasClean,R.code,R.reason),R.code!==4e3){if(E)return m.stop(),this.safeEmit("disconnected"),this._closed?void 0:void this._runWebSocket();if(this.safeEmit("failed",S),this._closed||m.retry(!0))return}this._closed=!0,this.safeEmit("close")}},this._ws.onerror=()=>{this._closed||d.error('WebSocket "error" event')},this._ws.onmessage=R=>{if(this._closed)return;const k=g.parse(R.data);k&&(this.listenerCount("message")!==0?this.safeEmit("message",k):d.error('no listeners for WebSocket "message" event, ignoring received message'))})})}}},9007:(a,c)=>{c.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},9596:(a,c,o)=>{let l;a.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:o.g):u=>(l||(l=Promise.resolve())).then(u).catch(h=>setTimeout(()=>{throw h},0))},2211:a=>{a.exports=function(c){var o,l,u="",h=(c=function(g){return g||(g={}),{length:g.length||8,numeric:typeof g.numeric!="boolean"||g.numeric,letters:typeof g.letters!="boolean"||g.letters,special:typeof g.special=="boolean"&&g.special,exclude:Array.isArray(g.exclude)?g.exclude:[]}}(c)).length,f=(c.exclude,function(g){var p="";g.numeric&&(p+="0123456789"),g.letters&&(p+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"),g.special&&(p+="!$%^&*()_+|~-=`{}[]:;<>?,./");for(var d=0;d<=g.exclude.length;d++)p=p.replace(g.exclude[d],"");return p}(c));for(o=1;o<=h;o++)u+=f.substring(l=Math.floor(Math.random()*f.length),l+1);return u}},5617:(a,c,o)=>{a.exports=o(8303)},8303:(a,c,o)=>{var l=o(3961);c.operation=function(u){var h=c.timeouts(u);return new l(h,{forever:u&&u.forever,unref:u&&u.unref,maxRetryTime:u&&u.maxRetryTime})},c.timeouts=function(u){if(u instanceof Array)return[].concat(u);var h={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var f in u)h[f]=u[f];if(h.minTimeout>h.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var g=[],p=0;p<h.retries;p++)g.push(this.createTimeout(p,h));return u&&u.forever&&!g.length&&g.push(this.createTimeout(p,h)),g.sort(function(d,m){return d-m}),g},c.createTimeout=function(u,h){var f=h.randomize?Math.random()+1:1,g=Math.round(f*h.minTimeout*Math.pow(h.factor,u));return g=Math.min(g,h.maxTimeout)},c.wrap=function(u,h,f){if(h instanceof Array&&(f=h,h=null),!f)for(var g in f=[],u)typeof u[g]=="function"&&f.push(g);for(var p=0;p<f.length;p++){var d=f[p],m=u[d];u[d]=(function(E){var S=c.operation(h),R=Array.prototype.slice.call(arguments,1),k=R.pop();R.push(function(C){S.retry(C)||(C&&(arguments[0]=S.mainError()),k.apply(this,arguments))}),S.attempt(function(){E.apply(u,R)})}).bind(u,m),u[d].options=h}}},3961:a=>{function c(o,l){typeof l=="boolean"&&(l={forever:l}),this._originalTimeouts=JSON.parse(JSON.stringify(o)),this._timeouts=o,this._options=l||{},this._maxRetryTime=l&&l.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}a.exports=c,c.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},c.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},c.prototype.retry=function(o){if(this._timeout&&clearTimeout(this._timeout),!o)return!1;var l=new Date().getTime();if(o&&l-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(o);var u=this._timeouts.shift();if(u===void 0){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),u=this._timeouts.shift()}var h=this,f=setTimeout(function(){h._attempts++,h._operationTimeoutCb&&(h._timeout=setTimeout(function(){h._operationTimeoutCb(h._attempts)},h._operationTimeout),h._options.unref&&h._timeout.unref()),h._fn(h._attempts)},u);return this._options.unref&&f.unref(),!0},c.prototype.attempt=function(o,l){this._fn=o,l&&(l.timeout&&(this._operationTimeout=l.timeout),l.cb&&(this._operationTimeoutCb=l.cb));var u=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){u._operationTimeoutCb()},u._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},c.prototype.try=function(o){console.log("Using RetryOperation.try() is deprecated"),this.attempt(o)},c.prototype.start=function(o){console.log("Using RetryOperation.start() is deprecated"),this.attempt(o)},c.prototype.start=c.prototype.try,c.prototype.errors=function(){return this._errors},c.prototype.attempts=function(){return this._attempts},c.prototype.mainError=function(){if(this._errors.length===0)return null;for(var o={},l=null,u=0,h=0;h<this._errors.length;h++){var f=this._errors[h],g=f.message,p=(o[g]||0)+1;o[g]=p,p>=u&&(l=f,u=p)}return l}},5602:a=>{var c=a.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(o){return o.encoding?"rtpmap:%d %s/%s/%s":o.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(o){return o.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(o){return o.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(o){return"extmap:%d"+(o.direction?"/%s":"%v")+(o["encrypt-uri"]?" %s":"%v")+" %s"+(o.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(o){return o.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(o){var l="candidate:%s %d %s %d %s %d typ %s";return l+=o.raddr!=null?" raddr %s rport %d":"%v%v",l+=o.tcptype!=null?" tcptype %s":"%v",o.generation!=null&&(l+=" generation %d"),l+=o["network-id"]!=null?" network-id %d":"%v",l+=o["network-cost"]!=null?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(o){var l="ssrc:%d";return o.attribute!=null&&(l+=" %s",o.value!=null&&(l+=":%s")),l}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(o){return o.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(o){return o.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(o){return"imageattr:%s %s %s"+(o.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(o){return"simulcast:%s %s"+(o.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(o){return"ts-refclk:%s"+(o.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(o){var l="mediaclk:";return l+=o.id!=null?"id=%s %s":"%v%s",l+=o.mediaClockValue!=null?"=%s":"",l+=o.rateNumerator!=null?" rate=%s":"",l+=o.rateDenominator!=null?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(c).forEach(function(o){c[o].forEach(function(l){l.reg||(l.reg=/(.*)/),l.format||(l.format="%s")})})},7363:(a,c,o)=>{var l=o(5020),u=o(3804);c.write=u,c.parse=l.parse,c.parseParams=l.parseParams,c.parseFmtpConfig=l.parseFmtpConfig,c.parsePayloads=l.parsePayloads,c.parseRemoteCandidates=l.parseRemoteCandidates,c.parseImageAttributes=l.parseImageAttributes,c.parseSimulcastStreamList=l.parseSimulcastStreamList},5020:(a,c,o)=>{var l=function(p){return String(Number(p))===p?Number(p):p},u=function(p,d,m){var E=p.name&&p.names;p.push&&!d[p.push]?d[p.push]=[]:E&&!d[p.name]&&(d[p.name]={});var S=p.push?{}:E?d[p.name]:d;(function(R,k,C,x){if(x&&!C)k[x]=l(R[1]);else for(var P=0;P<C.length;P+=1)R[P+1]!=null&&(k[C[P]]=l(R[P+1]))})(m.match(p.reg),S,p.names,p.name),p.push&&d[p.push].push(S)},h=o(5602),f=RegExp.prototype.test.bind(/^([a-z])=(.*)/);c.parse=function(p){var d={},m=[],E=d;return p.split(/(\r\n|\r|\n)/).filter(f).forEach(function(S){var R=S[0],k=S.slice(2);R==="m"&&(m.push({rtp:[],fmtp:[]}),E=m[m.length-1]);for(var C=0;C<(h[R]||[]).length;C+=1){var x=h[R][C];if(x.reg.test(k))return u(x,E,k)}}),d.media=m,d};var g=function(p,d){var m=d.split(/=(.+)/,2);return m.length===2?p[m[0]]=l(m[1]):m.length===1&&d.length>1&&(p[m[0]]=void 0),p};c.parseParams=function(p){return p.split(/;\s?/).reduce(g,{})},c.parseFmtpConfig=c.parseParams,c.parsePayloads=function(p){return p.toString().split(" ").map(Number)},c.parseRemoteCandidates=function(p){for(var d=[],m=p.split(" ").map(l),E=0;E<m.length;E+=3)d.push({component:m[E],ip:m[E+1],port:m[E+2]});return d},c.parseImageAttributes=function(p){return p.split(" ").map(function(d){return d.substring(1,d.length-1).split(",").reduce(g,{})})},c.parseSimulcastStreamList=function(p){return p.split(";").map(function(d){return d.split(",").map(function(m){var E,S=!1;return m[0]!=="~"?E=l(m):(E=l(m.substring(1,m.length)),S=!0),{scid:E,paused:S}})})}},3804:(a,c,o)=>{var l=o(5602),u=/%[sdv%]/g,h=function(d){var m=1,E=arguments,S=E.length;return d.replace(u,function(R){if(m>=S)return R;var k=E[m];switch(m+=1,R){case"%%":return"%";case"%s":return String(k);case"%d":return Number(k);case"%v":return""}})},f=function(d,m,E){var S=[d+"="+(m.format instanceof Function?m.format(m.push?E:E[m.name]):m.format)];if(m.names)for(var R=0;R<m.names.length;R+=1){var k=m.names[R];m.name?S.push(E[m.name][k]):S.push(E[m.names[R]])}else S.push(E[m.name]);return h.apply(null,S)},g=["v","o","s","i","u","e","p","c","b","t","r","z","a"],p=["i","c","b","a"];a.exports=function(d,m){m=m||{},d.version==null&&(d.version=0),d.name==null&&(d.name=" "),d.media.forEach(function(k){k.payloads==null&&(k.payloads="")});var E=m.outerOrder||g,S=m.innerOrder||p,R=[];return E.forEach(function(k){l[k].forEach(function(C){C.name in d&&d[C.name]!=null?R.push(f(k,C,d)):C.push in d&&d[C.push]!=null&&d[C.push].forEach(function(x){R.push(f(k,C,x))})})}),d.media.forEach(function(k){R.push(f("m",l.m[0],k)),S.forEach(function(C){l[C].forEach(function(x){x.name in k&&k[x.name]!=null?R.push(f(C,x,k)):x.push in k&&k[x.push]!=null&&k[x.push].forEach(function(P){R.push(f(C,x,P))})})})}),R.join(`\r
`)+`\r
`}},7232:function(a,c,o){var l;(function(u,h){var f="function",g="undefined",p="object",d="string",m="major",E="model",S="name",R="type",k="vendor",C="version",x="architecture",P="console",D="mobile",b="tablet",w="smarttv",v="wearable",_="embedded",y="Amazon",T="Apple",L="ASUS",I="BlackBerry",N="Browser",M="Chrome",U="Firefox",j="Google",Q="Huawei",Y="LG",he="Microsoft",re="Motorola",pe="Opera",fe="Samsung",ue="Sharp",ee="Sony",Z="Xiaomi",le="Zebra",ye="Facebook",mt="Chromium OS",Ye="Mac OS",ct=function(Qt){for(var zt={},At=0;At<Qt.length;At++)zt[Qt[At].toUpperCase()]=Qt[At];return zt},ht=function(Qt,zt){return typeof Qt===d&&kt(zt).indexOf(kt(Qt))!==-1},kt=function(Qt){return Qt.toLowerCase()},Sr=function(Qt,zt){if(typeof Qt===d)return Qt=Qt.replace(/^\s\s*/,""),typeof zt===g?Qt:Qt.substring(0,500)},wt=function(Qt,zt){for(var At,Lr,yt,Qe,Et,Ae,Ne=0;Ne<zt.length&&!Et;){var Ze=zt[Ne],Oe=zt[Ne+1];for(At=Lr=0;At<Ze.length&&!Et&&Ze[At];)if(Et=Ze[At++].exec(Qt))for(yt=0;yt<Oe.length;yt++)Ae=Et[++Lr],typeof(Qe=Oe[yt])===p&&Qe.length>0?Qe.length===2?typeof Qe[1]==f?this[Qe[0]]=Qe[1].call(this,Ae):this[Qe[0]]=Qe[1]:Qe.length===3?typeof Qe[1]!==f||Qe[1].exec&&Qe[1].test?this[Qe[0]]=Ae?Ae.replace(Qe[1],Qe[2]):h:this[Qe[0]]=Ae?Qe[1].call(this,Ae,Qe[2]):h:Qe.length===4&&(this[Qe[0]]=Ae?Qe[3].call(this,Ae.replace(Qe[1],Qe[2])):h):this[Qe]=Ae||h;Ne+=2}},Zt=function(Qt,zt){for(var At in zt)if(typeof zt[At]===p&&zt[At].length>0){for(var Lr=0;Lr<zt[At].length;Lr++)if(ht(zt[At][Lr],Qt))return At==="?"?h:At}else if(ht(zt[At],Qt))return At==="?"?h:At;return Qt},vr={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Wr={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[C,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[C,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,C],[/opios[\/ ]+([\w\.]+)/i],[C,[S,pe+" Mini"]],[/\bopr\/([\w\.]+)/i],[C,[S,pe]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[C,[S,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[S,C],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[C,[S,"UC"+N]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[C,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[C,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[C,[S,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[C,[S,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[C,[S,"Smart Lenovo "+N]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+N],C],[/\bfocus\/([\w\.]+)/i],[C,[S,U+" Focus"]],[/\bopt\/([\w\.]+)/i],[C,[S,pe+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[C,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[C,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[C,[S,pe+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[C,[S,"MIUI "+N]],[/fxios\/([-\w\.]+)/i],[C,[S,U]],[/\bqihu|(qi?ho?o?|360)browser/i],[[S,"360 "+N]],[/(oculus|sailfish|huawei|vivo)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1 "+N],C],[/samsungbrowser\/([\w\.]+)/i],[C,[S,fe+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[S,/_/g," "],C],[/metasr[\/ ]?([\d\.]+)/i],[C,[S,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[S,"Sogou Mobile"],C],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[S,C],[/(lbbrowser)/i,/\[(linkedin)app\]/i],[S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,ye],C],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[S,C],[/\bgsa\/([\w\.]+) .*safari\//i],[C,[S,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[C,[S,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[C,[S,M+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,M+" WebView"],C],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[C,[S,"Android "+N]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,C],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[C,[S,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[C,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[C,Zt,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[S,C],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],C],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[C,[S,U+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[S,C],[/(cobalt)\/([\w\.]+)/i],[S,[C,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[x,"amd64"]],[/(ia32(?=;))/i],[[x,kt]],[/((?:i[346]|x)86)[;\)]/i],[[x,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[x,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[x,"armhf"]],[/windows (ce|mobile); ppc;/i],[[x,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[x,/ower/,"",kt]],[/(sun4\w)[;\)]/i],[[x,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[x,kt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[E,[k,fe],[R,b]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[E,[k,fe],[R,D]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[E,[k,T],[R,D]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[E,[k,T],[R,b]],[/(macintosh);/i],[E,[k,T]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[E,[k,ue],[R,D]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[E,[k,Q],[R,b]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[E,[k,Q],[R,D]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[E,/_/g," "],[k,Z],[R,D]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[E,/_/g," "],[k,Z],[R,b]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[E,[k,"OPPO"],[R,D]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[E,[k,"Vivo"],[R,D]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[E,[k,"Realme"],[R,D]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[E,[k,re],[R,D]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[E,[k,re],[R,b]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[E,[k,Y],[R,b]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[E,[k,Y],[R,D]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[E,[k,"Lenovo"],[R,b]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[E,/_/g," "],[k,"Nokia"],[R,D]],[/(pixel c)\b/i],[E,[k,j],[R,b]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[E,[k,j],[R,D]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[E,[k,ee],[R,D]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[E,"Xperia Tablet"],[k,ee],[R,b]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[E,[k,"OnePlus"],[R,D]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[E,[k,y],[R,b]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[E,/(.+)/g,"Fire Phone $1"],[k,y],[R,D]],[/(playbook);[-\w\),; ]+(rim)/i],[E,k,[R,b]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[E,[k,I],[R,D]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[E,[k,L],[R,b]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[E,[k,L],[R,D]],[/(nexus 9)/i],[E,[k,"HTC"],[R,b]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[k,[E,/_/g," "],[R,D]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[E,[k,"Acer"],[R,b]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[E,[k,"Meizu"],[R,D]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[E,[k,"Ulefone"],[R,D]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[k,E,[R,D]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[k,E,[R,b]],[/(surface duo)/i],[E,[k,he],[R,b]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[E,[k,"Fairphone"],[R,D]],[/(u304aa)/i],[E,[k,"AT&T"],[R,D]],[/\bsie-(\w*)/i],[E,[k,"Siemens"],[R,D]],[/\b(rct\w+) b/i],[E,[k,"RCA"],[R,b]],[/\b(venue[\d ]{2,7}) b/i],[E,[k,"Dell"],[R,b]],[/\b(q(?:mv|ta)\w+) b/i],[E,[k,"Verizon"],[R,b]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[E,[k,"Barnes & Noble"],[R,b]],[/\b(tm\d{3}\w+) b/i],[E,[k,"NuVision"],[R,b]],[/\b(k88) b/i],[E,[k,"ZTE"],[R,b]],[/\b(nx\d{3}j) b/i],[E,[k,"ZTE"],[R,D]],[/\b(gen\d{3}) b.+49h/i],[E,[k,"Swiss"],[R,D]],[/\b(zur\d{3}) b/i],[E,[k,"Swiss"],[R,b]],[/\b((zeki)?tb.*\b) b/i],[E,[k,"Zeki"],[R,b]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[k,"Dragon Touch"],E,[R,b]],[/\b(ns-?\w{0,9}) b/i],[E,[k,"Insignia"],[R,b]],[/\b((nxa|next)-?\w{0,9}) b/i],[E,[k,"NextBook"],[R,b]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[k,"Voice"],E,[R,D]],[/\b(lvtel\-)?(v1[12]) b/i],[[k,"LvTel"],E,[R,D]],[/\b(ph-1) /i],[E,[k,"Essential"],[R,D]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[E,[k,"Envizen"],[R,b]],[/\b(trio[-\w\. ]+) b/i],[E,[k,"MachSpeed"],[R,b]],[/\btu_(1491) b/i],[E,[k,"Rotor"],[R,b]],[/(shield[\w ]+) b/i],[E,[k,"Nvidia"],[R,b]],[/(sprint) (\w+)/i],[k,E,[R,D]],[/(kin\.[onetw]{3})/i],[[E,/\./g," "],[k,he],[R,D]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[E,[k,le],[R,b]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[E,[k,le],[R,D]],[/smart-tv.+(samsung)/i],[k,[R,w]],[/hbbtv.+maple;(\d+)/i],[[E,/^/,"SmartTV"],[k,fe],[R,w]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[k,Y],[R,w]],[/(apple) ?tv/i],[k,[E,T+" TV"],[R,w]],[/crkey/i],[[E,M+"cast"],[k,j],[R,w]],[/droid.+aft(\w+)( bui|\))/i],[E,[k,y],[R,w]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[E,[k,ue],[R,w]],[/(bravia[\w ]+)( bui|\))/i],[E,[k,ee],[R,w]],[/(mitv-\w{5}) bui/i],[E,[k,Z],[R,w]],[/Hbbtv.*(technisat) (.*);/i],[k,E,[R,w]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[k,Sr],[E,Sr],[R,w]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,w]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[k,E,[R,P]],[/droid.+; (shield) bui/i],[E,[k,"Nvidia"],[R,P]],[/(playstation [345portablevi]+)/i],[E,[k,ee],[R,P]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[E,[k,he],[R,P]],[/((pebble))app/i],[k,E,[R,v]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[E,[k,T],[R,v]],[/droid.+; (glass) \d/i],[E,[k,j],[R,v]],[/droid.+; (wt63?0{2,3})\)/i],[E,[k,le],[R,v]],[/(quest( 2| pro)?)/i],[E,[k,ye],[R,v]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[k,[R,_]],[/(aeobc)\b/i],[E,[k,y],[R,_]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[E,[R,D]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[E,[R,b]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,b]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,D]],[/(android[-\w\. ]{0,9});.+buil/i],[E,[k,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[C,[S,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[C,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[S,C],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[C,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,C],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[S,[C,Zt,vr]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[C,Zt,vr],[S,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[C,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,Ye],[C,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[C,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,C],[/\(bb(10);/i],[C,[S,I]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[C,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[C,[S,U+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[C,[S,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[C,[S,"watchOS"]],[/crkey\/([\d\.]+)/i],[C,[S,M+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[S,mt],C],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,C],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],C],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[S,C]]},br=function(Qt,zt){if(typeof Qt===p&&(zt=Qt,Qt=h),!(this instanceof br))return new br(Qt,zt).getResult();var At=typeof u!==g&&u.navigator?u.navigator:h,Lr=Qt||(At&&At.userAgent?At.userAgent:""),yt=At&&At.userAgentData?At.userAgentData:h,Qe=zt?function(Ae,Ne){var Ze={};for(var Oe in Ae)Ne[Oe]&&Ne[Oe].length%2==0?Ze[Oe]=Ne[Oe].concat(Ae[Oe]):Ze[Oe]=Ae[Oe];return Ze}(Wr,zt):Wr,Et=At&&At.userAgent==Lr;return this.getBrowser=function(){var Ae,Ne={};return Ne[S]=h,Ne[C]=h,wt.call(Ne,Lr,Qe.browser),Ne[m]=typeof(Ae=Ne[C])===d?Ae.replace(/[^\d\.]/g,"").split(".")[0]:h,Et&&At&&At.brave&&typeof At.brave.isBrave==f&&(Ne[S]="Brave"),Ne},this.getCPU=function(){var Ae={};return Ae[x]=h,wt.call(Ae,Lr,Qe.cpu),Ae},this.getDevice=function(){var Ae={};return Ae[k]=h,Ae[E]=h,Ae[R]=h,wt.call(Ae,Lr,Qe.device),Et&&!Ae[R]&&yt&&yt.mobile&&(Ae[R]=D),Et&&Ae[E]=="Macintosh"&&At&&typeof At.standalone!==g&&At.maxTouchPoints&&At.maxTouchPoints>2&&(Ae[E]="iPad",Ae[R]=b),Ae},this.getEngine=function(){var Ae={};return Ae[S]=h,Ae[C]=h,wt.call(Ae,Lr,Qe.engine),Ae},this.getOS=function(){var Ae={};return Ae[S]=h,Ae[C]=h,wt.call(Ae,Lr,Qe.os),Et&&!Ae[S]&&yt&&yt.platform!="Unknown"&&(Ae[S]=yt.platform.replace(/chrome os/i,mt).replace(/macos/i,Ye)),Ae},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Lr},this.setUA=function(Ae){return Lr=typeof Ae===d&&Ae.length>500?Sr(Ae,500):Ae,this},this.setUA(Lr),this};br.VERSION="1.0.37",br.BROWSER=ct([S,C,m]),br.CPU=ct([x]),br.DEVICE=ct([E,k,R,P,D,w,b,v,_]),br.ENGINE=br.OS=ct([S,C]),typeof c!==g?(a.exports&&(c=a.exports=br),c.UAParser=br):o.amdO?(l=(function(){return br}).call(c,o,c,a))===h||(a.exports=l):typeof u!==g&&(u.UAParser=br);var Br=typeof u!==g&&(u.jQuery||u.Zepto);if(Br&&!Br.ua){var Jr=new br;Br.ua=Jr.getResult(),Br.ua.get=function(){return Jr.getUA()},Br.ua.set=function(Qt){Jr.setUA(Qt);var zt=Jr.getResult();for(var At in zt)Br.ua[At]=zt[At]}}})(typeof window=="object"?window:this)},952:(a,c,o)=>{var l;if(typeof globalThis=="object")l=globalThis;else try{l=o(4903)}catch{}finally{if(l||typeof window>"u"||(l=window),!l)throw new Error("Could not determine global this")}var u=l.WebSocket||l.MozWebSocket,h=o(9840);function f(g,p){return p?new u(g,p):new u(g)}u&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(g){Object.defineProperty(f,g,{get:function(){return u[g]}})}),a.exports={w3cwebsocket:u?f:null,version:h}},9840:(a,c,o)=>{a.exports=o(9003).version},8624:(a,c,o)=>{o.r(c),o.d(c,{DOMException:()=>v,Headers:()=>m,Request:()=>P,Response:()=>b,fetch:()=>_});var l=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||o.g!==void 0&&o.g||{},u={searchParams:"URLSearchParams"in l,iterable:"Symbol"in l&&"iterator"in Symbol,blob:"FileReader"in l&&"Blob"in l&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in l,arrayBuffer:"ArrayBuffer"in l};if(u.arrayBuffer)var h=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],f=ArrayBuffer.isView||function(y){return y&&h.indexOf(Object.prototype.toString.call(y))>-1};function g(y){if(typeof y!="string"&&(y=String(y)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(y)||y==="")throw new TypeError('Invalid character in header field name: "'+y+'"');return y.toLowerCase()}function p(y){return typeof y!="string"&&(y=String(y)),y}function d(y){var T={next:function(){var L=y.shift();return{done:L===void 0,value:L}}};return u.iterable&&(T[Symbol.iterator]=function(){return T}),T}function m(y){this.map={},y instanceof m?y.forEach(function(T,L){this.append(L,T)},this):Array.isArray(y)?y.forEach(function(T){if(T.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+T.length);this.append(T[0],T[1])},this):y&&Object.getOwnPropertyNames(y).forEach(function(T){this.append(T,y[T])},this)}function E(y){if(!y._noBody)return y.bodyUsed?Promise.reject(new TypeError("Already read")):void(y.bodyUsed=!0)}function S(y){return new Promise(function(T,L){y.onload=function(){T(y.result)},y.onerror=function(){L(y.error)}})}function R(y){var T=new FileReader,L=S(T);return T.readAsArrayBuffer(y),L}function k(y){if(y.slice)return y.slice(0);var T=new Uint8Array(y.byteLength);return T.set(new Uint8Array(y)),T.buffer}function C(){return this.bodyUsed=!1,this._initBody=function(y){var T;this.bodyUsed=this.bodyUsed,this._bodyInit=y,y?typeof y=="string"?this._bodyText=y:u.blob&&Blob.prototype.isPrototypeOf(y)?this._bodyBlob=y:u.formData&&FormData.prototype.isPrototypeOf(y)?this._bodyFormData=y:u.searchParams&&URLSearchParams.prototype.isPrototypeOf(y)?this._bodyText=y.toString():u.arrayBuffer&&u.blob&&(T=y)&&DataView.prototype.isPrototypeOf(T)?(this._bodyArrayBuffer=k(y.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):u.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(y)||f(y))?this._bodyArrayBuffer=k(y):this._bodyText=y=Object.prototype.toString.call(y):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof y=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):u.searchParams&&URLSearchParams.prototype.isPrototypeOf(y)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},u.blob&&(this.blob=function(){var y=E(this);if(y)return y;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var y=E(this);return y||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}if(u.blob)return this.blob().then(R);throw new Error("could not read as ArrayBuffer")},this.text=function(){var y,T,L,I,N,M=E(this);if(M)return M;if(this._bodyBlob)return y=this._bodyBlob,T=new FileReader,L=S(T),I=/charset=([A-Za-z0-9_-]+)/.exec(y.type),N=I?I[1]:"utf-8",T.readAsText(y,N),L;if(this._bodyArrayBuffer)return Promise.resolve(function(U){for(var j=new Uint8Array(U),Q=new Array(j.length),Y=0;Y<j.length;Y++)Q[Y]=String.fromCharCode(j[Y]);return Q.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},u.formData&&(this.formData=function(){return this.text().then(D)}),this.json=function(){return this.text().then(JSON.parse)},this}m.prototype.append=function(y,T){y=g(y),T=p(T);var L=this.map[y];this.map[y]=L?L+", "+T:T},m.prototype.delete=function(y){delete this.map[g(y)]},m.prototype.get=function(y){return y=g(y),this.has(y)?this.map[y]:null},m.prototype.has=function(y){return this.map.hasOwnProperty(g(y))},m.prototype.set=function(y,T){this.map[g(y)]=p(T)},m.prototype.forEach=function(y,T){for(var L in this.map)this.map.hasOwnProperty(L)&&y.call(T,this.map[L],L,this)},m.prototype.keys=function(){var y=[];return this.forEach(function(T,L){y.push(L)}),d(y)},m.prototype.values=function(){var y=[];return this.forEach(function(T){y.push(T)}),d(y)},m.prototype.entries=function(){var y=[];return this.forEach(function(T,L){y.push([L,T])}),d(y)},u.iterable&&(m.prototype[Symbol.iterator]=m.prototype.entries);var x=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function P(y,T){if(!(this instanceof P))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var L,I,N=(T=T||{}).body;if(y instanceof P){if(y.bodyUsed)throw new TypeError("Already read");this.url=y.url,this.credentials=y.credentials,T.headers||(this.headers=new m(y.headers)),this.method=y.method,this.mode=y.mode,this.signal=y.signal,N||y._bodyInit==null||(N=y._bodyInit,y.bodyUsed=!0)}else this.url=String(y);if(this.credentials=T.credentials||this.credentials||"same-origin",!T.headers&&this.headers||(this.headers=new m(T.headers)),this.method=(L=T.method||this.method||"GET",I=L.toUpperCase(),x.indexOf(I)>-1?I:L),this.mode=T.mode||this.mode||null,this.signal=T.signal||this.signal||function(){if("AbortController"in l)return new AbortController().signal}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&N)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(N),!(this.method!=="GET"&&this.method!=="HEAD"||T.cache!=="no-store"&&T.cache!=="no-cache")){var M=/([?&])_=[^&]*/;M.test(this.url)?this.url=this.url.replace(M,"$1_="+new Date().getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+new Date().getTime()}}function D(y){var T=new FormData;return y.trim().split("&").forEach(function(L){if(L){var I=L.split("="),N=I.shift().replace(/\+/g," "),M=I.join("=").replace(/\+/g," ");T.append(decodeURIComponent(N),decodeURIComponent(M))}}),T}function b(y,T){if(!(this instanceof b))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(T||(T={}),this.type="default",this.status=T.status===void 0?200:T.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=T.statusText===void 0?"":""+T.statusText,this.headers=new m(T.headers),this.url=T.url||"",this._initBody(y)}P.prototype.clone=function(){return new P(this,{body:this._bodyInit})},C.call(P.prototype),C.call(b.prototype),b.prototype.clone=function(){return new b(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new m(this.headers),url:this.url})},b.error=function(){var y=new b(null,{status:200,statusText:""});return y.ok=!1,y.status=0,y.type="error",y};var w=[301,302,303,307,308];b.redirect=function(y,T){if(w.indexOf(T)===-1)throw new RangeError("Invalid status code");return new b(null,{status:T,headers:{location:y}})};var v=l.DOMException;try{new v}catch{(v=function(T,L){this.message=T,this.name=L;var I=Error(T);this.stack=I.stack}).prototype=Object.create(Error.prototype),v.prototype.constructor=v}function _(y,T){return new Promise(function(L,I){var N=new P(y,T);if(N.signal&&N.signal.aborted)return I(new v("Aborted","AbortError"));var M=new XMLHttpRequest;function U(){M.abort()}if(M.onload=function(){var Q,Y,he={statusText:M.statusText,headers:(Q=M.getAllResponseHeaders()||"",Y=new m,Q.replace(/\r?\n[\t ]+/g," ").split("\r").map(function(pe){return pe.indexOf(`
`)===0?pe.substr(1,pe.length):pe}).forEach(function(pe){var fe=pe.split(":"),ue=fe.shift().trim();if(ue){var ee=fe.join(":").trim();try{Y.append(ue,ee)}catch(Z){console.warn("Response "+Z.message)}}}),Y)};N.url.indexOf("file://")===0&&(M.status<200||M.status>599)?he.status=200:he.status=M.status,he.url="responseURL"in M?M.responseURL:he.headers.get("X-Request-URL");var re="response"in M?M.response:M.responseText;setTimeout(function(){L(new b(re,he))},0)},M.onerror=function(){setTimeout(function(){I(new TypeError("Network request failed"))},0)},M.ontimeout=function(){setTimeout(function(){I(new TypeError("Network request timed out"))},0)},M.onabort=function(){setTimeout(function(){I(new v("Aborted","AbortError"))},0)},M.open(N.method,function(Q){try{return Q===""&&l.location.href?l.location.href:Q}catch{return Q}}(N.url),!0),N.credentials==="include"?M.withCredentials=!0:N.credentials==="omit"&&(M.withCredentials=!1),"responseType"in M&&(u.blob?M.responseType="blob":u.arrayBuffer&&(M.responseType="arraybuffer")),T&&typeof T.headers=="object"&&!(T.headers instanceof m||l.Headers&&T.headers instanceof l.Headers)){var j=[];Object.getOwnPropertyNames(T.headers).forEach(function(Q){j.push(g(Q)),M.setRequestHeader(Q,p(T.headers[Q]))}),N.headers.forEach(function(Q,Y){j.indexOf(Y)===-1&&M.setRequestHeader(Y,Q)})}else N.headers.forEach(function(Q,Y){M.setRequestHeader(Y,Q)});N.signal&&(N.signal.addEventListener("abort",U),M.onreadystatechange=function(){M.readyState===4&&N.signal.removeEventListener("abort",U)}),M.send(N._bodyInit===void 0?null:N._bodyInit)})}_.polyfill=!0,l.fetch||(l.fetch=_,l.Headers=m,l.Request=P,l.Response=b)},477:()=>{},4633:(a,c,o)=>{var l=o(3738).default;function u(){a.exports=u=function(){return f},a.exports.__esModule=!0,a.exports.default=a.exports;var h,f={},g=Object.prototype,p=g.hasOwnProperty,d=Object.defineProperty||function(ue,ee,Z){ue[ee]=Z.value},m=typeof Symbol=="function"?Symbol:{},E=m.iterator||"@@iterator",S=m.asyncIterator||"@@asyncIterator",R=m.toStringTag||"@@toStringTag";function k(ue,ee,Z){return Object.defineProperty(ue,ee,{value:Z,enumerable:!0,configurable:!0,writable:!0}),ue[ee]}try{k({},"")}catch{k=function(ee,Z,le){return ee[Z]=le}}function C(ue,ee,Z,le){var ye=ee&&ee.prototype instanceof _?ee:_,mt=Object.create(ye.prototype),Ye=new pe(le||[]);return d(mt,"_invoke",{value:Q(ue,Z,Ye)}),mt}function x(ue,ee,Z){try{return{type:"normal",arg:ue.call(ee,Z)}}catch(le){return{type:"throw",arg:le}}}f.wrap=C;var P="suspendedStart",D="suspendedYield",b="executing",w="completed",v={};function _(){}function y(){}function T(){}var L={};k(L,E,function(){return this});var I=Object.getPrototypeOf,N=I&&I(I(fe([])));N&&N!==g&&p.call(N,E)&&(L=N);var M=T.prototype=_.prototype=Object.create(L);function U(ue){["next","throw","return"].forEach(function(ee){k(ue,ee,function(Z){return this._invoke(ee,Z)})})}function j(ue,ee){function Z(ye,mt,Ye,ct){var ht=x(ue[ye],ue,mt);if(ht.type!=="throw"){var kt=ht.arg,Sr=kt.value;return Sr&&l(Sr)=="object"&&p.call(Sr,"__await")?ee.resolve(Sr.__await).then(function(wt){Z("next",wt,Ye,ct)},function(wt){Z("throw",wt,Ye,ct)}):ee.resolve(Sr).then(function(wt){kt.value=wt,Ye(kt)},function(wt){return Z("throw",wt,Ye,ct)})}ct(ht.arg)}var le;d(this,"_invoke",{value:function(ye,mt){function Ye(){return new ee(function(ct,ht){Z(ye,mt,ct,ht)})}return le=le?le.then(Ye,Ye):Ye()}})}function Q(ue,ee,Z){var le=P;return function(ye,mt){if(le===b)throw Error("Generator is already running");if(le===w){if(ye==="throw")throw mt;return{value:h,done:!0}}for(Z.method=ye,Z.arg=mt;;){var Ye=Z.delegate;if(Ye){var ct=Y(Ye,Z);if(ct){if(ct===v)continue;return ct}}if(Z.method==="next")Z.sent=Z._sent=Z.arg;else if(Z.method==="throw"){if(le===P)throw le=w,Z.arg;Z.dispatchException(Z.arg)}else Z.method==="return"&&Z.abrupt("return",Z.arg);le=b;var ht=x(ue,ee,Z);if(ht.type==="normal"){if(le=Z.done?w:D,ht.arg===v)continue;return{value:ht.arg,done:Z.done}}ht.type==="throw"&&(le=w,Z.method="throw",Z.arg=ht.arg)}}}function Y(ue,ee){var Z=ee.method,le=ue.iterator[Z];if(le===h)return ee.delegate=null,Z==="throw"&&ue.iterator.return&&(ee.method="return",ee.arg=h,Y(ue,ee),ee.method==="throw")||Z!=="return"&&(ee.method="throw",ee.arg=new TypeError("The iterator does not provide a '"+Z+"' method")),v;var ye=x(le,ue.iterator,ee.arg);if(ye.type==="throw")return ee.method="throw",ee.arg=ye.arg,ee.delegate=null,v;var mt=ye.arg;return mt?mt.done?(ee[ue.resultName]=mt.value,ee.next=ue.nextLoc,ee.method!=="return"&&(ee.method="next",ee.arg=h),ee.delegate=null,v):mt:(ee.method="throw",ee.arg=new TypeError("iterator result is not an object"),ee.delegate=null,v)}function he(ue){var ee={tryLoc:ue[0]};1 in ue&&(ee.catchLoc=ue[1]),2 in ue&&(ee.finallyLoc=ue[2],ee.afterLoc=ue[3]),this.tryEntries.push(ee)}function re(ue){var ee=ue.completion||{};ee.type="normal",delete ee.arg,ue.completion=ee}function pe(ue){this.tryEntries=[{tryLoc:"root"}],ue.forEach(he,this),this.reset(!0)}function fe(ue){if(ue||ue===""){var ee=ue[E];if(ee)return ee.call(ue);if(typeof ue.next=="function")return ue;if(!isNaN(ue.length)){var Z=-1,le=function ye(){for(;++Z<ue.length;)if(p.call(ue,Z))return ye.value=ue[Z],ye.done=!1,ye;return ye.value=h,ye.done=!0,ye};return le.next=le}}throw new TypeError(l(ue)+" is not iterable")}return y.prototype=T,d(M,"constructor",{value:T,configurable:!0}),d(T,"constructor",{value:y,configurable:!0}),y.displayName=k(T,R,"GeneratorFunction"),f.isGeneratorFunction=function(ue){var ee=typeof ue=="function"&&ue.constructor;return!!ee&&(ee===y||(ee.displayName||ee.name)==="GeneratorFunction")},f.mark=function(ue){return Object.setPrototypeOf?Object.setPrototypeOf(ue,T):(ue.__proto__=T,k(ue,R,"GeneratorFunction")),ue.prototype=Object.create(M),ue},f.awrap=function(ue){return{__await:ue}},U(j.prototype),k(j.prototype,S,function(){return this}),f.AsyncIterator=j,f.async=function(ue,ee,Z,le,ye){ye===void 0&&(ye=Promise);var mt=new j(C(ue,ee,Z,le),ye);return f.isGeneratorFunction(ee)?mt:mt.next().then(function(Ye){return Ye.done?Ye.value:mt.next()})},U(M),k(M,R,"Generator"),k(M,E,function(){return this}),k(M,"toString",function(){return"[object Generator]"}),f.keys=function(ue){var ee=Object(ue),Z=[];for(var le in ee)Z.push(le);return Z.reverse(),function ye(){for(;Z.length;){var mt=Z.pop();if(mt in ee)return ye.value=mt,ye.done=!1,ye}return ye.done=!0,ye}},f.values=fe,pe.prototype={constructor:pe,reset:function(ue){if(this.prev=0,this.next=0,this.sent=this._sent=h,this.done=!1,this.delegate=null,this.method="next",this.arg=h,this.tryEntries.forEach(re),!ue)for(var ee in this)ee.charAt(0)==="t"&&p.call(this,ee)&&!isNaN(+ee.slice(1))&&(this[ee]=h)},stop:function(){this.done=!0;var ue=this.tryEntries[0].completion;if(ue.type==="throw")throw ue.arg;return this.rval},dispatchException:function(ue){if(this.done)throw ue;var ee=this;function Z(ht,kt){return mt.type="throw",mt.arg=ue,ee.next=ht,kt&&(ee.method="next",ee.arg=h),!!kt}for(var le=this.tryEntries.length-1;le>=0;--le){var ye=this.tryEntries[le],mt=ye.completion;if(ye.tryLoc==="root")return Z("end");if(ye.tryLoc<=this.prev){var Ye=p.call(ye,"catchLoc"),ct=p.call(ye,"finallyLoc");if(Ye&&ct){if(this.prev<ye.catchLoc)return Z(ye.catchLoc,!0);if(this.prev<ye.finallyLoc)return Z(ye.finallyLoc)}else if(Ye){if(this.prev<ye.catchLoc)return Z(ye.catchLoc,!0)}else{if(!ct)throw Error("try statement without catch or finally");if(this.prev<ye.finallyLoc)return Z(ye.finallyLoc)}}}},abrupt:function(ue,ee){for(var Z=this.tryEntries.length-1;Z>=0;--Z){var le=this.tryEntries[Z];if(le.tryLoc<=this.prev&&p.call(le,"finallyLoc")&&this.prev<le.finallyLoc){var ye=le;break}}ye&&(ue==="break"||ue==="continue")&&ye.tryLoc<=ee&&ee<=ye.finallyLoc&&(ye=null);var mt=ye?ye.completion:{};return mt.type=ue,mt.arg=ee,ye?(this.method="next",this.next=ye.finallyLoc,v):this.complete(mt)},complete:function(ue,ee){if(ue.type==="throw")throw ue.arg;return ue.type==="break"||ue.type==="continue"?this.next=ue.arg:ue.type==="return"?(this.rval=this.arg=ue.arg,this.method="return",this.next="end"):ue.type==="normal"&&ee&&(this.next=ee),v},finish:function(ue){for(var ee=this.tryEntries.length-1;ee>=0;--ee){var Z=this.tryEntries[ee];if(Z.finallyLoc===ue)return this.complete(Z.completion,Z.afterLoc),re(Z),v}},catch:function(ue){for(var ee=this.tryEntries.length-1;ee>=0;--ee){var Z=this.tryEntries[ee];if(Z.tryLoc===ue){var le=Z.completion;if(le.type==="throw"){var ye=le.arg;re(Z)}return ye}}throw Error("illegal catch attempt")},delegateYield:function(ue,ee,Z){return this.delegate={iterator:fe(ue),resultName:ee,nextLoc:Z},this.method==="next"&&(this.arg=h),v}},f}a.exports=u,a.exports.__esModule=!0,a.exports.default=a.exports},3738:a=>{function c(o){return a.exports=c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(l){return typeof l}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},a.exports.__esModule=!0,a.exports.default=a.exports,c(o)}a.exports=c,a.exports.__esModule=!0,a.exports.default=a.exports},4756:(a,c,o)=>{var l=o(4633)();a.exports=l;try{regeneratorRuntime=l}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=l:Function("r","regeneratorRuntime = r")(l)}},3145:(a,c,o)=>{function l(u,h){(h==null||h>u.length)&&(h=u.length);for(var f=0,g=new Array(h);f<h;f++)g[f]=u[f];return g}o.d(c,{A:()=>l})},467:(a,c,o)=>{function l(h,f,g,p,d,m,E){try{var S=h[m](E),R=S.value}catch(k){return void g(k)}S.done?f(R):Promise.resolve(R).then(p,d)}function u(h){return function(){var f=this,g=arguments;return new Promise(function(p,d){var m=h.apply(f,g);function E(R){l(m,p,d,E,S,"next",R)}function S(R){l(m,p,d,E,S,"throw",R)}E(void 0)})}}o.d(c,{A:()=>u})},3029:(a,c,o)=>{function l(u,h){if(!(u instanceof h))throw new TypeError("Cannot call a class as a function")}o.d(c,{A:()=>l})},2901:(a,c,o)=>{o.d(c,{A:()=>h});var l=o(816);function u(f,g){for(var p=0;p<g.length;p++){var d=g[p];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(f,(0,l.A)(d.key),d)}}function h(f,g,p){return g&&u(f.prototype,g),p&&u(f,p),Object.defineProperty(f,"prototype",{writable:!1}),f}},4467:(a,c,o)=>{o.d(c,{A:()=>u});var l=o(816);function u(h,f,g){return(f=(0,l.A)(f))in h?Object.defineProperty(h,f,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[f]=g,h}},296:(a,c,o)=>{o.d(c,{A:()=>u});var l=o(7800);function u(h,f){return function(g){if(Array.isArray(g))return g}(h)||function(g,p){var d=g==null?null:typeof Symbol<"u"&&g[Symbol.iterator]||g["@@iterator"];if(d!=null){var m,E,S,R,k=[],C=!0,x=!1;try{if(S=(d=d.call(g)).next,p===0){if(Object(d)!==d)return;C=!1}else for(;!(C=(m=S.call(d)).done)&&(k.push(m.value),k.length!==p);C=!0);}catch(P){x=!0,E=P}finally{try{if(!C&&d.return!=null&&(R=d.return(),Object(R)!==R))return}finally{if(x)throw E}}return k}}(h,f)||(0,l.A)(h,f)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}},5458:(a,c,o)=>{o.d(c,{A:()=>h});var l=o(3145),u=o(7800);function h(f){return function(g){if(Array.isArray(g))return(0,l.A)(g)}(f)||function(g){if(typeof Symbol<"u"&&g[Symbol.iterator]!=null||g["@@iterator"]!=null)return Array.from(g)}(f)||(0,u.A)(f)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}},816:(a,c,o)=>{o.d(c,{A:()=>u});var l=o(2284);function u(h){var f=function(g,p){if((0,l.A)(g)!="object"||!g)return g;var d=g[Symbol.toPrimitive];if(d!==void 0){var m=d.call(g,p||"default");if((0,l.A)(m)!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return(p==="string"?String:Number)(g)}(h,"string");return(0,l.A)(f)=="symbol"?f:f+""}},2284:(a,c,o)=>{function l(u){return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},l(u)}o.d(c,{A:()=>l})},7800:(a,c,o)=>{o.d(c,{A:()=>u});var l=o(3145);function u(h,f){if(h){if(typeof h=="string")return(0,l.A)(h,f);var g=Object.prototype.toString.call(h).slice(8,-1);return g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set"?Array.from(h):g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g)?(0,l.A)(h,f):void 0}}},7949:a=>{a.exports=JSON.parse('{"name":"protoo-client","version":"4.0.6","description":"protoo JavaScript client module","author":"Iñaki Baz Castillo <ibc@aliax.net>","homepage":"https://protoo.versatica.com","license":"MIT","repository":{"type":"git","url":"https://github.com/ibc/protoo.git"},"main":"lib/index.js","keywords":["nodejs","browser","websocket"],"engines":{"node":">=8.0.0"},"scripts":{"lint":"eslint -c .eslintrc.js lib"},"dependencies":{"debug":"^4.3.1","events":"^3.2.0","retry":"^0.12.0"},"devDependencies":{"eslint":"^5.16.0"},"optionalDependencies":{"websocket":"^1.0.33"}}')},9003:a=>{a.exports={version:"1.0.34"}}},i={};function s(a){var c=i[a];if(c!==void 0)return c.exports;var o=i[a]={exports:{}};return n[a].call(o.exports,o,o.exports,s),o.exports}return s.amdO={},s.n=a=>{var c=a&&a.__esModule?()=>a.default:()=>a;return s.d(c,{a:c}),c},s.d=(a,c)=>{for(var o in c)s.o(c,o)&&!s.o(a,o)&&Object.defineProperty(a,o,{enumerable:!0,get:c[o]})},s.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),s.o=(a,c)=>Object.prototype.hasOwnProperty.call(a,c),s.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},s(1751)})())})(yb);var Nc=yb.exports,Ir="videosdk-live-react-sdk",De={"participant-joined":Ir+"-participant-joined","participant-left":Ir+"-participant-left","speaker-changed":Ir+"-speaker-changed","presenter-changed":Ir+"-presenter-changed","main-participant-changed":Ir+"-main-participant-changed","entry-requested":Ir+"-entry-requested","entry-responded":Ir+"-entry-responded","recording-started":Ir+"-recording-started","recording-stopped":Ir+"-recording-stopped","chat-message":Ir+"-chat-message","meeting-joined":Ir+"-meeting-joined","meeting-left":Ir+"-meeting-left","live-stream-started":Ir+"-live-stream-started","live-stream-stopped":Ir+"-live-stream-stopped","video-state-changed":Ir+"-video-state-changed","video-seeked":Ir+"-video-seeked","webcam-requested":Ir+"-webcam-requested","mic-requested":Ir+"-mic-requested","pin-state-changed":Ir+"-pin-state-changed","connection-open":Ir+"-connection-open","connection-close":Ir+"-connection-close","switch-meeting":Ir+"-switch-meeting",error:Ir+"-error","hls-started":Ir+"-hls-started","hls-stopped":Ir+"-hls-stopped","hls-state-changed":Ir+"-hls-state-changed","hls-playable-state-changed":Ir+"-hls-playable-state-changed","recording-state-changed":Ir+"-recording-state-changed","livestream-state-changed":Ir+"-livestream-state-changed","meeting-state-changed":Ir+"-meeting-state-changed","participant-mode-changed":Ir+"-participant-mode-changed","transcription-state-changed":Ir+"-transcription-state-changed","transcription-text":Ir+"-transcription-text"},Le=new yx;Le.setMaxListeners(9999);var Rg=Ie.createContext(),pl=function(e){var t=e===void 0?{}:e,n=t.onParticipantJoined,i=n===void 0?function(){}:n,s=t.onParticipantLeft,a=s===void 0?function(){}:s,c=t.onSpeakerChanged,o=c===void 0?function(){}:c,l=t.onPresenterChanged,u=l===void 0?function(){}:l,h=t.onMainParticipantChanged,f=h===void 0?function(){}:h,g=t.onEntryRequested,p=g===void 0?function(){}:g,d=t.onEntryResponded,m=d===void 0?function(){}:d,E=t.onRecordingStarted,S=E===void 0?function(){}:E,R=t.onRecordingStopped,k=R===void 0?function(){}:R,C=t.onChatMessage,x=C===void 0?function(){}:C,P=t.onMeetingJoined,D=P===void 0?function(){}:P,b=t.onMeetingLeft,w=b===void 0?function(){}:b,v=t.onLiveStreamStarted,_=v===void 0?function(){}:v,y=t.onLiveStreamStopped,T=y===void 0?function(){}:y,L=t.onVideoStateChanged,I=L===void 0?function(){}:L,N=t.onVideoSeeked,M=N===void 0?function(){}:N,U=t.onWebcamRequested,j=U===void 0?function(){}:U,Q=t.onMicRequested,Y=Q===void 0?function(){}:Q,he=t.onPinStateChanged,re=he===void 0?function(){}:he,pe=t.onConnectionOpen,fe=pe===void 0?function(){}:pe,ue=t.onConnetionClose,ee=ue===void 0?function(){}:ue,Z=t.onSwitchMeeting,le=Z===void 0?function(){}:Z,ye=t.onError,mt=ye===void 0?function(){}:ye,Ye=t.onHlsStarted,ct=Ye===void 0?function(){}:Ye,ht=t.onHlsStopped,kt=ht===void 0?function(){}:ht,Sr=t.onHlsStateChanged,wt=Sr===void 0?function(){}:Sr,Zt=t.onRecordingStateChanged,vr=Zt===void 0?function(){}:Zt,Wr=t.onLivestreamStateChanged,br=Wr===void 0?function(){}:Wr,Br=t.onMeetingStateChanged,Jr=Br===void 0?function(){}:Br,Qt=t.onParticipantModeChanged,zt=Qt===void 0?function(){}:Qt;return Ie.useEffect(function(){return Le.on(De["participant-joined"],i),Le.on(De["participant-left"],a),Le.on(De["speaker-changed"],o),Le.on(De["presenter-changed"],u),Le.on(De["main-participant-changed"],f),Le.on(De["entry-requested"],p),Le.on(De["entry-responded"],m),Le.on(De["recording-started"],S),Le.on(De["recording-stopped"],k),Le.on(De["chat-message"],x),Le.on(De["meeting-joined"],D),Le.on(De["meeting-left"],w),Le.on(De["live-stream-started"],_),Le.on(De["live-stream-stopped"],T),Le.on(De["video-state-changed"],I),Le.on(De["video-seeked"],M),Le.on(De["webcam-requested"],j),Le.on(De["mic-requested"],Y),Le.on(De["pin-state-changed"],re),Le.on(De["connection-open"],fe),Le.on(De["connection-close"],ee),Le.on(De["switch-meeting"],le),Le.on(De.error,mt),Le.on(De["hls-started"],ct),Le.on(De["hls-stopped"],kt),Le.on(De["hls-state-changed"],wt),Le.on(De["recording-state-changed"],vr),Le.on(De["livestream-state-changed"],br),Le.on(De["meeting-state-changed"],Jr),Le.on(De["participant-mode-changed"],zt),function(){Le.off(De["meeting-state-changed"],Jr),Le.off(De["participant-joined"],i),Le.off(De["participant-left"],a),Le.off(De["speaker-changed"],o),Le.off(De["presenter-changed"],u),Le.off(De["main-participant-changed"],f),Le.off(De["entry-requested"],p),Le.off(De["entry-responded"],m),Le.off(De["recording-started"],S),Le.off(De["recording-stopped"],k),Le.off(De["chat-message"],x),Le.off(De["meeting-joined"],D),Le.off(De["meeting-left"],w),Le.off(De["live-stream-started"],_),Le.off(De["live-stream-stopped"],T),Le.off(De["video-state-changed"],I),Le.off(De["video-seeked"],M),Le.off(De["webcam-requested"],j),Le.off(De["mic-requested"],Y),Le.off(De["pin-state-changed"],re),Le.off(De["connection-open"],fe),Le.off(De["connection-close"],ee),Le.off(De["switch-meeting"],le),Le.off(De.error,mt),Le.off(De["hls-started"],ct),Le.off(De["hls-stopped"],kt),Le.off(De["hls-state-changed"],wt),Le.off(De["recording-state-changed"],vr),Le.off(De["livestream-state-changed"],br),Le.off(De["participant-mode-changed"],zt)}},[]),Ie.useContext(Rg)},_x=function(e){var t=e.children,n=e.onParticipantJoined,i=n===void 0?function(){}:n,s=e.onParticipantLeft,a=s===void 0?function(){}:s,c=e.onSpeakerChanged,o=c===void 0?function(){}:c,l=e.onPresenterChanged,u=l===void 0?function(){}:l,h=e.onMainParticipantChanged,f=h===void 0?function(){}:h,g=e.onEntryRequested,p=g===void 0?function(){}:g,d=e.onEntryResponded,m=d===void 0?function(){}:d,E=e.onRecordingStarted,S=E===void 0?function(){}:E,R=e.onRecordingStopped,k=R===void 0?function(){}:R,C=e.onChatMessage,x=C===void 0?function(){}:C,P=e.onMeetingJoined,D=P===void 0?function(){}:P,b=e.onMeetingLeft,w=b===void 0?function(){}:b,v=e.onLiveStreamStarted,_=v===void 0?function(){}:v,y=e.onLiveStreamStopped,T=y===void 0?function(){}:y,L=e.onVideoStateChanged,I=L===void 0?function(){}:L,N=e.onVideoSeeked,M=N===void 0?function(){}:N,U=e.onWebcamRequested,j=U===void 0?function(){}:U,Q=e.onMicRequested,Y=Q===void 0?function(){}:Q,he=e.onPinStateChanged,re=he===void 0?function(){}:he,pe=e.onConnectionOpen,fe=pe===void 0?function(){}:pe,ue=e.onConnetionClose,ee=ue===void 0?function(){}:ue,Z=e.onSwitchMeeting,le=Z===void 0?function(){}:Z,ye=e.onError,mt=ye===void 0?function(){}:ye,Ye=e.onHlsStarted,ct=Ye===void 0?function(){}:Ye,ht=e.onHlsStopped,kt=ht===void 0?function(){}:ht,Sr=e.onHlsStateChanged,wt=Sr===void 0?function(){}:Sr,Zt=e.onRecordingStateChanged,vr=Zt===void 0?function(){}:Zt,Wr=e.onLivestreamStateChanged,br=Wr===void 0?function(){}:Wr,Br=e.onMeetingStateChanged,Jr=Br===void 0?function(){}:Br,Qt=e.onParticipantModeChanged,zt=Qt===void 0?function(){}:Qt;return Ie.useEffect(function(){return Le.on(De["meeting-state-changed"],Jr),Le.on(De["participant-joined"],i),Le.on(De["participant-left"],a),Le.on(De["speaker-changed"],o),Le.on(De["presenter-changed"],u),Le.on(De["main-participant-changed"],f),Le.on(De["entry-requested"],p),Le.on(De["entry-responded"],m),Le.on(De["recording-started"],S),Le.on(De["recording-stopped"],k),Le.on(De["chat-message"],x),Le.on(De["meeting-joined"],D),Le.on(De["meeting-left"],w),Le.on(De["live-stream-enabled"],_),Le.on(De["live-stream-disabled"],T),Le.on(De["video-state-changed"],I),Le.on(De["video-seeked"],M),Le.on(De["webcam-requested"],j),Le.on(De["mic-requested"],Y),Le.on(De["pin-state-changed"],re),Le.on(De["connection-open"],fe),Le.on(De["connection-close"],ee),Le.on(De["switch-meeting"],le),Le.on(De.error,mt),Le.on(De["hls-started"],ct),Le.on(De["hls-stopped"],kt),Le.on(De["hls-state-changed"],wt),Le.on(De["recording-state-changed"],vr),Le.on(De["livestream-state-changed"],br),Le.on(De["participant-mode-changed"],zt),function(){Le.off(De["meeting-state-changed"],Jr),Le.off(De["participant-joined"],i),Le.off(De["participant-left"],a),Le.off(De["speaker-changed"],o),Le.off(De["presenter-changed"],u),Le.off(De["main-participant-changed"],f),Le.off(De["entry-requested"],p),Le.off(De["entry-responded"],m),Le.off(De["recording-started"],S),Le.off(De["recording-stopped"],k),Le.off(De["chat-message"],x),Le.off(De["meeting-joined"],D),Le.off(De["meeting-left"],w),Le.off(De["live-stream-enabled"],_),Le.off(De["live-stream-disabled"],T),Le.off(De["video-state-changed"],I),Le.off(De["video-seeked"],M),Le.off(De["webcam-requested"],j),Le.off(De["mic-requested"],Y),Le.off(De["pin-state-changed"],re),Le.off(De["connection-open"],fe),Le.off(De["connection-close"],ee),Le.off(De["switch-meeting"],le),Le.off(De.error,mt),Le.off(De["hls-started"],ct),Le.off(De["hls-stopped"],kt),Le.off(De["hls-state-changed"],wt),Le.off(De["recording-state-changed"],vr),Le.off(De["livestream-state-changed"],br),Le.off(De["participant-mode-changed"],zt)}},[]),gs.createElement(gs.Fragment,null,gs.createElement(Rg.Consumer,null,t))},bx="0.1.91",Sx=function(e){var t=e.children,n=e.config,i=e.token,s=e.joinWithoutUserInteraction,a=e.reinitialiseMeetingOnConfigChange,c=e.deviceInfo,o=Ie.useState(null),l=o[0],u=o[1],h=Ie.useState(null),f=h[0],g=h[1],p=Ie.useState(null),d=p[0],m=p[1],E=Ie.useState(null),S=E[0],R=E[1],k=Ie.useState(null),C=k[0],x=k[1],P=Ie.useState(!1),D=P[0],b=P[1],w=Ie.useState(!1),v=w[0],_=w[1],y=Ie.useState(!1),T=y[0],L=y[1],I=Ie.useState(!1),N=I[0],M=I[1],U=Ie.useState([]),j=U[0],Q=U[1],Y=Ie.useState(new Map),he=Y[0],re=Y[1],pe=Ie.useState(new Map),fe=pe[0],ue=pe[1],ee=Ie.useState(!1),Z=ee[0],le=ee[1],ye=Ie.useState(new Map),mt=ye[0],Ye=ye[1],ct=Ie.useState(!1),ht=ct[0],kt=ct[1],Sr=Ie.useState(!1),wt=Sr[0],Zt=Sr[1],vr=Ie.useState("RECORDING_STOPPED"),Wr=vr[0],br=vr[1],Br=Ie.useState("LIVESTREAM_STOPPED"),Jr=Br[0],Qt=Br[1],zt=Ie.useState("HLS_STOPPED"),At=zt[0],Lr=zt[1],yt=Ie.useState({downstreamUrl:null,playbackHlsUrl:null,livestreamUrl:null}),Qe=yt[0],Et=yt[1],Ae=Ie.useState("TRANSCRIPTION_STOPPED"),Ne=Ae[0],Ze=Ae[1],Oe=Ie.useRef(),vt=Ie.useRef(),Mt=Ie.useRef(),ke=Ie.useRef(),lr=Ie.useRef(),yr=Ie.useRef(n),wr=Ie.useRef(i),Ur=Ie.useRef(!1),yn=Ie.useRef(),Ge=Ie.useMemo(function(){return a},[]);Ie.useEffect(function(){Oe.current=l},[l]),Ie.useEffect(function(){vt.current=D},[D]),Ie.useEffect(function(){Mt.current=v},[v]),Ie.useEffect(function(){ke.current=T},[T]),Ie.useEffect(function(){lr.current=N},[N]),Ie.useEffect(function(){yr.current=n},[n]),Ie.useEffect(function(){wr.current=i},[i]),Ie.useEffect(function(){yn.current=wt},[wt]);var Ot=function(){u(null),g(null),m(null),R(null),x(null),b(!1),_(!1),L(!1),M(!1),Q([]),le(!1),re(new Map),ue(new Map),Ye(new Map),kt(!1),Zt(!1),br("RECORDING_STOPPED"),Qt("LIVESTREAM_STOPPED"),Lr("HLS_STOPPED"),Ze("TRANSCRIPTION_STOPPED"),Et({downstreamUrl:null,playbackHlsUrl:null,livestreamUrl:null})},xt=function(J){re(function(it){it.set(J.id,J);var tr=new Map(it);return tr}),Le.emit(De["participant-joined"],J)},Ke=function(J){re(function(it){it.delete(J.id);var tr=new Map(it);return tr}),Le.emit(De["participant-left"],J)},Zr=function(J){var it,tr;x(J),L(J===(Oe==null||(it=Oe.current)===null||it===void 0||(tr=it.localParticipant)===null||tr===void 0?void 0:tr.id)),Le.emit(De["presenter-changed"],J)},kr=function(J){m(J),Le.emit(De["main-participant-changed"],J)},Or=function(J){R(J),Le.emit(De["speaker-changed"],J)},sr=function(J){Q(function(it){return[].concat(it,[J])}),Le.emit(De["chat-message"],J)},ar=function(J){Le.emit(De["entry-requested"],J)},Mr=function(J,it){Le.emit(De["entry-responded"],J,it)},tn=function(){M(!0),Le.emit(De["recording-started"])},_n=function(){M(!1),Le.emit(De["recording-stopped"])},Jn=function(J){J.track.readyState==="live"&&(J.kind==="video"?_(!0):J.kind==="audio"&&b(!0))},ss=function(J){J.kind==="video"?_(!1):J.kind==="audio"&&b(!1)},li=function(J){le(!0),Le.emit(De["live-stream-started"],J)},Zn=function(){le(!1),Le.emit(De["live-stream-stopped"])},As=function(J){Zt(!0),Le.emit(De["hls-started"],J)},Ua=function(){Zt(!1),Le.emit(De["hls-stopped"])},as=function(J){Le.emit(De["video-state-changed"],J)},fa=function(J){Le.emit(De["video-seeked"],J)},ma=function(J){Le.emit(De["webcam-requested"],J)},$n=function(J){Le.emit(De["mic-requested"],J)},je=function(J){Ur.current=!0,Q(function(it){return[].concat(it,J.messages)}),Le.emit(De["meeting-joined"],J),kt(!0)},ga=function St(){Le.emit(De["meeting-left"]);var J=Oe.current;if(J){var it;typeof(J==null?void 0:J.off)=="function"&&(J.off("meeting-state-changed",Ve),J.off("participant-joined",xt),J.off("participant-left",Ke),J.off("presenter-changed",Zr),J.off("main-participant-changed",kr),J.off("speaker-changed",Or),J.off("entry-requested",ar),J.off("entry-responded",Mr),J.off("chat-message",sr),J.off("recording-started",tn),J.off("recording-stopped",_n),J.off("meeting-joined",je),J.off("meeting-left",St),J.off("livestream-started",li),J.off("livestream-stopped",Zn),J.off("video-state-changed",as),J.off("video-seeked",fa),J.off("webcam-requested",ma),J.off("mic-requested",$n),J.off("pin-state-changed",Qs),J.off("connection-open",$a),J.off("connection-close",va),J.off("switch-meeting",Va),J.off("error",ya),J.off("hls-started",As),J.off("hls-stopped",Ua),J.off("recording-state-changed",Pe),J.off("livestream-state-changed",Ga),J.off("hls-state-changed",be),J.off("participant-mode-changed",$t),J.off("transcription-state-changed",He)),typeof(J==null||(it=J.localParticipant)===null||it===void 0?void 0:it.off)=="function"&&(J.localParticipant.off("stream-enabled",Jn),J.localParticipant.off("stream-disabled",ss)),Ot()}},Qs=function(J){var it=J.participantId,tr=J.state,an=J.pinnedBy;ue(function(Gn){!tr.cam&&!tr.share?Gn.delete(it):Gn.set(it,tr);var Hn=new Map(Gn);return Hn}),Le.emit(De["pin-state-changed"],{participantId:it,state:tr,pinnedBy:an})},$a=function(J){Ye(function(it){it.set(J.id,J);var tr=new Map(it);return tr}),Le.emit(De["connection-open"],J)},va=function(J){Ye(function(it){it.delete(J);var tr=new Map(it);return tr}),Le.emit(De["connection-close"],J)},Va=function(J){Le.emit(De["switch-meeting"],J)},ya=function(J){Le.emit(De.error,J)},Pe=function(J){br(J==null?void 0:J.status),Le.emit(De["recording-state-changed"],J)},Ga=function(J){Qt(J==null?void 0:J.status),Le.emit(De["livestream-state-changed"],J)},be=function(J){Lr(J==null?void 0:J.status),(J==null?void 0:J.status)=="HLS_PLAYABLE"?Et({downstreamUrl:J==null?void 0:J.downstreamUrl,playbackHlsUrl:J==null?void 0:J.playbackHlsUrl,livestreamUrl:J==null?void 0:J.livestreamUrl}):(J==null?void 0:J.status)=="HLS_STOPPED"&&Et({downstreamUrl:null,playbackHlsUrl:null,livestreamUrl:null}),Le.emit(De["hls-state-changed"],J)},Ve=function(J){Le.emit(De["meeting-state-changed"],J)},He=function(J){Ze(J==null?void 0:J.status),Le.emit(De["transcription-state-changed"],J)},lt=function(J){Le.emit(De["transcription-text"],J)},$t=function(J){var it,tr;re(function(an){var Gn=an.get(J.participantId);Gn.mode=J.mode,an.set(Gn.id,Gn);var Hn=new Map(an);return Hn}),J.participantId===(Oe==null||(it=Oe.current)===null||it===void 0||(tr=it.localParticipant)===null||tr===void 0?void 0:tr.id)&&g(function(an){return an.mode=J.mode,an}),Le.emit(De["participant-mode-changed"],J)},Vt=function(){var J=Nc.VideoSDK&&Nc.VideoSDK.initMeeting(yr.current);u(J);var it=J.localParticipant,tr=J.participants;tr.set(it.id,it),re(tr),g(it),J.on("meeting-state-changed",Ve),J.on("participant-joined",xt),J.on("participant-left",Ke),J.on("presenter-changed",Zr),J.on("main-participant-changed",kr),J.on("speaker-changed",Or),J.on("entry-requested",ar),J.on("entry-responded",Mr),J.on("chat-message",sr),J.on("recording-started",tn),J.on("recording-stopped",_n),J.on("meeting-joined",je),J.on("meeting-left",ga),J.on("livestream-started",li),J.on("livestream-stopped",Zn),J.on("video-state-changed",as),J.on("video-seeked",fa),J.on("webcam-requested",ma),J.on("mic-requested",$n),J.on("pin-state-changed",Qs),J.on("connection-open",$a),J.on("connection-close",va),J.on("switch-meeting",Va),J.on("error",ya),J.on("hls-started",As),J.on("hls-stopped",Ua),J.on("recording-state-changed",Pe),J.on("livestream-state-changed",Ga),J.on("hls-state-changed",be),J.on("participant-mode-changed",$t),J.on("transcription-state-changed",He),J.on("transcription-text",lt),J.localParticipant.on("stream-enabled",Jn),J.localParticipant.on("stream-disabled",ss),J.join()},hr=function(){var J=Oe.current;J&&J.leave()},or=function(){var J=Oe.current;J&&J.end()},Nt=function(J,it,tr,an){var Gn=Oe.current;Gn&&Gn.startRecording(J,it,tr,an)},Cr=function(){var J=Oe.current;if(J){var it=lr.current;it&&J.stopRecording()}},Gt=function(J){J===void 0&&(J=void 0);var it=Oe.current;it&&it.unmuteMic(J)},pr=function(){var J=Oe.current;J&&J.muteMic()},Er=function(J){J===void 0&&(J=void 0);var it=vt.current;it?pr():Gt(J)},Nr=function(){var J=Oe.current;J&&J.disableWebcam()},hn=function(J){J===void 0&&(J=void 0);var it=Oe.current;it&&it.enableWebcam(J)},kn=function(J){J===void 0&&(J=void 0);var it=Mt.current;it?Nr():hn(J)},vi=function(){var J=Oe.current;J&&J.disableScreenShare()},er=function(J){J===void 0&&(J=void 0);var it=Oe.current;it&&it.enableScreenShare(J)},Bi=function(J){J===void 0&&(J=void 0);var it=ke.current;it?vi():er(J)},ei=function(J){var it=Oe.current;it&&it.changeMode(J)},qi=function(J){var it=Oe.current;it&&it.sendChatMessage(J)},Pi=function(J,it){var tr=Oe.current;tr&&tr.respondEntry(J,it)},os=function(){try{var J=Oe.current;return Promise.resolve(function(){if(J)return Promise.resolve(J.getMics())}())}catch(it){return Promise.reject(it)}},cs=function(){try{var J=Oe.current;return Promise.resolve(function(){if(J)return Promise.resolve(J.getWebcams())}())}catch(it){return Promise.reject(it)}},Os=function(J){var it=Oe.current;it&&it.changeWebcam(J)},_a=function(J){var it=Oe.current;it&&it.replaceWebcamStream(J)},ba=function(J){var it=Oe.current;it&&it.changeMic(J)},Co=function(J){var it=J.link,tr=Oe.current;tr&&tr.startVideo({link:it})},Xs=function(){var J=Oe.current;J&&J.stopVideo()},Ha=function(){var J=Oe.current;J&&J.resumeVideo()},Wa=function(J){var it=J.currentTime,tr=Oe.current;tr&&tr.pauseVideo({currentTime:it})},Po=function(J){var it=J.currentTime,tr=Oe.current;tr&&tr.seekVideo({currentTime:it})},Vn=function(J,it){var tr=Oe.current;tr&&tr.startLivestream(J,it)},dc=function(){var J=Oe.current;J&&J.stopLivestream()},Sa=function(J){var it=J.meetingId,tr=J.payload;try{var an=Oe.current,Gn=function(){if(an)return Promise.resolve(an.connectTo({meetingId:it,payload:tr})).then(function(){})}();return Promise.resolve(Gn&&Gn.then?Gn.then(function(){}):void 0)}catch(Hn){return Promise.reject(Hn)}},hc=function(J,it){var tr=Oe.current;tr&&tr.startHls(J,it)},Lo=function(){var J=Oe.current;J&&J.stopHls()},Do=function(){Nc.VideoSDK.config(wr.current),c?Nc.VideoSDK.analytics(c):Nc.VideoSDK.analytics({sdkType:"react-web",sdkVersion:bx}),s&&Vt()};return Ie.useEffect(function(){Do()},[]),Ie.useEffect(function(){Ge&&Ur.current&&(hr(),Do(),!s&&Vt())},[n.meetingId,i,Ge]),gs.createElement(Rg.Provider,{value:{meetingId:l==null?void 0:l.id,meeting:l,baseUrl:l==null?void 0:l.baseUrl,localParticipant:f,mainParticipant:d,activeSpeakerId:S,participants:he,presenterId:C,localMicOn:D,localWebcamOn:v,localScreenShareOn:T,messages:j,isRecording:N,isLiveStreaming:Z,pinnedParticipants:fe,connections:mt,isHls:wt,recordingState:Wr,livestreamState:Jr,hlsState:At,hlsUrls:Qe,transcriptionState:Ne,isMeetingJoined:ht,selectedCameraDevice:l==null?void 0:l.selectedCameraDevice,selectedMicrophoneDevice:l==null?void 0:l.selectedMicrophoneDevice,join:Vt,leave:hr,end:or,startRecording:Nt,stopRecording:Cr,sendChatMessage:qi,respondEntry:Pi,muteMic:pr,unmuteMic:Gt,toggleMic:Er,disableWebcam:Nr,enableWebcam:hn,toggleWebcam:kn,disableScreenShare:vi,enableScreenShare:er,toggleScreenShare:Bi,getMics:os,getWebcams:cs,changeWebcam:Os,replaceWebcamStream:_a,changeMic:ba,changeMode:ei,startVideo:Co,stopVideo:Xs,resumeVideo:Ha,pauseVideo:Wa,seekVideo:Po,startLivestream:Vn,stopLivestream:dc,connectTo:Sa,startHls:hc,stopHls:Lo}},t)},wx=function(e,t){var n={},i=n.onStreamEnabled,s=i===void 0?function(){}:i,a=n.onStreamDisabled,c=a===void 0?function(){}:a,o=n.onMediaStatusChanged,l=o===void 0?function(){}:o,u=n.onVideoQualityChanged,h=u===void 0?function(){}:u,f=Ie.useState(null),g=f[0],p=f[1],d=Ie.useState(null),m=d[0],E=d[1],S=Ie.useState(null),R=S[0],k=S[1],C=Ie.useState(null),x=C[0],P=C[1],D=pl(),b=Ie.useMemo(function(){var Qe,Et=D==null?void 0:D.participants,Ae=D==null?void 0:D.localParticipant,Ne=D==null?void 0:D.activeSpeakerId,Ze=D==null?void 0:D.mainParticipant,Oe=(D==null||(Qe=D.pinnedParticipants)===null||Qe===void 0?void 0:Qe.get(e))||{cam:!1,share:!1};return{participants:Et,localParticipant:Ae,activeSpeakerId:Ne,mainParticipant:Ze,pinState:Oe}},[D]),w=b.participants,v=b.localParticipant,_=b.activeSpeakerId,y=b.mainParticipant,T=b.pinState,L=w==null?void 0:w.get(e),I=Ie.useState(L==null?void 0:L.webcamOn),N=I[0],M=I[1],U=Ie.useState(L==null?void 0:L.micOn),j=U[0],Q=U[1],Y=Ie.useState(L==null?void 0:L.mode),he=Y[0],re=Y[1],pe=function(Et){if(Et.track.readyState==="live")switch(Et.kind){case"video":g!=null&&p(null),p(Et);break;case"audio":m!=null&&E(null),E(Et);break;case"share":R!=null&&k(null),k(Et);break;case"shareAudio":x!=null&&P(null),P(Et);break}},fe=function(Et){switch(Et.kind){case"video":p(null);break;case"audio":E(null);break;case"share":k(null);break;case"shareAudio":P(null);break}},ue=function(Et){pe(Et),s(Et)},ee=function(Et){e===Et.participantId&&re(Et.mode)},Z=function(Et){fe(Et),c(Et)},le=function(Et){var Ae=Et.peerId,Ne=Et.prevQuality,Ze=Et.currentQuality;h({peerId:Ae,prevQuality:Ne,currentQuality:Ze})},ye=function(Et){var Ae=Et.kind,Ne=Et.peerId,Ze=Et.newStatus;Ae=="audio"?Q(Ze):Ae=="video"&&M(Ze),l({kind:Ae,peerId:Ne,newStatus:Ze})},mt=function(Et){L==null||L.setQuality(Et)},Ye=function(Et,Ae){L==null||L.setViewPort(Et,Ae)},ct=function(){L==null||L.enableMic()},ht=function(){L==null||L.disableMic()},kt=function(){L==null||L.enableWebcam()},Sr=function(){L==null||L.disableWebcam()},wt=function(Et){L==null||L.pin(Et)},Zt=function(Et){L==null||L.unpin(Et)},vr=function(){L==null||L.remove()},Wr=function(Et){var Ae=Et===void 0?{}:Et,Ne=Ae.height,Ze=Ae.width;return Promise.resolve(L==null?void 0:L.captureImage({height:Ne,width:Ze}))},br=function(){return Promise.resolve(L==null?void 0:L.getAudioStats())},Br=function(){return Promise.resolve(L==null?void 0:L.getVideoStats())},Jr=function(){return Promise.resolve(L==null?void 0:L.getShareStats())},Qt=function(){L==null||L.consumeWebcamStreams()},zt=function(){L==null||L.consumeMicStreams()},At=function(){L==null||L.stopConsumingWebcamStreams()},Lr=function(){L==null||L.stopConsumingMicStreams()},yt=function(Et){return Promise.resolve(L==null?void 0:L.switchTo(Et)).then(function(){})};return Ie.useEffect(function(){var Qe=L==null?void 0:L.streams;return Qe&&Qe.forEach(function(Et){pe(Et)}),L!=null&&L.micOn&&Q(j),L!=null&&L.webcamOn&&M(N),L==null||L.on("stream-enabled",ue),L==null||L.on("stream-disabled",Z),L==null||L.on("media-status-changed",ye),L==null||L.on("video-quality-changed",le),Le.on(De["participant-mode-changed"],ee),function(){L==null||L.off("stream-enabled",ue),L==null||L.off("stream-disabled",Z),L==null||L.off("media-status-changed",ye),L==null||L.off("video-quality-changed",le),Le.off(De["participant-mode-changed"],ee)}},[L]),{displayName:L==null?void 0:L.displayName,participant:L,webcamStream:g,micStream:m,screenShareStream:R,screenShareAudioStream:x,webcamOn:N||!!g,micOn:j||!!m,mode:he,metaData:L==null?void 0:L.metaData,screenShareOn:!!R,isLocal:(v==null?void 0:v.id)===e,isActiveSpeaker:_===e,isMainParticipant:(y==null?void 0:y.id)===e,pinState:T,consumeMicStreams:zt,consumeWebcamStreams:Qt,stopConsumingMicStreams:Lr,stopConsumingWebcamStreams:At,setQuality:mt,setViewPort:Ye,enableMic:ct,disableMic:ht,enableWebcam:kt,disableWebcam:Sr,captureImage:Wr,pin:wt,unpin:Zt,remove:vr,switchTo:yt,getAudioStats:br,getVideoStats:Br,getShareStats:Jr}},am=Nc.VideoSDK.Constants;const om="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhcGlrZXkiOiIzODk2YmMwMC1hNzExLTQ0NmEtYWVlMi03OTdmY2QyNGVhZDAiLCJwZXJtaXNzaW9ucyI6WyJhbGxvd19qb2luIl0sImlhdCI6MTcxNjQxOTEwMCwiZXhwIjoxNzE3MDIzOTAwfQ.jk4Qs2ZG1VyDye0TjO1SQgOdxrEQpSAaOUcwlOyvkCA",Ex=async({token:r})=>{const e=await fetch("https://api.videosdk.live/v2/rooms",{method:"POST",headers:{authorization:`${om}`,"Content-Type":"application/json"},body:JSON.stringify({})}),{roomId:t}=await e.json();return t},Rx="modulepreload",Tx=function(r){return"/"+r},Ev={},Xi=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));i=Promise.all(t.map(c=>{if(c=Tx(c),c in Ev)return;Ev[c]=!0;const o=c.endsWith(".css"),l=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${l}`))return;const u=document.createElement("link");if(u.rel=o?"stylesheet":Rx,o||(u.as="script",u.crossOrigin=""),u.href=c,a&&u.setAttribute("nonce",a),document.head.appendChild(u),o)return new Promise((h,f)=>{u.addEventListener("load",h),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${c}`)))})}))}return i.then(()=>e()).catch(s=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s})};var xx=function(e,t,n){var i=document.head||document.getElementsByTagName("head")[0],s=document.createElement("script");typeof t=="function"&&(n=t,t={}),t=t||{},n=n||function(){},s.type=t.type||"text/javascript",s.charset=t.charset||"utf8",s.async="async"in t?!!t.async:!0,s.src=e,t.attrs&&kx(s,t.attrs),t.text&&(s.text=""+t.text);var a="onload"in s?Rv:Cx;a(s,n),s.onload||Rv(s,n),i.appendChild(s)};function kx(r,e){for(var t in e)r.setAttribute(t,e[t])}function Rv(r,e){r.onload=function(){this.onerror=this.onload=null,e(null,r)},r.onerror=function(){this.onerror=this.onload=null,e(new Error("Failed to load "+this.src),r)}}function Cx(r,e){r.onreadystatechange=function(){this.readyState!="complete"&&this.readyState!="loaded"||(this.onreadystatechange=null,e(null,r))}}var Px=function(e){return Lx(e)&&!Dx(e)};function Lx(r){return!!r&&typeof r=="object"}function Dx(r){var e=Object.prototype.toString.call(r);return e==="[object RegExp]"||e==="[object Date]"||Ox(r)}var Ix=typeof Symbol=="function"&&Symbol.for,Ax=Ix?Symbol.for("react.element"):60103;function Ox(r){return r.$$typeof===Ax}function Mx(r){return Array.isArray(r)?[]:{}}function Tu(r,e){return e.clone!==!1&&e.isMergeableObject(r)?fl(Mx(r),r,e):r}function Nx(r,e,t){return r.concat(e).map(function(n){return Tu(n,t)})}function Fx(r,e){if(!e.customMerge)return fl;var t=e.customMerge(r);return typeof t=="function"?t:fl}function jx(r){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(r).filter(function(e){return Object.propertyIsEnumerable.call(r,e)}):[]}function Tv(r){return Object.keys(r).concat(jx(r))}function _b(r,e){try{return e in r}catch{return!1}}function Bx(r,e){return _b(r,e)&&!(Object.hasOwnProperty.call(r,e)&&Object.propertyIsEnumerable.call(r,e))}function Ux(r,e,t){var n={};return t.isMergeableObject(r)&&Tv(r).forEach(function(i){n[i]=Tu(r[i],t)}),Tv(e).forEach(function(i){Bx(r,i)||(_b(r,i)&&t.isMergeableObject(e[i])?n[i]=Fx(i,t)(r[i],e[i],t):n[i]=Tu(e[i],t))}),n}function fl(r,e,t){t=t||{},t.arrayMerge=t.arrayMerge||Nx,t.isMergeableObject=t.isMergeableObject||Px,t.cloneUnlessOtherwiseSpecified=Tu;var n=Array.isArray(e),i=Array.isArray(r),s=n===i;return s?n?t.arrayMerge(r,e,t):Ux(r,e,t):Tu(e,t)}fl.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(n,i){return fl(n,i,t)},{})};var $x=fl,bb=$x,Vx=Object.create,np=Object.defineProperty,Gx=Object.getOwnPropertyDescriptor,Hx=Object.getOwnPropertyNames,Wx=Object.getPrototypeOf,zx=Object.prototype.hasOwnProperty,Kx=(r,e)=>{for(var t in e)np(r,t,{get:e[t],enumerable:!0})},Sb=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Hx(e))!zx.call(r,i)&&i!==t&&np(r,i,{get:()=>e[i],enumerable:!(n=Gx(e,i))||n.enumerable});return r},Tg=(r,e,t)=>(t=r!=null?Vx(Wx(r)):{},Sb(!r||!r.__esModule?np(t,"default",{value:r,enumerable:!0}):t,r)),qx=r=>Sb(np({},"__esModule",{value:!0}),r),wb={};Kx(wb,{callPlayer:()=>u2,getConfig:()=>c2,getSDK:()=>o2,isBlobUrl:()=>h2,isMediaStream:()=>d2,lazy:()=>Jx,omit:()=>l2,parseEndTime:()=>i2,parseStartTime:()=>n2,queryString:()=>a2,randomString:()=>s2,supportsWebKitPresentationMode:()=>p2});var ip=qx(wb),Yx=Tg(Ie),Qx=Tg(xx),Xx=Tg(bb);const Jx=r=>Yx.default.lazy(async()=>{const e=await r();return typeof e.default=="function"?e:e.default}),Zx=/[?&#](?:start|t)=([0-9hms]+)/,e2=/[?&#]end=([0-9hms]+)/,cm=/(\d+)(h|m|s)/g,t2=/^\d+$/;function Eb(r,e){if(r instanceof Array)return;const t=r.match(e);if(t){const n=t[1];if(n.match(cm))return r2(n);if(t2.test(n))return parseInt(n)}}function r2(r){let e=0,t=cm.exec(r);for(;t!==null;){const[,n,i]=t;i==="h"&&(e+=parseInt(n,10)*60*60),i==="m"&&(e+=parseInt(n,10)*60),i==="s"&&(e+=parseInt(n,10)),t=cm.exec(r)}return e}function n2(r){return Eb(r,Zx)}function i2(r){return Eb(r,e2)}function s2(){return Math.random().toString(36).substr(2,5)}function a2(r){return Object.keys(r).map(e=>`${e}=${r[e]}`).join("&")}function Bp(r){return window[r]?window[r]:window.exports&&window.exports[r]?window.exports[r]:window.module&&window.module.exports&&window.module.exports[r]?window.module.exports[r]:null}const Cc={},o2=function(e,t,n=null,i=()=>!0,s=Qx.default){const a=Bp(t);return a&&i(a)?Promise.resolve(a):new Promise((c,o)=>{if(Cc[e]){Cc[e].push({resolve:c,reject:o});return}Cc[e]=[{resolve:c,reject:o}];const l=u=>{Cc[e].forEach(h=>h.resolve(u))};if(n){const u=window[n];window[n]=function(){u&&u(),l(Bp(t))}}s(e,u=>{u?(Cc[e].forEach(h=>h.reject(u)),Cc[e]=null):n||l(Bp(t))})})};function c2(r,e){return(0,Xx.default)(e.config,r.config)}function l2(r,...e){const t=[].concat(...e),n={},i=Object.keys(r);for(const s of i)t.indexOf(s)===-1&&(n[s]=r[s]);return n}function u2(r,...e){if(!this.player||!this.player[r]){let t=`ReactPlayer: ${this.constructor.displayName} player could not call %c${r}%c – `;return this.player?this.player[r]||(t+="The method was not available"):t+="The player was not available",console.warn(t,"font-weight: bold",""),null}return this.player[r](...e)}function d2(r){return typeof window<"u"&&typeof window.MediaStream<"u"&&r instanceof window.MediaStream}function h2(r){return/^blob:/.test(r)}function p2(r=document.createElement("video")){const e=/iPhone|iPod/.test(navigator.userAgent)===!1;return r.webkitSupportsPresentationMode&&typeof r.webkitSetPresentationMode=="function"&&e}var xg=Object.defineProperty,f2=Object.getOwnPropertyDescriptor,m2=Object.getOwnPropertyNames,g2=Object.prototype.hasOwnProperty,v2=(r,e)=>{for(var t in e)xg(r,t,{get:e[t],enumerable:!0})},y2=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of m2(e))!g2.call(r,i)&&i!==t&&xg(r,i,{get:()=>e[i],enumerable:!(n=f2(e,i))||n.enumerable});return r},_2=r=>y2(xg({},"__esModule",{value:!0}),r),Rb={};v2(Rb,{AUDIO_EXTENSIONS:()=>kg,DASH_EXTENSIONS:()=>jb,FLV_EXTENSIONS:()=>Bb,HLS_EXTENSIONS:()=>Pg,MATCH_URL_DAILYMOTION:()=>Ob,MATCH_URL_FACEBOOK:()=>Cb,MATCH_URL_FACEBOOK_WATCH:()=>Pb,MATCH_URL_KALTURA:()=>Fb,MATCH_URL_MIXCLOUD:()=>Mb,MATCH_URL_MUX:()=>kb,MATCH_URL_SOUNDCLOUD:()=>Tb,MATCH_URL_STREAMABLE:()=>Lb,MATCH_URL_TWITCH_CHANNEL:()=>Ab,MATCH_URL_TWITCH_VIDEO:()=>Ib,MATCH_URL_VIDYARD:()=>Nb,MATCH_URL_VIMEO:()=>xb,MATCH_URL_WISTIA:()=>Db,MATCH_URL_YOUTUBE:()=>lm,VIDEO_EXTENSIONS:()=>Cg,canPlay:()=>S2});var b2=_2(Rb),xv=ip;const lm=/(?:youtu\.be\/|youtube(?:-nocookie|education)?\.com\/(?:embed\/|v\/|watch\/|watch\?v=|watch\?.+&v=|shorts\/|live\/))((\w|-){11})|youtube\.com\/playlist\?list=|youtube\.com\/user\//,Tb=/(?:soundcloud\.com|snd\.sc)\/[^.]+$/,xb=/vimeo\.com\/(?!progressive_redirect).+/,kb=/stream\.mux\.com\/(?!\w+\.m3u8)(\w+)/,Cb=/^https?:\/\/(www\.)?facebook\.com.*\/(video(s)?|watch|story)(\.php?|\/).+$/,Pb=/^https?:\/\/fb\.watch\/.+$/,Lb=/streamable\.com\/([a-z0-9]+)$/,Db=/(?:wistia\.(?:com|net)|wi\.st)\/(?:medias|embed)\/(?:iframe\/)?([^?]+)/,Ib=/(?:www\.|go\.)?twitch\.tv\/videos\/(\d+)($|\?)/,Ab=/(?:www\.|go\.)?twitch\.tv\/([a-zA-Z0-9_]+)($|\?)/,Ob=/^(?:(?:https?):)?(?:\/\/)?(?:www\.)?(?:(?:dailymotion\.com(?:\/embed)?\/video)|dai\.ly)\/([a-zA-Z0-9]+)(?:_[\w_-]+)?(?:[\w.#_-]+)?/,Mb=/mixcloud\.com\/([^/]+\/[^/]+)/,Nb=/vidyard.com\/(?:watch\/)?([a-zA-Z0-9-_]+)/,Fb=/^https?:\/\/[a-zA-Z]+\.kaltura.(com|org)\/p\/([0-9]+)\/sp\/([0-9]+)00\/embedIframeJs\/uiconf_id\/([0-9]+)\/partner_id\/([0-9]+)(.*)entry_id.([a-zA-Z0-9-_].*)$/,kg=/\.(m4a|m4b|mp4a|mpga|mp2|mp2a|mp3|m2a|m3a|wav|weba|aac|oga|spx)($|\?)/i,Cg=/\.(mp4|og[gv]|webm|mov|m4v)(#t=[,\d+]+)?($|\?)/i,Pg=/\.(m3u8)($|\?)/i,jb=/\.(mpd)($|\?)/i,Bb=/\.(flv)($|\?)/i,um=r=>{if(r instanceof Array){for(const e of r)if(typeof e=="string"&&um(e)||um(e.src))return!0;return!1}return(0,xv.isMediaStream)(r)||(0,xv.isBlobUrl)(r)?!0:kg.test(r)||Cg.test(r)||Pg.test(r)||jb.test(r)||Bb.test(r)},S2={youtube:r=>r instanceof Array?r.every(e=>lm.test(e)):lm.test(r),soundcloud:r=>Tb.test(r)&&!kg.test(r),vimeo:r=>xb.test(r)&&!Cg.test(r)&&!Pg.test(r),mux:r=>kb.test(r),facebook:r=>Cb.test(r)||Pb.test(r),streamable:r=>Lb.test(r),wistia:r=>Db.test(r),twitch:r=>Ib.test(r)||Ab.test(r),dailymotion:r=>Ob.test(r),mixcloud:r=>Mb.test(r),vidyard:r=>Nb.test(r),kaltura:r=>Fb.test(r),file:um};var Lg=Object.defineProperty,w2=Object.getOwnPropertyDescriptor,E2=Object.getOwnPropertyNames,R2=Object.prototype.hasOwnProperty,T2=(r,e)=>{for(var t in e)Lg(r,t,{get:e[t],enumerable:!0})},x2=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of E2(e))!R2.call(r,i)&&i!==t&&Lg(r,i,{get:()=>e[i],enumerable:!(n=w2(e,i))||n.enumerable});return r},k2=r=>x2(Lg({},"__esModule",{value:!0}),r),Ub={};T2(Ub,{default:()=>P2});var C2=k2(Ub),Qi=ip,Vi=b2,P2=[{key:"youtube",name:"YouTube",canPlay:Vi.canPlay.youtube,lazyPlayer:(0,Qi.lazy)(()=>Xi(()=>import("./YouTube-BlU3j1y1.js").then(r=>r.Y),[]))},{key:"soundcloud",name:"SoundCloud",canPlay:Vi.canPlay.soundcloud,lazyPlayer:(0,Qi.lazy)(()=>Xi(()=>import("./SoundCloud-UCl_ewhz.js").then(r=>r.S),[]))},{key:"vimeo",name:"Vimeo",canPlay:Vi.canPlay.vimeo,lazyPlayer:(0,Qi.lazy)(()=>Xi(()=>import("./Vimeo-DGGseqJ9.js").then(r=>r.V),[]))},{key:"mux",name:"Mux",canPlay:Vi.canPlay.mux,lazyPlayer:(0,Qi.lazy)(()=>Xi(()=>import("./Mux-D9FyQXgT.js").then(r=>r.M),[]))},{key:"facebook",name:"Facebook",canPlay:Vi.canPlay.facebook,lazyPlayer:(0,Qi.lazy)(()=>Xi(()=>import("./Facebook-BtTohSBK.js").then(r=>r.F),[]))},{key:"streamable",name:"Streamable",canPlay:Vi.canPlay.streamable,lazyPlayer:(0,Qi.lazy)(()=>Xi(()=>import("./Streamable-D9l8H87a.js").then(r=>r.S),[]))},{key:"wistia",name:"Wistia",canPlay:Vi.canPlay.wistia,lazyPlayer:(0,Qi.lazy)(()=>Xi(()=>import("./Wistia-gO2-IhQ1.js").then(r=>r.W),[]))},{key:"twitch",name:"Twitch",canPlay:Vi.canPlay.twitch,lazyPlayer:(0,Qi.lazy)(()=>Xi(()=>import("./Twitch-Bfewvxrm.js").then(r=>r.T),[]))},{key:"dailymotion",name:"DailyMotion",canPlay:Vi.canPlay.dailymotion,lazyPlayer:(0,Qi.lazy)(()=>Xi(()=>import("./DailyMotion-ChNb3HXL.js").then(r=>r.D),[]))},{key:"mixcloud",name:"Mixcloud",canPlay:Vi.canPlay.mixcloud,lazyPlayer:(0,Qi.lazy)(()=>Xi(()=>import("./Mixcloud-3FP2Tevl.js").then(r=>r.M),[]))},{key:"vidyard",name:"Vidyard",canPlay:Vi.canPlay.vidyard,lazyPlayer:(0,Qi.lazy)(()=>Xi(()=>import("./Vidyard-B3egKP32.js").then(r=>r.V),[]))},{key:"kaltura",name:"Kaltura",canPlay:Vi.canPlay.kaltura,lazyPlayer:(0,Qi.lazy)(()=>Xi(()=>import("./Kaltura-9dlyyNC2.js").then(r=>r.K),[]))},{key:"file",name:"FilePlayer",canPlay:Vi.canPlay.file,canEnablePIP:r=>Vi.canPlay.file(r)&&(document.pictureInPictureEnabled||(0,Qi.supportsWebKitPresentationMode)())&&!Vi.AUDIO_EXTENSIONS.test(r),lazyPlayer:(0,Qi.lazy)(()=>Xi(()=>import("./FilePlayer-GTMlymHT.js").then(r=>r.F),[]))}],kv=Number.isNaN||function(e){return typeof e=="number"&&e!==e};function L2(r,e){return!!(r===e||kv(r)&&kv(e))}function D2(r,e){if(r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(!L2(r[t],e[t]))return!1;return!0}function I2(r,e){e===void 0&&(e=D2);var t,n=[],i,s=!1;function a(){for(var c=[],o=0;o<arguments.length;o++)c[o]=arguments[o];return s&&t===this&&e(c,n)||(i=r.apply(this,c),s=!0,t=this,n=c),i}return a}const A2=Object.freeze(Object.defineProperty({__proto__:null,default:I2},Symbol.toStringTag,{value:"Module"})),O2=ww(A2);var M2=typeof Element<"u",N2=typeof Map=="function",F2=typeof Set=="function",j2=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Vd(r,e){if(r===e)return!0;if(r&&e&&typeof r=="object"&&typeof e=="object"){if(r.constructor!==e.constructor)return!1;var t,n,i;if(Array.isArray(r)){if(t=r.length,t!=e.length)return!1;for(n=t;n--!==0;)if(!Vd(r[n],e[n]))return!1;return!0}var s;if(N2&&r instanceof Map&&e instanceof Map){if(r.size!==e.size)return!1;for(s=r.entries();!(n=s.next()).done;)if(!e.has(n.value[0]))return!1;for(s=r.entries();!(n=s.next()).done;)if(!Vd(n.value[1],e.get(n.value[0])))return!1;return!0}if(F2&&r instanceof Set&&e instanceof Set){if(r.size!==e.size)return!1;for(s=r.entries();!(n=s.next()).done;)if(!e.has(n.value[0]))return!1;return!0}if(j2&&ArrayBuffer.isView(r)&&ArrayBuffer.isView(e)){if(t=r.length,t!=e.length)return!1;for(n=t;n--!==0;)if(r[n]!==e[n])return!1;return!0}if(r.constructor===RegExp)return r.source===e.source&&r.flags===e.flags;if(r.valueOf!==Object.prototype.valueOf&&typeof r.valueOf=="function"&&typeof e.valueOf=="function")return r.valueOf()===e.valueOf();if(r.toString!==Object.prototype.toString&&typeof r.toString=="function"&&typeof e.toString=="function")return r.toString()===e.toString();if(i=Object.keys(r),t=i.length,t!==Object.keys(e).length)return!1;for(n=t;n--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[n]))return!1;if(M2&&r instanceof Element)return!1;for(n=t;n--!==0;)if(!((i[n]==="_owner"||i[n]==="__v"||i[n]==="__o")&&r.$$typeof)&&!Vd(r[i[n]],e[i[n]]))return!1;return!0}return r!==r&&e!==e}var $b=function(e,t){try{return Vd(e,t)}catch(n){if((n.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw n}},Vb={exports:{}},B2="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",U2=B2,$2=U2;function Gb(){}function Hb(){}Hb.resetWarningCache=Gb;var V2=function(){function r(n,i,s,a,c,o){if(o!==$2){var l=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw l.name="Invariant Violation",l}}r.isRequired=r;function e(){return r}var t={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:e,element:r,elementType:r,instanceOf:e,node:r,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:Hb,resetWarningCache:Gb};return t.PropTypes=t,t};Vb.exports=V2();var G2=Vb.exports,H2=Object.create,sp=Object.defineProperty,W2=Object.getOwnPropertyDescriptor,z2=Object.getOwnPropertyNames,K2=Object.getPrototypeOf,q2=Object.prototype.hasOwnProperty,Y2=(r,e)=>{for(var t in e)sp(r,t,{get:e[t],enumerable:!0})},Wb=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of z2(e))!q2.call(r,i)&&i!==t&&sp(r,i,{get:()=>e[i],enumerable:!(n=W2(e,i))||n.enumerable});return r},Q2=(r,e,t)=>(t=r!=null?H2(K2(r)):{},Wb(!r||!r.__esModule?sp(t,"default",{value:r,enumerable:!0}):t,r)),X2=r=>Wb(sp({},"__esModule",{value:!0}),r),zb={};Y2(zb,{defaultProps:()=>ek,propTypes:()=>Z2});var Kb=X2(zb),J2=Q2(G2);const{string:Ei,bool:Gi,number:Pc,array:Up,oneOfType:Vl,shape:ps,object:Mi,func:si,node:Cv}=J2.default,Z2={url:Vl([Ei,Up,Mi]),playing:Gi,loop:Gi,controls:Gi,volume:Pc,muted:Gi,playbackRate:Pc,width:Vl([Ei,Pc]),height:Vl([Ei,Pc]),style:Mi,progressInterval:Pc,playsinline:Gi,pip:Gi,stopOnUnmount:Gi,light:Vl([Gi,Ei,Mi]),playIcon:Cv,previewTabIndex:Pc,previewAriaLabel:Ei,fallback:Cv,oEmbedUrl:Ei,wrapper:Vl([Ei,si,ps({render:si.isRequired})]),config:ps({soundcloud:ps({options:Mi}),youtube:ps({playerVars:Mi,embedOptions:Mi,onUnstarted:si}),facebook:ps({appId:Ei,version:Ei,playerId:Ei,attributes:Mi}),dailymotion:ps({params:Mi}),vimeo:ps({playerOptions:Mi,title:Ei}),mux:ps({attributes:Mi,version:Ei}),file:ps({attributes:Mi,tracks:Up,forceVideo:Gi,forceAudio:Gi,forceHLS:Gi,forceSafariHLS:Gi,forceDisableHls:Gi,forceDASH:Gi,forceFLV:Gi,hlsOptions:Mi,hlsVersion:Ei,dashVersion:Ei,flvVersion:Ei}),wistia:ps({options:Mi,playerId:Ei,customControls:Up}),mixcloud:ps({options:Mi}),twitch:ps({options:Mi,playerId:Ei}),vidyard:ps({options:Mi})}),onReady:si,onStart:si,onPlay:si,onPause:si,onBuffer:si,onBufferEnd:si,onEnded:si,onError:si,onDuration:si,onSeek:si,onPlaybackRateChange:si,onPlaybackQualityChange:si,onProgress:si,onClickPreview:si,onEnablePIP:si,onDisablePIP:si},Ri=()=>{},ek={playing:!1,loop:!1,controls:!1,volume:null,muted:!1,playbackRate:1,width:"640px",height:"360px",style:{},progressInterval:1e3,playsinline:!1,pip:!1,stopOnUnmount:!0,light:!1,fallback:null,wrapper:"div",previewTabIndex:0,previewAriaLabel:"",oEmbedUrl:"https://noembed.com/embed?url={url}",config:{soundcloud:{options:{visual:!0,buying:!1,liking:!1,download:!1,sharing:!1,show_comments:!1,show_playcount:!1}},youtube:{playerVars:{playsinline:1,showinfo:0,rel:0,iv_load_policy:3,modestbranding:1},embedOptions:{},onUnstarted:Ri},facebook:{appId:"1309697205772819",version:"v3.3",playerId:null,attributes:{}},dailymotion:{params:{api:1,"endscreen-enable":!1}},vimeo:{playerOptions:{autopause:!1,byline:!1,portrait:!1,title:!1},title:null},mux:{attributes:{},version:"2"},file:{attributes:{},tracks:[],forceVideo:!1,forceAudio:!1,forceHLS:!1,forceDASH:!1,forceFLV:!1,hlsOptions:{},hlsVersion:"1.1.4",dashVersion:"3.1.3",flvVersion:"1.5.0",forceDisableHls:!1},wistia:{options:{},playerId:null,customControls:null},mixcloud:{options:{hide_cover:1}},twitch:{options:{},playerId:null},vidyard:{options:{}}},onReady:Ri,onStart:Ri,onPlay:Ri,onPause:Ri,onBuffer:Ri,onBufferEnd:Ri,onEnded:Ri,onError:Ri,onDuration:Ri,onSeek:Ri,onPlaybackRateChange:Ri,onPlaybackQualityChange:Ri,onProgress:Ri,onClickPreview:Ri,onEnablePIP:Ri,onDisablePIP:Ri};var tk=Object.create,Mu=Object.defineProperty,rk=Object.getOwnPropertyDescriptor,nk=Object.getOwnPropertyNames,ik=Object.getPrototypeOf,sk=Object.prototype.hasOwnProperty,ak=(r,e,t)=>e in r?Mu(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ok=(r,e)=>{for(var t in e)Mu(r,t,{get:e[t],enumerable:!0})},qb=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of nk(e))!sk.call(r,i)&&i!==t&&Mu(r,i,{get:()=>e[i],enumerable:!(n=rk(e,i))||n.enumerable});return r},Yb=(r,e,t)=>(t=r!=null?tk(ik(r)):{},qb(!r||!r.__esModule?Mu(t,"default",{value:r,enumerable:!0}):t,r)),ck=r=>qb(Mu({},"__esModule",{value:!0}),r),Bn=(r,e,t)=>(ak(r,typeof e!="symbol"?e+"":e,t),t),Qb={};ok(Qb,{default:()=>ap});var lk=ck(Qb),Pv=Yb(Ie),uk=Yb($b),Xb=Kb,dk=ip;const hk=5e3;class ap extends Pv.Component{constructor(){super(...arguments),Bn(this,"mounted",!1),Bn(this,"isReady",!1),Bn(this,"isPlaying",!1),Bn(this,"isLoading",!0),Bn(this,"loadOnReady",null),Bn(this,"startOnPlay",!0),Bn(this,"seekOnPlay",null),Bn(this,"onDurationCalled",!1),Bn(this,"handlePlayerMount",e=>{if(this.player){this.progress();return}this.player=e,this.player.load(this.props.url),this.progress()}),Bn(this,"getInternalPlayer",e=>this.player?this.player[e]:null),Bn(this,"progress",()=>{if(this.props.url&&this.player&&this.isReady){const e=this.getCurrentTime()||0,t=this.getSecondsLoaded(),n=this.getDuration();if(n){const i={playedSeconds:e,played:e/n};t!==null&&(i.loadedSeconds=t,i.loaded=t/n),(i.playedSeconds!==this.prevPlayed||i.loadedSeconds!==this.prevLoaded)&&this.props.onProgress(i),this.prevPlayed=i.playedSeconds,this.prevLoaded=i.loadedSeconds}}this.progressTimeout=setTimeout(this.progress,this.props.progressFrequency||this.props.progressInterval)}),Bn(this,"handleReady",()=>{if(!this.mounted)return;this.isReady=!0,this.isLoading=!1;const{onReady:e,playing:t,volume:n,muted:i}=this.props;e(),!i&&n!==null&&this.player.setVolume(n),this.loadOnReady?(this.player.load(this.loadOnReady,!0),this.loadOnReady=null):t&&this.player.play(),this.handleDurationCheck()}),Bn(this,"handlePlay",()=>{this.isPlaying=!0,this.isLoading=!1;const{onStart:e,onPlay:t,playbackRate:n}=this.props;this.startOnPlay&&(this.player.setPlaybackRate&&n!==1&&this.player.setPlaybackRate(n),e(),this.startOnPlay=!1),t(),this.seekOnPlay&&(this.seekTo(this.seekOnPlay),this.seekOnPlay=null),this.handleDurationCheck()}),Bn(this,"handlePause",e=>{this.isPlaying=!1,this.isLoading||this.props.onPause(e)}),Bn(this,"handleEnded",()=>{const{activePlayer:e,loop:t,onEnded:n}=this.props;e.loopOnEnded&&t&&this.seekTo(0),t||(this.isPlaying=!1,n())}),Bn(this,"handleError",(...e)=>{this.isLoading=!1,this.props.onError(...e)}),Bn(this,"handleDurationCheck",()=>{clearTimeout(this.durationCheckTimeout);const e=this.getDuration();e?this.onDurationCalled||(this.props.onDuration(e),this.onDurationCalled=!0):this.durationCheckTimeout=setTimeout(this.handleDurationCheck,100)}),Bn(this,"handleLoaded",()=>{this.isLoading=!1})}componentDidMount(){this.mounted=!0}componentWillUnmount(){clearTimeout(this.progressTimeout),clearTimeout(this.durationCheckTimeout),this.isReady&&this.props.stopOnUnmount&&(this.player.stop(),this.player.disablePIP&&this.player.disablePIP()),this.mounted=!1}componentDidUpdate(e){if(!this.player)return;const{url:t,playing:n,volume:i,muted:s,playbackRate:a,pip:c,loop:o,activePlayer:l,disableDeferredLoading:u}=this.props;if(!(0,uk.default)(e.url,t)){if(this.isLoading&&!l.forceLoad&&!u&&!(0,dk.isMediaStream)(t)){console.warn(`ReactPlayer: the attempt to load ${t} is being deferred until the player has loaded`),this.loadOnReady=t;return}this.isLoading=!0,this.startOnPlay=!0,this.onDurationCalled=!1,this.player.load(t,this.isReady)}!e.playing&&n&&!this.isPlaying&&this.player.play(),e.playing&&!n&&this.isPlaying&&this.player.pause(),!e.pip&&c&&this.player.enablePIP&&this.player.enablePIP(),e.pip&&!c&&this.player.disablePIP&&this.player.disablePIP(),e.volume!==i&&i!==null&&this.player.setVolume(i),e.muted!==s&&(s?this.player.mute():(this.player.unmute(),i!==null&&setTimeout(()=>this.player.setVolume(i)))),e.playbackRate!==a&&this.player.setPlaybackRate&&this.player.setPlaybackRate(a),e.loop!==o&&this.player.setLoop&&this.player.setLoop(o)}getDuration(){return this.isReady?this.player.getDuration():null}getCurrentTime(){return this.isReady?this.player.getCurrentTime():null}getSecondsLoaded(){return this.isReady?this.player.getSecondsLoaded():null}seekTo(e,t,n){if(!this.isReady){e!==0&&(this.seekOnPlay=e,setTimeout(()=>{this.seekOnPlay=null},hk));return}if(t?t==="fraction":e>0&&e<1){const s=this.player.getDuration();if(!s){console.warn("ReactPlayer: could not seek using fraction – duration not yet available");return}this.player.seekTo(s*e,n);return}this.player.seekTo(e,n)}render(){const e=this.props.activePlayer;return e?Pv.default.createElement(e,{...this.props,onMount:this.handlePlayerMount,onReady:this.handleReady,onPlay:this.handlePlay,onPause:this.handlePause,onEnded:this.handleEnded,onLoaded:this.handleLoaded,onError:this.handleError}):null}}Bn(ap,"displayName","Player");Bn(ap,"propTypes",Xb.propTypes);Bn(ap,"defaultProps",Xb.defaultProps);var pk=Object.create,Nu=Object.defineProperty,fk=Object.getOwnPropertyDescriptor,mk=Object.getOwnPropertyNames,gk=Object.getPrototypeOf,vk=Object.prototype.hasOwnProperty,yk=(r,e,t)=>e in r?Nu(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,_k=(r,e)=>{for(var t in e)Nu(r,t,{get:e[t],enumerable:!0})},Jb=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of mk(e))!vk.call(r,i)&&i!==t&&Nu(r,i,{get:()=>e[i],enumerable:!(n=fk(e,i))||n.enumerable});return r},Fu=(r,e,t)=>(t=r!=null?pk(gk(r)):{},Jb(!r||!r.__esModule?Nu(t,"default",{value:r,enumerable:!0}):t,r)),bk=r=>Jb(Nu({},"__esModule",{value:!0}),r),jn=(r,e,t)=>(yk(r,typeof e!="symbol"?e+"":e,t),t),Zb={};_k(Zb,{createReactPlayer:()=>Pk});var Sk=bk(Zb),Fc=Fu(Ie),wk=Fu(bb),$p=Fu(O2),Lv=Fu($b),Yl=Kb,eS=ip,Ek=Fu(lk);const Rk=(0,eS.lazy)(()=>Xi(()=>import("./Preview-BrSHFc-2.js").then(r=>r.P),[])),Tk=typeof window<"u"&&window.document&&typeof document<"u",xk=typeof Cd<"u"&&Cd.window&&Cd.window.document,kk=Object.keys(Yl.propTypes),Ck=Tk||xk?Fc.Suspense:()=>null,Gl=[],Pk=(r,e)=>{var t;return t=class extends Fc.Component{constructor(){super(...arguments),jn(this,"state",{showPreview:!!this.props.light}),jn(this,"references",{wrapper:n=>{this.wrapper=n},player:n=>{this.player=n}}),jn(this,"handleClickPreview",n=>{this.setState({showPreview:!1}),this.props.onClickPreview(n)}),jn(this,"showPreview",()=>{this.setState({showPreview:!0})}),jn(this,"getDuration",()=>this.player?this.player.getDuration():null),jn(this,"getCurrentTime",()=>this.player?this.player.getCurrentTime():null),jn(this,"getSecondsLoaded",()=>this.player?this.player.getSecondsLoaded():null),jn(this,"getInternalPlayer",(n="player")=>this.player?this.player.getInternalPlayer(n):null),jn(this,"seekTo",(n,i,s)=>{if(!this.player)return null;this.player.seekTo(n,i,s)}),jn(this,"handleReady",()=>{this.props.onReady(this)}),jn(this,"getActivePlayer",(0,$p.default)(n=>{for(const i of[...Gl,...r])if(i.canPlay(n))return i;return e||null})),jn(this,"getConfig",(0,$p.default)((n,i)=>{const{config:s}=this.props;return wk.default.all([Yl.defaultProps.config,Yl.defaultProps.config[i]||{},s,s[i]||{}])})),jn(this,"getAttributes",(0,$p.default)(n=>(0,eS.omit)(this.props,kk))),jn(this,"renderActivePlayer",n=>{if(!n)return null;const i=this.getActivePlayer(n);if(!i)return null;const s=this.getConfig(n,i.key);return Fc.default.createElement(Ek.default,{...this.props,key:i.key,ref:this.references.player,config:s,activePlayer:i.lazyPlayer||i,onReady:this.handleReady})})}shouldComponentUpdate(n,i){return!(0,Lv.default)(this.props,n)||!(0,Lv.default)(this.state,i)}componentDidUpdate(n){const{light:i}=this.props;!n.light&&i&&this.setState({showPreview:!0}),n.light&&!i&&this.setState({showPreview:!1})}renderPreview(n){if(!n)return null;const{light:i,playIcon:s,previewTabIndex:a,oEmbedUrl:c,previewAriaLabel:o}=this.props;return Fc.default.createElement(Rk,{url:n,light:i,playIcon:s,previewTabIndex:a,previewAriaLabel:o,oEmbedUrl:c,onClick:this.handleClickPreview})}render(){const{url:n,style:i,width:s,height:a,fallback:c,wrapper:o}=this.props,{showPreview:l}=this.state,u=this.getAttributes(n),h=typeof o=="string"?this.references.wrapper:void 0;return Fc.default.createElement(o,{ref:h,style:{...i,width:s,height:a},...u},Fc.default.createElement(Ck,{fallback:c},l?this.renderPreview(n):this.renderActivePlayer(n)))}},jn(t,"displayName","ReactPlayer"),jn(t,"propTypes",Yl.propTypes),jn(t,"defaultProps",Yl.defaultProps),jn(t,"addCustomPlayer",n=>{Gl.push(n)}),jn(t,"removeCustomPlayers",()=>{Gl.length=0}),jn(t,"canPlay",n=>{for(const i of[...Gl,...r])if(i.canPlay(n))return!0;return!1}),jn(t,"canEnablePIP",n=>{for(const i of[...Gl,...r])if(i.canEnablePIP&&i.canEnablePIP(n))return!0;return!1}),t};var Lk=Object.create,op=Object.defineProperty,Dk=Object.getOwnPropertyDescriptor,Ik=Object.getOwnPropertyNames,Ak=Object.getPrototypeOf,Ok=Object.prototype.hasOwnProperty,Mk=(r,e)=>{for(var t in e)op(r,t,{get:e[t],enumerable:!0})},tS=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ik(e))!Ok.call(r,i)&&i!==t&&op(r,i,{get:()=>e[i],enumerable:!(n=Dk(e,i))||n.enumerable});return r},Nk=(r,e,t)=>(t=r!=null?Lk(Ak(r)):{},tS(!r||!r.__esModule?op(t,"default",{value:r,enumerable:!0}):t,r)),Fk=r=>tS(op({},"__esModule",{value:!0}),r),rS={};Mk(rS,{default:()=>$k});var jk=Fk(rS),dm=Nk(C2),Bk=Sk;const Uk=dm.default[dm.default.length-1];var $k=(0,Bk.createReactPlayer)(dm.default,Uk);const Vk=Fh(jk);function Gk(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var nS={exports:{}};(function(r,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(o,l,u){if(u=u||{},o=o.trim(),l=l.trim(),!l){if(!u.alwaysNormalize)return o;var h=c.parseURL(o);if(!h)throw new Error("Error trying to parse base URL.");return h.path=c.normalizePath(h.path),c.buildURLFromParts(h)}var f=c.parseURL(l);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return u.alwaysNormalize?(f.path=c.normalizePath(f.path),c.buildURLFromParts(f)):l;var g=c.parseURL(o);if(!g)throw new Error("Error trying to parse base URL.");if(!g.netLoc&&g.path&&g.path[0]!=="/"){var p=i.exec(g.path);g.netLoc=p[1],g.path=p[2]}g.netLoc&&!g.path&&(g.path="/");var d={scheme:g.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(d.netLoc=g.netLoc,f.path[0]!=="/"))if(!f.path)d.path=g.path,f.params||(d.params=g.params,f.query||(d.query=g.query));else{var m=g.path,E=m.substring(0,m.lastIndexOf("/")+1)+f.path;d.path=c.normalizePath(E)}return d.path===null&&(d.path=u.alwaysNormalize?c.normalizePath(f.path):f.path),c.buildURLFromParts(d)},parseURL:function(o){var l=n.exec(o);return l?{scheme:l[1]||"",netLoc:l[2]||"",path:l[3]||"",params:l[4]||"",query:l[5]||"",fragment:l[6]||""}:null},normalizePath:function(o){for(o=o.split("").reverse().join("").replace(s,"");o.length!==(o=o.replace(a,"")).length;);return o.split("").reverse().join("")},buildURLFromParts:function(o){return o.scheme+o.netLoc+o.path+o.params+o.query+o.fragment}};r.exports=c})()})(nS);var Dg=nS.exports;function Dv(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function gi(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Dv(Object(t),!0).forEach(function(n){zk(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Dv(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function Hk(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Wk(r){var e=Hk(r,"string");return typeof e=="symbol"?e:String(e)}function zk(r,e,t){return e=Wk(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Xn(){return Xn=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Xn.apply(this,arguments)}const Pt=Number.isFinite||function(r){return typeof r=="number"&&isFinite(r)},Kk=Number.isSafeInteger||function(r){return typeof r=="number"&&Math.abs(r)<=qk},qk=Number.MAX_SAFE_INTEGER||9007199254740991;let H=function(r){return r.MEDIA_ATTACHING="hlsMediaAttaching",r.MEDIA_ATTACHED="hlsMediaAttached",r.MEDIA_DETACHING="hlsMediaDetaching",r.MEDIA_DETACHED="hlsMediaDetached",r.BUFFER_RESET="hlsBufferReset",r.BUFFER_CODECS="hlsBufferCodecs",r.BUFFER_CREATED="hlsBufferCreated",r.BUFFER_APPENDING="hlsBufferAppending",r.BUFFER_APPENDED="hlsBufferAppended",r.BUFFER_EOS="hlsBufferEos",r.BUFFER_FLUSHING="hlsBufferFlushing",r.BUFFER_FLUSHED="hlsBufferFlushed",r.MANIFEST_LOADING="hlsManifestLoading",r.MANIFEST_LOADED="hlsManifestLoaded",r.MANIFEST_PARSED="hlsManifestParsed",r.LEVEL_SWITCHING="hlsLevelSwitching",r.LEVEL_SWITCHED="hlsLevelSwitched",r.LEVEL_LOADING="hlsLevelLoading",r.LEVEL_LOADED="hlsLevelLoaded",r.LEVEL_UPDATED="hlsLevelUpdated",r.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",r.LEVELS_UPDATED="hlsLevelsUpdated",r.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",r.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",r.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",r.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",r.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",r.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",r.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",r.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",r.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",r.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",r.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",r.CUES_PARSED="hlsCuesParsed",r.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",r.INIT_PTS_FOUND="hlsInitPtsFound",r.FRAG_LOADING="hlsFragLoading",r.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",r.FRAG_LOADED="hlsFragLoaded",r.FRAG_DECRYPTED="hlsFragDecrypted",r.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",r.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",r.FRAG_PARSING_METADATA="hlsFragParsingMetadata",r.FRAG_PARSED="hlsFragParsed",r.FRAG_BUFFERED="hlsFragBuffered",r.FRAG_CHANGED="hlsFragChanged",r.FPS_DROP="hlsFpsDrop",r.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",r.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",r.ERROR="hlsError",r.DESTROYING="hlsDestroying",r.KEY_LOADING="hlsKeyLoading",r.KEY_LOADED="hlsKeyLoaded",r.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",r.BACK_BUFFER_REACHED="hlsBackBufferReached",r.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",r}({}),rr=function(r){return r.NETWORK_ERROR="networkError",r.MEDIA_ERROR="mediaError",r.KEY_SYSTEM_ERROR="keySystemError",r.MUX_ERROR="muxError",r.OTHER_ERROR="otherError",r}({}),Me=function(r){return r.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",r.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",r.KEY_SYSTEM_NO_SESSION="keySystemNoSession",r.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",r.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",r.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",r.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",r.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",r.MANIFEST_LOAD_ERROR="manifestLoadError",r.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",r.MANIFEST_PARSING_ERROR="manifestParsingError",r.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",r.LEVEL_EMPTY_ERROR="levelEmptyError",r.LEVEL_LOAD_ERROR="levelLoadError",r.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",r.LEVEL_PARSING_ERROR="levelParsingError",r.LEVEL_SWITCH_ERROR="levelSwitchError",r.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",r.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",r.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",r.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",r.FRAG_LOAD_ERROR="fragLoadError",r.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",r.FRAG_DECRYPT_ERROR="fragDecryptError",r.FRAG_PARSING_ERROR="fragParsingError",r.FRAG_GAP="fragGap",r.REMUX_ALLOC_ERROR="remuxAllocError",r.KEY_LOAD_ERROR="keyLoadError",r.KEY_LOAD_TIMEOUT="keyLoadTimeOut",r.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",r.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",r.BUFFER_APPEND_ERROR="bufferAppendError",r.BUFFER_APPENDING_ERROR="bufferAppendingError",r.BUFFER_STALLED_ERROR="bufferStalledError",r.BUFFER_FULL_ERROR="bufferFullError",r.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",r.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",r.INTERNAL_EXCEPTION="internalException",r.INTERNAL_ABORTED="aborted",r.UNKNOWN="unknown",r}({});const Ko=function(){},hm={trace:Ko,debug:Ko,log:Ko,warn:Ko,info:Ko,error:Ko};let su=hm;function Yk(r){const e=self.console[r];return e?e.bind(self.console,`[${r}] >`):Ko}function Qk(r,...e){e.forEach(function(t){su[t]=r[t]?r[t].bind(r):Yk(t)})}function Xk(r,e){if(typeof console=="object"&&r===!0||typeof r=="object"){Qk(r,"debug","log","info","warn","error");try{su.log(`Debug logs enabled for "${e}" in hls.js version 1.5.8`)}catch{su=hm}}else su=hm}const Ee=su,Jk=/^(\d+)x(\d+)$/,Iv=/(.+?)=(".*?"|.*?)(?:,|$)/g;class En{constructor(e){typeof e=="string"&&(e=En.parseAttrList(e)),Xn(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const n=new Uint8Array(t.length/2);for(let i=0;i<t.length/2;i++)n[i]=parseInt(t.slice(i*2,i*2+2),16);return n}else return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}bool(e){return this[e]==="YES"}decimalResolution(e){const t=Jk.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const n={},i='"';for(Iv.lastIndex=0;(t=Iv.exec(e))!==null;){let s=t[2];s.indexOf(i)===0&&s.lastIndexOf(i)===s.length-1&&(s=s.slice(1,-1));const a=t[1].trim();n[a]=s}return n}}function Zk(r){return r!=="ID"&&r!=="CLASS"&&r!=="START-DATE"&&r!=="DURATION"&&r!=="END-DATE"&&r!=="END-ON-NEXT"}function eC(r){return r==="SCTE35-OUT"||r==="SCTE35-IN"}class iS{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const n=t.attr;for(const i in n)if(Object.prototype.hasOwnProperty.call(e,i)&&e[i]!==n[i]){Ee.warn(`DATERANGE tag attribute: "${i}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=i;break}e=Xn(new En({}),n,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const n=new Date(this.attr["END-DATE"]);Pt(n.getTime())&&(this._endDate=n)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return e!==null?new Date(this._startDate.getTime()+e*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Pt(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&Pt(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class cp{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Gr={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class sS{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[Gr.AUDIO]:null,[Gr.VIDEO]:null,[Gr.AUDIOVIDEO]:null},this.baseurl=e}setByteRange(e,t){const n=e.split("@",2);let i;n.length===1?i=(t==null?void 0:t.byteRangeEndOffset)||0:i=parseInt(n[1]),this._byteRange=[i,parseInt(n[0])+i]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Dg.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class Vp extends sS{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new cp,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const n=Object.keys(this.levelkeys);if(n.length===1)return this._decryptdata=this.levelkeys[n[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!Pt(this.programDateTime))return null;const e=Pt(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),n=t.length;if(n>1||n===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,i,s,a=!1){const{elementaryStreams:c}=this,o=c[e];if(!o){c[e]={startPTS:t,endPTS:n,startDTS:i,endDTS:s,partial:a};return}o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,n),o.startDTS=Math.min(o.startDTS,i),o.endDTS=Math.max(o.endDTS,s)}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Gr.AUDIO]=null,e[Gr.VIDEO]=null,e[Gr.AUDIOVIDEO]=null}}class tC extends sS{constructor(e,t,n,i,s){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new cp,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}const rC=10;class nC{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?Pt(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||rC}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function Ig(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0))}function iC(r){const e=pm(r).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function sC(r){const e=function(n,i,s){const a=n[i];n[i]=n[s],n[s]=a};e(r,0,3),e(r,1,2),e(r,4,5),e(r,6,7)}function aC(r){const e=r.split(":");let t=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),i=n[n.length-1].split(",");if(i.length===2){const s=i[0]==="base64",a=i[1];s?(n.splice(-1,1),t=Ig(a)):t=iC(a)}}return t}function pm(r){return Uint8Array.from(unescape(encodeURIComponent(r)),e=>e.charCodeAt(0))}const ml=typeof self<"u"?self:void 0;var vn={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},es={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Av(r){switch(r){case es.FAIRPLAY:return vn.FAIRPLAY;case es.PLAYREADY:return vn.PLAYREADY;case es.WIDEVINE:return vn.WIDEVINE;case es.CLEARKEY:return vn.CLEARKEY}}var aS={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function oC(r){if(r===aS.WIDEVINE)return vn.WIDEVINE}function Ov(r){switch(r){case vn.FAIRPLAY:return es.FAIRPLAY;case vn.PLAYREADY:return es.PLAYREADY;case vn.WIDEVINE:return es.WIDEVINE;case vn.CLEARKEY:return es.CLEARKEY}}function Gp(r){const{drmSystems:e,widevineLicenseUrl:t}=r,n=e?[vn.FAIRPLAY,vn.WIDEVINE,vn.PLAYREADY,vn.CLEARKEY].filter(i=>!!e[i]):[];return!n[vn.WIDEVINE]&&t&&n.push(vn.WIDEVINE),n}const oS=function(r){return ml!=null&&(r=ml.navigator)!=null&&r.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function cC(r,e,t,n){let i;switch(r){case vn.FAIRPLAY:i=["cenc","sinf"];break;case vn.WIDEVINE:case vn.PLAYREADY:i=["cenc"];break;case vn.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${r}`)}return lC(i,e,t,n)}function lC(r,e,t,n){return[{initDataTypes:r,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs="${s}"`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs="${s}"`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function ec(r,e,t){return Uint8Array.prototype.slice?r.slice(e,t):new Uint8Array(Array.prototype.slice.call(r,e,t))}const Ag=(r,e)=>e+10<=r.length&&r[e]===73&&r[e+1]===68&&r[e+2]===51&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128,cS=(r,e)=>e+10<=r.length&&r[e]===51&&r[e+1]===68&&r[e+2]===73&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128,xu=(r,e)=>{const t=e;let n=0;for(;Ag(r,e);){n+=10;const i=lp(r,e+6);n+=i,cS(r,e+10)&&(n+=10),e+=n}if(n>0)return r.subarray(t,t+n)},lp=(r,e)=>{let t=0;return t=(r[e]&127)<<21,t|=(r[e+1]&127)<<14,t|=(r[e+2]&127)<<7,t|=r[e+3]&127,t},uC=(r,e)=>Ag(r,e)&&lp(r,e+6)+10<=r.length-e,Og=r=>{const e=uS(r);for(let t=0;t<e.length;t++){const n=e[t];if(lS(n))return gC(n)}},lS=r=>r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp",dC=r=>{const e=String.fromCharCode(r[0],r[1],r[2],r[3]),t=lp(r,4),n=10;return{type:e,size:t,data:r.subarray(n,n+t)}},uS=r=>{let e=0;const t=[];for(;Ag(r,e);){const n=lp(r,e+6);e+=10;const i=e+n;for(;e+8<i;){const s=dC(r.subarray(e)),a=hC(s);a&&t.push(a),e+=s.size+10}cS(r,e)&&(e+=10)}return t},hC=r=>r.type==="PRIV"?pC(r):r.type[0]==="W"?mC(r):fC(r),pC=r=>{if(r.size<2)return;const e=ha(r.data,!0),t=new Uint8Array(r.data.subarray(e.length+1));return{key:r.type,info:e,data:t.buffer}},fC=r=>{if(r.size<2)return;if(r.type==="TXXX"){let t=1;const n=ha(r.data.subarray(t),!0);t+=n.length+1;const i=ha(r.data.subarray(t));return{key:r.type,info:n,data:i}}const e=ha(r.data.subarray(1));return{key:r.type,data:e}},mC=r=>{if(r.type==="WXXX"){if(r.size<2)return;let t=1;const n=ha(r.data.subarray(t),!0);t+=n.length+1;const i=ha(r.data.subarray(t));return{key:r.type,info:n,data:i}}const e=ha(r.data);return{key:r.type,data:e}},gC=r=>{if(r.data.byteLength===8){const e=new Uint8Array(r.data),t=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}},ha=(r,e=!1)=>{const t=vC();if(t){const l=t.decode(r);if(e){const u=l.indexOf("\0");return u!==-1?l.substring(0,u):l}return l.replace(/\0/g,"")}const n=r.length;let i,s,a,c="",o=0;for(;o<n;){if(i=r[o++],i===0&&e)return c;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c+=String.fromCharCode(i);break;case 12:case 13:s=r[o++],c+=String.fromCharCode((i&31)<<6|s&63);break;case 14:s=r[o++],a=r[o++],c+=String.fromCharCode((i&15)<<12|(s&63)<<6|(a&63)<<0);break}}return c};let Hp;function vC(){if(!navigator.userAgent.includes("PlayStation 4"))return!Hp&&typeof self.TextDecoder<"u"&&(Hp=new self.TextDecoder("utf-8")),Hp}const sa={hexDump:function(r){let e="";for(let t=0;t<r.length;t++){let n=r[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}},xh=Math.pow(2,32)-1,yC=[].push,dS={video:1,audio:2,id3:3,text:4};function ai(r){return String.fromCharCode.apply(null,r)}function hS(r,e){const t=r[e]<<8|r[e+1];return t<0?65536+t:t}function Yt(r,e){const t=pS(r,e);return t<0?4294967296+t:t}function Mv(r,e){let t=Yt(r,e);return t*=Math.pow(2,32),t+=Yt(r,e+4),t}function pS(r,e){return r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}function Wp(r,e,t){r[e]=t>>24,r[e+1]=t>>16&255,r[e+2]=t>>8&255,r[e+3]=t&255}function _C(r){const e=r.byteLength;for(let t=0;t<e;){const n=Yt(r,t);if(n>8&&r[t+4]===109&&r[t+5]===111&&r[t+6]===111&&r[t+7]===102)return!0;t=n>1?t+n:e}return!1}function fr(r,e){const t=[];if(!e.length)return t;const n=r.byteLength;for(let i=0;i<n;){const s=Yt(r,i),a=ai(r.subarray(i+4,i+8)),c=s>1?i+s:n;if(a===e[0])if(e.length===1)t.push(r.subarray(i+8,c));else{const o=fr(r.subarray(i+8,c),e.slice(1));o.length&&yC.apply(t,o)}i=c}return t}function bC(r){const e=[],t=r[0];let n=8;const i=Yt(r,n);n+=4;let s=0,a=0;t===0?(s=Yt(r,n),a=Yt(r,n+4),n+=8):(s=Mv(r,n),a=Mv(r,n+8),n+=16),n+=2;let c=r.length+a;const o=hS(r,n);n+=2;for(let l=0;l<o;l++){let u=n;const h=Yt(r,u);u+=4;const f=h&2147483647;if((h&2147483648)>>>31===1)return Ee.warn("SIDX has hierarchical references (not supported)"),null;const p=Yt(r,u);u+=4,e.push({referenceSize:f,subsegmentDuration:p,info:{duration:p/i,start:c,end:c+f-1}}),c+=f,u+=4,n=u}return{earliestPresentationTime:s,timescale:i,version:t,referencesCount:o,references:e}}function fS(r){const e=[],t=fr(r,["moov","trak"]);for(let i=0;i<t.length;i++){const s=t[i],a=fr(s,["tkhd"])[0];if(a){let c=a[0];const o=Yt(a,c===0?12:20),l=fr(s,["mdia","mdhd"])[0];if(l){c=l[0];const u=Yt(l,c===0?12:20),h=fr(s,["mdia","hdlr"])[0];if(h){const f=ai(h.subarray(8,12)),g={soun:Gr.AUDIO,vide:Gr.VIDEO}[f];if(g){const p=fr(s,["mdia","minf","stbl","stsd"])[0],d=SC(p);e[o]={timescale:u,type:g},e[g]=gi({timescale:u,id:o},d)}}}}}return fr(r,["moov","mvex","trex"]).forEach(i=>{const s=Yt(i,4),a=e[s];a&&(a.default={duration:Yt(i,12),flags:Yt(i,20)})}),e}function SC(r){const e=r.subarray(8),t=e.subarray(86),n=ai(e.subarray(4,8));let i=n;const s=n==="enca"||n==="encv";if(s){const c=fr(e,[n])[0].subarray(n==="enca"?28:78);fr(c,["sinf"]).forEach(l=>{const u=fr(l,["schm"])[0];if(u){const h=ai(u.subarray(4,8));if(h==="cbcs"||h==="cenc"){const f=fr(l,["frma"])[0];f&&(i=ai(f))}}})}switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const a=fr(t,["avcC"])[0];i+="."+yd(a[1])+yd(a[2])+yd(a[3]);break}case"mp4a":{const a=fr(e,[n])[0],c=fr(a.subarray(28),["esds"])[0];if(c&&c.length>12){let o=4;if(c[o++]!==3)break;o=zp(c,o),o+=2;const l=c[o++];if(l&128&&(o+=2),l&64&&(o+=c[o++]),c[o++]!==4)break;o=zp(c,o);const u=c[o++];if(u===64)i+="."+yd(u);else break;if(o+=12,c[o++]!==5)break;o=zp(c,o);const h=c[o++];let f=(h&248)>>3;f===31&&(f+=1+((h&7)<<3)+((c[o]&224)>>5)),i+="."+f}break}case"hvc1":case"hev1":{const a=fr(t,["hvcC"])[0],c=a[1],o=["","A","B","C"][c>>6],l=c&31,u=Yt(a,2),h=(c&32)>>5?"H":"L",f=a[12],g=a.subarray(6,12);i+="."+o+l,i+="."+u.toString(16).toUpperCase(),i+="."+h+f;let p="";for(let d=g.length;d--;){const m=g[d];(m||p)&&(p="."+m.toString(16).toUpperCase()+p)}i+=p;break}case"dvh1":case"dvhe":{const a=fr(t,["dvcC"])[0],c=a[2]>>1&127,o=a[2]<<5&32|a[3]>>3&31;i+="."+ra(c)+"."+ra(o);break}case"vp09":{const a=fr(t,["vpcC"])[0],c=a[4],o=a[5],l=a[6]>>4&15;i+="."+ra(c)+"."+ra(o)+"."+ra(l);break}case"av01":{const a=fr(t,["av1C"])[0],c=a[1]>>>5,o=a[1]&31,l=a[2]>>>7?"H":"M",u=(a[2]&64)>>6,h=(a[2]&32)>>5,f=c===2&&u?h?12:10:u?10:8,g=(a[2]&16)>>4,p=(a[2]&8)>>3,d=(a[2]&4)>>2,m=a[2]&3;i+="."+c+"."+ra(o)+l+"."+ra(f)+"."+g+"."+p+d+m+"."+ra(1)+"."+ra(1)+"."+ra(1)+"."+0;break}}return{codec:i,encrypted:s}}function zp(r,e){const t=e+5;for(;r[e++]&128&&e<t;);return e}function yd(r){return("0"+r.toString(16).toUpperCase()).slice(-2)}function ra(r){return(r<10?"0":"")+r}function wC(r,e){if(!r||!e)return r;const t=e.keyId;return t&&e.isCommonEncryption&&fr(r,["moov","trak"]).forEach(i=>{const a=fr(i,["mdia","minf","stbl","stsd"])[0].subarray(8);let c=fr(a,["enca"]);const o=c.length>0;o||(c=fr(a,["encv"])),c.forEach(l=>{const u=o?l.subarray(28):l.subarray(78);fr(u,["sinf"]).forEach(f=>{const g=mS(f);if(g){const p=g.subarray(8,24);p.some(d=>d!==0)||(Ee.log(`[eme] Patching keyId in 'enc${o?"a":"v"}>sinf>>tenc' box: ${sa.hexDump(p)} -> ${sa.hexDump(t)}`),g.set(t,8))}})})}),r}function mS(r){const e=fr(r,["schm"])[0];if(e){const t=ai(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return fr(r,["schi","tenc"])[0]}return Ee.error("[eme] missing 'schm' box"),null}function EC(r,e){return fr(e,["moof","traf"]).reduce((t,n)=>{const i=fr(n,["tfdt"])[0],s=i[0],a=fr(n,["tfhd"]).reduce((c,o)=>{const l=Yt(o,4),u=r[l];if(u){let h=Yt(i,4);if(s===1){if(h===xh)return Ee.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),c;h*=xh+1,h+=Yt(i,8)}const f=u.timescale||9e4,g=h/f;if(Pt(g)&&(c===null||g<c))return g}return c},null);return a!==null&&Pt(a)&&(t===null||a<t)?a:t},null)}function RC(r,e){let t=0,n=0,i=0;const s=fr(r,["moof","traf"]);for(let a=0;a<s.length;a++){const c=s[a],o=fr(c,["tfhd"])[0],l=Yt(o,4),u=e[l];if(!u)continue;const h=u.default,f=Yt(o,0)|(h==null?void 0:h.flags);let g=h==null?void 0:h.duration;f&8&&(f&2?g=Yt(o,12):g=Yt(o,8));const p=u.timescale||9e4,d=fr(c,["trun"]);for(let m=0;m<d.length;m++){if(t=TC(d[m]),!t&&g){const E=Yt(d[m],4);t=g*E}u.type===Gr.VIDEO?n+=t/p:u.type===Gr.AUDIO&&(i+=t/p)}}if(n===0&&i===0){let a=1/0,c=0,o=0;const l=fr(r,["sidx"]);for(let u=0;u<l.length;u++){const h=bC(l[u]);if(h!=null&&h.references){a=Math.min(a,h.earliestPresentationTime/h.timescale);const f=h.references.reduce((g,p)=>g+p.info.duration||0,0);c=Math.max(c,f+h.earliestPresentationTime/h.timescale),o=c-a}}if(o&&Pt(o))return o}return n||i}function TC(r){const e=Yt(r,0);let t=8;e&1&&(t+=4),e&4&&(t+=4);let n=0;const i=Yt(r,4);for(let s=0;s<i;s++){if(e&256){const a=Yt(r,t);n+=a,t+=4}e&512&&(t+=4),e&1024&&(t+=4),e&2048&&(t+=4)}return n}function xC(r,e,t){fr(e,["moof","traf"]).forEach(n=>{fr(n,["tfhd"]).forEach(i=>{const s=Yt(i,4),a=r[s];if(!a)return;const c=a.timescale||9e4;fr(n,["tfdt"]).forEach(o=>{const l=o[0],u=t*c;if(u){let h=Yt(o,4);if(l===0)h-=u,h=Math.max(h,0),Wp(o,4,h);else{h*=Math.pow(2,32),h+=Yt(o,8),h-=u,h=Math.max(h,0);const f=Math.floor(h/(xh+1)),g=Math.floor(h%(xh+1));Wp(o,4,f),Wp(o,8,g)}}})})})}function kC(r){const e={valid:null,remainder:null},t=fr(r,["moof"]);if(t.length<2)return e.remainder=r,e;const n=t[t.length-1];return e.valid=ec(r,0,n.byteOffset-8),e.remainder=ec(r,n.byteOffset-8),e}function Is(r,e){const t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function Nv(r,e){const t=[],n=e.samples,i=e.timescale,s=e.id;let a=!1;return fr(n,["moof"]).map(o=>{const l=o.byteOffset-8;fr(o,["traf"]).map(h=>{const f=fr(h,["tfdt"]).map(g=>{const p=g[0];let d=Yt(g,4);return p===1&&(d*=Math.pow(2,32),d+=Yt(g,8)),d/i})[0];return f!==void 0&&(r=f),fr(h,["tfhd"]).map(g=>{const p=Yt(g,4),d=Yt(g,0)&16777215,m=(d&1)!==0,E=(d&2)!==0,S=(d&8)!==0;let R=0;const k=(d&16)!==0;let C=0;const x=(d&32)!==0;let P=8;p===s&&(m&&(P+=8),E&&(P+=4),S&&(R=Yt(g,P),P+=4),k&&(C=Yt(g,P),P+=4),x&&(P+=4),e.type==="video"&&(a=CC(e.codec)),fr(h,["trun"]).map(D=>{const b=D[0],w=Yt(D,0)&16777215,v=(w&1)!==0;let _=0;const y=(w&4)!==0,T=(w&256)!==0;let L=0;const I=(w&512)!==0;let N=0;const M=(w&1024)!==0,U=(w&2048)!==0;let j=0;const Q=Yt(D,4);let Y=8;v&&(_=Yt(D,Y),Y+=4),y&&(Y+=4);let he=_+l;for(let re=0;re<Q;re++){if(T?(L=Yt(D,Y),Y+=4):L=R,I?(N=Yt(D,Y),Y+=4):N=C,M&&(Y+=4),U&&(b===0?j=Yt(D,Y):j=pS(D,Y),Y+=4),e.type===Gr.VIDEO){let pe=0;for(;pe<N;){const fe=Yt(n,he);if(he+=4,PC(a,n[he])){const ue=n.subarray(he,he+fe);gS(ue,a?2:1,r+j/i,t)}he+=fe,pe+=fe+4}}r+=L/i}}))})})}),t}function CC(r){if(!r)return!1;const e=r.indexOf("."),t=e<0?r:r.substring(0,e);return t==="hvc1"||t==="hev1"||t==="dvh1"||t==="dvhe"}function PC(r,e){if(r){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function gS(r,e,t,n){const i=vS(r);let s=0;s+=e;let a=0,c=0,o=0;for(;s<i.length;){a=0;do{if(s>=i.length)break;o=i[s++],a+=o}while(o===255);c=0;do{if(s>=i.length)break;o=i[s++],c+=o}while(o===255);const l=i.length-s;let u=s;if(c<l)s+=c;else if(c>l){Ee.error(`Malformed SEI payload. ${c} is too small, only ${l} bytes left to parse.`);break}if(a===4){if(i[u++]===181){const f=hS(i,u);if(u+=2,f===49){const g=Yt(i,u);if(u+=4,g===1195456820){const p=i[u++];if(p===3){const d=i[u++],m=31&d,E=64&d,S=E?2+m*3:0,R=new Uint8Array(S);if(E){R[0]=d;for(let k=1;k<S;k++)R[k]=i[u++]}n.push({type:p,payloadType:a,pts:t,bytes:R})}}}}}else if(a===5&&c>16){const h=[];for(let p=0;p<16;p++){const d=i[u++].toString(16);h.push(d.length==1?"0"+d:d),(p===3||p===5||p===7||p===9)&&h.push("-")}const f=c-16,g=new Uint8Array(f);for(let p=0;p<f;p++)g[p]=i[u++];n.push({payloadType:a,pts:t,uuid:h.join(""),userData:ha(g),userDataBytes:g})}}}function vS(r){const e=r.byteLength,t=[];let n=1;for(;n<e-2;)r[n]===0&&r[n+1]===0&&r[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return r;const i=e-t.length,s=new Uint8Array(i);let a=0;for(n=0;n<i;a++,n++)a===t[0]&&(a++,t.shift()),s[n]=r[a];return s}function LC(r){const e=r[0];let t="",n="",i=0,s=0,a=0,c=0,o=0,l=0;if(e===0){for(;ai(r.subarray(l,l+1))!=="\0";)t+=ai(r.subarray(l,l+1)),l+=1;for(t+=ai(r.subarray(l,l+1)),l+=1;ai(r.subarray(l,l+1))!=="\0";)n+=ai(r.subarray(l,l+1)),l+=1;n+=ai(r.subarray(l,l+1)),l+=1,i=Yt(r,12),s=Yt(r,16),c=Yt(r,20),o=Yt(r,24),l=28}else if(e===1){l+=4,i=Yt(r,l),l+=4;const h=Yt(r,l);l+=4;const f=Yt(r,l);for(l+=4,a=2**32*h+f,Kk(a)||(a=Number.MAX_SAFE_INTEGER,Ee.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),c=Yt(r,l),l+=4,o=Yt(r,l),l+=4;ai(r.subarray(l,l+1))!=="\0";)t+=ai(r.subarray(l,l+1)),l+=1;for(t+=ai(r.subarray(l,l+1)),l+=1;ai(r.subarray(l,l+1))!=="\0";)n+=ai(r.subarray(l,l+1)),l+=1;n+=ai(r.subarray(l,l+1)),l+=1}const u=r.subarray(l,r.byteLength);return{schemeIdUri:t,value:n,timeScale:i,presentationTime:a,presentationTimeDelta:s,eventDuration:c,id:o,payload:u}}function DC(r,...e){const t=e.length;let n=8,i=t;for(;i--;)n+=e[i].byteLength;const s=new Uint8Array(n);for(s[0]=n>>24&255,s[1]=n>>16&255,s[2]=n>>8&255,s[3]=n&255,s.set(r,4),i=0,n=8;i<t;i++)s.set(e[i],n),n+=e[i].byteLength;return s}function IC(r,e,t){if(r.byteLength!==16)throw new RangeError("Invalid system id");let n,i;n=0,i=new Uint8Array;let s;n>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const a=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),DC([112,115,115,104],new Uint8Array([n,0,0,0]),r,s,i,a,t||new Uint8Array)}function AC(r){if(!(r instanceof ArrayBuffer)||r.byteLength<32)return null;const e={version:0,systemId:"",kids:null,data:null},t=new DataView(r),n=t.getUint32(0);if(r.byteLength!==n&&n>44||t.getUint32(4)!==1886614376||(e.version=t.getUint32(8)>>>24,e.version>1))return null;e.systemId=sa.hexDump(new Uint8Array(r,12,16));const s=t.getUint32(28);if(e.version===0){if(n-32<s)return null;e.data=new Uint8Array(r,32,s)}else if(e.version===1){e.kids=[];for(let a=0;a<s;a++)e.kids.push(new Uint8Array(r,32+a*16,16))}return e}let _d={};class ku{static clearKeyUriToKeyIdMap(){_d={}}constructor(e,t,n,i=[1],s=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=i,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&e!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case es.FAIRPLAY:case es.WIDEVINE:case es.PLAYREADY:case es.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof e!="number"&&(this.method==="AES-128"&&!this.iv&&Ee.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const n=OC(e);return new ku(this.method,this.uri,"identity",this.keyFormatVersions,n)}const t=aC(this.uri);if(t)switch(this.keyFormat){case es.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case es.PLAYREADY:{const n=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=IC(n,null,t);const i=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),s=String.fromCharCode.apply(null,Array.from(i)),a=s.substring(s.indexOf("<"),s.length),l=new DOMParser().parseFromString(a,"text/xml").getElementsByTagName("KID")[0];if(l){const u=l.childNodes[0]?l.childNodes[0].nodeValue:l.getAttribute("VALUE");if(u){const h=Ig(u).subarray(0,16);sC(h),this.keyId=h}}break}default:{let n=t.subarray(0,16);if(n.length!==16){const i=new Uint8Array(16);i.set(n,16-n.length),n=i}this.keyId=n;break}}if(!this.keyId||this.keyId.byteLength!==16){let n=_d[this.uri];if(!n){const i=Object.keys(_d).length%Number.MAX_SAFE_INTEGER;n=new Uint8Array(16),new DataView(n.buffer,12,4).setUint32(0,i),_d[this.uri]=n}this.keyId=n}return this}}function OC(r){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=r>>8*(15-t)&255;return e}const yS=/\{\$([a-zA-Z0-9-_]+)\}/g;function Fv(r){return yS.test(r)}function Ji(r,e,t){if(r.variableList!==null||r.hasVariableRefs)for(let n=t.length;n--;){const i=t[n],s=e[i];s&&(e[i]=fm(r,s))}}function fm(r,e){if(r.variableList!==null||r.hasVariableRefs){const t=r.variableList;return e.replace(yS,n=>{const i=n.substring(2,n.length-1),s=t==null?void 0:t[i];return s===void 0?(r.playlistParsingError||(r.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),n):s})}return e}function jv(r,e,t){let n=r.variableList;n||(r.variableList=n={});let i,s;if("QUERYPARAM"in e){i=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(i))s=a.get(i);else throw new Error(`"${i}" does not match any query parameter in URI: "${t}"`)}catch(a){r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else i=e.NAME,s=e.VALUE;i in n?r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):n[i]=s||""}function MC(r,e,t){const n=e.IMPORT;if(t&&n in t){let i=r.variableList;i||(r.variableList=i={}),i[n]=t[n]}else r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}function ac(r=!0){return typeof self>"u"?void 0:(r||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function NC(r){return typeof self<"u"&&r===self.ManagedMediaSource}const kh={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function FC(r,e){const t=kh[e];return!!t&&!!t[r.slice(0,4)]}function Kp(r,e,t=!0){return!r.split(",").some(n=>!_S(n,e,t))}function _S(r,e,t=!0){var n;const i=ac(t);return(n=i==null?void 0:i.isTypeSupported(Cu(r,e)))!=null?n:!1}function Cu(r,e){return`${e}/mp4;codecs="${r}"`}function Bv(r){if(r){const e=r.substring(0,4);return kh.video[e]}return 2}function Ch(r){return r.split(",").reduce((e,t)=>{const n=kh.video[t];return n?(n*2+e)/(e?3:2):(kh.audio[t]+e)/(e?2:1)},0)}const qp={};function jC(r,e=!0){if(qp[r])return qp[r];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[r];for(let n=0;n<t.length;n++)if(_S(t[n],"audio",e))return qp[r]=t[n],t[n];return r}const BC=/flac|opus/i;function Ph(r,e=!0){return r.replace(BC,t=>jC(t.toLowerCase(),e))}function Uv(r,e){return r&&r!=="mp4a"?r:e&&e.split(",")[0]}function UC(r){const e=r.split(".");if(e.length>2){let t=e.shift()+".";return t+=parseInt(e.shift()).toString(16),t+=("000"+parseInt(e.shift()).toString(16)).slice(-4),t}return r}const $v=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Vv=/#EXT-X-MEDIA:(.*)/g,$C=/^#EXT(?:INF|-X-TARGETDURATION):/m,Gv=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),VC=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class ca{static findGroup(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(i.id===t)return i}}static resolve(e,t){return Dg.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return $C.test(e)}static parseMasterPlaylist(e,t){const n=Fv(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},s=[];$v.lastIndex=0;let a;for(;(a=$v.exec(e))!=null;)if(a[1]){var c;const l=new En(a[1]);Ji(i,l,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const u=fm(i,a[2]),h={attrs:l,bitrate:l.decimalInteger("BANDWIDTH")||l.decimalInteger("AVERAGE-BANDWIDTH"),name:l.NAME,url:ca.resolve(u,t)},f=l.decimalResolution("RESOLUTION");f&&(h.width=f.width,h.height=f.height),GC(l.CODECS,h),(c=h.unknownCodecs)!=null&&c.length||s.push(h),i.levels.push(h)}else if(a[3]){const l=a[3],u=a[4];switch(l){case"SESSION-DATA":{const h=new En(u);Ji(i,h,["DATA-ID","LANGUAGE","VALUE","URI"]);const f=h["DATA-ID"];f&&(i.sessionData===null&&(i.sessionData={}),i.sessionData[f]=h);break}case"SESSION-KEY":{const h=Hv(u,t,i);h.encrypted&&h.isSupported()?(i.sessionKeys===null&&(i.sessionKeys=[]),i.sessionKeys.push(h)):Ee.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${u}"`);break}case"DEFINE":{{const h=new En(u);Ji(i,h,["NAME","VALUE","QUERYPARAM"]),jv(i,h,t)}break}case"CONTENT-STEERING":{const h=new En(u);Ji(i,h,["SERVER-URI","PATHWAY-ID"]),i.contentSteering={uri:ca.resolve(h["SERVER-URI"],t),pathwayId:h["PATHWAY-ID"]||"."};break}case"START":{i.startTimeOffset=Wv(u);break}}}const o=s.length>0&&s.length<i.levels.length;return i.levels=o?s:i.levels,i.levels.length===0&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,n){let i;const s={},a=n.levels,c={AUDIO:a.map(l=>({id:l.attrs.AUDIO,audioCodec:l.audioCodec})),SUBTITLES:a.map(l=>({id:l.attrs.SUBTITLES,textCodec:l.textCodec})),"CLOSED-CAPTIONS":[]};let o=0;for(Vv.lastIndex=0;(i=Vv.exec(e))!==null;){const l=new En(i[1]),u=l.TYPE;if(u){const h=c[u],f=s[u]||[];s[u]=f,Ji(n,l,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const g=l.LANGUAGE,p=l["ASSOC-LANGUAGE"],d=l.CHANNELS,m=l.CHARACTERISTICS,E=l["INSTREAM-ID"],S={attrs:l,bitrate:0,id:o++,groupId:l["GROUP-ID"]||"",name:l.NAME||g||"",type:u,default:l.bool("DEFAULT"),autoselect:l.bool("AUTOSELECT"),forced:l.bool("FORCED"),lang:g,url:l.URI?ca.resolve(l.URI,t):""};if(p&&(S.assocLang=p),d&&(S.channels=d),m&&(S.characteristics=m),E&&(S.instreamId=E),h!=null&&h.length){const R=ca.findGroup(h,S.groupId)||h[0];zv(S,R,"audioCodec"),zv(S,R,"textCodec")}f.push(S)}}return s}static parseLevelPlaylist(e,t,n,i,s,a){const c=new nC(t),o=c.fragments;let l=null,u=0,h=0,f=0,g=0,p=null,d=new Vp(i,t),m,E,S,R=-1,k=!1,C=null;for(Gv.lastIndex=0,c.m3u8=e,c.hasVariableRefs=Fv(e);(m=Gv.exec(e))!==null;){k&&(k=!1,d=new Vp(i,t),d.start=f,d.sn=u,d.cc=g,d.level=n,l&&(d.initSegment=l,d.rawProgramDateTime=l.rawProgramDateTime,l.rawProgramDateTime=null,C&&(d.setByteRange(C),C=null)));const b=m[1];if(b){d.duration=parseFloat(b);const w=(" "+m[2]).slice(1);d.title=w||null,d.tagList.push(w?["INF",b,w]:["INF",b])}else if(m[3]){if(Pt(d.duration)){d.start=f,S&&Yv(d,S,c),d.sn=u,d.level=n,d.cc=g,o.push(d);const w=(" "+m[3]).slice(1);d.relurl=fm(c,w),Kv(d,p),p=d,f+=d.duration,u++,h=0,k=!0}}else if(m[4]){const w=(" "+m[4]).slice(1);p?d.setByteRange(w,p):d.setByteRange(w)}else if(m[5])d.rawProgramDateTime=(" "+m[5]).slice(1),d.tagList.push(["PROGRAM-DATE-TIME",d.rawProgramDateTime]),R===-1&&(R=o.length);else{if(m=m[0].match(VC),!m){Ee.warn("No matches on slow regex match for level playlist!");continue}for(E=1;E<m.length&&!(typeof m[E]<"u");E++);const w=(" "+m[E]).slice(1),v=(" "+m[E+1]).slice(1),_=m[E+2]?(" "+m[E+2]).slice(1):"";switch(w){case"PLAYLIST-TYPE":c.type=v.toUpperCase();break;case"MEDIA-SEQUENCE":u=c.startSN=parseInt(v);break;case"SKIP":{const y=new En(v);Ji(c,y,["RECENTLY-REMOVED-DATERANGES"]);const T=y.decimalInteger("SKIPPED-SEGMENTS");if(Pt(T)){c.skippedSegments=T;for(let I=T;I--;)o.unshift(null);u+=T}const L=y.enumeratedString("RECENTLY-REMOVED-DATERANGES");L&&(c.recentlyRemovedDateranges=L.split("	"));break}case"TARGETDURATION":c.targetduration=Math.max(parseInt(v),1);break;case"VERSION":c.version=parseInt(v);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":c.live=!1;break;case"#":(v||_)&&d.tagList.push(_?[v,_]:[v]);break;case"DISCONTINUITY":g++,d.tagList.push(["DIS"]);break;case"GAP":d.gap=!0,d.tagList.push([w]);break;case"BITRATE":d.tagList.push([w,v]);break;case"DATERANGE":{const y=new En(v);Ji(c,y,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),Ji(c,y,y.clientAttrs);const T=new iS(y,c.dateRanges[y.ID]);T.isValid||c.skippedSegments?c.dateRanges[T.id]=T:Ee.warn(`Ignoring invalid DATERANGE tag: "${v}"`),d.tagList.push(["EXT-X-DATERANGE",v]);break}case"DEFINE":{{const y=new En(v);Ji(c,y,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in y?MC(c,y,a):jv(c,y,t)}break}case"DISCONTINUITY-SEQUENCE":g=parseInt(v);break;case"KEY":{const y=Hv(v,t,c);if(y.isSupported()){if(y.method==="NONE"){S=void 0;break}S||(S={}),S[y.keyFormat]&&(S=Xn({},S)),S[y.keyFormat]=y}else Ee.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${v}"`);break}case"START":c.startTimeOffset=Wv(v);break;case"MAP":{const y=new En(v);if(Ji(c,y,["BYTERANGE","URI"]),d.duration){const T=new Vp(i,t);qv(T,y,n,S),l=T,d.initSegment=l,l.rawProgramDateTime&&!d.rawProgramDateTime&&(d.rawProgramDateTime=l.rawProgramDateTime)}else{const T=d.byteRangeEndOffset;if(T){const L=d.byteRangeStartOffset;C=`${T-L}@${L}`}else C=null;qv(d,y,n,S),l=d,k=!0}break}case"SERVER-CONTROL":{const y=new En(v);c.canBlockReload=y.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=y.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&y.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=y.optionalFloat("PART-HOLD-BACK",0),c.holdBack=y.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const y=new En(v);c.partTarget=y.decimalFloatingPoint("PART-TARGET");break}case"PART":{let y=c.partList;y||(y=c.partList=[]);const T=h>0?y[y.length-1]:void 0,L=h++,I=new En(v);Ji(c,I,["BYTERANGE","URI"]);const N=new tC(I,d,t,L,T);y.push(N),d.duration+=N.duration;break}case"PRELOAD-HINT":{const y=new En(v);Ji(c,y,["URI"]),c.preloadHint=y;break}case"RENDITION-REPORT":{const y=new En(v);Ji(c,y,["URI"]),c.renditionReports=c.renditionReports||[],c.renditionReports.push(y);break}default:Ee.warn(`line parsed but not handled: ${m}`);break}}}p&&!p.relurl?(o.pop(),f-=p.duration,c.partList&&(c.fragmentHint=p)):c.partList&&(Kv(d,p),d.cc=g,c.fragmentHint=d,S&&Yv(d,S,c));const x=o.length,P=o[0],D=o[x-1];if(f+=c.skippedSegments*c.targetduration,f>0&&x&&D){c.averagetargetduration=f/x;const b=D.sn;c.endSN=b!=="initSegment"?b:0,c.live||(D.endList=!0),P&&(c.startCC=P.cc)}else c.endSN=0,c.startCC=0;return c.fragmentHint&&(f+=c.fragmentHint.duration),c.totalduration=f,c.endCC=g,R>0&&HC(o,R),c}}function Hv(r,e,t){var n,i;const s=new En(r);Ji(t,s,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const a=(n=s.METHOD)!=null?n:"",c=s.URI,o=s.hexadecimalInteger("IV"),l=s.KEYFORMATVERSIONS,u=(i=s.KEYFORMAT)!=null?i:"identity";c&&s.IV&&!o&&Ee.error(`Invalid IV: ${s.IV}`);const h=c?ca.resolve(c,e):"",f=(l||"1").split("/").map(Number).filter(Number.isFinite);return new ku(a,h,u,f,o)}function Wv(r){const t=new En(r).decimalFloatingPoint("TIME-OFFSET");return Pt(t)?t:null}function GC(r,e){let t=(r||"").split(/[ ,]+/).filter(n=>n);["video","audio","text"].forEach(n=>{const i=t.filter(s=>FC(s,n));i.length&&(e[`${n}Codec`]=i.join(","),t=t.filter(s=>i.indexOf(s)===-1))}),e.unknownCodecs=t}function zv(r,e,t){const n=e[t];n&&(r[t]=n)}function HC(r,e){let t=r[e];for(let n=e;n--;){const i=r[n];if(!i)return;i.programDateTime=t.programDateTime-i.duration*1e3,t=i}}function Kv(r,e){r.rawProgramDateTime?r.programDateTime=Date.parse(r.rawProgramDateTime):e!=null&&e.programDateTime&&(r.programDateTime=e.endProgramDateTime),Pt(r.programDateTime)||(r.programDateTime=null,r.rawProgramDateTime=null)}function qv(r,e,t,n){r.relurl=e.URI,e.BYTERANGE&&r.setByteRange(e.BYTERANGE),r.level=t,r.sn="initSegment",n&&(r.levelkeys=n),r.initSegment=null}function Yv(r,e,t){r.levelkeys=e;const{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&n.push(r)}var Dr={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Jt={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function Qv(r){const{type:e}=r;switch(e){case Dr.AUDIO_TRACK:return Jt.AUDIO;case Dr.SUBTITLE_TRACK:return Jt.SUBTITLE;default:return Jt.MAIN}}function Yp(r,e){let t=r.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class WC{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.LEVEL_LOADING,this.onLevelLoading,this),e.on(H.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(H.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.LEVEL_LOADING,this.onLevelLoading,this),e.off(H.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(H.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,i=t.loader,s=n||i,a=new s(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Dr.MANIFEST,url:n,deliveryDirectives:null})}onLevelLoading(e,t){const{id:n,level:i,pathwayId:s,url:a,deliveryDirectives:c}=t;this.load({id:n,level:i,pathwayId:s,responseType:"text",type:Dr.LEVEL,url:a,deliveryDirectives:c})}onAudioTrackLoading(e,t){const{id:n,groupId:i,url:s,deliveryDirectives:a}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:Dr.AUDIO_TRACK,url:s,deliveryDirectives:a})}onSubtitleTrackLoading(e,t){const{id:n,groupId:i,url:s,deliveryDirectives:a}=t;this.load({id:n,groupId:i,level:null,responseType:"text",type:Dr.SUBTITLE_TRACK,url:s,deliveryDirectives:a})}load(e){var t;const n=this.hls.config;let i=this.getInternalLoader(e);if(i){const l=i.context;if(l&&l.url===e.url&&l.level===e.level){Ee.trace("[playlist-loader]: playlist request ongoing");return}Ee.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}let s;if(e.type===Dr.MANIFEST?s=n.manifestLoadPolicy.default:s=Xn({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),Pt((t=e.deliveryDirectives)==null?void 0:t.part)){let l;if(e.type===Dr.LEVEL&&e.level!==null?l=this.hls.levels[e.level].details:e.type===Dr.AUDIO_TRACK&&e.id!==null?l=this.hls.audioTracks[e.id].details:e.type===Dr.SUBTITLE_TRACK&&e.id!==null&&(l=this.hls.subtitleTracks[e.id].details),l){const u=l.partTarget,h=l.targetduration;if(u&&h){const f=Math.max(u*3,h*.8)*1e3;s=Xn({},s,{maxTimeToFirstByteMs:Math.min(f,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,s.maxTimeToFirstByteMs)})}}}const a=s.errorRetry||s.timeoutRetry||{},c={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},o={onSuccess:(l,u,h,f)=>{const g=this.getInternalLoader(h);this.resetInternalLoader(h.type);const p=l.data;if(p.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(l,h,new Error("no EXTM3U delimiter"),f||null,u);return}u.parsing.start=performance.now(),ca.isMediaPlaylist(p)?this.handleTrackOrLevelPlaylist(l,u,h,f||null,g):this.handleMasterPlaylist(l,u,h,f)},onError:(l,u,h,f)=>{this.handleNetworkError(u,h,!1,l,f)},onTimeout:(l,u,h)=>{this.handleNetworkError(u,h,!0,void 0,l)}};i.load(e,c,o)}handleMasterPlaylist(e,t,n,i){const s=this.hls,a=e.data,c=Yp(e,n),o=ca.parseMasterPlaylist(a,c);if(o.playlistParsingError){this.handleManifestParsingError(e,n,o.playlistParsingError,i,t);return}const{contentSteering:l,levels:u,sessionData:h,sessionKeys:f,startTimeOffset:g,variableList:p}=o;this.variableList=p;const{AUDIO:d=[],SUBTITLES:m,"CLOSED-CAPTIONS":E}=ca.parseMasterPlaylistMedia(a,c,o);d.length&&!d.some(R=>!R.url)&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(Ee.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),d.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new En({}),bitrate:0,url:""})),s.trigger(H.MANIFEST_LOADED,{levels:u,audioTracks:d,subtitles:m,captions:E,contentSteering:l,url:c,stats:t,networkDetails:i,sessionData:h,sessionKeys:f,startTimeOffset:g,variableList:p})}handleTrackOrLevelPlaylist(e,t,n,i,s){const a=this.hls,{id:c,level:o,type:l}=n,u=Yp(e,n),h=0,f=Pt(o)?o:Pt(c)?c:0,g=Qv(n),p=ca.parseLevelPlaylist(e.data,u,f,g,h,this.variableList);if(l===Dr.MANIFEST){const d={attrs:new En({}),bitrate:0,details:p,name:"",url:u};a.trigger(H.MANIFEST_LOADED,{levels:[d],audioTracks:[],url:u,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=p,this.handlePlaylistLoaded(p,e,t,n,i,s)}handleManifestParsingError(e,t,n,i,s){this.hls.trigger(H.ERROR,{type:rr.NETWORK_ERROR,details:Me.MANIFEST_PARSING_ERROR,fatal:t.type===Dr.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:i,stats:s})}handleNetworkError(e,t,n=!1,i,s){let a=`A network ${n?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===Dr.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===Dr.AUDIO_TRACK||e.type===Dr.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const c=new Error(a);Ee.warn(`[playlist-loader]: ${a}`);let o=Me.UNKNOWN,l=!1;const u=this.getInternalLoader(e);switch(e.type){case Dr.MANIFEST:o=n?Me.MANIFEST_LOAD_TIMEOUT:Me.MANIFEST_LOAD_ERROR,l=!0;break;case Dr.LEVEL:o=n?Me.LEVEL_LOAD_TIMEOUT:Me.LEVEL_LOAD_ERROR,l=!1;break;case Dr.AUDIO_TRACK:o=n?Me.AUDIO_TRACK_LOAD_TIMEOUT:Me.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case Dr.SUBTITLE_TRACK:o=n?Me.SUBTITLE_TRACK_LOAD_TIMEOUT:Me.SUBTITLE_LOAD_ERROR,l=!1;break}u&&this.resetInternalLoader(e.type);const h={type:rr.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:u,context:e,error:c,networkDetails:t,stats:s};if(i){const f=(t==null?void 0:t.url)||e.url;h.response=gi({url:f,data:void 0},i)}this.hls.trigger(H.ERROR,h)}handlePlaylistLoaded(e,t,n,i,s,a){const c=this.hls,{type:o,level:l,id:u,groupId:h,deliveryDirectives:f}=i,g=Yp(t,i),p=Qv(i),d=typeof i.level=="number"&&p===Jt.MAIN?l:void 0;if(!e.fragments.length){const E=new Error("No Segments found in Playlist");c.trigger(H.ERROR,{type:rr.NETWORK_ERROR,details:Me.LEVEL_EMPTY_ERROR,fatal:!1,url:g,error:E,reason:E.message,response:t,context:i,level:d,parent:p,networkDetails:s,stats:n});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const m=e.playlistParsingError;if(m){c.trigger(H.ERROR,{type:rr.NETWORK_ERROR,details:Me.LEVEL_PARSING_ERROR,fatal:!1,url:g,error:m,reason:m.message,response:t,context:i,level:d,parent:p,networkDetails:s,stats:n});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),o){case Dr.MANIFEST:case Dr.LEVEL:c.trigger(H.LEVEL_LOADED,{details:e,level:d||0,id:u||0,stats:n,networkDetails:s,deliveryDirectives:f});break;case Dr.AUDIO_TRACK:c.trigger(H.AUDIO_TRACK_LOADED,{details:e,id:u||0,groupId:h||"",stats:n,networkDetails:s,deliveryDirectives:f});break;case Dr.SUBTITLE_TRACK:c.trigger(H.SUBTITLE_TRACK_LOADED,{details:e,id:u||0,groupId:h||"",stats:n,networkDetails:s,deliveryDirectives:f});break}}}function bS(r,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=r,e.dispatchEvent(t)}function SS(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues&&!r.cues.getCueById(e.id))try{if(r.addCue(e),!r.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){Ee.debug(`[texttrack-utils]: ${n}`);try{const i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,r.addCue(i)}catch(i){Ee.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}t==="disabled"&&(r.mode=t)}function Qc(r){const e=r.mode;if(e==="disabled"&&(r.mode="hidden"),r.cues)for(let t=r.cues.length;t--;)r.removeCue(r.cues[t]);e==="disabled"&&(r.mode=e)}function mm(r,e,t,n){const i=r.mode;if(i==="disabled"&&(r.mode="hidden"),r.cues&&r.cues.length>0){const s=KC(r.cues,e,t);for(let a=0;a<s.length;a++)(!n||n(s[a]))&&r.removeCue(s[a])}i==="disabled"&&(r.mode=i)}function zC(r,e){if(e<r[0].startTime)return 0;const t=r.length-1;if(e>r[t].endTime)return-1;let n=0,i=t;for(;n<=i;){const s=Math.floor((i+n)/2);if(e<r[s].startTime)i=s-1;else if(e>r[s].startTime&&n<t)n=s+1;else return s}return r[n].startTime-e<e-r[i].startTime?n:i}function KC(r,e,t){const n=[],i=zC(r,e);if(i>-1)for(let s=i,a=r.length;s<a;s++){const c=r[s];if(c.startTime>=e&&c.endTime<=t)n.push(c);else if(c.startTime>t)return n}return n}function Gd(r){const e=[];for(let t=0;t<r.length;t++){const n=r[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(r[t])}return e}var zs={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const qC=.25;function gm(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Xv(r,e,t,n,i){let s=new r(e,t,"");try{s.value=n,i&&(s.type=i)}catch{s=new r(e,t,JSON.stringify(i?gi({type:i},n):n))}return s}const bd=(()=>{const r=gm();try{r&&new r(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function Qp(r,e){return r.getTime()/1e3-e}function YC(r){return Uint8Array.from(r.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class QC{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(H.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(H.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(H.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(H.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(Qc(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if(n.kind==="metadata"&&n.label==="id3")return bS(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:n,enableID3MetadataCues:i}}}=this;if(!n&&!i)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=gm();if(a)for(let c=0;c<s.length;c++){const o=s[c].type;if(o===zs.emsg&&!n||!i)continue;const l=uS(s[c].data);if(l){const u=s[c].pts;let h=u+s[c].duration;h>bd&&(h=bd),h-u<=0&&(h=u+qC);for(let g=0;g<l.length;g++){const p=l[g];if(!lS(p)){this.updateId3CueEnds(u,o);const d=Xv(a,u,h,p,o);d&&this.id3Track.addCue(d)}}}}}updateId3CueEnds(e,t){var n;const i=(n=this.id3Track)==null?void 0:n.cues;if(i)for(let s=i.length;s--;){const a=i[s];a.type===t&&a.startTime<e&&a.endTime===bd&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:i}){const{id3Track:s,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:c,enableID3MetadataCues:o}}=a;if(s&&(c||o)){let l;i==="audio"?l=u=>u.type===zs.audioId3&&o:i==="video"?l=u=>u.type===zs.emsg&&c:l=u=>u.type===zs.audioId3&&o||u.type===zs.emsg&&c,mm(s,t,n,l)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:n,id3Track:i}=this,{dateRanges:s}=t,a=Object.keys(s);if(i){const u=Object.keys(n).filter(h=>!a.includes(h));for(let h=u.length;h--;){const f=u[h];Object.keys(n[f].cues).forEach(g=>{i.removeCue(n[f].cues[g])}),delete n[f]}}const c=t.fragments[t.fragments.length-1];if(a.length===0||!Pt(c==null?void 0:c.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=c.programDateTime/1e3-c.start,l=gm();for(let u=0;u<a.length;u++){const h=a[u],f=s[h],g=Qp(f.startDate,o),p=n[h],d=(p==null?void 0:p.cues)||{};let m=(p==null?void 0:p.durationKnown)||!1,E=bd;const S=f.endDate;if(S)E=Qp(S,o),m=!0;else if(f.endOnNext&&!m){const k=a.reduce((C,x)=>{if(x!==f.id){const P=s[x];if(P.class===f.class&&P.startDate>f.startDate&&(!C||f.startDate<C.startDate))return P}return C},null);k&&(E=Qp(k.startDate,o),m=!0)}const R=Object.keys(f.attr);for(let k=0;k<R.length;k++){const C=R[k];if(!Zk(C))continue;const x=d[C];if(x)m&&!p.durationKnown&&(x.endTime=E);else if(l){let P=f.attr[C];eC(C)&&(P=YC(P));const D=Xv(l,g,E,{key:C,data:P},zs.dateRange);D&&(D.id=h,this.id3Track.addCue(D),d[C]=D)}}n[h]={cues:d,dateRange:f,durationKnown:m}}}}class XC{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(e===null)return null;const{holdBack:t,partHoldBack:n,targetduration:i}=e,{liveSyncDuration:s,liveSyncDurationCount:a,lowLatencyMode:c}=this.config,o=this.hls.userConfig;let l=c&&n||t;(o.liveSyncDuration||o.liveSyncDurationCount||l===0)&&(l=s!==void 0?s:a*i);const u=i;return l+Math.min(this.stallCount*1,u)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,n=this.levelDetails;if(e===null||t===null||n===null)return null;const i=n.edge,s=e-t-this.edgeStalled,a=i-n.totalduration,c=i-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(a,s),c)}get drift(){const{levelDetails:e}=this;return e===null?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(H.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(H.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(H.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(H.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(H.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(H.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var n;t.details===Me.BUFFER_STALLED_ERROR&&(this.stallCount++,(n=this.levelDetails)!=null&&n.live&&Ee.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const n=this.computeLatency();if(n===null)return;this._latency=n;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:s}=this.config;if(!i||s===1||!t.live)return;const a=this.targetLatency;if(a===null)return;const c=n-a,o=Math.min(this.maxLatency,a+t.targetduration);if(c<o&&c>.05&&this.forwardBufferLength>1){const u=Math.min(2,Math.max(1,s)),h=Math.round(2/(1+Math.exp(-.75*c-this.edgeStalled))*20)/20;e.playbackRate=Math.min(u,Math.max(1,h))}else e.playbackRate!==1&&e.playbackRate!==0&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}const vm=["NONE","TYPE-0","TYPE-1",null];function JC(r){return vm.indexOf(r)>-1}const Lh=["SDR","PQ","HLG"];function ZC(r){return!!r&&Lh.indexOf(r)>-1}var Hd={No:"",Yes:"YES",v2:"v2"};function Jv(r){const{canSkipUntil:e,canSkipDateRanges:t,age:n}=r,i=n<e/2;return e&&i?t?Hd.v2:Hd.Yes:Hd.No}class Zv{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class gl{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(t=>!!t).map(t=>t.substring(0,4)).join(","),this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return ey(this._audioGroups,e)}hasSubtitleGroup(e){return ey(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let n=this._audioGroups;n||(n=this._audioGroups=[]),n.indexOf(t)===-1&&n.push(t)}else if(e==="text"){let n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(t)===-1&&n.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function ey(r,e){return!e||!r?!1:r.indexOf(e)!==-1}function Xp(r,e){const t=e.startPTS;if(Pt(t)){let n=0,i;e.sn>r.sn?(n=t-r.start,i=r):(n=r.start-t,i=e),i.duration!==n&&(i.duration=n)}else e.sn>r.sn?r.cc===e.cc&&r.minEndPTS?e.start=r.start+(r.minEndPTS-r.start):e.start=r.start+r.duration:e.start=Math.max(r.start-e.duration,0)}function wS(r,e,t,n,i,s){n-t<=0&&(Ee.warn("Fragment should have a positive duration",e),n=t+e.duration,s=i+e.duration);let c=t,o=n;const l=e.startPTS,u=e.endPTS;if(Pt(l)){const m=Math.abs(l-t);Pt(e.deltaPTS)?e.deltaPTS=Math.max(m,e.deltaPTS):e.deltaPTS=m,c=Math.max(t,l),t=Math.min(t,l),i=Math.min(i,e.startDTS),o=Math.min(n,u),n=Math.max(n,u),s=Math.max(s,e.endDTS)}const h=t-e.start;e.start!==0&&(e.start=t),e.duration=n-e.start,e.startPTS=t,e.maxStartPTS=c,e.startDTS=i,e.endPTS=n,e.minEndPTS=o,e.endDTS=s;const f=e.sn;if(!r||f<r.startSN||f>r.endSN)return 0;let g;const p=f-r.startSN,d=r.fragments;for(d[p]=e,g=p;g>0;g--)Xp(d[g],d[g-1]);for(g=p;g<d.length-1;g++)Xp(d[g],d[g+1]);return r.fragmentHint&&Xp(d[d.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,h}function eP(r,e){let t=null;const n=r.fragments;for(let o=n.length-1;o>=0;o--){const l=n[o].initSegment;if(l){t=l;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;let i=0,s;if(nP(r,e,(o,l)=>{o.relurl&&(i=o.cc-l.cc),Pt(o.startPTS)&&Pt(o.endPTS)&&(l.start=l.startPTS=o.startPTS,l.startDTS=o.startDTS,l.maxStartPTS=o.maxStartPTS,l.endPTS=o.endPTS,l.endDTS=o.endDTS,l.minEndPTS=o.minEndPTS,l.duration=o.endPTS-o.startPTS,l.duration&&(s=l),e.PTSKnown=e.alignedSliding=!0),l.elementaryStreams=o.elementaryStreams,l.loader=o.loader,l.stats=o.stats,o.initSegment&&(l.initSegment=o.initSegment,t=o.initSegment)}),t&&(e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments).forEach(l=>{var u;l&&(!l.initSegment||l.initSegment.relurl===((u=t)==null?void 0:u.relurl))&&(l.initSegment=t)}),e.skippedSegments)if(e.deltaUpdateFailed=e.fragments.some(o=>!o),e.deltaUpdateFailed){Ee.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let o=e.skippedSegments;o--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}else e.canSkipDateRanges&&(e.dateRanges=tP(r.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));const a=e.fragments;if(i){Ee.warn("discontinuity sliding from playlist, take drift into account");for(let o=0;o<a.length;o++)a[o].cc+=i}e.skippedSegments&&(e.startCC=e.fragments[0].cc),rP(r.partList,e.partList,(o,l)=>{l.elementaryStreams=o.elementaryStreams,l.stats=o.stats}),s?wS(e,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):ES(r,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=r.driftStartTime,e.driftStart=r.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const o=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=o),e.driftEndTime=c,e.driftEnd=o}else e.driftEndTime=r.driftEndTime,e.driftEnd=r.driftEnd,e.advancedDateTime=r.advancedDateTime}function tP(r,e,t){const n=Xn({},r);return t&&t.forEach(i=>{delete n[i]}),Object.keys(e).forEach(i=>{const s=new iS(e[i].attr,n[i]);s.isValid?n[i]=s:Ee.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(e[i].attr)}"`)}),n}function rP(r,e,t){if(r&&e){let n=0;for(let i=0,s=r.length;i<=s;i++){const a=r[i],c=e[i+n];a&&c&&a.index===c.index&&a.fragment.sn===c.fragment.sn?t(a,c):n--}}}function nP(r,e,t){const n=e.skippedSegments,i=Math.max(r.startSN,e.startSN)-e.startSN,s=(r.fragmentHint?1:0)+(n?e.endSN:Math.min(r.endSN,e.endSN))-e.startSN,a=e.startSN-r.startSN,c=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,o=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;for(let l=i;l<=s;l++){const u=o[a+l];let h=c[l];n&&!h&&l<n&&(h=e.fragments[l]=u),u&&h&&t(u,h)}}function ES(r,e){const t=e.startSN+e.skippedSegments-r.startSN,n=r.fragments;t<0||t>=n.length||ym(e,n[t].start)}function ym(r,e){if(e){const t=r.fragments;for(let n=r.skippedSegments;n<t.length;n++)t[n].start+=e;r.fragmentHint&&(r.fragmentHint.start+=e)}}function iP(r,e=1/0){let t=1e3*r.targetduration;if(r.updated){const n=r.fragments;if(n.length&&t*4>e){const s=n[n.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function sP(r,e,t){if(!(r!=null&&r.details))return null;const n=r.details;let i=n.fragments[e-n.startSN];return i||(i=n.fragmentHint,i&&i.sn===e)?i:e<n.startSN&&t&&t.sn===e?t:null}function ty(r,e,t){var n;return r!=null&&r.details?RS((n=r.details)==null?void 0:n.partList,e,t):null}function RS(r,e,t){if(r)for(let n=r.length;n--;){const i=r[n];if(i.index===t&&i.fragment.sn===e)return i}return null}function TS(r){r.forEach((e,t)=>{const{details:n}=e;n!=null&&n.fragments&&n.fragments.forEach(i=>{i.level=t})})}function Dh(r){switch(r.details){case Me.FRAG_LOAD_TIMEOUT:case Me.KEY_LOAD_TIMEOUT:case Me.LEVEL_LOAD_TIMEOUT:case Me.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function ry(r,e){const t=Dh(e);return r.default[`${t?"timeout":"error"}Retry`]}function Mg(r,e){const t=r.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*r.retryDelayMs,r.maxRetryDelayMs)}function ny(r){return gi(gi({},r),{errorRetry:null,timeoutRetry:null})}function Ih(r,e,t,n){if(!r)return!1;const i=n==null?void 0:n.code,s=e<r.maxNumRetry&&(aP(i)||!!t);return r.shouldRetry?r.shouldRetry(r,e,t,n,s):s}function aP(r){return r===0&&navigator.onLine===!1||!!r&&(r<400||r>499)}const xS={search:function(r,e){let t=0,n=r.length-1,i=null,s=null;for(;t<=n;){i=(t+n)/2|0,s=r[i];const a=e(s);if(a>0)t=i+1;else if(a<0)n=i-1;else return s}return null}};function oP(r,e,t){if(e===null||!Array.isArray(r)||!r.length||!Pt(e))return null;const n=r[0].programDateTime;if(e<(n||0))return null;const i=r[r.length-1].endProgramDateTime;if(e>=(i||0))return null;t=t||0;for(let s=0;s<r.length;++s){const a=r[s];if(cP(e,t,a))return a}return null}function Ah(r,e,t=0,n=0){let i=null;if(r){i=e[r.sn-e[0].sn+1]||null;const a=r.endDTS-t;a>0&&a<15e-7&&(t+=15e-7)}else t===0&&e[0].start===0&&(i=e[0]);if(i&&(!r||r.level===i.level)&&_m(t,n,i)===0)return i;const s=xS.search(e,_m.bind(null,t,n));return s&&(s!==r||!i)?s:i}function _m(r=0,e=0,t){if(t.start<=r&&t.start+t.duration>r)return 0;const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=r?1:t.start-n>r&&t.start?-1:0}function cP(r,e,t){const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>r}function lP(r,e){return xS.search(r,t=>t.cc<e?1:t.cc>e?-1:0)}var xi={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},$s={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class uP{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=Ee.log.bind(Ee,"[info]:"),this.warn=Ee.warn.bind(Ee,"[warning]:"),this.error=Ee.error.bind(Ee,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(H.ERROR,this.onError,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(H.ERROR,this.onError,this),e.off(H.ERROR,this.onErrorOut,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===Jt.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var n,i;if(t.fatal)return;const s=this.hls,a=t.context;switch(t.details){case Me.FRAG_LOAD_ERROR:case Me.FRAG_LOAD_TIMEOUT:case Me.KEY_LOAD_ERROR:case Me.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case Me.FRAG_PARSING_ERROR:if((n=t.frag)!=null&&n.gap){t.errorAction={action:xi.DoNothing,flags:$s.None};return}case Me.FRAG_GAP:case Me.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=xi.SendAlternateToPenaltyBox;return}case Me.LEVEL_EMPTY_ERROR:case Me.LEVEL_PARSING_ERROR:{var c,o;const l=t.parent===Jt.MAIN?t.level:s.loadLevel;t.details===Me.LEVEL_EMPTY_ERROR&&((c=t.context)!=null&&(o=c.levelDetails)!=null&&o.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case Me.LEVEL_LOAD_ERROR:case Me.LEVEL_LOAD_TIMEOUT:typeof(a==null?void 0:a.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.level));return;case Me.AUDIO_TRACK_LOAD_ERROR:case Me.AUDIO_TRACK_LOAD_TIMEOUT:case Me.SUBTITLE_LOAD_ERROR:case Me.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){const l=s.levels[s.loadLevel];if(l&&(a.type===Dr.AUDIO_TRACK&&l.hasAudioGroup(a.groupId)||a.type===Dr.SUBTITLE_TRACK&&l.hasSubtitleGroup(a.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=xi.SendAlternateToPenaltyBox,t.errorAction.flags=$s.MoveAllAlternatesMatchingHost;return}}return;case Me.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const l=s.levels[s.loadLevel],u=l==null?void 0:l.attrs["HDCP-LEVEL"];u?t.errorAction={action:xi.SendAlternateToPenaltyBox,flags:$s.MoveAllAlternatesMatchingHDCP,hdcpLevel:u}:this.keySystemError(t)}return;case Me.BUFFER_ADD_CODEC_ERROR:case Me.REMUX_ALLOC_ERROR:case Me.BUFFER_APPEND_ERROR:t.errorAction=this.getLevelSwitchAction(t,(i=t.level)!=null?i:s.loadLevel);return;case Me.INTERNAL_EXCEPTION:case Me.BUFFER_APPENDING_ERROR:case Me.BUFFER_FULL_ERROR:case Me.LEVEL_SWITCH_ERROR:case Me.BUFFER_STALLED_ERROR:case Me.BUFFER_SEEK_OVER_HOLE:case Me.BUFFER_NUDGE_ON_STALL:t.errorAction={action:xi.DoNothing,flags:$s.None};return}t.type===rr.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const n=this.hls,i=ry(n.config.playlistLoadPolicy,e),s=this.playlistError++;if(Ih(i,s,Dh(e),e.response))return{action:xi.RetryRequest,flags:$s.None,retryConfig:i,retryCount:s};const c=this.getLevelSwitchAction(e,t);return i&&(c.retryConfig=i,c.retryCount=s),c}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),i=t.levels[n],{fragLoadPolicy:s,keyLoadPolicy:a}=t.config,c=ry(e.details.startsWith("key")?a:s,e),o=t.levels.reduce((u,h)=>u+h.fragmentError,0);if(i&&(e.details!==Me.FRAG_GAP&&i.fragmentError++,Ih(c,o,Dh(e),e.response)))return{action:xi.RetryRequest,flags:$s.None,retryConfig:c,retryCount:o};const l=this.getLevelSwitchAction(e,n);return c&&(l.retryConfig=c,l.retryCount=o),l}getLevelSwitchAction(e,t){const n=this.hls;t==null&&(t=n.loadLevel);const i=this.hls.levels[t];if(i){var s,a;const l=e.details;i.loadError++,l===Me.BUFFER_APPEND_ERROR&&i.fragmentError++;let u=-1;const{levels:h,loadLevel:f,minAutoLevel:g,maxAutoLevel:p}=n;n.autoLevelEnabled||(n.loadLevel=-1);const d=(s=e.frag)==null?void 0:s.type,E=(d===Jt.AUDIO&&l===Me.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(l===Me.BUFFER_ADD_CODEC_ERROR||l===Me.BUFFER_APPEND_ERROR))&&h.some(({audioCodec:x})=>i.audioCodec!==x),R=e.sourceBufferName==="video"&&(l===Me.BUFFER_ADD_CODEC_ERROR||l===Me.BUFFER_APPEND_ERROR)&&h.some(({codecSet:x,audioCodec:P})=>i.codecSet!==x&&i.audioCodec===P),{type:k,groupId:C}=(a=e.context)!=null?a:{};for(let x=h.length;x--;){const P=(x+f)%h.length;if(P!==f&&P>=g&&P<=p&&h[P].loadError===0){var c,o;const D=h[P];if(l===Me.FRAG_GAP&&e.frag){const b=h[P].details;if(b){const w=Ah(e.frag,b.fragments,e.frag.start);if(w!=null&&w.gap)continue}}else{if(k===Dr.AUDIO_TRACK&&D.hasAudioGroup(C)||k===Dr.SUBTITLE_TRACK&&D.hasSubtitleGroup(C))continue;if(d===Jt.AUDIO&&(c=i.audioGroups)!=null&&c.some(b=>D.hasAudioGroup(b))||d===Jt.SUBTITLE&&(o=i.subtitleGroups)!=null&&o.some(b=>D.hasSubtitleGroup(b))||E&&i.audioCodec===D.audioCodec||!E&&i.audioCodec!==D.audioCodec||R&&i.codecSet===D.codecSet)continue}u=P;break}}if(u>-1&&n.loadLevel!==u)return e.levelRetry=!0,this.playlistError=0,{action:xi.SendAlternateToPenaltyBox,flags:$s.None,nextAutoLevel:u}}return{action:xi.SendAlternateToPenaltyBox,flags:$s.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case xi.DoNothing:break;case xi.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==Me.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:i,hdcpLevel:s,nextAutoLevel:a}=n;switch(i){case $s.None:this.switchLevel(e,a);break;case $s.MoveAllAlternatesMatchingHDCP:s&&(t.maxHdcpLevel=vm[vm.indexOf(s)-1],n.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}n.resolved||this.switchLevel(e,a)}switchLevel(e,t){t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}}class Ng{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=Ee.log.bind(Ee,`${t}:`),this.warn=Ee.warn.bind(Ee,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const i=t==null?void 0:t.renditionReports;if(i){let s=-1;for(let a=0;a<i.length;a++){const c=i[a];let o;try{o=new self.URL(c.URI,t.url).href}catch(l){Ee.warn(`Could not construct new URL for Rendition Report: ${l}`),o=c.URI||""}if(o===e){s=a;break}else o===e.substring(0,o.length)&&(s=a)}if(s!==-1){const a=i[s],c=parseInt(a["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let o=parseInt(a["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const u=Math.min(t.age-t.partTarget,t.targetduration);o>=0&&u>t.partTarget&&(o+=1)}const l=n&&Jv(n);return new Zv(c,o>=0?o:void 0,l)}}}loadPlaylist(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,n){const{details:i,stats:s}=t,a=self.performance.now(),c=s.loading.first?Math.max(0,a-s.loading.first):0;if(i.advancedDateTime=Date.now()-c,i.live||n!=null&&n.live){if(i.reloaded(n),n&&this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),n&&i.fragments.length>0&&eP(n,i),!this.canLoad||!i.live)return;let o,l,u;if(i.canBlockReload&&i.endSN&&i.advanced){const m=this.hls.config.lowLatencyMode,E=i.lastPartSn,S=i.endSN,R=i.lastPartIndex,k=R!==-1,C=E===S,x=m?0:R;k?(l=C?S+1:E,u=C?x:R+1):l=S+1;const P=i.age,D=P+i.ageHeader;let b=Math.min(D-i.partTarget,i.targetduration*1.5);if(b>0){if(n&&b>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${b} with playlist age: ${i.age}`),b=0;else{const w=Math.floor(b/i.targetduration);if(l+=w,u!==void 0){const v=Math.round(b%i.targetduration/i.partTarget);u+=v}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${P.toFixed(2)}s goal: ${b} skip sn ${w} to part ${u}`)}i.tuneInGoal=b}if(o=this.getDeliveryDirectives(i,t.deliveryDirectives,l,u),m||!C){this.loadPlaylist(o);return}}else(i.canBlockReload||i.canSkipUntil)&&(o=this.getDeliveryDirectives(i,t.deliveryDirectives,l,u));const h=this.hls.mainForwardBufferInfo,f=h?h.end-h.len:0,g=(i.edge-f)*1e3,p=iP(i,g);i.updated&&a>this.requestScheduled+p&&(this.requestScheduled=s.loading.start),l!==void 0&&i.canBlockReload?this.requestScheduled=s.loading.first+p-(i.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+p<a?this.requestScheduled=a:this.requestScheduled-a<=0&&(this.requestScheduled+=p);let d=this.requestScheduled-a;d=Math.max(0,d),this.log(`reload live playlist ${e} in ${Math.round(d)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(o),d)}else this.clearTimer()}getDeliveryDirectives(e,t,n,i){let s=Jv(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,i=t.part,s=Hd.No),new Zv(n,i,s)}checkRetry(e){const t=e.details,n=Dh(e),i=e.errorAction,{action:s,retryCount:a=0,retryConfig:c}=i||{},o=!!i&&!!c&&(s===xi.RetryRequest||!i.resolved&&s===xi.SendAlternateToPenaltyBox);if(o){var l;if(this.requestScheduled=-1,a>=c.maxNumRetry)return!1;if(n&&(l=e.context)!=null&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${c.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const u=Mg(c,a);this.timer=self.setTimeout(()=>this.loadPlaylist(),u),this.warn(`Retrying playlist loading ${a+1}/${c.maxNumRetry} after "${t}" in ${u}ms`)}e.levelRetry=!0,i.resolved=!0}return o}}class Lc{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class dP{constructor(e,t,n,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Lc(e),this.fast_=new Lc(t),this.defaultTTFB_=i,this.ttfb_=new Lc(e)}update(e,t){const{slow_:n,fast_:i,ttfb_:s}=this;n.halfLife!==e&&(this.slow_=new Lc(e,n.getEstimate(),n.getTotalWeight())),i.halfLife!==t&&(this.fast_=new Lc(t,i.getEstimate(),i.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new Lc(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,i=e/1e3,s=n/i;this.fast_.sample(i,s),this.slow_.sample(i,s)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}const kS={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},iy={};function hP(r,e,t,n,i,s){const a=r.audioCodec?r.audioGroups:null,c=s==null?void 0:s.audioCodec,o=s==null?void 0:s.channels,l=o?parseInt(o):c?1/0:2;let u=null;if(a!=null&&a.length)try{a.length===1&&a[0]?u=e.groups[a[0]].channels:u=a.reduce((h,f)=>{if(f){const g=e.groups[f];if(!g)throw new Error(`Audio track group ${f} not found`);Object.keys(g.channels).forEach(p=>{h[p]=(h[p]||0)+g.channels[p]})}return h},{2:0})}catch{return!0}return r.videoCodec!==void 0&&(r.width>1920&&r.height>1088||r.height>1920&&r.width>1088||r.frameRate>Math.max(n,30)||r.videoRange!=="SDR"&&r.videoRange!==t||r.bitrate>Math.max(i,8e6))||!!u&&Pt(l)&&Object.keys(u).some(h=>parseInt(h)>l)}function pP(r,e,t){const n=r.videoCodec,i=r.audioCodec;if(!n||!i||!t)return Promise.resolve(kS);const s={width:r.width,height:r.height,bitrate:Math.ceil(Math.max(r.bitrate*.9,r.averageBitrate)),framerate:r.frameRate||30},a=r.videoRange;a!=="SDR"&&(s.transferFunction=a.toLowerCase());const c=n.split(",").map(o=>({type:"media-source",video:gi(gi({},s),{},{contentType:Cu(o,"video")})}));return i&&r.audioGroups&&r.audioGroups.forEach(o=>{var l;o&&((l=e.groups[o])==null||l.tracks.forEach(u=>{if(u.groupId===o){const h=u.channels||"",f=parseFloat(h);Pt(f)&&f>2&&c.push.apply(c,i.split(",").map(g=>({type:"media-source",audio:{contentType:Cu(g,"audio"),channels:""+f}})))}}))}),Promise.all(c.map(o=>{const l=fP(o);return iy[l]||(iy[l]=t.decodingInfo(o))})).then(o=>({supported:!o.some(l=>!l.supported),configurations:c,decodingInfoResults:o})).catch(o=>({supported:!1,configurations:c,decodingInfoResults:[],error:o}))}function fP(r){const{audio:e,video:t}=r,n=t||e;if(n){const i=n.contentType.split('"')[1];if(t)return`r${t.height}x${t.width}f${Math.ceil(t.framerate)}${t.transferFunction||"sd"}_${i}_${Math.ceil(t.bitrate/1e5)}`;if(e)return`c${e.channels}${e.spatialRendering?"s":"n"}_${i}`}return""}function mP(){if(typeof matchMedia=="function"){const r=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(r.media!==e.media)return r.matches===!0}return!1}function gP(r,e){let t=!1,n=[];return r&&(t=r!=="SDR",n=[r]),e&&(n=e.allowedVideoRanges||Lh.slice(0),t=e.preferHDR!==void 0?e.preferHDR:mP(),t?n=n.filter(i=>i!=="SDR"):n=["SDR"]),{preferHDR:t,allowedVideoRanges:n}}function vP(r,e,t,n,i){const s=Object.keys(r),a=n==null?void 0:n.channels,c=n==null?void 0:n.audioCodec,o=a&&parseInt(a)===2;let l=!0,u=!1,h=1/0,f=1/0,g=1/0,p=0,d=[];const{preferHDR:m,allowedVideoRanges:E}=gP(e,i);for(let C=s.length;C--;){const x=r[s[C]];l=x.channels[2]>0,h=Math.min(h,x.minHeight),f=Math.min(f,x.minFramerate),g=Math.min(g,x.minBitrate);const P=E.filter(D=>x.videoRanges[D]>0);P.length>0&&(u=!0,d=P)}h=Pt(h)?h:0,f=Pt(f)?f:0;const S=Math.max(1080,h),R=Math.max(30,f);return g=Pt(g)?g:t,t=Math.max(g,t),u||(e=void 0,d=[]),{codecSet:s.reduce((C,x)=>{const P=r[x];if(x===C)return C;if(P.minBitrate>t)return Ta(x,`min bitrate of ${P.minBitrate} > current estimate of ${t}`),C;if(!P.hasDefaultAudio)return Ta(x,"no renditions with default or auto-select sound found"),C;if(c&&x.indexOf(c.substring(0,4))%5!==0)return Ta(x,`audio codec preference "${c}" not found`),C;if(a&&!o){if(!P.channels[a])return Ta(x,`no renditions with ${a} channel sound found (channels options: ${Object.keys(P.channels)})`),C}else if((!c||o)&&l&&P.channels[2]===0)return Ta(x,"no renditions with stereo sound found"),C;return P.minHeight>S?(Ta(x,`min resolution of ${P.minHeight} > maximum of ${S}`),C):P.minFramerate>R?(Ta(x,`min framerate of ${P.minFramerate} > maximum of ${R}`),C):d.some(D=>P.videoRanges[D]>0)?P.maxScore<p?(Ta(x,`max score of ${P.maxScore} < selected max of ${p}`),C):C&&(Ch(x)>=Ch(C)||P.fragmentError>r[C].fragmentError)?C:(p=P.maxScore,x):(Ta(x,`no variants with VIDEO-RANGE of ${JSON.stringify(d)} found`),C)},void 0),videoRanges:d,preferHDR:m,minFramerate:f,minBitrate:g}}function Ta(r,e){Ee.log(`[abr] start candidates with "${r}" ignored because ${e}`)}function yP(r){return r.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const i=t.channels||"2";return n.channels[i]=(n.channels[i]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function _P(r,e,t,n){return r.slice(t,n+1).reduce((i,s)=>{if(!s.codecSet)return i;const a=s.audioGroups;let c=i[s.codecSet];c||(i[s.codecSet]=c={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!a,fragmentError:0}),c.minBitrate=Math.min(c.minBitrate,s.bitrate);const o=Math.min(s.height,s.width);return c.minHeight=Math.min(c.minHeight,o),c.minFramerate=Math.min(c.minFramerate,s.frameRate),c.maxScore=Math.max(c.maxScore,s.score),c.fragmentError+=s.fragmentError,c.videoRanges[s.videoRange]=(c.videoRanges[s.videoRange]||0)+1,a&&a.forEach(l=>{if(!l)return;const u=e.groups[l];u&&(c.hasDefaultAudio=c.hasDefaultAudio||e.hasDefaultAudio?u.hasDefault:u.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(u.channels).forEach(h=>{c.channels[h]=(c.channels[h]||0)+u.channels[h]}))}),i},{})}function la(r,e,t){if("attrs"in r){const n=e.indexOf(r);if(n!==-1)return n}for(let n=0;n<e.length;n++){const i=e[n];if(il(r,i,t))return n}return-1}function il(r,e,t){const{groupId:n,name:i,lang:s,assocLang:a,characteristics:c,default:o}=r,l=r.forced;return(n===void 0||e.groupId===n)&&(i===void 0||e.name===i)&&(s===void 0||e.lang===s)&&(s===void 0||e.assocLang===a)&&(o===void 0||e.default===o)&&(l===void 0||e.forced===l)&&(c===void 0||bP(c,e.characteristics))&&(t===void 0||t(r,e))}function bP(r,e=""){const t=r.split(","),n=e.split(",");return t.length===n.length&&!t.some(i=>n.indexOf(i)===-1)}function Dc(r,e){const{audioCodec:t,channels:n}=r;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(n===void 0||n===(e.channels||"2"))}function SP(r,e,t,n,i){const s=e[n],c=e.reduce((f,g,p)=>{const d=g.uri;return(f[d]||(f[d]=[])).push(p),f},{})[s.uri];c.length>1&&(n=Math.max.apply(Math,c));const o=s.videoRange,l=s.frameRate,u=s.codecSet.substring(0,4),h=sy(e,n,f=>{if(f.videoRange!==o||f.frameRate!==l||f.codecSet.substring(0,4)!==u)return!1;const g=f.audioGroups,p=t.filter(d=>!g||g.indexOf(d.groupId)!==-1);return la(r,p,i)>-1});return h>-1?h:sy(e,n,f=>{const g=f.audioGroups,p=t.filter(d=>!g||g.indexOf(d.groupId)!==-1);return la(r,p,i)>-1})}function sy(r,e,t){for(let n=e;n;n--)if(t(r[n]))return n;for(let n=e+1;n<r.length;n++)if(t(r[n]))return n;return-1}class wP{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{const{fragCurrent:t,partCurrent:n,hls:i}=this,{autoLevelEnabled:s,media:a}=i;if(!t||!a)return;const c=performance.now(),o=n?n.stats:t.stats,l=n?n.duration:t.duration,u=c-o.loading.start,h=i.minAutoLevel;if(o.aborted||o.loaded&&o.loaded===o.total||t.level<=h){this.clearTimer(),this._nextAutoLevel=-1;return}if(!s||a.paused||!a.playbackRate||!a.readyState)return;const f=i.mainForwardBufferInfo;if(f===null)return;const g=this.bwEstimator.getEstimateTTFB(),p=Math.abs(a.playbackRate);if(u<=Math.max(g,1e3*(l/(p*2))))return;const d=f.len/p,m=o.loading.first?o.loading.first-o.loading.start:-1,E=o.loaded&&m>-1,S=this.getBwEstimate(),R=i.levels,k=R[t.level],C=o.total||Math.max(o.loaded,Math.round(l*k.averageBitrate/8));let x=E?u-m:u;x<1&&E&&(x=Math.min(u,o.loaded*8/S));const P=E?o.loaded*1e3/x:0,D=P?(C-o.loaded)/P:C*8/S+g/1e3;if(D<=d)return;const b=P?P*8:S;let w=Number.POSITIVE_INFINITY,v;for(v=t.level-1;v>h;v--){const y=R[v].maxBitrate;if(w=this.getTimeToLoadFrag(g/1e3,b,l*y,!R[v].details),w<d)break}if(w>=D||w>l*10)return;i.nextLoadLevel=i.nextAutoLevel=v,E?this.bwEstimator.sample(u-Math.min(g,m),o.loaded):this.bwEstimator.sampleTTFB(u);const _=R[v].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>_&&this.resetEstimator(_),this.clearTimer(),Ee.warn(`[abr] Fragment ${t.sn}${n?" part "+n.index:""} of level ${t.level} is loading too slowly;
      Time to underbuffer: ${d.toFixed(3)} s
      Estimated load time for current fragment: ${D.toFixed(3)} s
      Estimated load time for down switch fragment: ${w.toFixed(3)} s
      TTFB estimate: ${m|0} ms
      Current BW estimate: ${Pt(S)?S|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${v} @ ${_|0} bps`),i.trigger(H.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:n,stats:o})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(Ee.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new dP(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.FRAG_LOADING,this.onFragLoading,this),e.on(H.FRAG_LOADED,this.onFragLoaded,this),e.on(H.FRAG_BUFFERED,this.onFragBuffered,this),e.on(H.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(H.LEVEL_LOADED,this.onLevelLoaded,this),e.on(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(H.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(H.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.FRAG_LOADING,this.onFragLoading,this),e.off(H.FRAG_LOADED,this.onFragLoaded,this),e.off(H.FRAG_BUFFERED,this.onFragBuffered,this),e.off(H.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(H.LEVEL_LOADED,this.onLevelLoaded,this),e.off(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(H.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(H.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var i;this.fragCurrent=n,this.partCurrent=(i=t.part)!=null?i:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case Me.BUFFER_ADD_CODEC_ERROR:case Me.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Me.FRAG_LOAD_TIMEOUT:{const n=t.frag,{fragCurrent:i,partCurrent:s}=this;if(n&&i&&n.sn===i.sn&&n.level===i.level){const a=performance.now(),c=s?s.stats:n.stats,o=a-c.loading.start,l=c.loading.first?c.loading.first-c.loading.start:-1;if(c.loaded&&l>-1){const h=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(o-Math.min(h,l),c.loaded)}else this.bwEstimator.sampleTTFB(o)}break}}}getTimeToLoadFrag(e,t,n,i){const s=e+n/t,a=i?this.lastLevelLoadSec:0;return s+a}onLevelLoaded(e,t){const n=this.hls.config,{loading:i}=t.stats,s=i.end-i.start;Pt(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD)}onFragLoaded(e,{frag:t,part:n}){const i=n?n.stats:t.stats;if(t.type===Jt.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=n?n.duration:t.duration,a=this.hls.levels[t.level],c=(a.loaded?a.loaded.bytes:0)+i.loaded,o=(a.loaded?a.loaded.duration:0)+s;a.loaded={bytes:c,duration:o},a.realBitrate=Math.round(8*c/o)}if(t.bitrateTest){const s={stats:i,frag:t,part:n,id:t.type};this.onFragBuffered(H.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:i}=t,s=i!=null&&i.stats.loaded?i.stats:n.stats;if(s.aborted||this.ignoreFragment(n))return;const a=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,s.loaded),s.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Jt.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,s=this.findBestLevel(n,t,e,0,i,1,1);if(s>-1)return s;const a=this.hls.firstLevel,c=Math.min(Math.max(a,t),e);return Ee.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${c}`),c}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,n=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(e!==-1&&(!n||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=n&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,s)&&a[e].loadError<=a[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this,{maxAutoLevel:i,config:s,minAutoLevel:a}=n,c=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay();let u=s.abrBandWidthFactor,h=s.abrBandWidthUpFactor;if(l){const m=this.findBestLevel(o,a,i,l,0,u,h);if(m>=0)return m}let f=c?Math.min(c,s.maxStarvationDelay):s.maxStarvationDelay;if(!l){const m=this.bitrateTestDelay;m&&(f=(c?Math.min(c,s.maxLoadingDelay):s.maxLoadingDelay)-m,Ee.info(`[abr] bitrate test took ${Math.round(1e3*m)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),u=h=1)}const g=this.findBestLevel(o,a,i,l,f,u,h);if(Ee.info(`[abr] ${l?"rebuffering expected":"buffer is empty"}, optimal quality level ${g}`),g>-1)return g;const p=n.levels[a],d=n.levels[n.loadLevel];return(p==null?void 0:p.bitrate)<(d==null?void 0:d.bitrate)?a:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,i,s,a,c){var o;const l=i+s,u=this.lastLoadedFragLevel,h=u===-1?this.hls.firstLevel:u,{fragCurrent:f,partCurrent:g}=this,{levels:p,allAudioTracks:d,loadLevel:m,config:E}=this.hls;if(p.length===1)return 0;const S=p[h],R=!!(S!=null&&(o=S.details)!=null&&o.live),k=m===-1||u===-1;let C,x="SDR",P=(S==null?void 0:S.frameRate)||0;const{audioPreference:D,videoPreference:b}=E,w=this.audioTracksByGroup||(this.audioTracksByGroup=yP(d));if(k){if(this.firstSelection!==-1)return this.firstSelection;const L=this.codecTiers||(this.codecTiers=_P(p,w,t,n)),I=vP(L,x,e,D,b),{codecSet:N,videoRanges:M,minFramerate:U,minBitrate:j,preferHDR:Q}=I;C=N,x=Q?M[M.length-1]:M[0],P=U,e=Math.max(e,j),Ee.log(`[abr] picked start tier ${JSON.stringify(I)}`)}else C=S==null?void 0:S.codecSet,x=S==null?void 0:S.videoRange;const v=g?g.duration:f?f.duration:0,_=this.bwEstimator.getEstimateTTFB()/1e3,y=[];for(let L=n;L>=t;L--){var T;const I=p[L],N=L>h;if(!I)continue;if(E.useMediaCapabilities&&!I.supportedResult&&!I.supportedPromise){const re=navigator.mediaCapabilities;typeof(re==null?void 0:re.decodingInfo)=="function"&&hP(I,w,x,P,e,D)?(I.supportedPromise=pP(I,w,re),I.supportedPromise.then(pe=>{if(!this.hls)return;I.supportedResult=pe;const fe=this.hls.levels,ue=fe.indexOf(I);pe.error?Ee.warn(`[abr] MediaCapabilities decodingInfo error: "${pe.error}" for level ${ue} ${JSON.stringify(pe)}`):pe.supported||(Ee.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${ue} ${JSON.stringify(pe)}`),ue>-1&&fe.length>1&&(Ee.log(`[abr] Removing unsupported level ${ue}`),this.hls.removeLevel(ue)))})):I.supportedResult=kS}if(C&&I.codecSet!==C||x&&I.videoRange!==x||N&&P>I.frameRate||!N&&P>0&&P<I.frameRate||I.supportedResult&&!((T=I.supportedResult.decodingInfoResults)!=null&&T[0].smooth)){y.push(L);continue}const M=I.details,U=(g?M==null?void 0:M.partTarget:M==null?void 0:M.averagetargetduration)||v;let j;N?j=c*e:j=a*e;const Q=v&&i>=v*2&&s===0?p[L].averageBitrate:p[L].maxBitrate,Y=this.getTimeToLoadFrag(_,j,Q*U,M===void 0);if(j>=Q&&(L===u||I.loadError===0&&I.fragmentError===0)&&(Y<=_||!Pt(Y)||R&&!this.bitrateTestDelay||Y<l)){const re=this.forcedAutoLevel;return L!==m&&(re===-1||re!==m)&&(y.length&&Ee.trace(`[abr] Skipped level(s) ${y.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${p[y[0]].codecs}" ${p[y[0]].videoRange}; not compatible with "${S.codecs}" ${x}`),Ee.info(`[abr] switch candidate:${h}->${L} adjustedbw(${Math.round(j)})-bitrate=${Math.round(j-Q)} ttfb:${_.toFixed(1)} avgDuration:${U.toFixed(1)} maxFetchDuration:${l.toFixed(1)} fetchDuration:${Y.toFixed(1)} firstSelection:${k} codecSet:${C} videoRange:${x} hls.loadLevel:${m}`)),k&&(this.firstSelection=L),L}}return-1}set nextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls,i=Math.min(Math.max(e,n),t);this._nextAutoLevel!==i&&(this.nextAutoLevelKey="",this._nextAutoLevel=i)}}class EP{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var fi={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class RP{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(H.BUFFER_APPENDED,this.onBufferAppended,this),e.on(H.FRAG_BUFFERED,this.onFragBuffered,this),e.on(H.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(H.BUFFER_APPENDED,this.onBufferAppended,this),e.off(H.FRAG_BUFFERED,this.onFragBuffered,this),e.off(H.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let i=n.length;i--;){const s=n[i];if(!s)break;const a=s.end;if(s.start<=e&&a!==null&&e<=a)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:n}=this,i=Object.keys(n);for(let s=i.length;s--;){const a=n[i[s]];if((a==null?void 0:a.body.type)===t&&a.buffered){const c=a.body;if(c.start<=e&&e<=c.end)return c}}return null}detectEvictedFragments(e,t,n,i){this.timeRanges&&(this.timeRanges[e]=t);const s=(i==null?void 0:i.fragment.sn)||-1;Object.keys(this.fragments).forEach(a=>{const c=this.fragments[a];if(!c||s>=c.body.sn)return;if(!c.buffered&&!c.loaded){c.body.type===n&&this.removeFragment(c.body);return}const o=c.range[e];o&&o.time.some(l=>{const u=!this.isTimeBuffered(l.startPTS,l.endPTS,t);return u&&this.removeFragment(c.body),u})})}detectPartialFragments(e){const t=this.timeRanges,{frag:n,part:i}=e;if(!t||n.sn==="initSegment")return;const s=Ic(n),a=this.fragments[s];if(!a||a.buffered&&n.gap)return;const c=!n.relurl;Object.keys(t).forEach(o=>{const l=n.elementaryStreams[o];if(!l)return;const u=t[o],h=c||l.partial===!0;a.range[o]=this.getBufferedTimes(n,i,h,u)}),a.loaded=null,Object.keys(a.range).length?(a.buffered=!0,(a.body.endList=n.endList||a.body.endList)&&(this.endListFragments[a.body.type]=a),Sd(a)||this.removeParts(n.sn-1,n.type)):this.removeFragment(a.body)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=n.filter(i=>i.fragment.sn>=e))}fragBuffered(e,t){const n=Ic(e);let i=this.fragments[n];!i&&t&&(i=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,n,i){const s={time:[],partial:n},a=e.start,c=e.end,o=e.minEndPTS||c,l=e.maxStartPTS||a;for(let u=0;u<i.length;u++){const h=i.start(u)-this.bufferPadding,f=i.end(u)+this.bufferPadding;if(l>=h&&o<=f){s.time.push({startPTS:Math.max(a,i.start(u)),endPTS:Math.min(c,i.end(u))});break}else if(a<f&&c>h){const g=Math.max(a,i.start(u)),p=Math.min(c,i.end(u));p>g&&(s.partial=!0,s.time.push({startPTS:g,endPTS:p}))}else if(c<=h)break}return s}getPartialFragment(e){let t=null,n,i,s,a=0;const{bufferPadding:c,fragments:o}=this;return Object.keys(o).forEach(l=>{const u=o[l];u&&Sd(u)&&(i=u.body.start-c,s=u.body.end+c,e>=i&&e<=s&&(n=Math.min(e-i,s-e),a<=n&&(t=u.body,a=n)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Sd(t))}getState(e){const t=Ic(e),n=this.fragments[t];return n?n.buffered?Sd(n)?fi.PARTIAL:fi.OK:fi.APPENDING:fi.NOT_LOADED}isTimeBuffered(e,t,n){let i,s;for(let a=0;a<n.length;a++){if(i=n.start(a)-this.bufferPadding,s=n.end(a)+this.bufferPadding,e>=i&&t<=s)return!0;if(t<=i)return!1}return!1}onFragLoaded(e,t){const{frag:n,part:i}=t;if(n.sn==="initSegment"||n.bitrateTest)return;const s=i?null:t,a=Ic(n);this.fragments[a]={body:n,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:i,timeRanges:s}=t;if(n.sn==="initSegment")return;const a=n.type;if(i){let c=this.activePartLists[a];c||(this.activePartLists[a]=c=[]),c.push(i)}this.timeRanges=s,Object.keys(s).forEach(c=>{const o=s[c];this.detectEvictedFragments(c,o,a,i)})}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Ic(e);return!!this.fragments[t]}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,n,i,s){i&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const c=this.fragments[a];if(!c)return;const o=c.body;o.type!==n||i&&!o.gap||o.start<t&&o.end>e&&(c.buffered||s)&&this.removeFragment(o)})}removeFragment(e){const t=Ic(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const i=e.sn;this.activePartLists[e.type]=n.filter(s=>s.fragment.sn!==i)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function Sd(r){var e,t,n;return r.buffered&&(r.body.gap||((e=r.range.video)==null?void 0:e.partial)||((t=r.range.audio)==null?void 0:t.partial)||((n=r.range.audiovideo)==null?void 0:n.partial))}function Ic(r){return`${r.type}_${r.level}_${r.sn}`}const TP={length:0,start:()=>0,end:()=>0};class nn{static isBuffered(e,t){try{if(e){const n=nn.getBuffered(e);for(let i=0;i<n.length;i++)if(t>=n.start(i)&&t<=n.end(i))return!0}}catch{}return!1}static bufferInfo(e,t,n){try{if(e){const i=nn.getBuffered(e),s=[];let a;for(a=0;a<i.length;a++)s.push({start:i.start(a),end:i.end(a)});return this.bufferedInfo(s,t,n)}}catch{}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.sort(function(l,u){const h=l.start-u.start;return h||u.end-l.end});let i=[];if(n)for(let l=0;l<e.length;l++){const u=i.length;if(u){const h=i[u-1].end;e[l].start-h<n?e[l].end>h&&(i[u-1].end=e[l].end):i.push(e[l])}else i.push(e[l])}else i=e;let s=0,a,c=t,o=t;for(let l=0;l<i.length;l++){const u=i[l].start,h=i[l].end;if(t+n>=u&&t<h)c=u,o=h,s=o-t;else if(t+n<u){a=u;break}}return{len:s,start:c||0,end:o||0,nextStart:a}}static getBuffered(e){try{return e.buffered}catch(t){return Ee.log("failed to get media.buffered",t),TP}}}class Fg{constructor(e,t,n,i=0,s=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=wd(),this.buffering={audio:wd(),video:wd(),audiovideo:wd()},this.level=e,this.sn=t,this.id=n,this.size=i,this.part=s,this.partial=a}}function wd(){return{start:0,executeStart:0,executeEnd:0,end:0}}function Wd(r,e){for(let n=0,i=r.length;n<i;n++){var t;if(((t=r[n])==null?void 0:t.cc)===e)return r[n]}return null}function xP(r,e,t){return!!(e&&(t.endCC>t.startCC||r&&r.cc<t.startCC))}function kP(r,e){const t=r.fragments,n=e.fragments;if(!n.length||!t.length){Ee.log("No fragments to align");return}const i=Wd(t,n[0].cc);if(!i||i&&!i.startPTS){Ee.log("No frag in previous level to align on");return}return i}function ay(r,e){if(r){const t=r.start+e;r.start=r.startPTS=t,r.endPTS=t+r.duration}}function CS(r,e){const t=e.fragments;for(let n=0,i=t.length;n<i;n++)ay(t[n],r);e.fragmentHint&&ay(e.fragmentHint,r),e.alignedSliding=!0}function CP(r,e,t){e&&(PP(r,t,e),!t.alignedSliding&&e&&Oh(t,e),!t.alignedSliding&&e&&!t.skippedSegments&&ES(e,t))}function PP(r,e,t){if(xP(r,t,e)){const n=kP(t,e);n&&Pt(n.start)&&(Ee.log(`Adjusting PTS using last level due to CC increase within current level ${e.url}`),CS(n.start,e))}}function Oh(r,e){if(!r.hasProgramDateTime||!e.hasProgramDateTime)return;const t=r.fragments,n=e.fragments;if(!t.length||!n.length)return;let i,s;const a=Math.min(e.endCC,r.endCC);e.startCC<a&&r.startCC<a&&(i=Wd(n,a),s=Wd(t,a)),(!i||!s)&&(i=n[Math.floor(n.length/2)],s=Wd(t,i.cc)||t[Math.floor(t.length/2)]);const c=i.programDateTime,o=s.programDateTime;if(!c||!o)return;const l=(o-c)/1e3-(s.start-i.start);CS(l,r)}const oy=Math.pow(2,17);class LP{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new Ca({type:rr.NETWORK_ERROR,details:Me.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const i=this.config,s=i.fLoader,a=i.loader;return new Promise((c,o)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(g=>g[0]==="GAP")){o(ly(e));return}else e.gap=!1;const l=this.loader=e.loader=s?new s(i):new a(i),u=cy(e),h=ny(i.fragLoadPolicy.default),f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:oy};e.stats=l.stats,l.load(u,f,{onSuccess:(g,p,d,m)=>{this.resetLoader(e,l);let E=g.data;d.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(E.slice(0,16)),E=E.slice(16)),c({frag:e,part:null,payload:E,networkDetails:m})},onError:(g,p,d,m)=>{this.resetLoader(e,l),o(new Ca({type:rr.NETWORK_ERROR,details:Me.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:gi({url:n,data:void 0},g),error:new Error(`HTTP Error ${g.code} ${g.text}`),networkDetails:d,stats:m}))},onAbort:(g,p,d)=>{this.resetLoader(e,l),o(new Ca({type:rr.NETWORK_ERROR,details:Me.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:d,stats:g}))},onTimeout:(g,p,d)=>{this.resetLoader(e,l),o(new Ca({type:rr.NETWORK_ERROR,details:Me.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:d,stats:g}))},onProgress:(g,p,d,m)=>{t&&t({frag:e,part:null,payload:d,networkDetails:m})}})})}loadPart(e,t,n){this.abort();const i=this.config,s=i.fLoader,a=i.loader;return new Promise((c,o)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){o(ly(e,t));return}const l=this.loader=e.loader=s?new s(i):new a(i),u=cy(e,t),h=ny(i.fragLoadPolicy.default),f={loadPolicy:h,timeout:h.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:oy};t.stats=l.stats,l.load(u,f,{onSuccess:(g,p,d,m)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const E={frag:e,part:t,payload:g.data,networkDetails:m};n(E),c(E)},onError:(g,p,d,m)=>{this.resetLoader(e,l),o(new Ca({type:rr.NETWORK_ERROR,details:Me.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:gi({url:u.url,data:void 0},g),error:new Error(`HTTP Error ${g.code} ${g.text}`),networkDetails:d,stats:m}))},onAbort:(g,p,d)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),o(new Ca({type:rr.NETWORK_ERROR,details:Me.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:d,stats:g}))},onTimeout:(g,p,d)=>{this.resetLoader(e,l),o(new Ca({type:rr.NETWORK_ERROR,details:Me.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:d,stats:g}))}})})}updateStatsFromPart(e,t){const n=e.stats,i=t.stats,s=i.total;if(n.loaded+=i.loaded,s){const o=Math.round(e.duration/t.duration),l=Math.min(Math.round(n.loaded/s),o),h=(o-l)*Math.round(n.loaded/l);n.total=n.loaded+h}else n.total=Math.max(n.loaded,n.total);const a=n.loading,c=i.loading;a.start?a.first+=c.first-c.start:(a.start=c.start,a.first=c.first),a.end=c.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function cy(r,e=null){const t=e||r,n={frag:r,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if(Pt(i)&&Pt(s)){var a;let c=i,o=s;if(r.sn==="initSegment"&&((a=r.decryptdata)==null?void 0:a.method)==="AES-128"){const l=s-i;l%16&&(o=s+(16-l%16)),i!==0&&(n.resetIV=!0,c=i-16)}n.rangeStart=c,n.rangeEnd=o}return n}function ly(r,e){const t=new Error(`GAP ${r.gap?"tag":"attribute"} found`),n={type:rr.MEDIA_ERROR,details:Me.FRAG_GAP,fatal:!1,frag:r,error:t,networkDetails:null};return e&&(n.part=e),(e||r).stats.aborted=!0,new Ca(n)}class Ca extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class DP{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class IP{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function AP(r){const e=r.byteLength,t=e&&new DataView(r.buffer).getUint8(e-1);return t?ec(r,0,e-t):r}class OP{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let i=0;i<4;i++)n[i]=t.getUint32(i*4);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,i=n[0],s=n[1],a=n[2],c=n[3],o=this.invSubMix,l=o[0],u=o[1],h=o[2],f=o[3],g=new Uint32Array(256);let p=0,d=0,m=0;for(m=0;m<256;m++)m<128?g[m]=m<<1:g[m]=m<<1^283;for(m=0;m<256;m++){let E=d^d<<1^d<<2^d<<3^d<<4;E=E>>>8^E&255^99,e[p]=E,t[E]=p;const S=g[p],R=g[S],k=g[R];let C=g[E]*257^E*16843008;i[p]=C<<24|C>>>8,s[p]=C<<16|C>>>16,a[p]=C<<8|C>>>24,c[p]=C,C=k*16843009^R*65537^S*257^p*16843008,l[E]=C<<24|C>>>8,u[E]=C<<16|C>>>16,h[E]=C<<8|C>>>24,f[E]=C,p?(p=S^g[g[g[k^S]]],d^=g[g[d]]):p=d=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,i=0;for(;i<t.length&&n;)n=t[i]===this.key[i],i++;if(n)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const a=this.ksRows=(s+6+1)*4;let c,o;const l=this.keySchedule=new Uint32Array(a),u=this.invKeySchedule=new Uint32Array(a),h=this.sBox,f=this.rcon,g=this.invSubMix,p=g[0],d=g[1],m=g[2],E=g[3];let S,R;for(c=0;c<a;c++){if(c<s){S=l[c]=t[c];continue}R=S,c%s===0?(R=R<<8|R>>>24,R=h[R>>>24]<<24|h[R>>>16&255]<<16|h[R>>>8&255]<<8|h[R&255],R^=f[c/s|0]<<24):s>6&&c%s===4&&(R=h[R>>>24]<<24|h[R>>>16&255]<<16|h[R>>>8&255]<<8|h[R&255]),l[c]=S=(l[c-s]^R)>>>0}for(o=0;o<a;o++)c=a-o,o&3?R=l[c]:R=l[c-4],o<4||c<=4?u[o]=R:u[o]=p[h[R>>>24]]^d[h[R>>>16&255]]^m[h[R>>>8&255]]^E[h[R&255]],u[o]=u[o]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){const i=this.keySize+6,s=this.invKeySchedule,a=this.invSBox,c=this.invSubMix,o=c[0],l=c[1],u=c[2],h=c[3],f=this.uint8ArrayToUint32Array_(n);let g=f[0],p=f[1],d=f[2],m=f[3];const E=new Int32Array(e),S=new Int32Array(E.length);let R,k,C,x,P,D,b,w,v,_,y,T,L,I;const N=this.networkToHostOrderSwap;for(;t<E.length;){for(v=N(E[t]),_=N(E[t+1]),y=N(E[t+2]),T=N(E[t+3]),P=v^s[0],D=T^s[1],b=y^s[2],w=_^s[3],L=4,I=1;I<i;I++)R=o[P>>>24]^l[D>>16&255]^u[b>>8&255]^h[w&255]^s[L],k=o[D>>>24]^l[b>>16&255]^u[w>>8&255]^h[P&255]^s[L+1],C=o[b>>>24]^l[w>>16&255]^u[P>>8&255]^h[D&255]^s[L+2],x=o[w>>>24]^l[P>>16&255]^u[D>>8&255]^h[b&255]^s[L+3],P=R,D=k,b=C,w=x,L=L+4;R=a[P>>>24]<<24^a[D>>16&255]<<16^a[b>>8&255]<<8^a[w&255]^s[L],k=a[D>>>24]<<24^a[b>>16&255]<<16^a[w>>8&255]<<8^a[P&255]^s[L+1],C=a[b>>>24]<<24^a[w>>16&255]<<16^a[P>>8&255]<<8^a[D&255]^s[L+2],x=a[w>>>24]<<24^a[P>>16&255]<<16^a[D>>8&255]<<8^a[b&255]^s[L+3],S[t]=N(R^g),S[t+1]=N(x^p),S[t+2]=N(C^d),S[t+3]=N(k^m),g=v,p=_,d=y,m=T,t=t+4}return S.buffer}}const MP=16;class jg{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?AP(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n){return this.useSoftware?new Promise((i,s)=>{this.softwareDecrypt(new Uint8Array(e),t,n);const a=this.flush();a?i(a.buffer):s(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n)}softwareDecrypt(e,t,n){const{currentIV:i,currentResult:s,remainderData:a}=this;this.logOnce("JS AES decrypt"),a&&(e=Is(a,e),this.remainderData=null);const c=this.getValidChunk(e);if(!c.length)return null;i&&(n=i);let o=this.softwareDecrypter;o||(o=this.softwareDecrypter=new OP),o.expandKey(t);const l=s;return this.currentResult=o.decrypt(c.buffer,0,n),this.currentIV=ec(c,-16).buffer,l||null}webCryptoDecrypt(e,t,n){const i=this.subtle;return(this.key!==t||!this.fastAesKey)&&(this.key=t,this.fastAesKey=new IP(i,t)),this.fastAesKey.expandKey().then(s=>i?(this.logOnce("WebCrypto AES decrypt"),new DP(i,new Uint8Array(n)).decrypt(e.buffer,s)):Promise.reject(new Error("web crypto not initialized"))).catch(s=>(Ee.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${s.name}: ${s.message}`),this.onWebCryptoError(e,t,n)))}onWebCryptoError(e,t,n){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n);const i=this.flush();if(i)return i.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%MP;return n!==e.length&&(t=ec(e,0,n),this.remainderData=ec(e,n)),t}logOnce(e){this.logEnabled&&(Ee.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const NP={toString:function(r){let e="";const t=r.length;for(let n=0;n<t;n++)e+=`[${r.start(n).toFixed(3)}-${r.end(n).toFixed(3)}]`;return e}},ze={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Bg extends EP{constructor(e,t,n,i,s){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ze.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=s,this.logPrefix=i,this.log=Ee.log.bind(Ee,`${i}:`),this.warn=Ee.warn.bind(Ee,`${i}:`),this.hls=e,this.fragmentLoader=new LP(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new jg(e.config),e.on(H.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ze.STOPPED}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const n=t.partList;if(n!=null&&n.length){const s=n[n.length-1];return nn.isBuffered(this.media,s.start+s.duration/2)}const i=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(i)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),n.addEventListener("seeking",this.onvseeking),n.addEventListener("ended",this.onvended);const i=this.config;this.levels&&i.autoStartLoad&&this.state===ze.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(){const e=this.media;e!=null&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:n,mediaBuffer:i,state:s}=this,a=n?n.currentTime:0,c=nn.bufferInfo(i||n,a,e.maxBufferHole);if(this.log(`media seeking to ${Pt(a)?a.toFixed(3):a}, state: ${s}`),this.state===ze.ENDED)this.resetLoadingState();else if(t){const o=e.maxFragLookUpTolerance,l=t.start-o,u=t.start+t.duration+o;if(!c.len||u<c.start||l>c.end){const h=a>u;(a<l||h)&&(h&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}n&&(this.fragmentTracker.removeFragmentsInRange(a,1/0,this.playlistType,!0),this.lastCurrentTime=a),!this.loadedmetadata&&!c.len&&(this.nextLoadPosition=this.startPosition=a),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(H.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=ze.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const i=s=>{if(this.fragContextChanged(e)){this.warn(`Fragment ${e.sn}${s.part?" p: "+s.part.index:""} of level ${e.level} was dropped during download.`),this.fragmentTracker.removeFragment(e);return}e.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,n,i).then(s=>{if(!s)return;const a=this.state;if(this.fragContextChanged(e)){(a===ze.FRAG_LOADING||!this.fragCurrent&&a===ze.PARSING)&&(this.fragmentTracker.removeFragment(e),this.state=ze.IDLE);return}"payload"in s&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(H.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===ze.STOPPED||this.state===ze.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===fi.APPENDING){const s=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,s),c=Math.max(e.duration,a?a.len:this.config.maxBufferLength);this.reduceMaxBufferLength(c)&&n.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===fi.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:n};this.hls.trigger(H.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{if(!n||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:i}=this,{payload:s}=n,a=e.decryptdata;if(s&&s.byteLength>0&&a!=null&&a.key&&a.iv&&a.method==="AES-128"){const c=self.performance.now();return this.decrypter.decrypt(new Uint8Array(s),a.key.buffer,a.iv.buffer).catch(o=>{throw i.trigger(H.ERROR,{type:rr.MEDIA_ERROR,details:Me.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:e}),o}).then(o=>{const l=self.performance.now();return i.trigger(H.FRAG_DECRYPTED,{frag:e,payload:o,stats:{tstart:c,tdecrypt:l}}),n.payload=o,this.completeInitSegmentLoad(n)})}return this.completeInitSegmentLoad(n)}).catch(n=>{this.state===ze.STOPPED||this.state===ze.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state=ze.IDLE,e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){var n,i,s,a;const c=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===Jt.MAIN?"level":"track"} ${e.level} (frag:[${((n=e.startPTS)!=null?n:NaN).toFixed(3)}-${((i=e.endPTS)!=null?i:NaN).toFixed(3)}] > buffer:${c?NP.toString(nn.getBuffered(c)):"(detached)"})`),e.sn!=="initSegment"){var o;if(e.type!==Jt.SUBTITLE){const u=e.elementaryStreams;if(!Object.keys(u).some(h=>!!u[h])){this.state=ze.IDLE;return}}const l=(o=this.levels)==null?void 0:o[e.level];l!=null&&l.fragmentError&&(this.log(`Resetting level fragment error count of ${l.fragmentError} on frag buffered`),l.fragmentError=0)}this.state=ze.IDLE,c&&(!this.loadedmetadata&&e.type==Jt.MAIN&&c.buffered.length&&((s=this.fragCurrent)==null?void 0:s.sn)===((a=this.fragPrevious)==null?void 0:a.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:i,partsLoaded:s}=e,a=!s||s.length===0||s.some(o=>!o),c=new Fg(n.level,n.sn,n.stats.chunkCount+1,0,i?i.index:-1,!a);t.flush(c)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,i){var s;const a=t==null?void 0:t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let c=null;if(e.encrypted&&!((s=e.decryptdata)!=null&&s.key)?(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${e.level}`),this.state=ze.KEY_LOADING,this.fragCurrent=e,c=this.keyLoader.load(e).then(u=>{if(!this.fragContextChanged(u.frag))return this.hls.trigger(H.KEY_LOADED,u),this.state===ze.KEY_LOADING&&(this.state=ze.IDLE),u}),this.hls.trigger(H.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(c=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&a.encryptedFragments.length&&this.keyLoader.loadClear(e,a.encryptedFragments),n=Math.max(e.start,n||0),this.config.lowLatencyMode&&e.sn!=="initSegment"){const u=a.partList;if(u&&i){n>e.end&&a.fragmentHint&&(e=a.fragmentHint);const h=this.getNextPart(u,e,n);if(h>-1){const f=u[h];this.log(`Loading part sn: ${e.sn} p: ${f.index} cc: ${e.cc} of playlist [${a.startSN}-${a.endSN}] parts [0-${h}-${u.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=f.start+f.duration,this.state=ze.FRAG_LOADING;let g;return c?g=c.then(p=>!p||this.fragContextChanged(p.frag)?null:this.doFragPartsLoad(e,f,t,i)).catch(p=>this.handleFragLoadError(p)):g=this.doFragPartsLoad(e,f,t,i).catch(p=>this.handleFragLoadError(p)),this.hls.trigger(H.FRAG_LOADING,{frag:e,part:f,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):g}else if(!e.url||this.loadedEndOfParts(u,n))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${a?"of ["+a.startSN+"-"+a.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(n.toFixed(3))}`),Pt(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ze.FRAG_LOADING;const o=this.config.progressive;let l;return o&&c?l=c.then(u=>!u||this.fragContextChanged(u==null?void 0:u.frag)?null:this.fragmentLoader.load(e,i)).catch(u=>this.handleFragLoadError(u)):l=Promise.all([this.fragmentLoader.load(e,o?i:void 0),c]).then(([u])=>(!o&&u&&i&&i(u),u)).catch(u=>this.handleFragLoadError(u)),this.hls.trigger(H.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):l}doFragPartsLoad(e,t,n,i){return new Promise((s,a)=>{var c;const o=[],l=(c=n.details)==null?void 0:c.partList,u=h=>{this.fragmentLoader.loadPart(e,h,i).then(f=>{o[h.index]=f;const g=f.part;this.hls.trigger(H.FRAG_LOADED,f);const p=ty(n,e.sn,h.index+1)||RS(l,e.sn,h.index+1);if(p)u(p);else return s({frag:e,part:g,partsLoaded:o})}).catch(a)};u(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===Me.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(H.ERROR,t)}else this.hls.trigger(H.ERROR,{type:rr.OTHER_ERROR,details:Me.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ze.PARSING){!this.fragCurrent&&this.state!==ze.STOPPED&&this.state!==ze.ERROR&&(this.state=ze.IDLE);return}const{frag:n,part:i,level:s}=t,a=self.performance.now();n.stats.parsing.end=a,i&&(i.stats.parsing.end=a),this.updateLevelTiming(n,i,s,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:i,sn:s,part:a}=e;if(!(t!=null&&t[i]))return this.warn(`Levels object was unset while buffering fragment ${s} of level ${i}. The current chunk will not be buffered.`),null;const c=t[i],o=a>-1?ty(c,s,a):null,l=o?o.fragment:sP(c,s,n);return l?(n&&n!==l&&(l.stats=n.stats),{frag:l,part:o,level:c}):null}bufferFragmentData(e,t,n,i,s){var a;if(!e||this.state!==ze.PARSING)return;const{data1:c,data2:o}=e;let l=c;if(c&&o&&(l=Is(c,o)),!((a=l)!=null&&a.length))return;const u={type:e.type,frag:t,part:n,chunkMeta:i,parent:t.type,data:l};if(this.hls.trigger(H.BUFFER_APPENDING,u),e.dropped&&e.independent&&!n){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!nn.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const n=t.currentTime,i=nn.bufferInfo(t,n,0),s=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),c=Math.max(Math.min(e.start-a,i.end-a),n+a);e.start-c>a&&this.flushMainBuffer(c,e.start)}getFwdBufferInfo(e,t){const n=this.getLoadPosition();return Pt(n)?this.getFwdBufferInfoAtPos(e,n,t):null}getFwdBufferInfoAtPos(e,t,n){const{config:{maxBufferHole:i}}=this,s=nn.bufferInfo(e,t,i);if(s.len===0&&s.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,n);if(a&&s.nextStart<a.end)return nn.bufferInfo(e,t,Math.max(s.nextStart,i))}return s}getMaxBufferLength(e){const{config:t}=this;let n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e){const t=this.config,n=e||t.maxBufferLength;return t.maxMaxBufferLength>=n?(t.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${t.maxMaxBufferLength}s`),!0):!1}getAppendedFrag(e,t=Jt.MAIN){const n=this.fragmentTracker.getAppendedFrag(e,Jt.MAIN);return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,i=n.length;if(!i)return null;const{config:s}=this,a=n[0].start;let c;if(t.live){const o=s.initialLiveManifestSize;if(i<o)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${o})`),null;(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a)&&(c=this.getInitialLiveFragment(t,n),this.startPosition=this.nextLoadPosition=c?this.hls.liveSyncPosition||c.start:e)}else e<=a&&(c=n[0]);if(!c){const o=s.lowLatencyMode?t.partEnd:t.fragmentEnd;c=this.getFragmentAtPosition(e,o,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===fi.OK||n===fi.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,i,s){const a=e.gap,c=this.getNextFragment(this.nextLoadPosition,t);if(c===null)return c;if(e=c,a&&e&&!e.gap&&n.nextStart){const o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,i);if(o!==null&&n.len+o.len>=s)return this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let i=-1,s=!1,a=!0;for(let c=0,o=e.length;c<o;c++){const l=e[c];if(a=a&&!l.independent,i>-1&&n<l.start)break;const u=l.loaded;u?i=-1:(s||l.independent||a)&&l.fragment===t&&(i=c),s=u}return i}loadedEndOfParts(e,t){const n=e[e.length-1];return n&&t>n.start&&n.loaded}getInitialLiveFragment(e,t){const n=this.fragPrevious;let i=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),i=oP(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const s=n.sn+1;if(s>=e.startSN&&s<=e.endSN){const a=t[s-e.startSN];n.cc===a.cc&&(i=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=lP(t,n.cc),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(i=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,n){const{config:i}=this;let{fragPrevious:s}=this,{fragments:a,endSN:c}=n;const{fragmentHint:o}=n,l=i.maxFragLookUpTolerance,u=n.partList,h=!!(i.lowLatencyMode&&u!=null&&u.length&&o);h&&o&&!this.bitrateTest&&(a=a.concat(o),c=o.sn);let f;if(e<t){const g=e>t-l?0:l;f=Ah(s,a,e,g)}else f=a[a.length-1];if(f){const g=f.sn-n.startSN,p=this.fragmentTracker.getState(f);if((p===fi.OK||p===fi.PARTIAL&&f.gap)&&(s=f),s&&f.sn===s.sn&&(!h||u[0].fragment.sn>f.sn)&&s&&f.level===s.level){const m=a[g+1];f.sn<c&&this.fragmentTracker.getState(m)!==fi.OK?f=m:f=null}}return f}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const i=this.hls.liveSyncPosition,s=n.currentTime,a=e.fragments[0].start,c=e.edge,o=s>=a-t.maxFragLookUpTolerance&&s<=c;if(i!==null&&n.duration>i&&(s<i||!o)){const l=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&n.readyState<4||s<c-l)&&(this.loadedmetadata||(this.nextLoadPosition=i),n.readyState&&(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${c}, reset currentTime to : ${i.toFixed(3)}`),n.currentTime=i))}}alignPlaylists(e,t,n){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const s=e.fragments[0].start,a=!t,c=e.alignedSliding&&Pt(s);if(a||!c&&!s){const{fragPrevious:o}=this;CP(o,n,e);const l=e.fragments[0].start;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${o?o.sn:"na"} fragments: ${i}`),l}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let n=this.startPosition;if(n<t&&(n=-1),n===-1||this.lastCurrentTime===-1){const i=this.startTimeOffset!==null,s=i?this.startTimeOffset:e.startTimeOffset;s!==null&&Pt(s)?(n=t+s,s<0&&(n+=e.totalduration),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Start time offset ${s} found in ${i?"multivariant":"media"} playlist, adjust startPosition to ${n}`),this.startPosition=n):e.live?n=this.hls.liveSyncPosition||t:this.startPosition=n=0,this.lastCurrentTime=n}this.nextLoadPosition=n}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&e.sn!=="initSegment"&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==ze.FRAG_LOADING_WAITING_RETRY)&&(this.state=ze.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const u=this.getCurrentContext(t.chunkMeta);u&&(t.frag=u.frag)}const n=t.frag;if(!n||n.type!==e||!this.levels)return;if(this.fragContextChanged(n)){var i;this.warn(`Frag load error must match current frag to retry ${n.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const s=t.details===Me.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(n,!0);const a=t.errorAction,{action:c,retryCount:o=0,retryConfig:l}=a||{};if(a&&c===xi.RetryRequest&&l){this.resetStartWhenNotLoaded(this.levelLastLoaded);const u=Mg(l,o);this.warn(`Fragment ${n.sn} of ${e} ${n.level} errored with ${t.details}, retrying loading ${o+1}/${l.maxNumRetry} in ${u}ms`),a.resolved=!0,this.retryDate=self.performance.now()+u,this.state=ze.FRAG_LOADING_WAITING_RETRY}else if(l&&a)if(this.resetFragmentErrors(e),o<l.maxNumRetry)!s&&c!==xi.RemoveAlternatePermanently&&(a.resolved=!0);else{Ee.warn(`${t.details} reached or exceeded max retry (${o})`);return}else(a==null?void 0:a.action)===xi.SendAlternateToPenaltyBox?this.state=ze.WAITING_LEVEL:this.state=ze.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===ze.PARSING||this.state===ze.PARSED){const t=e.parent,n=this.getFwdBufferInfo(this.mediaBuffer,t),i=n&&n.len>.5;i&&this.reduceMaxBufferLength(n.len);const s=!i;return s&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${t} buffer`),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),s}return!1}resetFragmentErrors(e){e===Jt.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==ze.STOPPED&&(this.state=ze.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const i=nn.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,n),this.state===ze.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=ze.IDLE}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,i){var s;const a=n.details;if(!a){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((o,l)=>{const u=e.elementaryStreams[l];if(u){const h=u.endPTS-u.startPTS;if(h<=0)return this.warn(`Could not parse fragment ${e.sn} ${l} duration reliably (${h})`),o||!1;const f=i?0:wS(a,e,u.startPTS,u.endPTS,u.startDTS,u.endDTS);return this.hls.trigger(H.LEVEL_PTS_UPDATED,{details:a,level:n,drift:f,type:l,frag:e,start:u.startPTS,end:u.endPTS}),!0}return o},!1)&&((s=this.transmuxer)==null?void 0:s.error)===null){const o=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(n.fragmentError===0&&(n.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(o.message),this.hls.trigger(H.ERROR,{type:rr.MEDIA_ERROR,details:Me.FRAG_PARSING_ERROR,fatal:!1,error:o,frag:e,reason:`Found no media in msn ${e.sn} of level "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=ze.PARSED,this.hls.trigger(H.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}class PS{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;if(e.length)e.length===1?n=e[0]:n=FP(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function FP(r,e){const t=new Uint8Array(e);let n=0;for(let i=0;i<r.length;i++){const s=r[i];t.set(s,n),n+=s.length}return t}function jP(){return typeof __HLS_WORKER_BUNDLE__=="function"}function BP(){const r=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(r);return{worker:new self.Worker(e),objectURL:e}}function UP(r){const e=new self.URL(r,self.location.href).href;return{worker:new self.Worker(e),scriptURL:e}}function aa(r="",e=9e4){return{type:r,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Ug{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=Is(this.cachedData,e),this.cachedData=null);let n=xu(e,0),i=n?n.length:0,s;const a=this._audioTrack,c=this._id3Track,o=n?Og(n):void 0,l=e.length;for((this.basePTS===null||this.frameIndex===0&&Pt(o))&&(this.basePTS=$P(o,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:zs.audioId3,duration:Number.POSITIVE_INFINITY});i<l;){if(this.canParse(e,i)){const u=this.appendFrame(a,e,i);u?(this.frameIndex++,this.lastPTS=u.sample.pts,i+=u.length,s=i):i=l}else uC(e,i)?(n=xu(e,i),c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:zs.audioId3,duration:Number.POSITIVE_INFINITY}),i+=n.length,s=i):i++;if(i===l&&s!==l){const u=ec(e,s);this.cachedData?this.cachedData=Is(this.cachedData,u):this.cachedData=u}}return{audioTrack:a,videoTrack:aa(),id3Track:c,textTrack:aa()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:aa(),id3Track:this._id3Track,textTrack:aa()}}destroy(){}}const $P=(r,e,t)=>{if(Pt(r))return r*90;const n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};function VP(r,e,t,n){let i,s,a,c;const o=navigator.userAgent.toLowerCase(),l=n,u=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];i=((e[t+2]&192)>>>6)+1;const h=(e[t+2]&60)>>>2;if(h>u.length-1){const f=new Error(`invalid ADTS sampling index:${h}`);r.emit(H.ERROR,H.ERROR,{type:rr.MEDIA_ERROR,details:Me.FRAG_PARSING_ERROR,fatal:!0,error:f,reason:f.message});return}return a=(e[t+2]&1)<<2,a|=(e[t+3]&192)>>>6,Ee.log(`manifest codec:${n}, ADTS type:${i}, samplingIndex:${h}`),/firefox/i.test(o)?h>=6?(i=5,c=new Array(4),s=h-3):(i=2,c=new Array(2),s=h):o.indexOf("android")!==-1?(i=2,c=new Array(2),s=h):(i=5,c=new Array(4),n&&(n.indexOf("mp4a.40.29")!==-1||n.indexOf("mp4a.40.5")!==-1)||!n&&h>=6?s=h-3:((n&&n.indexOf("mp4a.40.2")!==-1&&(h>=6&&a===1||/vivaldi/i.test(o))||!n&&a===1)&&(i=2,c=new Array(2)),s=h)),c[0]=i<<3,c[0]|=(h&14)>>1,c[1]|=(h&1)<<7,c[1]|=a<<3,i===5&&(c[1]|=(s&14)>>1,c[2]=(s&1)<<7,c[2]|=8,c[3]=0),{config:c,samplerate:u[h],channelCount:a,codec:"mp4a.40."+i,manifestCodec:l}}function LS(r,e){return r[e]===255&&(r[e+1]&246)===240}function DS(r,e){return r[e+1]&1?7:9}function $g(r,e){return(r[e+3]&3)<<11|r[e+4]<<3|(r[e+5]&224)>>>5}function GP(r,e){return e+5<r.length}function Mh(r,e){return e+1<r.length&&LS(r,e)}function HP(r,e){return GP(r,e)&&LS(r,e)&&$g(r,e)<=r.length-e}function WP(r,e){if(Mh(r,e)){const t=DS(r,e);if(e+t>=r.length)return!1;const n=$g(r,e);if(n<=t)return!1;const i=e+n;return i===r.length||Mh(r,i)}return!1}function IS(r,e,t,n,i){if(!r.samplerate){const s=VP(e,t,n,i);if(!s)return;r.config=s.config,r.samplerate=s.samplerate,r.channelCount=s.channelCount,r.codec=s.codec,r.manifestCodec=s.manifestCodec,Ee.log(`parsed codec:${r.codec}, rate:${s.samplerate}, channels:${s.channelCount}`)}}function AS(r){return 1024*9e4/r}function zP(r,e){const t=DS(r,e);if(e+t<=r.length){const n=$g(r,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function OS(r,e,t,n,i){const s=AS(r.samplerate),a=n+i*s,c=zP(e,t);let o;if(c){const{frameLength:h,headerLength:f}=c,g=f+h,p=Math.max(0,t+g-e.length);p?(o=new Uint8Array(g-f),o.set(e.subarray(t+f,e.length),0)):o=e.subarray(t+f,t+g);const d={unit:o,pts:a};return p||r.samples.push(d),{sample:d,length:g,missing:p}}const l=e.length-t;return o=new Uint8Array(l),o.set(e.subarray(t,e.length),0),{sample:{unit:o,pts:a},length:l,missing:-1}}let Ed=null;const KP=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],qP=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],YP=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],QP=[0,1,1,4];function MS(r,e,t,n,i){if(t+24>e.length)return;const s=NS(e,t);if(s&&t+s.frameLength<=e.length){const a=s.samplesPerFrame*9e4/s.sampleRate,c=n+i*a,o={unit:e.subarray(t,t+s.frameLength),pts:c,dts:c};return r.config=[],r.channelCount=s.channelCount,r.samplerate=s.sampleRate,r.samples.push(o),{sample:o,length:s.frameLength,missing:0}}}function NS(r,e){const t=r[e+1]>>3&3,n=r[e+1]>>1&3,i=r[e+2]>>4&15,s=r[e+2]>>2&3;if(t!==1&&i!==0&&i!==15&&s!==3){const a=r[e+2]>>1&1,c=r[e+3]>>6,o=t===3?3-n:n===3?3:4,l=KP[o*14+i-1]*1e3,h=qP[(t===3?0:t===2?1:2)*3+s],f=c===3?1:2,g=YP[t][n],p=QP[n],d=g*8*p,m=Math.floor(g*l/h+a)*p;if(Ed===null){const R=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ed=R?parseInt(R[1]):0}return!!Ed&&Ed<=87&&n===2&&l>=224e3&&c===0&&(r[e+3]=r[e+3]|128),{sampleRate:h,channelCount:f,frameLength:m,samplesPerFrame:d}}}function Vg(r,e){return r[e]===255&&(r[e+1]&224)===224&&(r[e+1]&6)!==0}function FS(r,e){return e+1<r.length&&Vg(r,e)}function XP(r,e){return Vg(r,e)&&4<=r.length-e}function jS(r,e){if(e+1<r.length&&Vg(r,e)){const n=NS(r,e);let i=4;n!=null&&n.frameLength&&(i=n.frameLength);const s=e+i;return s===r.length||FS(r,s)}return!1}class JP extends Ug{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=xu(e,0);let n=(t==null?void 0:t.length)||0;if(jS(e,n))return!1;for(let i=e.length;n<i;n++)if(WP(e,n))return Ee.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return HP(e,t)}appendFrame(e,t,n){IS(e,this.observer,t,n,e.manifestCodec);const i=OS(e,t,n,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i}}const ZP=/\/emsg[-/]ID3/i;class eL{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,i){const s=this.videoTrack=aa("video",1),a=this.audioTrack=aa("audio",1),c=this.txtTrack=aa("text",1);if(this.id3Track=aa("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const o=fS(e);if(o.video){const{id:l,timescale:u,codec:h}=o.video;s.id=l,s.timescale=c.timescale=u,s.codec=h}if(o.audio){const{id:l,timescale:u,codec:h}=o.audio;a.id=l,a.timescale=u,a.codec=h}c.id=dS.text,s.sampleDuration=0,s.duration=a.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return _C(e)}demux(e,t){this.timeOffset=t;let n=e;const i=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=Is(this.remainderData,e));const c=kC(n);this.remainderData=c.remainder,i.samples=c.valid||new Uint8Array}else i.samples=n;const a=this.extractID3Track(i,t);return s.samples=Nv(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return n.samples=Nv(e,t),{videoTrack:t,audioTrack:aa(),id3Track:i,textTrack:aa()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const i=fr(e.samples,["emsg"]);i&&i.forEach(s=>{const a=LC(s);if(ZP.test(a.schemeIdUri)){const c=Pt(a.presentationTime)?a.presentationTime/a.timeScale:t+a.presentationTimeDelta/a.timeScale;let o=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;o<=.001&&(o=Number.POSITIVE_INFINITY);const l=a.payload;n.samples.push({data:l,len:l.byteLength,dts:c,pts:c,type:zs.emsg,duration:o})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}const BS=(r,e)=>{let t=0,n=5;e+=n;const i=new Uint32Array(1),s=new Uint32Array(1),a=new Uint8Array(1);for(;n>0;){a[0]=r[e];const c=Math.min(n,8),o=8-c;s[0]=4278190080>>>24+o<<o,i[0]=(a[0]&s[0])>>o,t=t?t<<c|i[0]:i[0],e+=1,n-=c}return t};class tL extends Ug{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const i=US(e,t,n,this.basePTS,this.frameIndex);if(i!==-1)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;const t=xu(e,0);if(!t)return!1;const n=t.length;return e[n]===11&&e[n+1]===119&&Og(t)!==void 0&&BS(e,n)<16}}function US(r,e,t,n,i){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const c=[48e3,44100,32e3][s],o=e[t+4]&63,u=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][o*3+s]*2;if(t+u>e.length)return-1;const h=e[t+6]>>5;let f=0;h===2?f+=2:(h&1&&h!==1&&(f+=2),h&4&&(f+=2));const g=(e[t+6]<<8|e[t+7])>>12-f&1,d=[2,1,2,3,3,4,4,5][h]+g,m=e[t+5]>>3,E=e[t+5]&7,S=new Uint8Array([s<<6|m<<1|E>>2,(E&3)<<6|h<<3|g<<2|o>>4,o<<4&224]),R=1536/c*9e4,k=n+i*R,C=e.subarray(t,t+u);return r.config=S,r.channelCount=d,r.samplerate=c,r.samples.push({unit:C,pts:k}),u}class rL{constructor(){this.VideoSample=null}createVideoSample(e,t,n,i){return{key:e,frame:!1,pts:t,dts:n,units:[],debug:i,length:0}}getLastNalUnit(e){var t;let n=this.VideoSample,i;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){const s=n.units;i=s[s.length-1]}return i}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const n=t.samples,i=n.length;if(i){const s=n[i-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}e.debug.length&&Ee.log(e.pts+"/"+e.dts+":"+e.debug)}}class uy{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,i=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");i.set(e.subarray(n,n+s)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&Ee.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t=8,n=8,i;for(let s=0;s<e;s++)n!==0&&(i=this.readEG(),n=(t+i+256)%256),t=n===0?t:n}readSPS(){let e=0,t=0,n=0,i=0,s,a,c;const o=this.readUByte.bind(this),l=this.readBits.bind(this),u=this.readUEG.bind(this),h=this.readBoolean.bind(this),f=this.skipBits.bind(this),g=this.skipEG.bind(this),p=this.skipUEG.bind(this),d=this.skipScalingList.bind(this);o();const m=o();if(l(5),f(3),o(),p(),m===100||m===110||m===122||m===244||m===44||m===83||m===86||m===118||m===128){const x=u();if(x===3&&f(1),p(),p(),f(1),h())for(a=x!==3?8:12,c=0;c<a;c++)h()&&(c<6?d(16):d(64))}p();const E=u();if(E===0)u();else if(E===1)for(f(1),g(),g(),s=u(),c=0;c<s;c++)g();p(),f(1);const S=u(),R=u(),k=l(1);k===0&&f(1),f(1),h()&&(e=u(),t=u(),n=u(),i=u());let C=[1,1];if(h()&&h())switch(o()){case 1:C=[1,1];break;case 2:C=[12,11];break;case 3:C=[10,11];break;case 4:C=[16,11];break;case 5:C=[40,33];break;case 6:C=[24,11];break;case 7:C=[20,11];break;case 8:C=[32,11];break;case 9:C=[80,33];break;case 10:C=[18,11];break;case 11:C=[15,11];break;case 12:C=[64,33];break;case 13:C=[160,99];break;case 14:C=[4,3];break;case 15:C=[3,2];break;case 16:C=[2,1];break;case 255:{C=[o()<<8|o(),o()<<8|o()];break}}return{width:Math.ceil((S+1)*16-e*2-t*2),height:(2-k)*(R+1)*16-(k?2:4)*(n+i),pixelRatio:C}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class nL extends rL{parseAVCPES(e,t,n,i,s){const a=this.parseAVCNALu(e,n.data);let c=this.VideoSample,o,l=!1;n.data=null,c&&a.length&&!e.audFound&&(this.pushAccessUnit(c,e),c=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts,"")),a.forEach(u=>{var h;switch(u.type){case 1:{let d=!1;o=!0;const m=u.data;if(l&&m.length>4){const E=new uy(m).readSliceType();(E===2||E===4||E===7||E===9)&&(d=!0)}if(d){var f;(f=c)!=null&&f.frame&&!c.key&&(this.pushAccessUnit(c,e),c=this.VideoSample=null)}c||(c=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts,"")),c.frame=!0,c.key=d;break}case 5:o=!0,(h=c)!=null&&h.frame&&!c.key&&(this.pushAccessUnit(c,e),c=this.VideoSample=null),c||(c=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts,"")),c.key=!0,c.frame=!0;break;case 6:{o=!0,gS(u.data,1,n.pts,t.samples);break}case 7:{var g,p;o=!0,l=!0;const d=u.data,E=new uy(d).readSPS();if(!e.sps||e.width!==E.width||e.height!==E.height||((g=e.pixelRatio)==null?void 0:g[0])!==E.pixelRatio[0]||((p=e.pixelRatio)==null?void 0:p[1])!==E.pixelRatio[1]){e.width=E.width,e.height=E.height,e.pixelRatio=E.pixelRatio,e.sps=[d],e.duration=s;const S=d.subarray(1,4);let R="avc1.";for(let k=0;k<3;k++){let C=S[k].toString(16);C.length<2&&(C="0"+C),R+=C}e.codec=R}break}case 8:o=!0,e.pps=[u.data];break;case 9:o=!0,e.audFound=!0,c&&this.pushAccessUnit(c,e),c=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts,"");break;case 12:o=!0;break;default:o=!1,c&&(c.debug+="unknown NAL "+u.type+" ");break}c&&o&&c.units.push(u)}),i&&c&&(this.pushAccessUnit(c,e),this.VideoSample=null)}parseAVCNALu(e,t){const n=t.byteLength;let i=e.naluState||0;const s=i,a=[];let c=0,o,l,u,h=-1,f=0;for(i===-1&&(h=0,f=t[0]&31,i=0,c=1);c<n;){if(o=t[c++],!i){i=o?0:1;continue}if(i===1){i=o?0:2;continue}if(!o)i=3;else if(o===1){if(l=c-i-1,h>=0){const g={data:t.subarray(h,l),type:f};a.push(g)}else{const g=this.getLastNalUnit(e.samples);g&&(s&&c<=4-s&&g.state&&(g.data=g.data.subarray(0,g.data.byteLength-s)),l>0&&(g.data=Is(g.data,t.subarray(0,l)),g.state=0))}c<n?(u=t[c]&31,h=c,f=u,i=0):i=-1}else i=0}if(h>=0&&i>=0){const g={data:t.subarray(h,n),type:f,state:i};a.push(g)}if(a.length===0){const g=this.getLastNalUnit(e.samples);g&&(g.data=Is(g.data,t))}return e.naluState=i,a}}class iL{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new jg(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,n){const i=e[t].unit;if(i.length<=16)return;const s=i.subarray(16,i.length-i.length%16),a=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(a).then(c=>{const o=new Uint8Array(c);i.set(o,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)})}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)n.set(e.subarray(s,s+16),i);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)e.set(n.subarray(i,i+16),s);return e}decryptAvcSample(e,t,n,i,s){const a=vS(s.data),c=this.getAvcEncryptedData(a);this.decryptBuffer(c.buffer).then(o=>{s.data=this.getAvcDecryptedUnit(a,o),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,i)})}decryptAvcSamples(e,t,n,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){i();return}const s=e[t].units;for(;!(n>=s.length);n++){const a=s[n];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,n,i,a),!this.decrypter.isSync()))return}}}}const hi=188;class so{constructor(e,t,n){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.videoParser=new nL}static probe(e){const t=so.syncOffset(e);return t>0&&Ee.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),t!==-1}static syncOffset(e){const t=e.length;let n=Math.min(hi*5,t-hi)+1,i=0;for(;i<n;){let s=!1,a=-1,c=0;for(let o=i;o<t;o+=hi)if(e[o]===71&&(t-o===hi||e[o+hi]===71)){if(c++,a===-1&&(a=o,a!==0&&(n=Math.min(a+hi*99,e.length-hi)+1)),s||(s=bm(e,o)===0),s&&c>1&&(a===0&&c>2||o+hi>n))return a}else{if(c)return-1;break}i++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:dS[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=so.createTrack("video"),this._audioTrack=so.createTrack("audio",i),this._id3Track=so.createTrack("id3"),this._txtTrack=so.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n,this._duration=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,i=!1){n||(this.sampleAes=null);let s;const a=this._videoTrack,c=this._audioTrack,o=this._id3Track,l=this._txtTrack;let u=a.pid,h=a.pesData,f=c.pid,g=o.pid,p=c.pesData,d=o.pesData,m=null,E=this.pmtParsed,S=this._pmtId,R=e.length;if(this.remainderData&&(e=Is(this.remainderData,e),R=e.length,this.remainderData=null),R<hi&&!i)return this.remainderData=e,{audioTrack:c,videoTrack:a,id3Track:o,textTrack:l};const k=Math.max(0,so.syncOffset(e));R-=(R-k)%hi,R<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,R,e.buffer.byteLength-R));let C=0;for(let P=k;P<R;P+=hi)if(e[P]===71){const D=!!(e[P+1]&64),b=bm(e,P),w=(e[P+3]&48)>>4;let v;if(w>1){if(v=P+5+e[P+4],v===P+hi)continue}else v=P+4;switch(b){case u:D&&(h&&(s=Ac(h))&&this.videoParser.parseAVCPES(a,l,s,!1,this._duration),h={data:[],size:0}),h&&(h.data.push(e.subarray(v,P+hi)),h.size+=P+hi-v);break;case f:if(D){if(p&&(s=Ac(p)))switch(c.segmentCodec){case"aac":this.parseAACPES(c,s);break;case"mp3":this.parseMPEGPES(c,s);break;case"ac3":this.parseAC3PES(c,s);break}p={data:[],size:0}}p&&(p.data.push(e.subarray(v,P+hi)),p.size+=P+hi-v);break;case g:D&&(d&&(s=Ac(d))&&this.parseID3PES(o,s),d={data:[],size:0}),d&&(d.data.push(e.subarray(v,P+hi)),d.size+=P+hi-v);break;case 0:D&&(v+=e[v]+1),S=this._pmtId=sL(e,v);break;case S:{D&&(v+=e[v]+1);const _=aL(e,v,this.typeSupported,n);u=_.videoPid,u>0&&(a.pid=u,a.segmentCodec=_.segmentVideoCodec),f=_.audioPid,f>0&&(c.pid=f,c.segmentCodec=_.segmentAudioCodec),g=_.id3Pid,g>0&&(o.pid=g),m!==null&&!E&&(Ee.warn(`MPEG-TS PMT found at ${P} after unknown PID '${m}'. Backtracking to sync byte @${k} to parse all TS packets.`),m=null,P=k-188),E=this.pmtParsed=!0;break}case 17:case 8191:break;default:m=b;break}}else C++;if(C>0){const P=new Error(`Found ${C} TS packet/s that do not start with 0x47`);this.observer.emit(H.ERROR,H.ERROR,{type:rr.MEDIA_ERROR,details:Me.FRAG_PARSING_ERROR,fatal:!1,error:P,reason:P.message})}a.pesData=h,c.pesData=p,o.pesData=d;const x={audioTrack:c,videoTrack:a,id3Track:o,textTrack:l};return i&&this.extractRemainingSamples(x),x}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:i,textTrack:s}=e,a=n.pesData,c=t.pesData,o=i.pesData;let l;if(a&&(l=Ac(a))?(this.videoParser.parseAVCPES(n,s,l,!0,this._duration),n.pesData=null):n.pesData=a,c&&(l=Ac(c))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l);break}t.pesData=null}else c!=null&&c.size&&Ee.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=c;o&&(l=Ac(o))?(this.parseID3PES(i,l),i.pesData=null):i.pesData=o}demuxSampleAes(e,t,n){const i=this.demux(e,n,!0,!this.config.progressive),s=this.sampleAes=new iL(this.observer,this.config,t);return this.decrypt(i,s)}decrypt(e,t){return new Promise(n=>{const{audioTrack:i,videoTrack:s}=e;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{n(e)}):n(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{n(e)})})}destroy(){this._duration=0}parseAACPES(e,t){let n=0;const i=this.aacOverFlow;let s=t.data;if(i){this.aacOverFlow=null;const h=i.missing,f=i.sample.unit.byteLength;if(h===-1)s=Is(i.sample.unit,s);else{const g=f-h;i.sample.unit.set(s.subarray(0,h),g),e.samples.push(i.sample),n=i.missing}}let a,c;for(a=n,c=s.length;a<c-1&&!Mh(s,a);a++);if(a!==n){let h;const f=a<c-1;f?h=`AAC PES did not start with ADTS header,offset:${a}`:h="No ADTS header found in AAC PES";const g=new Error(h);if(Ee.warn(`parsing error: ${h}`),this.observer.emit(H.ERROR,H.ERROR,{type:rr.MEDIA_ERROR,details:Me.FRAG_PARSING_ERROR,fatal:!1,levelRetry:f,error:g,reason:h}),!f)return}IS(e,this.observer,s,a,this.audioCodec);let o;if(t.pts!==void 0)o=t.pts;else if(i){const h=AS(e.samplerate);o=i.sample.pts+h}else{Ee.warn("[tsdemuxer]: AAC PES unknown PTS");return}let l=0,u;for(;a<c;)if(u=OS(e,s,a,o,l),a+=u.length,u.missing){this.aacOverFlow=u;break}else for(l++;a<c-1&&!Mh(s,a);a++);}parseMPEGPES(e,t){const n=t.data,i=n.length;let s=0,a=0;const c=t.pts;if(c===void 0){Ee.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<i;)if(FS(n,a)){const o=MS(e,n,a,c,s);if(o)a+=o.length,s++;else break}else a++}parseAC3PES(e,t){{const n=t.data,i=t.pts;if(i===void 0){Ee.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=n.length;let a=0,c=0,o;for(;c<s&&(o=US(e,n,c,i,a++))>0;)c+=o}}parseID3PES(e,t){if(t.pts===void 0){Ee.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=Xn({},t,{type:this._videoTrack?zs.emsg:zs.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function bm(r,e){return((r[e+1]&31)<<8)+r[e+2]}function sL(r,e){return(r[e+10]&31)<<8|r[e+11]}function aL(r,e,t,n){const i={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},s=(r[e+1]&15)<<8|r[e+2],a=e+3+s-4,c=(r[e+10]&15)<<8|r[e+11];for(e+=12+c;e<a;){const o=bm(r,e),l=(r[e+3]&15)<<8|r[e+4];switch(r[e]){case 207:if(!n){Jp("ADTS AAC");break}case 15:i.audioPid===-1&&(i.audioPid=o);break;case 21:i.id3Pid===-1&&(i.id3Pid=o);break;case 219:if(!n){Jp("H.264");break}case 27:i.videoPid===-1&&(i.videoPid=o,i.segmentVideoCodec="avc");break;case 3:case 4:!t.mpeg&&!t.mp3?Ee.log("MPEG audio found, not supported in this browser"):i.audioPid===-1&&(i.audioPid=o,i.segmentAudioCodec="mp3");break;case 193:if(!n){Jp("AC-3");break}case 129:t.ac3?i.audioPid===-1&&(i.audioPid=o,i.segmentAudioCodec="ac3"):Ee.log("AC-3 audio found, not supported in this browser");break;case 6:if(i.audioPid===-1&&l>0){let u=e+5,h=l;for(;h>2;){switch(r[u]){case 106:t.ac3!==!0?Ee.log("AC-3 audio found, not supported in this browser for now"):(i.audioPid=o,i.segmentAudioCodec="ac3");break}const g=r[u+1]+2;u+=g,h-=g}}break;case 194:case 135:Ee.warn("Unsupported EC-3 in M2TS found");break;case 36:Ee.warn("Unsupported HEVC in M2TS found");break}e+=l+5}return i}function Jp(r){Ee.log(`${r} with AES-128-CBC encryption found in unencrypted stream`)}function Ac(r){let e=0,t,n,i,s,a;const c=r.data;if(!r||r.size===0)return null;for(;c[0].length<19&&c.length>1;)c[0]=Is(c[0],c[1]),c.splice(1,1);if(t=c[0],(t[0]<<16)+(t[1]<<8)+t[2]===1){if(n=(t[4]<<8)+t[5],n&&n>r.size-6)return null;const l=t[7];l&192&&(s=(t[9]&14)*536870912+(t[10]&255)*4194304+(t[11]&254)*16384+(t[12]&255)*128+(t[13]&254)/2,l&64?(a=(t[14]&14)*536870912+(t[15]&255)*4194304+(t[16]&254)*16384+(t[17]&255)*128+(t[18]&254)/2,s-a>60*9e4&&(Ee.warn(`${Math.round((s-a)/9e4)}s delta between PTS and DTS, align them`),s=a)):a=s),i=t[8];let u=i+9;if(r.size<=u)return null;r.size-=u;const h=new Uint8Array(r.size);for(let f=0,g=c.length;f<g;f++){t=c[f];let p=t.byteLength;if(u)if(u>p){u-=p;continue}else t=t.subarray(u),p-=u,u=0;h.set(t,e),e+=p}return n&&(n-=i+3),{data:h,pts:s,dts:a,len:n}}return null}class oL extends Ug{resetInitSegment(e,t,n,i){super.resetInitSegment(e,t,n,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=xu(e,0);let n=(t==null?void 0:t.length)||0;if(t&&e[n]===11&&e[n+1]===119&&Og(t)!==void 0&&BS(e,n)<=16)return!1;for(let i=e.length;n<i;n++)if(jS(e,n))return Ee.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return XP(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return MS(e,t,n,this.basePTS,this.frameIndex)}}class dy{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const ro=Math.pow(2,32)-1;class Ce{static init(){Ce.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in Ce.types)Ce.types.hasOwnProperty(e)&&(Ce.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Ce.HDLR_TYPES={video:t,audio:n};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);Ce.STTS=Ce.STSC=Ce.STCO=s,Ce.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Ce.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Ce.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Ce.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),c=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);Ce.FTYP=Ce.box(Ce.types.ftyp,a,o,a,c),Ce.DINF=Ce.box(Ce.types.dinf,Ce.box(Ce.types.dref,i))}static box(e,...t){let n=8,i=t.length;const s=i;for(;i--;)n+=t[i].byteLength;const a=new Uint8Array(n);for(a[0]=n>>24&255,a[1]=n>>16&255,a[2]=n>>8&255,a[3]=n&255,a.set(e,4),i=0,n=8;i<s;i++)a.set(t[i],n),n+=t[i].byteLength;return a}static hdlr(e){return Ce.box(Ce.types.hdlr,Ce.HDLR_TYPES[e])}static mdat(e){return Ce.box(Ce.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(ro+1)),i=Math.floor(t%(ro+1));return Ce.box(Ce.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))}static mdia(e){return Ce.box(Ce.types.mdia,Ce.mdhd(e.timescale,e.duration),Ce.hdlr(e.type),Ce.minf(e))}static mfhd(e){return Ce.box(Ce.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?Ce.box(Ce.types.minf,Ce.box(Ce.types.smhd,Ce.SMHD),Ce.DINF,Ce.stbl(e)):Ce.box(Ce.types.minf,Ce.box(Ce.types.vmhd,Ce.VMHD),Ce.DINF,Ce.stbl(e))}static moof(e,t,n){return Ce.box(Ce.types.moof,Ce.mfhd(e),Ce.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=Ce.trak(e[t]);return Ce.box.apply(null,[Ce.types.moov,Ce.mvhd(e[0].timescale,e[0].duration)].concat(n).concat(Ce.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=Ce.trex(e[t]);return Ce.box.apply(null,[Ce.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(ro+1)),i=Math.floor(t%(ro+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Ce.box(Ce.types.mvhd,s)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let i,s;for(i=0;i<t.length;i++)s=t[i].flags,n[i+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return Ce.box(Ce.types.sdtp,n)}static stbl(e){return Ce.box(Ce.types.stbl,Ce.stsd(e),Ce.box(Ce.types.stts,Ce.STTS),Ce.box(Ce.types.stsc,Ce.STSC),Ce.box(Ce.types.stsz,Ce.STSZ),Ce.box(Ce.types.stco,Ce.STCO))}static avc1(e){let t=[],n=[],i,s,a;for(i=0;i<e.sps.length;i++)s=e.sps[i],a=s.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(s));for(i=0;i<e.pps.length;i++)s=e.pps[i],a=s.byteLength,n.push(a>>>8&255),n.push(a&255),n=n.concat(Array.prototype.slice.call(s));const c=Ce.box(Ce.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),o=e.width,l=e.height,u=e.pixelRatio[0],h=e.pixelRatio[1];return Ce.box(Ce.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,o&255,l>>8&255,l&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,Ce.box(Ce.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Ce.box(Ce.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,h>>24,h>>16&255,h>>8&255,h&255])))}static esds(e){const t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static audioStsd(e){const t=e.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return Ce.box(Ce.types.mp4a,Ce.audioStsd(e),Ce.box(Ce.types.esds,Ce.esds(e)))}static mp3(e){return Ce.box(Ce.types[".mp3"],Ce.audioStsd(e))}static ac3(e){return Ce.box(Ce.types["ac-3"],Ce.audioStsd(e),Ce.box(Ce.types.dac3,e.config))}static stsd(e){return e.type==="audio"?e.segmentCodec==="mp3"&&e.codec==="mp3"?Ce.box(Ce.types.stsd,Ce.STSD,Ce.mp3(e)):e.segmentCodec==="ac3"?Ce.box(Ce.types.stsd,Ce.STSD,Ce.ac3(e)):Ce.box(Ce.types.stsd,Ce.STSD,Ce.mp4a(e)):Ce.box(Ce.types.stsd,Ce.STSD,Ce.avc1(e))}static tkhd(e){const t=e.id,n=e.duration*e.timescale,i=e.width,s=e.height,a=Math.floor(n/(ro+1)),c=Math.floor(n%(ro+1));return Ce.box(Ce.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,c>>24,c>>16&255,c>>8&255,c&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const n=Ce.sdtp(e),i=e.id,s=Math.floor(t/(ro+1)),a=Math.floor(t%(ro+1));return Ce.box(Ce.types.traf,Ce.box(Ce.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),Ce.box(Ce.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,a>>24,a>>16&255,a>>8&255,a&255])),Ce.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,Ce.box(Ce.types.trak,Ce.tkhd(e),Ce.mdia(e))}static trex(e){const t=e.id;return Ce.box(Ce.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],i=n.length,s=12+16*i,a=new Uint8Array(s);let c,o,l,u,h,f;for(t+=8+s,a.set([e.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),c=0;c<i;c++)o=n[c],l=o.duration,u=o.size,h=o.flags,f=o.cts,a.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,h.degradPrio&61440,h.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*c);return Ce.box(Ce.types.trun,a)}static initSegment(e){Ce.types||Ce.init();const t=Ce.moov(e);return Is(Ce.FTYP,t)}}Ce.types=void 0;Ce.HDLR_TYPES=void 0;Ce.STTS=void 0;Ce.STSC=void 0;Ce.STCO=void 0;Ce.STSZ=void 0;Ce.VMHD=void 0;Ce.SMHD=void 0;Ce.STSD=void 0;Ce.FTYP=void 0;Ce.DINF=void 0;const $S=9e4;function Gg(r,e,t=1,n=!1){const i=r*e*t;return n?Math.round(i):i}function cL(r,e,t=1,n=!1){return Gg(r,e,1/t,n)}function Hl(r,e=!1){return Gg(r,1e3,1/$S,e)}function lL(r,e=1){return Gg(r,$S,1/e)}const uL=10*1e3,hy=1024,dL=1152,hL=1536;let Oc=null,Zp=null;class zd{constructor(e,t,n,i=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,Oc===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Oc=a?parseInt(a[1]):0}if(Zp===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);Zp=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){Ee.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){Ee.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){Ee.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e.reduce((i,s)=>{const a=s.pts-i;return a<-4294967296?(t=!0,Ts(i,s.pts)):a>0?i:s.pts},e[0].pts);return t&&Ee.debug("PTS rollover detected"),n}remux(e,t,n,i,s,a,c,o){let l,u,h,f,g,p,d=s,m=s;const E=e.pid>-1,S=t.pid>-1,R=t.samples.length,k=e.samples.length>0,C=c&&R>0||R>1;if((!E||k)&&(!S||C)||this.ISGenerated||c){if(this.ISGenerated){var P,D,b,w;const T=this.videoTrackConfig;T&&(t.width!==T.width||t.height!==T.height||((P=t.pixelRatio)==null?void 0:P[0])!==((D=T.pixelRatio)==null?void 0:D[0])||((b=t.pixelRatio)==null?void 0:b[1])!==((w=T.pixelRatio)==null?void 0:w[1]))&&this.resetInitSegment()}else h=this.generateIS(e,t,s,a);const v=this.isVideoContiguous;let _=-1,y;if(C&&(_=pL(t.samples),!v&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,_>0){Ee.warn(`[mp4-remuxer]: Dropped ${_} out of ${R} video samples due to a missing keyframe`);const T=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(_),t.dropped+=_,m+=(t.samples[0].pts-T)/t.inputTimeScale,y=m}else _===-1&&(Ee.warn(`[mp4-remuxer]: No keyframe found out of ${R} video samples`),p=!1);if(this.ISGenerated){if(k&&C){const T=this.getVideoStartPts(t.samples),I=(Ts(e.samples[0].pts,T)-T)/t.inputTimeScale;d+=Math.max(0,I),m+=Math.max(0,-I)}if(k){if(e.samplerate||(Ee.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),h=this.generateIS(e,t,s,a)),u=this.remuxAudio(e,d,this.isAudioContiguous,a,S||C||o===Jt.AUDIO?m:void 0),C){const T=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(Ee.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),h=this.generateIS(e,t,s,a)),l=this.remuxVideo(t,m,v,T)}}else C&&(l=this.remuxVideo(t,m,v,0));l&&(l.firstKeyFrame=_,l.independent=_!==-1,l.firstKeyFramePTS=y)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(g=VS(n,s,this._initPTS,this._initDTS)),i.samples.length&&(f=GS(i,s,this._initPTS))),{audio:u,video:l,initSegment:h,independent:p,text:f,id3:g}}generateIS(e,t,n,i){const s=e.samples,a=t.samples,c=this.typeSupported,o={},l=this._initPTS;let u=!l||i,h="audio/mp4",f,g,p;if(u&&(f=g=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":c.mpeg?(h="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}o.audio={id:"audio",container:h,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&c.mpeg?new Uint8Array(0):Ce.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(p=e.inputTimeScale,!l||p!==l.timescale?f=g=s[0].pts-Math.round(p*n):u=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Ce.initSegment([t]),metadata:{width:t.width,height:t.height}},u)if(p=t.inputTimeScale,!l||p!==l.timescale){const d=this.getVideoStartPts(a),m=Math.round(p*n);g=Math.min(g,Ts(a[0].dts,d)-m),f=Math.min(f,d-m)}else u=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(o).length)return this.ISGenerated=!0,u?(this._initPTS={baseTime:f,timescale:p},this._initDTS={baseTime:g,timescale:p}):f=p=void 0,{tracks:o,initPTS:f,timescale:p}}remuxVideo(e,t,n,i){const s=e.inputTimeScale,a=e.samples,c=[],o=a.length,l=this._initPTS;let u=this.nextAvcDts,h=8,f=this.videoSampleDuration,g,p,d=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,E=!1;if(!n||u===null){const U=t*s,j=a[0].pts-Ts(a[0].dts,a[0].pts);Oc&&u!==null&&Math.abs(U-j-u)<15e3?n=!0:u=U-j}const S=l.baseTime*s/l.timescale;for(let U=0;U<o;U++){const j=a[U];j.pts=Ts(j.pts-S,u),j.dts=Ts(j.dts-S,u),j.dts<a[U>0?U-1:U].dts&&(E=!0)}E&&a.sort(function(U,j){const Q=U.dts-j.dts,Y=U.pts-j.pts;return Q||Y}),g=a[0].dts,p=a[a.length-1].dts;const R=p-g,k=R?Math.round(R/(o-1)):f||e.inputTimeScale/30;if(n){const U=g-u,j=U>k,Q=U<-1;if((j||Q)&&(j?Ee.warn(`AVC: ${Hl(U,!0)} ms (${U}dts) hole between fragments detected at ${t.toFixed(3)}`):Ee.warn(`AVC: ${Hl(-U,!0)} ms (${U}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!Q||u>=a[0].pts||Oc)){g=u;const Y=a[0].pts-U;if(j)a[0].dts=g,a[0].pts=Y;else for(let he=0;he<a.length&&!(a[he].dts>Y);he++)a[he].dts-=U,a[he].pts-=U;Ee.log(`Video: Initial PTS/DTS adjusted: ${Hl(Y,!0)}/${Hl(g,!0)}, delta: ${Hl(U,!0)} ms`)}}g=Math.max(0,g);let C=0,x=0,P=g;for(let U=0;U<o;U++){const j=a[U],Q=j.units,Y=Q.length;let he=0;for(let re=0;re<Y;re++)he+=Q[re].data.length;x+=he,C+=Y,j.length=he,j.dts<P?(j.dts=P,P+=k/4|0||1):P=j.dts,d=Math.min(j.pts,d),m=Math.max(j.pts,m)}p=a[o-1].dts;const D=x+4*C+8;let b;try{b=new Uint8Array(D)}catch(U){this.observer.emit(H.ERROR,H.ERROR,{type:rr.MUX_ERROR,details:Me.REMUX_ALLOC_ERROR,fatal:!1,error:U,bytes:D,reason:`fail allocating video mdat ${D}`});return}const w=new DataView(b.buffer);w.setUint32(0,D),b.set(Ce.types.mdat,4);let v=!1,_=Number.POSITIVE_INFINITY,y=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY,L=Number.NEGATIVE_INFINITY;for(let U=0;U<o;U++){const j=a[U],Q=j.units;let Y=0;for(let pe=0,fe=Q.length;pe<fe;pe++){const ue=Q[pe],ee=ue.data,Z=ue.data.byteLength;w.setUint32(h,Z),h+=4,b.set(ee,h),h+=Z,Y+=4+Z}let he;if(U<o-1)f=a[U+1].dts-j.dts,he=a[U+1].pts-j.pts;else{const pe=this.config,fe=U>0?j.dts-a[U-1].dts:k;if(he=U>0?j.pts-a[U-1].pts:k,pe.stretchShortVideoTrack&&this.nextAudioPts!==null){const ue=Math.floor(pe.maxBufferHole*s),ee=(i?d+i*s:this.nextAudioPts)-j.pts;ee>ue?(f=ee-fe,f<0?f=fe:v=!0,Ee.log(`[mp4-remuxer]: It is approximately ${ee/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=fe}else f=fe}const re=Math.round(j.pts-j.dts);_=Math.min(_,f),T=Math.max(T,f),y=Math.min(y,he),L=Math.max(L,he),c.push(new py(j.key,f,Y,re))}if(c.length){if(Oc){if(Oc<70){const U=c[0].flags;U.dependsOn=2,U.isNonSync=0}}else if(Zp&&L-y<T-_&&k/T<.025&&c[0].cts===0){Ee.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let U=g;for(let j=0,Q=c.length;j<Q;j++){const Y=U+c[j].duration,he=U+c[j].cts;if(j<Q-1){const re=Y+c[j+1].cts;c[j].duration=re-he}else c[j].duration=j?c[j-1].duration:k;c[j].cts=0,U=Y}}}f=v||!f?k:f,this.nextAvcDts=u=p+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;const M={data1:Ce.moof(e.sequenceNumber++,g,Xn({},e,{samples:c})),data2:b,startPTS:d/s,endPTS:(m+f)/s,startDTS:g/s,endDTS:u/s,type:"video",hasAudio:!1,hasVideo:!0,nb:c.length,dropped:e.dropped};return e.samples=[],e.dropped=0,M}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return dL;case"ac3":return hL;default:return hy}}remuxAudio(e,t,n,i,s){const a=e.inputTimeScale,c=e.samplerate?e.samplerate:a,o=a/c,l=this.getSamplesPerFrame(e),u=l*o,h=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,g=[],p=s!==void 0;let d=e.samples,m=f?0:8,E=this.nextAudioPts||-1;const S=t*a,R=h.baseTime*a/h.timescale;if(this.isAudioContiguous=n=n||d.length&&E>0&&(i&&Math.abs(S-E)<9e3||Math.abs(Ts(d[0].pts-R,S)-E)<20*u),d.forEach(function(I){I.pts=Ts(I.pts-R,S)}),!n||E<0){if(d=d.filter(I=>I.pts>=0),!d.length)return;s===0?E=0:i&&!p?E=Math.max(0,S):E=d[0].pts}if(e.segmentCodec==="aac"){const I=this.config.maxAudioFramesDrift;for(let N=0,M=E;N<d.length;N++){const U=d[N],j=U.pts,Q=j-M,Y=Math.abs(1e3*Q/a);if(Q<=-I*u&&p)N===0&&(Ee.warn(`Audio frame @ ${(j/a).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*Q/a)} ms.`),this.nextAudioPts=E=M=j);else if(Q>=I*u&&Y<uL&&p){let he=Math.round(Q/u);M=j-he*u,M<0&&(he--,M+=u),N===0&&(this.nextAudioPts=E=M),Ee.warn(`[mp4-remuxer]: Injecting ${he} audio frame @ ${(M/a).toFixed(3)}s due to ${Math.round(1e3*Q/a)} ms gap.`);for(let re=0;re<he;re++){const pe=Math.max(M,0);let fe=dy.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);fe||(Ee.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),fe=U.unit.subarray()),d.splice(N,0,{unit:fe,pts:pe}),M+=u,N++}}U.pts=M,M+=u}}let k=null,C=null,x,P=0,D=d.length;for(;D--;)P+=d[D].unit.byteLength;for(let I=0,N=d.length;I<N;I++){const M=d[I],U=M.unit;let j=M.pts;if(C!==null){const Y=g[I-1];Y.duration=Math.round((j-C)/o)}else if(n&&e.segmentCodec==="aac"&&(j=E),k=j,P>0){P+=m;try{x=new Uint8Array(P)}catch(Y){this.observer.emit(H.ERROR,H.ERROR,{type:rr.MUX_ERROR,details:Me.REMUX_ALLOC_ERROR,fatal:!1,error:Y,bytes:P,reason:`fail allocating audio mdat ${P}`});return}f||(new DataView(x.buffer).setUint32(0,P),x.set(Ce.types.mdat,4))}else return;x.set(U,m);const Q=U.byteLength;m+=Q,g.push(new py(!0,l,Q,0)),C=j}const b=g.length;if(!b)return;const w=g[g.length-1];this.nextAudioPts=E=C+o*w.duration;const v=f?new Uint8Array(0):Ce.moof(e.sequenceNumber++,k/o,Xn({},e,{samples:g}));e.samples=[];const _=k/a,y=E/a,L={data1:v,data2:x,startPTS:_,endPTS:y,startDTS:_,endDTS:y,type:"audio",hasAudio:!0,hasVideo:!1,nb:b};return this.isAudioContiguous=!0,L}remuxEmptyAudio(e,t,n,i){const s=e.inputTimeScale,a=e.samplerate?e.samplerate:s,c=s/a,o=this.nextAudioPts,l=this._initDTS,u=l.baseTime*9e4/l.timescale,h=(o!==null?o:i.startDTS*s)+u,f=i.endDTS*s+u,g=c*hy,p=Math.ceil((f-h)/g),d=dy.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(Ee.warn("[mp4-remuxer]: remux empty Audio"),!d){Ee.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const m=[];for(let E=0;E<p;E++){const S=h+E*g;m.push({unit:d,pts:S,dts:S})}return e.samples=m,this.remuxAudio(e,t,n,!1)}}function Ts(r,e){let t;if(e===null)return r;for(e<r?t=-8589934592:t=8589934592;Math.abs(r-e)>4294967296;)r+=t;return r}function pL(r){for(let e=0;e<r.length;e++)if(r[e].key)return e;return-1}function VS(r,e,t,n){const i=r.samples.length;if(!i)return;const s=r.inputTimeScale;for(let c=0;c<i;c++){const o=r.samples[c];o.pts=Ts(o.pts-t.baseTime*s/t.timescale,e*s)/s,o.dts=Ts(o.dts-n.baseTime*s/n.timescale,e*s)/s}const a=r.samples;return r.samples=[],{samples:a}}function GS(r,e,t){const n=r.samples.length;if(!n)return;const i=r.inputTimeScale;for(let a=0;a<n;a++){const c=r.samples[a];c.pts=Ts(c.pts-t.baseTime*i/t.timescale,e*i)/i}r.samples.sort((a,c)=>a.pts-c.pts);const s=r.samples;return r.samples=[],{samples:s}}class py{constructor(e,t,n,i){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=n,this.cts=i,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class fL{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,n,i){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(wC(e,i)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:n}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const i=this.initData=fS(e);i.audio&&(t=fy(i.audio,Gr.AUDIO)),i.video&&(n=fy(i.video,Gr.VIDEO));const s={};i.audio&&i.video?s.audiovideo={container:"video/mp4",codec:t+","+n,initSegment:e,id:"main"}:i.audio?s.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?s.video={container:"video/mp4",codec:n,initSegment:e,id:"main"}:Ee.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(e,t,n,i,s,a){var c,o;let{initPTS:l,lastEndTime:u}=this;const h={audio:void 0,video:void 0,text:i,id3:n,initSegment:void 0};Pt(u)||(u=this.lastEndTime=s||0);const f=t.samples;if(!(f!=null&&f.length))return h;const g={initPTS:void 0,timescale:1};let p=this.initData;if((c=p)!=null&&c.length||(this.generateInitSegment(f),p=this.initData),!((o=p)!=null&&o.length))return Ee.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),h;this.emitInitSegment&&(g.tracks=this.initTracks,this.emitInitSegment=!1);const d=RC(f,p),m=EC(p,f),E=m===null?s:m;(mL(l,E,s,d)||g.timescale!==l.timescale&&a)&&(g.initPTS=E-s,l&&l.timescale===1&&Ee.warn(`Adjusting initPTS by ${g.initPTS-l.baseTime}`),this.initPTS=l={baseTime:g.initPTS,timescale:1});const S=e?E-l.baseTime/l.timescale:u,R=S+d;xC(p,f,l.baseTime/l.timescale),d>0?this.lastEndTime=R:(Ee.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const k=!!p.audio,C=!!p.video;let x="";k&&(x+="audio"),C&&(x+="video");const P={data1:f,startPTS:S,startDTS:S,endPTS:R,endDTS:R,type:x,hasAudio:k,hasVideo:C,nb:1,dropped:0};return h.audio=P.type==="audio"?P:void 0,h.video=P.type!=="audio"?P:void 0,h.initSegment=g,h.id3=VS(n,s,l,l),i.samples.length&&(h.text=GS(i,s,l)),h}}function mL(r,e,t,n){if(r===null)return!0;const i=Math.max(n,1),s=e-r.baseTime/r.timescale;return Math.abs(s-t)>i}function fy(r,e){const t=r==null?void 0:r.codec;if(t&&t.length>4)return t;if(e===Gr.AUDIO){if(t==="ec-3"||t==="ac-3"||t==="alac")return t;if(t==="fLaC"||t==="Opus")return Ph(t,!1);const n="mp4a.40.5";return Ee.info(`Parsed audio codec "${t}" or audio object type not handled. Using "${n}"`),n}return Ee.warn(`Unhandled video codec "${t}"`),t==="hvc1"||t==="hev1"?"hvc1.1.6.L120.90":t==="av01"?"av01.0.04M.08":"avc1.42e01e"}let Pa;try{Pa=self.performance.now.bind(self.performance)}catch{Ee.debug("Unable to use Performance API on this environment"),Pa=ml==null?void 0:ml.Date.now}const Kd=[{demux:eL,remux:fL},{demux:so,remux:zd},{demux:JP,remux:zd},{demux:oL,remux:zd}];Kd.splice(2,0,{demux:tL,remux:zd});class my{constructor(e,t,n,i,s){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.vendor=i,this.id=s}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,i){const s=n.transmuxing;s.executeStart=Pa();let a=new Uint8Array(e);const{currentTransmuxState:c,transmuxConfig:o}=this;i&&(this.currentTransmuxState=i);const{contiguous:l,discontinuity:u,trackSwitch:h,accurateTimeOffset:f,timeOffset:g,initSegmentChange:p}=i||c,{audioCodec:d,videoCodec:m,defaultInitPts:E,duration:S,initSegmentData:R}=o,k=gL(a,t);if(k&&k.method==="AES-128"){const D=this.getDecrypter();if(D.isSync()){let b=D.softwareDecrypt(a,k.key.buffer,k.iv.buffer);if(n.part>-1&&(b=D.flush()),!b)return s.executeEnd=Pa(),ef(n);a=new Uint8Array(b)}else return this.decryptionPromise=D.webCryptoDecrypt(a,k.key.buffer,k.iv.buffer).then(b=>{const w=this.push(b,null,n);return this.decryptionPromise=null,w}),this.decryptionPromise}const C=this.needsProbing(u,h);if(C){const D=this.configureTransmuxer(a);if(D)return Ee.warn(`[transmuxer] ${D.message}`),this.observer.emit(H.ERROR,H.ERROR,{type:rr.MEDIA_ERROR,details:Me.FRAG_PARSING_ERROR,fatal:!1,error:D,reason:D.message}),s.executeEnd=Pa(),ef(n)}(u||h||p||C)&&this.resetInitSegment(R,d,m,S,t),(u||p||C)&&this.resetInitialTimestamp(E),l||this.resetContiguity();const x=this.transmux(a,k,g,f,n),P=this.currentTransmuxState;return P.contiguous=!0,P.discontinuity=!1,P.trackSwitch=!1,s.executeEnd=Pa(),x}flush(e){const t=e.transmuxing;t.executeStart=Pa();const{decrypter:n,currentTransmuxState:i,decryptionPromise:s}=this;if(s)return s.then(()=>this.flush(e));const a=[],{timeOffset:c}=i;if(n){const h=n.flush();h&&a.push(this.push(h,null,e))}const{demuxer:o,remuxer:l}=this;if(!o||!l)return t.executeEnd=Pa(),[ef(e)];const u=o.flush(c);return qd(u)?u.then(h=>(this.flushRemux(a,h,e),a)):(this.flushRemux(a,u,e),a)}flushRemux(e,t,n){const{audioTrack:i,videoTrack:s,id3Track:a,textTrack:c}=t,{accurateTimeOffset:o,timeOffset:l}=this.currentTransmuxState;Ee.log(`[transmuxer.ts]: Flushed fragment ${n.sn}${n.part>-1?" p: "+n.part:""} of level ${n.level}`);const u=this.remuxer.remux(i,s,a,c,l,o,!0,this.id);e.push({remuxResult:u,chunkMeta:n}),n.transmuxing.executeEnd=Pa()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,i,s){const{demuxer:a,remuxer:c}=this;!a||!c||(a.resetInitSegment(e,t,n,i),c.resetInitSegment(e,t,n,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,i,s){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,n,i,s):a=this.transmuxUnencrypted(e,n,i,s),a}transmuxUnencrypted(e,t,n,i){const{audioTrack:s,videoTrack:a,id3Track:c,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,a,c,o,t,n,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,n,i,s){return this.demuxer.demuxSampleAes(e,t,n).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,n,i,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:i,vendor:s}=this;let a;for(let f=0,g=Kd.length;f<g;f++){var c;if((c=Kd[f].demux)!=null&&c.probe(e)){a=Kd[f];break}}if(!a)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,l=this.remuxer,u=a.remux,h=a.demux;(!l||!(l instanceof u))&&(this.remuxer=new u(n,t,i,s)),(!o||!(o instanceof h))&&(this.demuxer=new h(n,t,i),this.probe=h.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new jg(this.config)),e}}function gL(r,e){let t=null;return r.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const ef=r=>({remuxResult:{},chunkMeta:r});function qd(r){return"then"in r&&r.then instanceof Function}class vL{constructor(e,t,n,i,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=i,this.defaultInitPts=s||null}}class yL{constructor(e,t,n,i,s,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=i,this.timeOffset=s,this.initSegmentChange=a}}var HS={exports:{}};(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(o,l,u){this.fn=o,this.context=l,this.once=u||!1}function s(o,l,u,h,f){if(typeof u!="function")throw new TypeError("The listener must be a function");var g=new i(u,h||o,f),p=t?t+l:l;return o._events[p]?o._events[p].fn?o._events[p]=[o._events[p],g]:o._events[p].push(g):(o._events[p]=g,o._eventsCount++),o}function a(o,l){--o._eventsCount===0?o._events=new n:delete o._events[l]}function c(){this._events=new n,this._eventsCount=0}c.prototype.eventNames=function(){var l=[],u,h;if(this._eventsCount===0)return l;for(h in u=this._events)e.call(u,h)&&l.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},c.prototype.listeners=function(l){var u=t?t+l:l,h=this._events[u];if(!h)return[];if(h.fn)return[h.fn];for(var f=0,g=h.length,p=new Array(g);f<g;f++)p[f]=h[f].fn;return p},c.prototype.listenerCount=function(l){var u=t?t+l:l,h=this._events[u];return h?h.fn?1:h.length:0},c.prototype.emit=function(l,u,h,f,g,p){var d=t?t+l:l;if(!this._events[d])return!1;var m=this._events[d],E=arguments.length,S,R;if(m.fn){switch(m.once&&this.removeListener(l,m.fn,void 0,!0),E){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,u),!0;case 3:return m.fn.call(m.context,u,h),!0;case 4:return m.fn.call(m.context,u,h,f),!0;case 5:return m.fn.call(m.context,u,h,f,g),!0;case 6:return m.fn.call(m.context,u,h,f,g,p),!0}for(R=1,S=new Array(E-1);R<E;R++)S[R-1]=arguments[R];m.fn.apply(m.context,S)}else{var k=m.length,C;for(R=0;R<k;R++)switch(m[R].once&&this.removeListener(l,m[R].fn,void 0,!0),E){case 1:m[R].fn.call(m[R].context);break;case 2:m[R].fn.call(m[R].context,u);break;case 3:m[R].fn.call(m[R].context,u,h);break;case 4:m[R].fn.call(m[R].context,u,h,f);break;default:if(!S)for(C=1,S=new Array(E-1);C<E;C++)S[C-1]=arguments[C];m[R].fn.apply(m[R].context,S)}}return!0},c.prototype.on=function(l,u,h){return s(this,l,u,h,!1)},c.prototype.once=function(l,u,h){return s(this,l,u,h,!0)},c.prototype.removeListener=function(l,u,h,f){var g=t?t+l:l;if(!this._events[g])return this;if(!u)return a(this,g),this;var p=this._events[g];if(p.fn)p.fn===u&&(!f||p.once)&&(!h||p.context===h)&&a(this,g);else{for(var d=0,m=[],E=p.length;d<E;d++)(p[d].fn!==u||f&&!p[d].once||h&&p[d].context!==h)&&m.push(p[d]);m.length?this._events[g]=m.length===1?m[0]:m:a(this,g)}return this},c.prototype.removeAllListeners=function(l){var u;return l?(u=t?t+l:l,this._events[u]&&a(this,u)):(this._events=new n,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,r.exports=c})(HS);var _L=HS.exports,Hg=Gk(_L);class WS{constructor(e,t,n,i){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=n,this.onFlush=i;const a=(u,h)=>{h=h||{},h.frag=this.frag,h.id=this.id,u===H.ERROR&&(this.error=h.error),this.hls.trigger(u,h)};this.observer=new Hg,this.observer.on(H.FRAG_DECRYPTED,a),this.observer.on(H.ERROR,a);const c=ac(s.preferManagedMediaSource)||{isTypeSupported:()=>!1},o={mpeg:c.isTypeSupported("audio/mpeg"),mp3:c.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:c.isTypeSupported('audio/mp4; codecs="ac-3"')},l=navigator.vendor;if(this.useWorker&&typeof Worker<"u"&&(s.workerPath||jP())){try{s.workerPath?(Ee.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=UP(s.workerPath)):(Ee.log(`injecting Web Worker for "${t}"`),this.workerContext=BP()),this.onwmsg=f=>this.onWorkerMessage(f);const{worker:h}=this.workerContext;h.addEventListener("message",this.onwmsg),h.onerror=f=>{const g=new Error(`${f.message}  (${f.filename}:${f.lineno})`);s.enableWorker=!1,Ee.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(H.ERROR,{type:rr.OTHER_ERROR,details:Me.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:g})},h.postMessage({cmd:"init",typeSupported:o,vendor:l,id:t,config:JSON.stringify(s)})}catch(h){Ee.warn(`Error setting up "${t}" Web Worker, fallback to inline`,h),this.resetWorker(),this.error=null,this.transmuxer=new my(this.observer,o,s,l,t)}return}this.transmuxer=new my(this.observer,o,s,l,t)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,n,i,s,a,c,o,l,u){var h,f;l.transmuxing.start=self.performance.now();const{transmuxer:g}=this,p=a?a.start:s.start,d=s.decryptdata,m=this.frag,E=!(m&&s.cc===m.cc),S=!(m&&l.level===m.level),R=m?l.sn-m.sn:-1,k=this.part?l.part-this.part.index:-1,C=R===0&&l.id>1&&l.id===(m==null?void 0:m.stats.chunkCount),x=!S&&(R===1||R===0&&(k===1||C&&k<=0)),P=self.performance.now();(S||R||s.stats.parsing.start===0)&&(s.stats.parsing.start=P),a&&(k||!x)&&(a.stats.parsing.start=P);const D=!(m&&((h=s.initSegment)==null?void 0:h.url)===((f=m.initSegment)==null?void 0:f.url)),b=new yL(E,x,o,S,p,D);if(!x||E||D){Ee.log(`[transmuxer-interface, ${s.type}]: Starting new transmux session for sn: ${l.sn} p: ${l.part} level: ${l.level} id: ${l.id}
        discontinuity: ${E}
        trackSwitch: ${S}
        contiguous: ${x}
        accurateTimeOffset: ${o}
        timeOffset: ${p}
        initSegmentChange: ${D}`);const w=new vL(n,i,t,c,u);this.configureTransmuxer(w)}if(this.frag=s,this.part=a,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:d,chunkMeta:l,state:b},e instanceof ArrayBuffer?[e]:[]);else if(g){const w=g.push(e,d,l,b);qd(w)?(g.async=!0,w.then(v=>{this.handleTransmuxComplete(v)}).catch(v=>{this.transmuxerError(v,l,"transmuxer-interface push error")})):(g.async=!1,this.handleTransmuxComplete(w))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let n=t.flush(e);qd(n)||t.async?(qd(n)||(n=Promise.resolve(n)),n.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")})):this.handleFlushResult(n,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(H.ERROR,{type:rr.MEDIA_ERROR,details:Me.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}onWorkerMessage(e){const t=e.data,n=this.hls;switch(t.event){case"init":{var i;const s=(i=this.workerContext)==null?void 0:i.objectURL;s&&self.URL.revokeObjectURL(s);break}case"transmuxComplete":{this.handleTransmuxComplete(t.data);break}case"flush":{this.onFlush(t.data);break}case"workerLog":Ee[t.data.logType]&&Ee[t.data.logType](t.data.message);break;default:{t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,n.trigger(t.event,t.data);break}}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}function zS(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(!vl(r[t].attrs,e[t].attrs))return!1;return!0}function vl(r,e,t){const n=r["STABLE-RENDITION-ID"];return n&&!t?n===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(i=>r[i]!==e[i])}function Sm(r,e){return e.label.toLowerCase()===r.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(r.lang||"").toLowerCase())}const gy=100;class bL extends Bg{constructor(e,t,n){super(e,t,n,"[audio-stream-controller]",Jt.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.LEVEL_LOADED,this.onLevelLoaded,this),e.on(H.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(H.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(H.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(H.ERROR,this.onError,this),e.on(H.BUFFER_RESET,this.onBufferReset,this),e.on(H.BUFFER_CREATED,this.onBufferCreated,this),e.on(H.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(H.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(H.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(H.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.LEVEL_LOADED,this.onLevelLoaded,this),e.off(H.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(H.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(H.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(H.ERROR,this.onError,this),e.off(H.BUFFER_RESET,this.onBufferReset,this),e.off(H.BUFFER_CREATED,this.onBufferCreated,this),e.off(H.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(H.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(H.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(H.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:n,initPTS:i,timescale:s}){if(n==="main"){const a=t.cc;this.initPTS[t.cc]={baseTime:i,timescale:s},this.log(`InitPTS for cc: ${a} found from main: ${i}`),this.videoTrackCC=a,this.state===ze.WAITING_INIT_PTS&&this.tick()}}startLoad(e){if(!this.levels){this.startPosition=e,this.state=ze.STOPPED;return}const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(gy),t>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=ze.IDLE):(this.loadedmetadata=!1,this.state=ze.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case ze.IDLE:this.doTickIdle();break;case ze.WAITING_TRACK:{var e;const{levels:n,trackId:i}=this,s=n==null||(e=n[i])==null?void 0:e.details;if(s){if(this.waitForCdnTuneIn(s))break;this.state=ze.WAITING_INIT_PTS}break}case ze.FRAG_LOADING_WAITING_RETRY:{var t;const n=performance.now(),i=this.retryDate;if(!i||n>=i||(t=this.media)!=null&&t.seeking){const{levels:s,trackId:a}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((s==null?void 0:s[a])||null),this.state=ze.IDLE}break}case ze.WAITING_INIT_PTS:{const n=this.waitingData;if(n){const{frag:i,part:s,cache:a,complete:c}=n;if(this.initPTS[i.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=ze.FRAG_LOADING;const o=a.flush(),l={frag:i,part:s,payload:o,networkDetails:null};this._handleFragmentLoadProgress(l),c&&super._handleFragmentLoadComplete(l)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${i.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const o=this.getLoadPosition(),l=nn.bufferInfo(this.mediaBuffer,o,this.config.maxBufferHole);_m(l.end,this.config.maxFragLookUpTolerance,i)<0&&(this.log(`Waiting fragment cc (${i.cc}) @ ${i.start} cancelled because another fragment at ${l.end} is needed`),this.clearWaitingFragment())}}else this.state=ze.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=ze.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:n,trackId:i}=this,s=e.config;if(!n&&(this.startFragRequested||!s.startFragPrefetch)||!(t!=null&&t[i]))return;const a=t[i],c=a.details;if(!c||c.live&&this.levelLastLoaded!==a||this.waitForCdnTuneIn(c)){this.state=ze.WAITING_TRACK;return}const o=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&o&&(this.bufferFlushed=!1,this.afterBufferFlushed(o,Gr.AUDIO,Jt.AUDIO));const l=this.getFwdBufferInfo(o,Jt.AUDIO);if(l===null)return;const{bufferedTrack:u,switchingTrack:h}=this;if(!h&&this._streamEnded(l,c)){e.trigger(H.BUFFER_EOS,{type:"audio"}),this.state=ze.ENDED;return}const f=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,Jt.MAIN),g=l.len,p=this.getMaxBufferLength(f==null?void 0:f.len),d=c.fragments,m=d[0].start;let E=this.flushing?this.getLoadPosition():l.end;if(h&&n){const C=this.getLoadPosition();u&&!vl(h.attrs,u.attrs)&&(E=C),c.PTSKnown&&C<m&&(l.end>m||l.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=m+.05)}if(g>=p&&!h&&E<d[d.length-1].start)return;let S=this.getNextFragment(E,c),R=!1;if(S&&this.isLoopLoading(S,E)&&(R=!!S.gap,S=this.getNextFragmentLoopLoading(S,c,l,Jt.MAIN,p)),!S){this.bufferFlushed=!0;return}const k=f&&S.start>f.end+c.targetduration;if(k||!(f!=null&&f.len)&&l.len){const C=this.getAppendedFrag(S.start,Jt.MAIN);if(C===null||(R||(R=!!C.gap||!!k&&f.len===0),k&&!R||R&&l.nextStart&&l.nextStart<C.end))return}this.loadFragment(S,a,E)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new gl(n))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),n?this.setInterval(gy):this.resetTransmuxer(),n?(this.switchingTrack=t,this.state=ze.IDLE,this.flushAudioIfNeeded(t)):(this.switchingTrack=null,this.bufferedTrack=t,this.state=ze.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(H.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var n;if(this.mainDetails==null){this.cachedTrackLoadedData=t;return}const{levels:i}=this,{details:s,id:a}=t;if(!i){this.warn(`Audio tracks were reset while loading level ${a}`);return}this.log(`Audio track ${a} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const c=i[a];let o=0;if(s.live||(n=c.details)!=null&&n.live){this.checkLiveUpdate(s);const u=this.mainDetails;if(s.deltaUpdateFailed||!u)return;if(!c.details&&s.hasProgramDateTime&&u.hasProgramDateTime)Oh(s,u),o=s.fragments[0].start;else{var l;o=this.alignPlaylists(s,c.details,(l=this.levelLastLoaded)==null?void 0:l.details)}}c.details=s,this.levelLastLoaded=c,!this.startFragRequested&&(this.mainDetails||!s.live)&&this.setStartPosition(this.mainDetails||s,o),this.state===ze.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=ze.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:n,part:i,payload:s}=e,{config:a,trackId:c,levels:o}=this;if(!o){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const l=o[c];if(!l){this.warn("Audio track is undefined on fragment load progress");return}const u=l.details;if(!u){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const h=a.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new WS(this.hls,Jt.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const g=this.initPTS[n.cc],p=(t=n.initSegment)==null?void 0:t.data;if(g!==void 0){const m=i?i.index:-1,E=m!==-1,S=new Fg(n.level,n.sn,n.stats.chunkCount,s.byteLength,m,E);f.push(s,p,h,"",n,i,u.totalduration,!1,S,g)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${u.startSN} ,${u.endSN}],track ${c}`);const{cache:d}=this.waitingData=this.waitingData||{frag:n,part:i,cache:new PS,complete:!1};d.push(new Uint8Array(s)),this.waitingVideoCC=this.videoTrackCC,this.state=ze.WAITING_INIT_PTS}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:n,part:i}=t;if(n.type!==Jt.AUDIO){if(!this.loadedmetadata&&n.type===Jt.MAIN){const s=this.videoBuffer||this.media;s&&nn.getBuffered(s).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(n.sn!=="initSegment"){this.fragPrevious=n;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(H.AUDIO_TRACK_SWITCHED,gi({},s)))}this.fragBufferedComplete(n,i)}onError(e,t){var n;if(t.fatal){this.state=ze.ERROR;return}switch(t.details){case Me.FRAG_GAP:case Me.FRAG_PARSING_ERROR:case Me.FRAG_DECRYPT_ERROR:case Me.FRAG_LOAD_ERROR:case Me.FRAG_LOAD_TIMEOUT:case Me.KEY_LOAD_ERROR:case Me.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Jt.AUDIO,t);break;case Me.AUDIO_TRACK_LOAD_ERROR:case Me.AUDIO_TRACK_LOAD_TIMEOUT:case Me.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ze.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===Dr.AUDIO_TRACK&&(this.state=ze.IDLE);break;case Me.BUFFER_APPEND_ERROR:case Me.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="audio")return;if(t.details===Me.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Me.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Gr.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Gr.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ze.ENDED&&(this.state=ze.IDLE);const n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,t,Jt.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:i}=this,{remuxResult:s,chunkMeta:a}=e,c=this.getCurrentContext(a);if(!c){this.resetWhenMissingContext(a);return}const{frag:o,part:l,level:u}=c,{details:h}=u,{audio:f,text:g,id3:p,initSegment:d}=s;if(this.fragContextChanged(o)||!h){this.fragmentTracker.removeFragment(o);return}if(this.state=ze.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),d!=null&&d.tracks){const m=o.initSegment||o;this._bufferInitSegment(u,d.tracks,m,a),i.trigger(H.FRAG_PARSING_INIT_SEGMENT,{frag:m,id:n,tracks:d.tracks})}if(f){const{startPTS:m,endPTS:E,startDTS:S,endDTS:R}=f;l&&(l.elementaryStreams[Gr.AUDIO]={startPTS:m,endPTS:E,startDTS:S,endDTS:R}),o.setElementaryStreamInfo(Gr.AUDIO,m,E,S,R),this.bufferFragmentData(f,o,l,a)}if(p!=null&&(t=p.samples)!=null&&t.length){const m=Xn({id:n,frag:o,details:h},p);i.trigger(H.FRAG_PARSING_METADATA,m)}if(g){const m=Xn({id:n,frag:o,details:h},g);i.trigger(H.FRAG_PARSING_USERDATA,m)}}_bufferInitSegment(e,t,n,i){if(this.state!==ze.PARSING)return;t.video&&delete t.video;const s=t.audio;if(!s)return;s.id="audio";const a=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${a}/${s.codec}]`),a&&a.split(",").length===1&&(s.levelCodec=a),this.hls.trigger(H.BUFFER_CODECS,t);const c=s.initSegment;if(c!=null&&c.byteLength){const o={type:"audio",frag:n,part:null,chunkMeta:i,parent:n.type,data:c};this.hls.trigger(H.BUFFER_APPENDING,o)}this.tickImmediate()}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);if(this.fragCurrent=e,this.switchingTrack||i===fi.NOT_LOADED||i===fi.PARTIAL){var s;if(e.sn==="initSegment")this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ze.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragments[0].start!==t.details.fragments[0].start&&Oh(t.details,a)}else this.startFragRequested=!0,super.loadFragment(e,t,n)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){const{media:t,bufferedTrack:n}=this,i=n==null?void 0:n.attrs,s=e.attrs;t&&i&&(i.CHANNELS!==s.CHANNELS||n.name!==e.name||n.lang!==e.lang)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(H.AUDIO_TRACK_SWITCHED,gi({},e))}}class SL extends Ng{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.MANIFEST_PARSED,this.onManifestParsed,this),e.on(H.LEVEL_LOADING,this.onLevelLoading,this),e.on(H.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(H.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(H.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.MANIFEST_PARSED,this.onManifestParsed,this),e.off(H.LEVEL_LOADING,this.onLevelLoading,this),e.off(H.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(H.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(H.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:i,details:s}=t,a=this.tracksInGroup[n];if(!a||a.groupId!==i){this.warn(`Audio track with id:${n} and group:${i} not found in active group ${a==null?void 0:a.groupId}`);return}const c=a.details;a.details=t.details,this.log(`Audio track ${n} "${a.name}" lang:${a.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,i=this.groupIds;let s=this.currentTrack;if(!n||(i==null?void 0:i.length)!==(n==null?void 0:n.length)||n!=null&&n.some(c=>(i==null?void 0:i.indexOf(c))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const c=this.tracks.filter(f=>!n||n.indexOf(f.groupId)!==-1);if(c.length)this.selectDefaultTrack&&!c.some(f=>f.default)&&(this.selectDefaultTrack=!1),c.forEach((f,g)=>{f.id=g});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=c;const o=this.hls.config.audioPreference;if(!s&&o){const f=la(o,c,Dc);if(f>-1)s=c[f];else{const g=la(o,this.tracks);s=this.tracks[g]}}let l=this.findTrackId(s);l===-1&&s&&(l=this.findTrackId(null));const u={audioTracks:c};this.log(`Updating audio tracks, ${c.length} track(s) found in group(s): ${n==null?void 0:n.join(",")}`),this.hls.trigger(H.AUDIO_TRACKS_UPDATED,u);const h=this.trackId;if(l!==-1&&h===-1)this.setAudioTrack(l);else if(c.length&&h===-1){var a;const f=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${c.length}`);this.warn(f.message),this.hls.trigger(H.ERROR,{type:rr.MEDIA_ERROR,details:Me.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}else this.shouldReloadPlaylist(s)&&this.setAudioTrack(this.trackId)}onError(e,t){t.fatal||!t.context||t.context.type===Dr.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&(this.requestScheduled=-1,this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const i=this.currentTrack;if(i&&il(e,i,Dc))return i;const s=la(e,this.tracksInGroup,Dc);if(s>-1){const a=this.tracksInGroup[s];return this.setAudioTrack(s),a}else if(i){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const c=SP(e,t.levels,n,a,Dc);if(c===-1)return null;t.nextLoadLevel=c}if(e.channels||e.audioCodec){const a=la(e,n);if(a>-1)return n[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const n=this.currentTrack,i=t[e],s=i.details&&!i.details.live;if(e===this.trackId&&i===n&&s||(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(H.AUDIO_TRACK_SWITCHING,gi({},i)),s))return;const a=this.switchParams(i.url,n==null?void 0:n.details,i.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const i=t[n];if(!(this.selectDefaultTrack&&!i.default)&&(!e||il(e,i,Dc)))return n}if(e){const{name:n,lang:i,assocLang:s,characteristics:a,audioCodec:c,channels:o}=e;for(let l=0;l<t.length;l++){const u=t[l];if(il({name:n,lang:i,assocLang:s,characteristics:a,audioCodec:c,channels:o},u,Dc))return l}for(let l=0;l<t.length;l++){const u=t[l];if(vl(e.attrs,u.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return l}for(let l=0;l<t.length;l++){const u=t[l];if(vl(e.attrs,u.attrs,["LANGUAGE"]))return l}}return-1}loadPlaylist(e){const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){super.loadPlaylist();const n=t.id,i=t.groupId;let s=t.url;if(e)try{s=e.addDirectives(s)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}this.log(`loading audio-track playlist ${n} "${t.name}" lang:${t.lang} group:${i}`),this.clearTimer(),this.hls.trigger(H.AUDIO_TRACK_LOADING,{url:s,id:n,groupId:i,deliveryDirectives:e||null})}}}const vy=500;class wL extends Bg{constructor(e,t,n){super(e,t,n,"[subtitle-stream-controller]",Jt.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.LEVEL_LOADED,this.onLevelLoaded,this),e.on(H.ERROR,this.onError,this),e.on(H.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(H.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(H.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(H.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(H.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(H.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.LEVEL_LOADED,this.onLevelLoaded,this),e.off(H.ERROR,this.onError,this),e.off(H.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(H.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(H.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(H.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(H.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(H.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=ze.IDLE,this.setInterval(vy),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:i}=t;if(this.fragPrevious=n,this.state=ze.IDLE,!i)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let a;const c=n.start;for(let l=0;l<s.length;l++)if(c>=s[l].start&&c<=s[l].end){a=s[l];break}const o=n.start+n.duration;a?a.end=o:(a={start:c,end:o},s.push(a)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null)}onBufferFlushing(e,t){const{startOffset:n,endOffset:i}=t;if(n===0&&i!==Number.POSITIVE_INFINITY){const s=i-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(a=>{for(let c=0;c<a.length;){if(a[c].end<=s){a.shift();continue}else if(a[c].start<s)a[c].start=s;else break;c++}}),this.fragmentTracker.removeFragmentsInRange(n,s,Jt.SUBTITLE)}}onFragBuffered(e,t){if(!this.loadedmetadata&&t.frag.type===Jt.MAIN){var n;(n=this.media)!=null&&n.buffered.length&&(this.loadedmetadata=!0)}}onError(e,t){const n=t.frag;(n==null?void 0:n.type)===Jt.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ze.STOPPED&&(this.state=ze.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&zS(this.levels,t)){this.levels=t.map(n=>new gl(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{const i=new gl(n);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Jt.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,!((n=this.levels)!=null&&n.length)||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(vy)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:i,levels:s}=this,{details:a,id:c}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${c}`);return}const o=s[i];if(c>=s.length||c!==i||!o)return;this.log(`Subtitle track ${c} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(a.live||(n=o.details)!=null&&n.live){const h=this.mainDetails;if(a.deltaUpdateFailed||!h)return;const f=h.fragments[0];if(!o.details)a.hasProgramDateTime&&h.hasProgramDateTime?(Oh(a,h),l=a.fragments[0].start):f&&(l=f.start,ym(a,l));else{var u;l=this.alignPlaylists(a,o.details,(u=this.levelLastLoaded)==null?void 0:u.details),l===0&&f&&(l=f.start,ym(a,l))}}o.details=a,this.levelLastLoaded=o,!this.startFragRequested&&(this.mainDetails||!a.live)&&this.setStartPosition(this.mainDetails||a,l),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===ze.IDLE&&(Ah(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,i=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&i!=null&&i.key&&i.iv&&i.method==="AES-128"){const a=performance.now();this.decrypter.decrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer).catch(c=>{throw s.trigger(H.ERROR,{type:rr.MEDIA_ERROR,details:Me.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:t}),c}).then(c=>{const o=performance.now();s.trigger(H.FRAG_DECRYPTED,{frag:t,payload:c,stats:{tstart:a,tdecrypt:o}})}).catch(c=>{this.warn(`${c.name}: ${c.message}`),this.state=ze.IDLE})}}doTick(){if(!this.media){this.state=ze.IDLE;return}if(this.state===ze.IDLE){const{currentTrackId:e,levels:t}=this,n=t==null?void 0:t[e];if(!n||!t.length||!n.details)return;const{config:i}=this,s=this.getLoadPosition(),a=nn.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,i.maxBufferHole),{end:c,len:o}=a,l=this.getFwdBufferInfo(this.media,Jt.MAIN),u=n.details,h=this.getMaxBufferLength(l==null?void 0:l.len)+u.levelTargetDuration;if(o>h)return;const f=u.fragments,g=f.length,p=u.edge;let d=null;const m=this.fragPrevious;if(c<p){const E=i.maxFragLookUpTolerance,S=c>p-E?0:E;d=Ah(m,f,Math.max(f[0].start,c),S),!d&&m&&m.start<f[0].start&&(d=f[0])}else d=f[g-1];if(!d)return;if(d=this.mapToInitFragWhenRequired(d),d.sn!=="initSegment"){const E=d.sn-u.startSN,S=f[E-1];S&&S.cc===d.cc&&this.fragmentTracker.getState(S)===fi.NOT_LOADED&&(d=S)}this.fragmentTracker.getState(d)===fi.NOT_LOADED&&this.loadFragment(d,n,c)}}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,n){this.fragCurrent=e,e.sn==="initSegment"?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,n))}get mediaBufferTimeRanges(){return new EL(this.tracksBuffered[this.currentTrackId]||[])}}class EL{constructor(e){this.buffered=void 0;const t=(n,i,s)=>{if(i=i>>>0,i>s-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${s})`);return e[i][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}class RL extends Ng{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const n=Gd(this.media.textTracks);for(let s=0;s<n.length;s++)if(n[s].mode==="hidden")t=n[s];else if(n[s].mode==="showing"){t=n[s];break}const i=this.findTrackForTextTrack(t);this.subtitleTrack!==i&&this.setSubtitleTrack(i)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.MANIFEST_PARSED,this.onManifestParsed,this),e.on(H.LEVEL_LOADING,this.onLevelLoading,this),e.on(H.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(H.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(H.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.MANIFEST_PARSED,this.onManifestParsed,this),e.off(H.LEVEL_LOADING,this.onLevelLoading,this),e.off(H.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(H.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(H.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),Gd(this.media.textTracks).forEach(t=>{Qc(t)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:i,details:s}=t,a=this.tracksInGroup[n];if(!a||a.groupId!==i){this.warn(`Subtitle track with id:${n} and group:${i} not found in active group ${a==null?void 0:a.groupId}`);return}const c=a.details;a.details=t.details,this.log(`Subtitle track ${n} "${a.name}" lang:${a.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,i=this.groupIds;let s=this.currentTrack;if(!n||(i==null?void 0:i.length)!==(n==null?void 0:n.length)||n!=null&&n.some(a=>(i==null?void 0:i.indexOf(a))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(u=>!n||n.indexOf(u.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(u=>u.default)&&(this.selectDefaultTrack=!1),a.forEach((u,h)=>{u.id=h});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const c=this.hls.config.subtitlePreference;if(!s&&c){this.selectDefaultTrack=!1;const u=la(c,a);if(u>-1)s=a[u];else{const h=la(c,this.tracks);s=this.tracks[h]}}let o=this.findTrackId(s);o===-1&&s&&(o=this.findTrackId(null));const l={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${n==null?void 0:n.join(",")}" group-id`),this.hls.trigger(H.SUBTITLE_TRACKS_UPDATED,l),o!==-1&&this.trackId===-1&&this.setSubtitleTrack(o)}else this.shouldReloadPlaylist(s)&&this.setSubtitleTrack(this.trackId)}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const s=t[i];if(!(n&&!s.default||!n&&!e)&&(!e||il(s,e)))return i}if(e){for(let i=0;i<t.length;i++){const s=t[i];if(vl(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){const s=t[i];if(vl(e.attrs,s.attrs,["LANGUAGE"]))return i}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const i=t[n];if(Sm(i,e))return n}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Dr.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&il(e,n))return n;const i=la(e,this.tracksInGroup);if(i>-1){const s=this.tracksInGroup[i];return this.setSubtitleTrack(i),s}else{if(n)return null;{const s=la(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){const n=t.id,i=t.groupId;let s=t.url;if(e)try{s=e.addDirectives(s)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}this.log(`Loading subtitle playlist for id ${n}`),this.hls.trigger(H.SUBTITLE_TRACK_LOADING,{url:s,id:n,groupId:i,deliveryDirectives:e||null})}}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Gd(e.textTracks),n=this.currentTrack;let i;if(n&&(i=t.filter(s=>Sm(n,s))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==i&&(s.mode="disabled")}),i){const s=this.subtitleDisplay?"showing":"hidden";i.mode!==s&&(i.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Pt(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const n=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i){this.hls.trigger(H.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!i.details&&!i.details.live;if(e===this.trackId&&i===n&&s)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:a,groupId:c="",name:o,type:l,url:u}=i;this.hls.trigger(H.SUBTITLE_TRACK_SWITCH,{id:a,groupId:c,name:o,type:l,url:u});const h=this.switchParams(i.url,n==null?void 0:n.details,i.details);this.loadPlaylist(h)}}class TL{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t,n){const i=this.queues[t];i.push(e),i.length===1&&!n&&this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;const n=new Promise(s=>{t=s}),i={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(i,e),n}executeNext(e){const t=this.queues[e];if(t.length){const n=t[0];try{n.execute()}catch(i){Ee.warn(`[buffer-operation-queue]: Exception executing "${e}" SourceBuffer operation: ${i}`),n.onError(i);const s=this.buffers[e];s!=null&&s.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const yy=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;class xL{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=n=>{this.hls&&this.hls.pauseBuffering()},this._onStartStreaming=n=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{const{media:n,mediaSource:i}=this;this.log("Media source opened"),n&&(n.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(H.MEDIA_ATTACHED,{media:n,mediaSource:i})),i&&i.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:n,_objectUrl:i}=this;n!==i&&Ee.error(`Media element src was set while attaching MediaSource (${i} > ${n})`)},this.hls=e;const t="[buffer-controller]";this.appendSource=NC(ac(e.config.preferManagedMediaSource)),this.log=Ee.log.bind(Ee,t),this.warn=Ee.warn.bind(Ee,t),this.error=Ee.error.bind(Ee,t),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){const{hls:e}=this;e.on(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.MANIFEST_PARSED,this.onManifestParsed,this),e.on(H.BUFFER_RESET,this.onBufferReset,this),e.on(H.BUFFER_APPENDING,this.onBufferAppending,this),e.on(H.BUFFER_CODECS,this.onBufferCodecs,this),e.on(H.BUFFER_EOS,this.onBufferEos,this),e.on(H.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(H.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(H.FRAG_PARSED,this.onFragParsed,this),e.on(H.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.MANIFEST_PARSED,this.onManifestParsed,this),e.off(H.BUFFER_RESET,this.onBufferReset,this),e.off(H.BUFFER_APPENDING,this.onBufferAppending,this),e.off(H.BUFFER_CODECS,this.onBufferCodecs,this),e.off(H.BUFFER_EOS,this.onBufferEos,this),e.off(H.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(H.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(H.FRAG_PARSED,this.onFragParsed,this),e.off(H.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new TL(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let n=2;(t.audio&&!t.video||!t.altAudio)&&(n=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=n,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const n=this.media=t.media,i=ac(this.appendSource);if(n&&i){var s;const a=this.mediaSource=new i;this.log(`created media source: ${(s=a.constructor)==null?void 0:s.name}`),a.addEventListener("sourceopen",this._onMediaSourceOpen),a.addEventListener("sourceended",this._onMediaSourceEnded),a.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(a.addEventListener("startstreaming",this._onStartStreaming),a.addEventListener("endstreaming",this._onEndStreaming));const c=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{n.removeAttribute("src");const o=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||o&&a instanceof o,_y(n),kL(n,c),n.load()}catch{n.src=c}else n.src=c;n.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:n}=this;if(t){if(this.log("media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(i){this.warn(`onMediaDetaching: ${i.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.removeEventListener("startstreaming",this._onStartStreaming),t.removeEventListener("endstreaming",this._onEndStreaming)),e&&(e.removeEventListener("emptied",this._onMediaEmptied),n&&self.URL.revokeObjectURL(n),this.mediaSrc===n?(e.removeAttribute("src"),this.appendSource&&_y(e),e.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(H.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{this.resetBuffer(e)}),this._initSourceBuffer()}resetBuffer(e){const t=this.sourceBuffer[e];try{if(t){var n;this.removeBufferListeners(e),this.sourceBuffer[e]=void 0,(n=this.mediaSource)!=null&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(t)}}catch(i){this.warn(`onBufferReset ${e}`,i)}}onBufferCodecs(e,t){const n=this.getSourceBufferTypes().length,i=Object.keys(t);if(i.forEach(a=>{if(n){const o=this.tracks[a];if(o&&typeof o.buffer.changeType=="function"){var c;const{id:l,codec:u,levelCodec:h,container:f,metadata:g}=t[a],p=Uv(o.codec,o.levelCodec),d=p==null?void 0:p.replace(yy,"$1");let m=Uv(u,h);const E=(c=m)==null?void 0:c.replace(yy,"$1");if(m&&d!==E){a.slice(0,5)==="audio"&&(m=Ph(m,this.appendSource));const S=`${f};codecs=${m}`;this.appendChangeType(a,S),this.log(`switching codec ${p} to ${m}`),this.tracks[a]={buffer:o.buffer,codec:u,container:f,levelCodec:h,metadata:g,id:l}}}}else this.pendingTracks[a]=t[a]}),n)return;const s=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==s&&(this.log(`${s} bufferCodec event(s) expected ${i.join(",")}`),this.bufferCodecEventsExpected=s),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks()}appendChangeType(e,t){const{operationQueue:n}=this,i={execute:()=>{const s=this.sourceBuffer[e];s&&(this.log(`changing ${e} sourceBuffer type to ${t}`),s.changeType(t)),n.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:s=>{this.warn(`Failed to change ${e} SourceBuffer type`,s)}};n.append(i,e,!!this.pendingTracks[e])}onBufferAppending(e,t){const{hls:n,operationQueue:i,tracks:s}=this,{data:a,type:c,frag:o,part:l,chunkMeta:u}=t,h=u.buffering[c],f=self.performance.now();h.start=f;const g=o.stats.buffering,p=l?l.stats.buffering:null;g.start===0&&(g.start=f),p&&p.start===0&&(p.start=f);const d=s.audio;let m=!1;c==="audio"&&(d==null?void 0:d.container)==="audio/mpeg"&&(m=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const E=o.start,S={execute:()=>{if(h.executeStart=self.performance.now(),m){const R=this.sourceBuffer[c];if(R){const k=E-R.timestampOffset;Math.abs(k)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${E} (delta: ${k}) sn: ${o.sn})`),R.timestampOffset=E)}}this.appendExecutor(a,c)},onStart:()=>{},onComplete:()=>{const R=self.performance.now();h.executeEnd=h.end=R,g.first===0&&(g.first=R),p&&p.first===0&&(p.first=R);const{sourceBuffer:k}=this,C={};for(const x in k)C[x]=nn.getBuffered(k[x]);this.appendErrors[c]=0,c==="audio"||c==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(H.BUFFER_APPENDED,{type:c,frag:o,part:l,chunkMeta:u,parent:o.type,timeRanges:C})},onError:R=>{const k={type:rr.MEDIA_ERROR,parent:o.type,details:Me.BUFFER_APPEND_ERROR,sourceBufferName:c,frag:o,part:l,chunkMeta:u,error:R,err:R,fatal:!1};if(R.code===DOMException.QUOTA_EXCEEDED_ERR)k.details=Me.BUFFER_FULL_ERROR;else{const C=++this.appendErrors[c];k.details=Me.BUFFER_APPEND_ERROR,this.warn(`Failed ${C}/${n.config.appendErrorMaxRetry} times to append segment in "${c}" sourceBuffer`),C>=n.config.appendErrorMaxRetry&&(k.fatal=!0)}n.trigger(H.ERROR,k)}};i.append(S,c,!!this.pendingTracks[c])}onBufferFlushing(e,t){const{operationQueue:n}=this,i=s=>({execute:this.removeExecutor.bind(this,s,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(H.BUFFER_FLUSHED,{type:s})},onError:a=>{this.warn(`Failed to remove from ${s} SourceBuffer`,a)}});t.type?n.append(i(t.type),t.type):this.getSourceBufferTypes().forEach(s=>{n.append(i(s),s)})}onFragParsed(e,t){const{frag:n,part:i}=t,s=[],a=i?i.elementaryStreams:n.elementaryStreams;a[Gr.AUDIOVIDEO]?s.push("audiovideo"):(a[Gr.AUDIO]&&s.push("audio"),a[Gr.VIDEO]&&s.push("video"));const c=()=>{const o=self.performance.now();n.stats.buffering.end=o,i&&(i.stats.buffering.end=o);const l=i?i.stats:n.stats;this.hls.trigger(H.FRAG_BUFFERED,{frag:n,part:i,stats:l,id:n.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(c,s)}onFragChanged(e,t){this.trimBuffers()}onBufferEos(e,t){this.getSourceBufferTypes().reduce((i,s)=>{const a=this.sourceBuffer[s];return a&&(!t.type||t.type===s)&&(a.ending=!0,a.ended||(a.ended=!0,this.log(`${s} sourceBuffer now EOS`))),i&&!!(!a||a.ended)},!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(s=>{const a=this.sourceBuffer[s];a&&(a.ending=!1)});const{mediaSource:i}=this;if(!i||i.readyState!=="open"){i&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${i.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),i.endOfStream()}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||t===null||!this.getSourceBufferTypes().length)return;const s=e.config,a=n.currentTime,c=t.levelTargetDuration,o=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(Pt(o)&&o>0){const l=Math.max(o,c),u=Math.floor(a/c)*c-l;this.flushBackBuffer(a,c,u)}if(Pt(s.frontBufferFlushThreshold)&&s.frontBufferFlushThreshold>0){const l=Math.max(s.maxBufferLength,s.frontBufferFlushThreshold),u=Math.max(l,c),h=Math.floor(a/c)*c+u;this.flushFrontBuffer(a,c,h)}}flushBackBuffer(e,t,n){const{details:i,sourceBuffer:s}=this;this.getSourceBufferTypes().forEach(c=>{const o=s[c];if(o){const l=nn.getBuffered(o);if(l.length>0&&n>l.start(0)){if(this.hls.trigger(H.BACK_BUFFER_REACHED,{bufferEnd:n}),i!=null&&i.live)this.hls.trigger(H.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(o.ended&&l.end(l.length-1)-e<t*2){this.log(`Cannot flush ${c} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(H.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:c})}}})}flushFrontBuffer(e,t,n){const{sourceBuffer:i}=this;this.getSourceBufferTypes().forEach(a=>{const c=i[a];if(c){const o=nn.getBuffered(c),l=o.length;if(l<2)return;const u=o.start(l-1),h=o.end(l-1);if(n>u||e>=u&&e<=h)return;if(c.ended&&e-h<2*t){this.log(`Cannot flush ${a} front buffer while SourceBuffer is in ended state`);return}this.hls.trigger(H.BUFFER_FLUSHING,{startOffset:u,endOffset:1/0,type:a})}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:e,hls:t,media:n,mediaSource:i}=this,s=e.fragments[0].start+e.totalduration,a=n.duration,c=Pt(i.duration)?i.duration:0;e.live&&t.config.liveDurationInfinity?(i.duration=1/0,this.updateSeekableRange(e)):(s>c&&s>a||!Pt(a))&&(this.log(`Updating Media Source duration to ${s.toFixed(3)}`),i.duration=s)}updateSeekableRange(e){const t=this.mediaSource,n=e.fragments;if(n.length&&e.live&&t!=null&&t.setLiveSeekableRange){const s=Math.max(0,n[0].start),a=Math.max(s,s+e.totalduration);this.log(`Media Source duration is set to ${t.duration}. Setting seekable range to ${s}-${a}.`),t.setLiveSeekableRange(s,a)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:n}=this,i=Object.keys(n).length;if(i&&(!e||i===2||"audiovideo"in n)){this.createSourceBuffers(n),this.pendingTracks={};const s=this.getSourceBufferTypes();if(s.length)this.hls.trigger(H.BUFFER_CREATED,{tracks:this.tracks}),s.forEach(a=>{t.executeNext(a)});else{const a=new Error("could not create source buffer for media codec(s)");this.hls.trigger(H.ERROR,{type:rr.MEDIA_ERROR,details:Me.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:a,reason:a.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:n}=this;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(const s in e)if(!t[s]){var i;const a=e[s];if(!a)throw Error(`source buffer exists for track ${s}, however track does not`);let c=((i=a.levelCodec)==null?void 0:i.indexOf(","))===-1?a.levelCodec:a.codec;c&&s.slice(0,5)==="audio"&&(c=Ph(c,this.appendSource));const o=`${a.container};codecs=${c}`;this.log(`creating sourceBuffer(${o})`);try{const l=t[s]=n.addSourceBuffer(o),u=s;this.addBufferListener(u,"updatestart",this._onSBUpdateStart),this.addBufferListener(u,"updateend",this._onSBUpdateEnd),this.addBufferListener(u,"error",this._onSBUpdateError),this.appendSource&&this.addBufferListener(u,"bufferedchange",(h,f)=>{const g=f.removedRanges;g!=null&&g.length&&this.hls.trigger(H.BUFFER_FLUSHED,{type:s})}),this.tracks[s]={buffer:l,codec:c,container:a.container,levelCodec:a.levelCodec,metadata:a.metadata,id:a.id}}catch(l){this.error(`error while trying to add sourceBuffer: ${l.message}`),this.hls.trigger(H.ERROR,{type:rr.MEDIA_ERROR,details:Me.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:l,sourceBufferName:s,mimeType:o})}}}get mediaSrc(){var e;const t=((e=this.media)==null?void 0:e.firstChild)||this.media;return t==null?void 0:t.src}_onSBUpdateStart(e){const{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const{operationQueue:n}=this;n.current(e).onComplete(),n.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){var n;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(n=this.mediaSource)==null?void 0:n.readyState}`);this.error(`${i}`,t),this.hls.trigger(H.ERROR,{type:rr.MEDIA_ERROR,details:Me.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const s=this.operationQueue.current(e);s&&s.onError(i)}removeExecutor(e,t,n){const{media:i,mediaSource:s,operationQueue:a,sourceBuffer:c}=this,o=c[e];if(!i||!s||!o){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),a.shiftAndExecuteNext(e);return}const l=Pt(i.duration)?i.duration:1/0,u=Pt(s.duration)?s.duration:1/0,h=Math.max(0,t),f=Math.min(n,l,u);f>h&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${h},${f}] from the ${e} SourceBuffer`),o.remove(h,f)):a.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.sourceBuffer[t];if(!n){if(!this.pendingTracks[t])throw new Error(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);return}n.ended=!1,n.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}const{operationQueue:n}=this,i=t.map(s=>n.appendBlocker(s));Promise.all(i).then(()=>{e(),t.forEach(s=>{const a=this.sourceBuffer[s];a!=null&&a.updating||n.shiftAndExecuteNext(s)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,n){const i=this.sourceBuffer[e];if(!i)return;const s=n.bind(this,e);this.listeners[e].push({event:t,listener:s}),i.addEventListener(t,s)}removeBufferListeners(e){const t=this.sourceBuffer[e];t&&this.listeners[e].forEach(n=>{t.removeEventListener(n.event,n.listener)})}}function _y(r){const e=r.querySelectorAll("source");[].slice.call(e).forEach(t=>{r.removeChild(t)})}function kL(r,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,r.appendChild(t)}const by={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},KS=function(e){let t=e;return by.hasOwnProperty(e)&&(t=by[e]),String.fromCharCode(t)},Vs=15,xa=100,CL={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},PL={17:2,18:4,21:6,22:8,23:10,19:13,20:15},LL={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},DL={25:2,26:4,29:6,30:8,31:10,27:13,28:15},IL=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class AL{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n=typeof t=="function"?t():t;Ee.log(`${this.time} [${e}] ${n}`)}}}const Ho=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class qS{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const i=t[n];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class OL{constructor(){this.uchar=" ",this.penState=new qS}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class ML{constructor(e){this.chars=[],this.pos=0,this.currPenState=new qS,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<xa;t++)this.chars.push(new OL);this.logger=e}equals(e){for(let t=0;t<xa;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<xa;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<xa;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>xa&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=xa)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=KS(e);if(this.pos>=xa){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<xa;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<xa;n++){const i=this.chars[n].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class tf{constructor(e){this.rows=[],this.currRow=Vs-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Vs;t++)this.rows.push(new ML(e));this.logger=e}reset(){for(let e=0;e<Vs;e++)this.rows[e].clear();this.currRow=Vs-1}equals(e){let t=!0;for(let n=0;n<Vs;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<Vs;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Vs;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let c=0;c<Vs;c++)this.rows[c].clear();const s=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const c=a.rows[s].cueStartTime,o=this.logger.time;if(c!==null&&o!==null&&c<o)for(let l=0;l<this.nrRollUpRows;l++)this.rows[t-this.nrRollUpRows+l+1].copy(a.rows[s+l])}}this.currRow=t;const n=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,a=Math.max(s-1,0);n.setCursor(e.indent),e.color=n.chars[a].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",i=-1;for(let s=0;s<Vs;s++){const a=this.rows[s].getTextString();a&&(i=s+1,e?t.push("Row "+i+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}}class Sy{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new tf(n),this.nonDisplayedMemory=new tf(n),this.lastOutputScreen=new tf(n),this.currRollUpRow=this.displayedMemory.rows[Vs-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Vs-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[n]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class wy{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=Ry(),this.logger=void 0;const i=this.logger=new AL;this.channels=[null,new Sy(e,t,i),new Sy(e+1,n,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){let n,i,s,a=!1;this.logger.time=e;for(let c=0;c<t.length;c+=2)if(i=t[c]&127,s=t[c+1]&127,!(i===0&&s===0)){if(this.logger.log(3,"["+Ho([t[c],t[c+1]])+"] -> ("+Ho([i,s])+")"),n=this.parseCmd(i,s),n||(n=this.parseMidrow(i,s)),n||(n=this.parsePAC(i,s)),n||(n=this.parseBackgroundAttributes(i,s)),!n&&(a=this.parseChars(i,s),a)){const o=this.currentChannel;o&&o>0?this.channels[o].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!n&&!a&&this.logger.log(2,"Couldn't parse cleaned data "+Ho([i,s])+" orig: "+Ho([t[c],t[c+1]]))}}parseCmd(e,t){const{cmdHistory:n}=this,i=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(i||s))return!1;if(Ey(e,t,n))return Mc(null,null,n),this.logger.log(3,"Repeated command ("+Ho([e,t])+") is dropped"),!0;const a=e===20||e===21||e===23?1:2,c=this.channels[a];return e===20||e===21||e===28||e===29?t===32?c.ccRCL():t===33?c.ccBS():t===34?c.ccAOF():t===35?c.ccAON():t===36?c.ccDER():t===37?c.ccRU(2):t===38?c.ccRU(3):t===39?c.ccRU(4):t===40?c.ccFON():t===41?c.ccRDC():t===42?c.ccTR():t===43?c.ccRTD():t===44?c.ccEDM():t===45?c.ccCR():t===46?c.ccENM():t===47&&c.ccEOC():c.ccTO(t-32),Mc(e,t,n),this.currentChannel=a,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[n];return i?(i.ccMIDROW(t),this.logger.log(3,"MIDROW ("+Ho([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n;const i=this.cmdHistory,s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,a=(e===16||e===24)&&t>=64&&t<=95;if(!(s||a))return!1;if(Ey(e,t,i))return Mc(null,null,i),!0;const c=e<=23?1:2;t>=64&&t<=95?n=c===1?CL[e]:LL[e]:n=c===1?PL[e]:DL[e];const o=this.channels[c];return o?(o.setPAC(this.interpretPAC(n,t)),Mc(e,t,i),this.currentChannel=c,!0):!1}interpretPAC(e,t){let n;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,i.underline=(n&1)===1,n<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((n-16)/2)*4,i}parseChars(e,t){let n,i=null,s=null;if(e>=25?(n=2,s=e-8):(n=1,s=e),s>=17&&s<=19){let a;s===17?a=t+80:s===18?a=t+112:a=t+144,this.logger.log(2,"Special char '"+KS(a)+"' in channel "+n),i=[a]}else e>=32&&e<=127&&(i=t===0?[e]:[e,t]);if(i){const a=Ho(i);this.logger.log(3,"Char codes =  "+a.join(",")),Mc(e,t,this.cmdHistory)}return i}parseBackgroundAttributes(e,t){const n=(e===16||e===24)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=45&&t<=47;if(!(n||i))return!1;let s;const a={};e===16||e===24?(s=Math.floor((t-32)/2),a.background=IL[s],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const c=e<=23?1:2;return this.channels[c].setBkgData(a),Mc(e,t,this.cmdHistory),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}this.cmdHistory=Ry()}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function Mc(r,e,t){t.a=r,t.b=e}function Ey(r,e,t){return t.a===r&&t.b===e}function Ry(){return{a:null,b:null}}class Rd{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var Wg=function(){if(ml!=null&&ml.VTTCue)return self.VTTCue;const r=["","lr","rl"],e=["start","middle","end","left","right"];function t(c,o){if(typeof o!="string"||!Array.isArray(c))return!1;const l=o.toLowerCase();return~c.indexOf(l)?l:!1}function n(c){return t(r,c)}function i(c){return t(e,c)}function s(c,...o){let l=1;for(;l<arguments.length;l++){const u=arguments[l];for(const h in u)c[h]=u[h]}return c}function a(c,o,l){const u=this,h={enumerable:!0};u.hasBeenReset=!1;let f="",g=!1,p=c,d=o,m=l,E=null,S="",R=!0,k="auto",C="start",x=50,P="middle",D=50,b="middle";Object.defineProperty(u,"id",s({},h,{get:function(){return f},set:function(w){f=""+w}})),Object.defineProperty(u,"pauseOnExit",s({},h,{get:function(){return g},set:function(w){g=!!w}})),Object.defineProperty(u,"startTime",s({},h,{get:function(){return p},set:function(w){if(typeof w!="number")throw new TypeError("Start time must be set to a number.");p=w,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",s({},h,{get:function(){return d},set:function(w){if(typeof w!="number")throw new TypeError("End time must be set to a number.");d=w,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",s({},h,{get:function(){return m},set:function(w){m=""+w,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",s({},h,{get:function(){return E},set:function(w){E=w,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",s({},h,{get:function(){return S},set:function(w){const v=n(w);if(v===!1)throw new SyntaxError("An invalid or illegal string was specified.");S=v,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",s({},h,{get:function(){return R},set:function(w){R=!!w,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",s({},h,{get:function(){return k},set:function(w){if(typeof w!="number"&&w!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");k=w,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",s({},h,{get:function(){return C},set:function(w){const v=i(w);if(!v)throw new SyntaxError("An invalid or illegal string was specified.");C=v,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",s({},h,{get:function(){return x},set:function(w){if(w<0||w>100)throw new Error("Position must be between 0 and 100.");x=w,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",s({},h,{get:function(){return P},set:function(w){const v=i(w);if(!v)throw new SyntaxError("An invalid or illegal string was specified.");P=v,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",s({},h,{get:function(){return D},set:function(w){if(w<0||w>100)throw new Error("Size must be between 0 and 100.");D=w,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",s({},h,{get:function(){return b},set:function(w){const v=i(w);if(!v)throw new SyntaxError("An invalid or illegal string was specified.");b=v,this.hasBeenReset=!0}})),u.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class NL{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function YS(r){function e(n,i,s,a){return(n|0)*3600+(i|0)*60+(s|0)+parseFloat(a||0)}const t=r.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class FL{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let i=0;i<n.length;++i)if(t===n[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function QS(r,e,t,n){const i=n?r.split(n):[r];for(const s in i){if(typeof i[s]!="string")continue;const a=i[s].split(t);if(a.length!==2)continue;const c=a[0],o=a[1];e(c,o)}}const wm=new Wg(0,0,""),Td=wm.align==="middle"?"middle":"center";function jL(r,e,t){const n=r;function i(){const c=YS(r);if(c===null)throw new Error("Malformed timestamp: "+n);return r=r.replace(/^[^\sa-zA-Z-]+/,""),c}function s(c,o){const l=new FL;QS(c,function(f,g){let p;switch(f){case"region":for(let d=t.length-1;d>=0;d--)if(t[d].id===g){l.set(f,t[d].region);break}break;case"vertical":l.alt(f,g,["rl","lr"]);break;case"line":p=g.split(","),l.integer(f,p[0]),l.percent(f,p[0])&&l.set("snapToLines",!1),l.alt(f,p[0],["auto"]),p.length===2&&l.alt("lineAlign",p[1],["start",Td,"end"]);break;case"position":p=g.split(","),l.percent(f,p[0]),p.length===2&&l.alt("positionAlign",p[1],["start",Td,"end","line-left","line-right","auto"]);break;case"size":l.percent(f,g);break;case"align":l.alt(f,g,["start",Td,"end","left","right"]);break}},/:/,/\s/),o.region=l.get("region",null),o.vertical=l.get("vertical","");let u=l.get("line","auto");u==="auto"&&wm.line===-1&&(u=-1),o.line=u,o.lineAlign=l.get("lineAlign","start"),o.snapToLines=l.get("snapToLines",!0),o.size=l.get("size",100),o.align=l.get("align",Td);let h=l.get("position","auto");h==="auto"&&wm.position===50&&(h=o.align==="start"||o.align==="left"?0:o.align==="end"||o.align==="right"?100:50),o.position=h}function a(){r=r.replace(/^\s+/,"")}if(a(),e.startTime=i(),a(),r.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);r=r.slice(3),a(),e.endTime=i(),a(),s(r,e)}function XS(r){return r.replace(/<br(?: \/)?>/gi,`
`)}class BL{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new NL,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let s=t.buffer,a=0;for(s=XS(s);a<s.length&&s[a]!=="\r"&&s[a]!==`
`;)++a;const c=s.slice(0,a);return s[a]==="\r"&&++a,s[a]===`
`&&++a,t.buffer=s.slice(a),c}function i(s){QS(s,function(a,c){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=n();const c=s.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(c!=null&&c[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:s=n(),t.state){case"HEADER":/:/.test(s)?i(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new Wg(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{jL(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const c=s.indexOf("-->")!==-1;if(!s||c&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const UL=/\r\n|\n\r|\n|\r/g,rf=function(e,t,n=0){return e.slice(n,n+t.length)===t},$L=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Pt(t)||!Pt(n)||!Pt(i)||!Pt(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*i,t+=60*60*1e3*s,t},nf=function(e){let t=5381,n=e.length;for(;n;)t=t*33^e.charCodeAt(--n);return(t>>>0).toString()};function zg(r,e,t){return nf(r.toString())+nf(e.toString())+nf(t)}const VL=function(e,t,n){let i=e[t],s=e[i.prevCC];if(!s||!s.new&&i.new){e.ccOffset=e.presentationOffset=i.start,i.new=!1;return}for(;(a=s)!=null&&a.new;){var a;e.ccOffset+=i.start-s.start,i.new=!1,i=s,s=e[i.prevCC]}e.presentationOffset=n};function GL(r,e,t,n,i,s,a){const c=new BL,o=ha(new Uint8Array(r)).trim().replace(UL,`
`).split(`
`),l=[],u=e?lL(e.baseTime,e.timescale):0;let h="00:00.000",f=0,g=0,p,d=!0;c.oncue=function(m){const E=t[n];let S=t.ccOffset;const R=(f-u)/9e4;if(E!=null&&E.new&&(g!==void 0?S=t.ccOffset=E.start:VL(t,n,R)),R){if(!e){p=new Error("Missing initPTS for VTT MPEGTS");return}S=R-t.presentationOffset}const k=m.endTime-m.startTime,C=Ts((m.startTime+S-g)*9e4,i*9e4)/9e4;m.startTime=Math.max(C,0),m.endTime=Math.max(C+k,0);const x=m.text.trim();m.text=decodeURIComponent(encodeURIComponent(x)),m.id||(m.id=zg(m.startTime,m.endTime,x)),m.endTime>0&&l.push(m)},c.onparsingerror=function(m){p=m},c.onflush=function(){if(p){a(p);return}s(l)},o.forEach(m=>{if(d)if(rf(m,"X-TIMESTAMP-MAP=")){d=!1,m.slice(16).split(",").forEach(E=>{rf(E,"LOCAL:")?h=E.slice(6):rf(E,"MPEGTS:")&&(f=parseInt(E.slice(7)))});try{g=$L(h)/1e3}catch(E){p=E}return}else m===""&&(d=!1);c.parse(m+`
`)}),c.flush()}const sf="stpp.ttml.im1t",JS=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,ZS=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,HL={left:"start",center:"center",right:"end",start:"start",end:"end"};function Ty(r,e,t,n){const i=fr(new Uint8Array(r),["mdat"]);if(i.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const s=i.map(c=>ha(c)),a=cL(e.baseTime,1,e.timescale);try{s.forEach(c=>t(WL(c,a)))}catch(c){n(c)}}function WL(r,e){const i=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(s).reduce((h,f)=>(h[f]=i.getAttribute(`ttp:${f}`)||s[f],h),{}),c=i.getAttribute("xml:space")!=="preserve",o=xy(af(i,"styling","style")),l=xy(af(i,"layout","region")),u=af(i,"body","[begin]");return[].map.call(u,h=>{const f=ew(h,c);if(!f||!h.hasAttribute("begin"))return null;const g=cf(h.getAttribute("begin"),a),p=cf(h.getAttribute("dur"),a);let d=cf(h.getAttribute("end"),a);if(g===null)throw ky(h);if(d===null){if(p===null)throw ky(h);d=g+p}const m=new Wg(g-e,d-e,f);m.id=zg(m.startTime,m.endTime,m.text);const E=l[h.getAttribute("region")],S=o[h.getAttribute("style")],R=zL(E,S,o),{textAlign:k}=R;if(k){const C=HL[k];C&&(m.lineAlign=C),m.align=k}return Xn(m,R),m}).filter(h=>h!==null)}function af(r,e,t){const n=r.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function xy(r){return r.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function ew(r,e){return[].slice.call(r.childNodes).reduce((t,n,i)=>{var s;return n.nodeName==="br"&&i?t+`
`:(s=n.childNodes)!=null&&s.length?ew(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function zL(r,e,t){const n="http://www.w3.org/ns/ttml#styling";let i=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=r!=null&&r.hasAttribute("style")?r.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(i=t[a]),s.reduce((c,o)=>{const l=of(e,n,o)||of(r,n,o)||of(i,n,o);return l&&(c[o]=l),c},{})}function of(r,e,t){return r&&r.hasAttributeNS(e,t)?r.getAttributeNS(e,t):null}function ky(r){return new Error(`Could not parse ttml timestamp ${r}`)}function cf(r,e){if(!r)return null;let t=YS(r);return t===null&&(JS.test(r)?t=KL(r,e):ZS.test(r)&&(t=qL(r,e))),t}function KL(r,e){const t=JS.exec(r),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function qL(r,e){const t=ZS.exec(r),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class YL{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Py(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(H.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(H.FRAG_LOADING,this.onFragLoading,this),e.on(H.FRAG_LOADED,this.onFragLoaded,this),e.on(H.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(H.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(H.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(H.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(H.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(H.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(H.FRAG_LOADING,this.onFragLoading,this),e.off(H.FRAG_LOADED,this.onFragLoaded,this),e.off(H.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(H.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(H.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(H.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(H.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const e=new Rd(this,"textTrack1"),t=new Rd(this,"textTrack2"),n=new Rd(this,"textTrack3"),i=new Rd(this,"textTrack4");this.cea608Parser1=new wy(1,e,t),this.cea608Parser2=new wy(3,n,i)}}addCues(e,t,n,i,s){let a=!1;for(let c=s.length;c--;){const o=s[c],l=QL(o[0],o[1],t,n);if(l>=0&&(o[0]=Math.min(o[0],t),o[1]=Math.max(o[1],n),a=!0,l/(n-t)>.5))return}if(a||s.push([t,n]),this.config.renderTextTracksNatively){const c=this.captionsTracks[e];this.Cues.newCue(c,t,n,i)}else{const c=this.Cues.newCue(null,t,n,i);this.hls.trigger(H.CUES_PARSED,{type:"captions",cues:c,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:i,timescale:s}){const{unparsedVttFrags:a}=this;n==="main"&&(this.initPTS[t.cc]={baseTime:i,timescale:s}),a.length&&(this.unparsedVttFrags=[],a.forEach(c=>{this.onFragLoaded(H.FRAG_LOADED,c)}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let i=0;i<n.textTracks.length;i++){const s=n.textTracks[i];if(Cy(s,{name:e,lang:t,attrs:{}}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:i}=this,{label:s,languageCode:a}=t[e],c=this.getExistingTrack(s,a);if(c)n[e]=c,Qc(n[e]),bS(n[e],i);else{const o=this.createTextTrack("captions",s,a);o&&(o[e]=!0,n[e]=o)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,i={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(H.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,n){const i=this.media;if(i)return i.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>{Qc(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Py(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)Qc(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],i=n.some(s=>s.textCodec===sf);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(zS(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const a=this.media,c=a?Gd(a.textTracks):null;if(this.tracks.forEach((o,l)=>{let u;if(c){let h=null;for(let f=0;f<c.length;f++)if(c[f]&&Cy(c[f],o)){h=c[f],c[f]=null;break}h&&(u=h)}if(u)Qc(u);else{const h=tw(o);u=this.createTextTrack(h,o.name,o.lang),u&&(u.mode="disabled")}u&&this.textTracks.push(u)}),c!=null&&c.length){const o=c.filter(l=>l!==null).map(l=>l.label);o.length&&Ee.warn(`Media element contains unused subtitle tracks: ${o.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(c=>({label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}));this.hls.trigger(H.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{const i=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!i)return;const s=`textTrack${i[1]}`,a=this.captionsProperties[s];a&&(a.label=n.name,n.lang&&(a.languageCode=n.lang),a.media=n)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){this.initCea608Parsers();const{cea608Parser1:n,cea608Parser2:i,lastCc:s,lastSn:a,lastPartIndex:c}=this;if(!(!this.enabled||!n||!i)&&t.frag.type===Jt.MAIN){var o,l;const{cc:u,sn:h}=t.frag,f=(o=t==null||(l=t.part)==null?void 0:l.index)!=null?o:-1;h===a+1||h===a&&f===c+1||u===s||(n.reset(),i.reset()),this.lastCc=u,this.lastSn=h,this.lastPartIndex=f}}onFragLoaded(e,t){const{frag:n,payload:i}=t;if(n.type===Jt.SUBTITLE)if(i.byteLength){const s=n.decryptdata,a="stats"in t;if(s==null||!s.encrypted||a){const c=this.tracks[n.level],o=this.vttCCs;o[n.cc]||(o[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),c&&c.textCodec===sf?this._parseIMSC1(n,i):this._parseVTTs(t)}}else this.hls.trigger(H.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;Ty(t,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),n.trigger(H.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{Ee.log(`Failed to parse IMSC1: ${i}`),n.trigger(H.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e){var t;const{frag:n,payload:i}=e,{initPTS:s,unparsedVttFrags:a}=this,c=s.length-1;if(!s[n.cc]&&c===-1){a.push(e);return}const o=this.hls,l=(t=n.initSegment)!=null&&t.data?Is(n.initSegment.data,new Uint8Array(i)):i;GL(l,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,u=>{this._appendCues(u,n.level),o.trigger(H.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},u=>{const h=u.message==="Missing initPTS for VTT MPEGTS";h?a.push(e):this._fallbackToIMSC1(n,i),Ee.log(`Failed to parse VTT cue: ${u}`),!(h&&c>n.cc)&&o.trigger(H.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:u})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||Ty(t,this.initPTS[e.cc],()=>{n.textCodec=sf,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(s=>SS(i,s))}else{const i=this.tracks[t];if(!i)return;const s=i.default?"default":"subtitles"+t;n.trigger(H.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===Jt.SUBTITLE&&this.onFragLoaded(H.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){this.initCea608Parsers();const{cea608Parser1:n,cea608Parser2:i}=this;if(!this.enabled||!n||!i)return;const{frag:s,samples:a}=t;if(!(s.type===Jt.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let c=0;c<a.length;c++){const o=a[c].bytes;if(o){const l=this.extractCea608Data(o);n.addData(a[c].pts,l[0]),i.addData(a[c].pts,l[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:i,type:s}){const{media:a}=this;if(!(!a||a.currentTime<n)){if(!s||s==="video"){const{captionsTracks:c}=this;Object.keys(c).forEach(o=>mm(c[o],t,n))}if(this.config.renderTextTracksNatively&&t===0&&i!==void 0){const{textTracks:c}=this;Object.keys(c).forEach(o=>mm(c[o],t,i))}}}extractCea608Data(e){const t=[[],[]],n=e[0]&31;let i=2;for(let s=0;s<n;s++){const a=e[i++],c=127&e[i++],o=127&e[i++];if(c===0&&o===0)continue;if((4&a)!==0){const u=3&a;(u===0||u===1)&&(t[u].push(c),t[u].push(o))}}return t}}function tw(r){return r.characteristics&&/transcribes-spoken-dialog/gi.test(r.characteristics)&&/describes-music-and-sound/gi.test(r.characteristics)?"captions":"subtitles"}function Cy(r,e){return!!r&&r.kind===tw(e)&&Sm(e,r)}function QL(r,e,t,n){return Math.min(e,n)-Math.max(r,t)}function Py(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class Kg{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(H.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(H.MANIFEST_PARSED,this.onManifestParsed,this),e.on(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(H.BUFFER_CODECS,this.onBufferCodecs,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(H.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(H.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(H.MANIFEST_PARSED,this.onManifestParsed,this),e.off(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(H.BUFFER_CODECS,this.onBufferCodecs,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Pt(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&Ee.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((i,s)=>this.isLevelAllowed(i)&&s<=e);return this.clientRect=null,Kg.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return e}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;const i=(c,o)=>o?c.width!==o.width||c.height!==o.height:!0;let s=e.length-1;const a=Math.max(t,n);for(let c=0;c<e.length;c+=1){const o=e[c];if((o.width>=a||o.height>=a)&&i(o,e[c+1])){s=c;break}}return s}}class XL{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(H.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(H.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,n){const i=performance.now();if(t){if(this.lastTime){const s=i-this.lastTime,a=n-this.lastDroppedFrames,c=t-this.lastDecodedFrames,o=1e3*a/s,l=this.hls;if(l.trigger(H.FPS_DROP,{currentDropped:a,currentDecoded:c,totalDroppedFrames:n}),o>0&&a>l.config.fpsDroppedMonitoringThreshold*c){let u=l.currentLevel;Ee.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(l.autoLevelCapping===-1||l.autoLevelCapping>=u)&&(u=u-1,l.trigger(H.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:l.currentLevel}),l.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}const xd="[eme]";class sl{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=sl.CDMCleanupPromise?[sl.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=Ee.debug.bind(Ee,xd),this.log=Ee.log.bind(Ee,xd),this.warn=Ee.warn.bind(Ee,xd),this.error=Ee.error.bind(Ee,xd),this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(H.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(H.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(H.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(H.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(H.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(H.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,i=t[e];if(i)return i.licenseUrl;if(e===vn.WIDEVINE&&n)return n;throw new Error(`no license server URL configured for key-system "${e}"`)}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(a,c,o)=>!!a&&o.indexOf(a)===c,i=t.map(a=>a.audioCodec).filter(n),s=t.map(a=>a.videoCodec).filter(n);return i.length+s.length===0&&s.push("avc1.42e01e"),new Promise((a,c)=>{const o=l=>{const u=l.shift();this.getMediaKeysPromise(u,i,s).then(h=>a({keySystem:u,mediaKeys:h})).catch(h=>{l.length?o(l):h instanceof Rs?c(h):c(new Rs({type:rr.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_NO_ACCESS,error:h,fatal:!0},h.message))})};o(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let i=`Configured requestMediaKeySystemAccess is not a function ${n}`;return oS===null&&self.location.protocol==="http:"&&(i=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(i))}return n(e,t)}getMediaKeysPromise(e,t,n){const i=cC(e,t,n,this.config.drmSystemOptions),s=this.keySystemAccessPromises[e];let a=s==null?void 0:s.keySystemAccess;if(!a){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(i)}`),a=this.requestMediaKeySystemAccess(e,i);const c=this.keySystemAccessPromises[e]={keySystemAccess:a};return a.catch(o=>{this.log(`Failed to obtain access to key-system "${e}": ${o}`)}),a.then(o=>{this.log(`Access for key-system "${o.keySystem}" obtained`);const l=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),c.mediaKeys=o.createMediaKeys().then(u=>(this.log(`Media-keys created for "${e}"`),l.then(h=>h?this.setMediaKeysServerCertificate(u,e,h):u))),c.mediaKeys.catch(u=>{this.error(`Failed to create media-keys for "${e}"}: ${u}`)}),c.mediaKeys})}return a.then(()=>s.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${sa.hexDump(e.keyId||[])}`);const i=n.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t),s="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(n,s,t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return sa.hexDump(e.keyId)}updateKeySession(e,t){var n;const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyID ${sa.hexDump(((n=e.decryptdata)==null?void 0:n.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),i.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,n)=>{const i=Gp(this.config),s=e.map(Av).filter(a=>!!a&&i.indexOf(a)!==-1);return this.getKeySystemSelectionPromise(s).then(({keySystem:a})=>{const c=Ov(a);c?t(c):n(new Error(`Unable to find format for key-system "${a}"`))}).catch(n)})}loadKey(e){const t=e.keyInfo.decryptdata,n=this.getKeyIdString(t),i=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);let s=this.keyIdToKeySessionPromise[n];return s||(s=this.keyIdToKeySessionPromise[n]=this.getKeySystemForKeyPromise(t).then(({keySystem:a,mediaKeys:c})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(a,c).then(()=>{this.throwIfDestroyed();const o=this.createMediaKeySessionContext({keySystem:a,mediaKeys:c,decryptdata:t});return this.generateRequestWithPreferredKeySession(o,"cenc",t.pssh,"playlist-key")}))),s.catch(a=>this.handleError(a))),s}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof Rs?this.hls.trigger(H.ERROR,e.data):this.hls.trigger(H.ERROR,{type:rr.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),n=this.keyIdToKeySessionPromise[t];if(!n){const i=Av(e.keyFormat),s=i?[i]:Gp(this.config);return this.attemptKeySystemAccess(s)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=Gp(this.config)),e.length===0)throw new Rs({type:rr.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}_onMediaEncrypted(e){const{initDataType:t,initData:n}=e;if(this.debug(`"${e.type}" event: init data type: "${t}"`),n===null)return;let i,s;if(t==="sinf"&&this.config.drmSystems[vn.FAIRPLAY]){const u=ai(new Uint8Array(n));try{const h=Ig(JSON.parse(u).sinf),f=mS(new Uint8Array(h));if(!f)return;i=f.subarray(8,24),s=vn.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{const u=AC(n);if(u===null)return;u.version===0&&u.systemId===aS.WIDEVINE&&u.data&&(i=u.data.subarray(8,24)),s=oC(u.systemId)}if(!s||!i)return;const a=sa.hexDump(i),{keyIdToKeySessionPromise:c,mediaKeySessions:o}=this;let l=c[a];for(let u=0;u<o.length;u++){const h=o[u],f=h.decryptdata;if(f.pssh||!f.keyId)continue;const g=sa.hexDump(f.keyId);if(a===g||f.uri.replace(/-/g,"").indexOf(a)!==-1){l=c[g],delete c[g],f.pssh=new Uint8Array(n),f.keyId=i,l=c[a]=l.then(()=>this.generateRequestWithPreferredKeySession(h,t,n,"encrypted-event-key-match"));break}}l||(l=c[a]=this.getKeySystemSelectionPromise([s]).then(({keySystem:u,mediaKeys:h})=>{var f;this.throwIfDestroyed();const g=new ku("ISO-23001-7",a,(f=Ov(u))!=null?f:"");return g.pssh=new Uint8Array(n),g.keyId=i,this.attemptSetMediaKeys(u,h).then(()=>{this.throwIfDestroyed();const p=this.createMediaKeySessionContext({decryptdata:g,keySystem:u,mediaKeys:h});return this.generateRequestWithPreferredKeySession(p,t,n,"encrypted-event-no-match")})})),l.catch(u=>this.handleError(u))}_onWaitingForKey(e){this.log(`"${e.type}" event`)}attemptSetMediaKeys(e,t){const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(n).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>n.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,n,i){var s,a;const c=(s=this.config.drmSystems)==null||(a=s[e.keySystem])==null?void 0:a.generateRequest;if(c)try{const p=c.call(this.hls,t,n,e);if(!p)throw new Error("Invalid response from configured generateRequest filter");t=p.initDataType,n=e.decryptdata.pssh=p.initData?new Uint8Array(p.initData):null}catch(p){var o;if(this.warn(p.message),(o=this.hls)!=null&&o.config.debug)throw p}if(n===null)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const l=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${i}": ${l} (init data type: ${t} length: ${n?n.byteLength:null})`);const u=new Hg,h=e._onmessage=p=>{const d=e.mediaKeysSession;if(!d){u.emit("error",new Error("invalid state"));return}const{messageType:m,message:E}=p;this.log(`"${m}" message event for session "${d.sessionId}" message size: ${E.byteLength}`),m==="license-request"||m==="license-renewal"?this.renewLicense(e,E).catch(S=>{this.handleError(S),u.emit("error",S)}):m==="license-release"?e.keySystem===vn.FAIRPLAY&&(this.updateKeySession(e,pm("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${m}"`)},f=e._onkeystatuseschange=p=>{if(!e.mediaKeysSession){u.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const m=e.keyStatus;u.emit("keyStatus",m),m==="expired"&&(this.warn(`${e.keySystem} expired for key ${l}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",h),e.mediaKeysSession.addEventListener("keystatuseschange",f);const g=new Promise((p,d)=>{u.on("error",d),u.on("keyStatus",m=>{m.startsWith("usable")?p():m==="output-restricted"?d(new Rs({type:rr.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):m==="internal-error"?d(new Rs({type:rr.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${m}"`)):m==="expired"?d(new Error("key expired while generating request")):this.warn(`unhandled key status change "${m}"`)})});return e.mediaKeysSession.generateRequest(t,n).then(()=>{var p;this.log(`Request generated for key-session "${(p=e.mediaKeysSession)==null?void 0:p.sessionId}" keyId: ${l}`)}).catch(p=>{throw new Rs({type:rr.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_NO_SESSION,error:p,fatal:!1},`Error generating key-session request: ${p}`)}).then(()=>g).catch(p=>{throw u.removeAllListeners(),this.removeSession(e),p}).then(()=>(u.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,n)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${sa.hexDump("buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n))} session keyId: ${sa.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,n=t.loader,i=new n(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,c)=>{const o={responseType:"arraybuffer",url:s},l=t.certLoadPolicy.default,u={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(f,g,p,d)=>{a(f.data)},onError:(f,g,p,d)=>{c(new Rs({type:rr.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:gi({url:o.url,data:void 0},f)},`"${e}" certificate request failed (${s}). Status: ${f.code} (${f.text})`))},onTimeout:(f,g,p)=>{c(new Rs({type:rr.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:p,response:{url:o.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(f,g,p)=>{c(new Error("aborted"))}};i.load(o,u,h)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((i,s)=>{e.setServerCertificate(n).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${n==null?void 0:n.byteLength}) on "${t}"`),i(e)}).catch(a=>{s(new Rs({type:rr.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(i=>{throw new Rs({type:rr.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:i,fatal:!0},i.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=new DOMParser().parseFromString(n,"application/xml"),s=i.querySelectorAll("HttpHeader");if(s.length>0){let u;for(let h=0,f=s.length;h<f;h++){var a,c;u=s[h];const g=(a=u.querySelector("name"))==null?void 0:a.textContent,p=(c=u.querySelector("value"))==null?void 0:c.textContent;g&&p&&e.setRequestHeader(g,p)}}const o=i.querySelector("Challenge"),l=o==null?void 0:o.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return pm(atob(l))}setupLicenseXHR(e,t,n,i){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,n,i)}).catch(a=>{if(!n.decryptdata)throw a;return e.open("POST",t,!0),s.call(this.hls,e,t,n,i)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||i})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((i,s)=>{const a=this.getLicenseServerUrl(e.keySystem);this.log(`Sending license request to URL: ${a}`);const c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(c.readyState===4)if(c.status===200){this._requestLicenseFailureCount=0;let o=c.response;this.log(`License received ${o instanceof ArrayBuffer?o.byteLength:o}`);const l=this.config.licenseResponseCallback;if(l)try{o=l.call(this.hls,c,a,e)}catch(u){this.error(u)}i(o)}else{const o=n.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||c.status>=400&&c.status<500)s(new Rs({type:rr.KEY_SYSTEM_ERROR,details:Me.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:c,response:{url:a,data:void 0,code:c.status,text:c.statusText}},`License Request XHR failed (${a}). Status: ${c.status} (${c.statusText})`));else{const u=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${u} attempts left`),this.requestLicense(e,t).then(i,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=c,this.setupLicenseXHR(c,a,e,t).then(({xhr:o,licenseChallenge:l})=>{e.keySystem==vn.PLAYREADY&&(l=this.unpackPlayReadyKeyMessage(o,l)),o.send(l)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,n.addEventListener("encrypted",this.onMediaEncrypted),n.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},ku.clearKeyUriToKeyIdMap();const n=t.length;sl.CDMCleanupPromise=Promise.all(t.map(i=>this.removeSession(i)).concat(e==null?void 0:e.setMediaKeys(null).catch(i=>{this.log(`Could not clear media keys: ${i}`)}))).then(()=>{n&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)}).catch(i=>{this.log(`Could not close sessions and clear media keys: ${i}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=t.reduce((i,s)=>(i.indexOf(s.keyFormat)===-1&&i.push(s.keyFormat),i),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);return i>-1&&this.mediaKeySessions.splice(i,1),t.remove().catch(s=>{this.log(`Could not remove session: ${s}`)}).then(()=>t.close()).catch(s=>{this.log(`Could not close session: ${s}`)})}}}sl.CDMCleanupPromise=void 0;class Rs extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}var Ni;(function(r){r.MANIFEST="m",r.AUDIO="a",r.VIDEO="v",r.MUXED="av",r.INIT="i",r.CAPTION="c",r.TIMED_TEXT="tt",r.KEY="k",r.OTHER="o"})(Ni||(Ni={}));var Em;(function(r){r.DASH="d",r.HLS="h",r.SMOOTH="s",r.OTHER="o"})(Em||(Em={}));var Xo;(function(r){r.OBJECT="CMCD-Object",r.REQUEST="CMCD-Request",r.SESSION="CMCD-Session",r.STATUS="CMCD-Status"})(Xo||(Xo={}));const JL={[Xo.OBJECT]:["br","d","ot","tb"],[Xo.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[Xo.SESSION]:["cid","pr","sf","sid","st","v"],[Xo.STATUS]:["bs","rtp"]};class yl{constructor(e,t){this.value=void 0,this.params=void 0,Array.isArray(e)&&(e=e.map(n=>n instanceof yl?n:new yl(n))),this.value=e,this.params=t}}class rw{constructor(e){this.description=void 0,this.description=e}}const ZL="Dict";function eD(r){return Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":typeof r=="object"?JSON.stringify(r):String(r)}function tD(r,e,t,n){return new Error(`failed to ${r} "${eD(e)}" as ${t}`,{cause:n})}const Ly="Bare Item",rD="Boolean",nD="Byte Sequence",iD="Decimal",sD="Integer";function aD(r){return r<-999999999999999||999999999999999<r}const oD=/[\x00-\x1f\x7f]+/,cD="Token",lD="Key";function pa(r,e,t){return tD("serialize",r,e,t)}function uD(r){if(typeof r!="boolean")throw pa(r,rD);return r?"?1":"?0"}function dD(r){return btoa(String.fromCharCode(...r))}function hD(r){if(ArrayBuffer.isView(r)===!1)throw pa(r,nD);return`:${dD(r)}:`}function nw(r){if(aD(r))throw pa(r,sD);return r.toString()}function pD(r){return`@${nw(r.getTime()/1e3)}`}function iw(r,e){if(r<0)return-iw(-r,e);const t=Math.pow(10,e);if(Math.abs(r*t%1-.5)<Number.EPSILON){const i=Math.floor(r*t);return(i%2===0?i:i+1)/t}else return Math.round(r*t)/t}function fD(r){const e=iw(r,3);if(Math.floor(Math.abs(e)).toString().length>12)throw pa(r,iD);const t=e.toString();return t.includes(".")?t:`${t}.0`}const mD="String";function gD(r){if(oD.test(r))throw pa(r,mD);return`"${r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function vD(r){return r.description||r.toString().slice(7,-1)}function Dy(r){const e=vD(r);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw pa(e,cD);return e}function Rm(r){switch(typeof r){case"number":if(!Pt(r))throw pa(r,Ly);return Number.isInteger(r)?nw(r):fD(r);case"string":return gD(r);case"symbol":return Dy(r);case"boolean":return uD(r);case"object":if(r instanceof Date)return pD(r);if(r instanceof Uint8Array)return hD(r);if(r instanceof rw)return Dy(r);default:throw pa(r,Ly)}}function Tm(r){if(/^[a-z*][a-z0-9\-_.*]*$/.test(r)===!1)throw pa(r,lD);return r}function qg(r){return r==null?"":Object.entries(r).map(([e,t])=>t===!0?`;${Tm(e)}`:`;${Tm(e)}=${Rm(t)}`).join("")}function sw(r){return r instanceof yl?`${Rm(r.value)}${qg(r.params)}`:Rm(r)}function yD(r){return`(${r.value.map(sw).join(" ")})${qg(r.params)}`}function _D(r,e={whitespace:!0}){if(typeof r!="object")throw pa(r,ZL);const t=r instanceof Map?r.entries():Object.entries(r),n=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([i,s])=>{s instanceof yl||(s=new yl(s));let a=Tm(i);return s.value===!0?a+=qg(s.params):(a+="=",Array.isArray(s.value)?a+=yD(s):a+=sw(s)),a}).join(`,${n}`)}function bD(r,e){return _D(r,e)}const SD=r=>r==="ot"||r==="sf"||r==="st",wD=r=>typeof r=="number"?Pt(r):r!=null&&r!==""&&r!==!1;function ED(r,e){const t=new URL(r),n=new URL(e);if(t.origin!==n.origin)return r;const i=t.pathname.split("/").slice(1),s=n.pathname.split("/").slice(1,-1);for(;i[0]===s[0];)i.shift(),s.shift();for(;s.length;)s.shift(),i.unshift("..");return i.join("/")}function RD(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(i=="x"?s:s&3|8).toString(16)})}}}const Yd=r=>Math.round(r),TD=(r,e)=>(e!=null&&e.baseUrl&&(r=ED(r,e.baseUrl)),encodeURIComponent(r)),kd=r=>Yd(r/100)*100,xD={br:Yd,d:Yd,bl:kd,dl:kd,mtp:kd,nor:TD,rtp:kd,tb:Yd};function kD(r,e){const t={};if(r==null||typeof r!="object")return t;const n=Object.keys(r).sort(),i=Xn({},xD,e==null?void 0:e.formatters),s=e==null?void 0:e.filter;return n.forEach(a=>{if(s!=null&&s(a))return;let c=r[a];const o=i[a];o&&(c=o(c,e)),!(a==="v"&&c===1)&&(a=="pr"&&c===1||wD(c)&&(SD(a)&&typeof c=="string"&&(c=new rw(c)),t[a]=c))}),t}function aw(r,e={}){return r?bD(kD(r,e),Xn({whitespace:!1},e)):""}function CD(r,e={}){if(!r)return{};const t=Object.entries(r),n=Object.entries(JL).concat(Object.entries((e==null?void 0:e.customHeaderMap)||{})),i=t.reduce((s,a)=>{var c,o;const[l,u]=a,h=((c=n.find(f=>f[1].includes(l)))==null?void 0:c[0])||Xo.REQUEST;return(o=s[h])!=null||(s[h]={}),s[h][l]=u,s},{});return Object.entries(i).reduce((s,[a,c])=>(s[a]=aw(c,e),s),{})}function PD(r,e,t){return Xn(r,CD(e,t))}const LD="CMCD";function DD(r,e={}){if(!r)return"";const t=aw(r,e);return`${LD}=${encodeURIComponent(t)}`}const Iy=/CMCD=[^&#]+/;function ID(r,e,t){const n=DD(e,t);if(!n)return r;if(Iy.test(r))return r.replace(Iy,n);const i=r.includes("?")?"&":"?";return`${r}${i}${n}`}class AD{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:Ni.MANIFEST,su:!this.initialized})}catch(s){Ee.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=i=>{try{const s=i.frag,a=this.hls.levels[s.level],c=this.getObjectType(s),o={d:s.duration*1e3,ot:c};(c===Ni.VIDEO||c===Ni.AUDIO||c==Ni.MUXED)&&(o.br=a.bitrate/1e3,o.tb=this.getTopBandwidth(c)/1e3,o.bl=this.getBufferLength(c)),this.apply(i,o)}catch(s){Ee.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||RD(),this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(H.MEDIA_DETACHED,this.onMediaDetached,this),e.on(H.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(H.MEDIA_DETACHED,this.onMediaDetached,this),e.off(H.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,i;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer}createData(){var e;return{v:1,sf:Em.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Xn(t,this.createData());const n=t.ot===Ni.INIT||t.ot===Ni.VIDEO||t.ot===Ni.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((s,a)=>(i.includes(a)&&(s[a]=t[a]),s),{})),this.useHeaders?(e.headers||(e.headers={}),PD(e.headers,t)):e.url=ID(e.url,t)}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Ni.TIMED_TEXT;if(e.sn==="initSegment")return Ni.INIT;if(t==="audio")return Ni.AUDIO;if(t==="main")return this.hls.audioTracks.length?Ni.VIDEO:Ni.MUXED}getTopBandwidth(e){let t=0,n;const i=this.hls;if(e===Ni.AUDIO)n=i.audioTracks;else{const s=i.maxAutoLevel,a=s>-1?s+1:i.levels.length;n=i.levels.slice(0,a)}for(const s of n)s.bitrate>t&&(t=s.bitrate);return t>0?t:NaN}getBufferLength(e){const t=this.hls.media,n=e===Ni.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:nn.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,c){t(s),this.loader.load(s,a,c)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,a,c){t(s),this.loader.load(s,a,c)}}}}const OD=3e5;class MD{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=Ee.log.bind(Ee,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(H.MANIFEST_PARSED,this.onManifestParsed,this),e.on(H.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(H.MANIFEST_PARSED,this.onManifestParsed,this),e.off(H.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((n==null?void 0:n.action)===xi.SendAlternateToPenaltyBox&&n.flags===$s.MoveAllAlternatesMatchingHost){const i=this.levels;let s=this.pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:c,pathwayId:o,type:l}=t.context;c&&i?a=this.getPathwayForGroupId(c,l,a):o&&(a=o)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!s&&i&&(s=i.reduce((c,o)=>(c.indexOf(o.pathwayId)===-1&&c.push(o.pathwayId),c),[])),s&&s.length>1&&(this.updatePathwayPriority(s),n.resolved=this.pathwayId!==a),n.resolved||Ee.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${i&&i.length} priorities: ${JSON.stringify(s)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this.pathwayPriority=e;let t;const n=this.penalizedPathways,i=performance.now();Object.keys(n).forEach(s=>{i-n[s]>OD&&delete n[s]});for(let s=0;s<e.length;s++){const a=e[s];if(a in n)continue;if(a===this.pathwayId)return;const c=this.hls.nextLoadLevel,o=this.hls.levels[c];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,TS(t),this.hls.trigger(H.LEVELS_UPDATED,{levels:t});const l=this.hls.levels[c];o&&l&&this.levels&&(l.attrs["STABLE-VARIANT-ID"]!==o.attrs["STABLE-VARIANT-ID"]&&l.bitrate!==o.bitrate&&this.log(`Unstable Pathways change from bitrate ${o.bitrate} to ${l.bitrate}`),this.hls.nextLoadLevel=c);break}}}getPathwayForGroupId(e,t,n){const i=this.getLevelsForPathway(n).concat(this.levels||[]);for(let s=0;s<i.length;s++)if(t===Dr.AUDIO_TRACK&&i[s].hasAudioGroup(e)||t===Dr.SUBTITLE_TRACK&&i[s].hasSubtitleGroup(e))return i[s].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},i={};e.forEach(s=>{const{ID:a,"BASE-ID":c,"URI-REPLACEMENT":o}=s;if(t.some(u=>u.pathwayId===a))return;const l=this.getLevelsForPathway(c).map(u=>{const h=new En(u.attrs);h["PATHWAY-ID"]=a;const f=h.AUDIO&&`${h.AUDIO}_clone_${a}`,g=h.SUBTITLES&&`${h.SUBTITLES}_clone_${a}`;f&&(n[h.AUDIO]=f,h.AUDIO=f),g&&(i[h.SUBTITLES]=g,h.SUBTITLES=g);const p=ow(u.uri,h["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",o),d=new gl({attrs:h,audioCodec:u.audioCodec,bitrate:u.bitrate,height:u.height,name:u.name,url:p,videoCodec:u.videoCodec,width:u.width});if(u.audioGroups)for(let m=1;m<u.audioGroups.length;m++)d.addGroupId("audio",`${u.audioGroups[m]}_clone_${a}`);if(u.subtitleGroups)for(let m=1;m<u.subtitleGroups.length;m++)d.addGroupId("text",`${u.subtitleGroups[m]}_clone_${a}`);return d});t.push(...l),Ay(this.audioTracks,n,o,a),Ay(this.subtitleTracks,i,o,a)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let i;try{i=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(i.protocol!=="data:"){const u=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+u)}const s={responseType:"json",url:i.href},a=t.steeringManifestLoadPolicy.default,c=a.errorRetry||a.timeoutRetry||{},o={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},l={onSuccess:(u,h,f,g)=>{this.log(`Loaded steering manifest: "${i}"`);const p=u.data;if(p.VERSION!==1){this.log(`Steering VERSION ${p.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=p.TTL;const{"RELOAD-URI":d,"PATHWAY-CLONES":m,"PATHWAY-PRIORITY":E}=p;if(d)try{this.uri=new self.URL(d,i).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${d}`);return}this.scheduleRefresh(this.uri||f.url),m&&this.clonePathways(m);const S={steeringManifest:p,url:i.toString()};this.hls.trigger(H.STEERING_MANIFEST_LOADED,S),E&&this.updatePathwayPriority(E)},onError:(u,h,f,g)=>{if(this.log(`Error loading steering manifest: ${u.code} ${u.text} (${h.url})`),this.stopLoad(),u.code===410){this.enabled=!1,this.log(`Steering manifest ${h.url} no longer available`);return}let p=this.timeToLoad*1e3;if(u.code===429){const d=this.loader;if(typeof(d==null?void 0:d.getResponseHeader)=="function"){const m=d.getResponseHeader("Retry-After");m&&(p=parseFloat(m)*1e3)}this.log(`Steering manifest ${h.url} rate limited`);return}this.scheduleRefresh(this.uri||h.url,p)},onTimeout:(u,h,f)=>{this.log(`Timeout loading steering manifest (${h.url})`),this.scheduleRefresh(this.uri||h.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(s,o,l)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var n;const i=(n=this.hls)==null?void 0:n.media;if(i&&!i.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Ay(r,e,t,n){r&&Object.keys(e).forEach(i=>{const s=r.filter(a=>a.groupId===i).map(a=>{const c=Xn({},a);return c.details=void 0,c.attrs=new En(c.attrs),c.url=c.attrs.URI=ow(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),c.groupId=c.attrs["GROUP-ID"]=e[i],c.attrs["PATHWAY-ID"]=n,c});r.push(...s)})}function ow(r,e,t,n){const{HOST:i,PARAMS:s,[t]:a}=n;let c;e&&(c=a==null?void 0:a[e],c&&(r=c));const o=new self.URL(r);return i&&!c&&(o.host=i),s&&Object.keys(s).sort().forEach(l=>{l&&o.searchParams.set(l,s[l])}),o.href}const ND=/^age:\s*[\d.]+\s*$/im;class cw{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new cp,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null,this.stats=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!this.stats.aborted)return s(n,t.url)}).catch(a=>(n.open("GET",t.url,!0),s(n,t.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(a=>{this.callbacks.onError({code:n.status,text:a.message},t,n,i)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:a}=n.loadPolicy;if(i)for(const c in i)e.setRequestHeader(c,i[c]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=s&&Pt(s)?s:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const i=t.readyState,s=this.config;if(!n.aborted&&i>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const a=t.status,c=t.responseType!=="text";if(a>=200&&a<300&&(c&&t.response||t.responseText!==null)){n.loading.end=Math.max(self.performance.now(),n.loading.first);const o=c?t.response:t.responseText,l=t.responseType==="arraybuffer"?o.byteLength:o.length;if(n.loaded=n.total=l,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first),!this.callbacks)return;const u=this.callbacks.onProgress;if(u&&u(n,e,o,t),!this.callbacks)return;const h={url:t.responseURL,data:o,code:a};this.callbacks.onSuccess(h,n,e,t)}else{const o=s.loadPolicy.errorRetry,l=n.retry,u={url:e.url,data:void 0,code:a};Ih(o,l,!1,u)?this.retry(o):(Ee.error(`${a} while loading ${e.url}`),this.callbacks.onError({code:a,text:t.statusText},e,t,n))}}}loadtimeout(){var e;const t=(e=this.config)==null?void 0:e.loadPolicy.timeoutRetry,n=this.stats.retry;if(Ih(t,n,!0))this.retry(t);else{var i;Ee.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=Mg(e,n.retry),n.retry++,Ee.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&ND.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}function FD(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const jD=/(\d+)-(\d+)\/(\d+)/;class Oy{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||VD,this.controller=new self.AbortController,this.stats=new cp}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const s=BD(e,this.controller.signal),a=n.onProgress,c=e.responseType==="arraybuffer",o=c?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=l&&Pt(l)?l:u,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),n.onTimeout(i,e,this.response)},t.timeout),self.fetch(this.request).then(h=>{this.response=this.loader=h;const f=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),n.onTimeout(i,e,this.response)},u-(f-i.loading.start)),!h.ok){const{status:g,statusText:p}=h;throw new GD(p||"fetch, bad network response",g,h)}return i.loading.first=f,i.total=$D(h.headers)||i.total,a&&Pt(t.highWaterMark)?this.loadProgressively(h,i,e,t.highWaterMark,a):c?h.arrayBuffer():e.responseType==="json"?h.json():h.text()}).then(h=>{const f=this.response;if(!f)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const g=h[o];g&&(i.loaded=i.total=g);const p={url:f.url,data:h,code:f.status};a&&!Pt(t.highWaterMark)&&a(i,e,h,f),n.onSuccess(p,i,e,f)}).catch(h=>{if(self.clearTimeout(this.requestTimeout),i.aborted)return;const f=h&&h.code||0,g=h?h.message:null;n.onError({code:f,text:g},e,h?h.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,i=0,s){const a=new PS,c=e.body.getReader(),o=()=>c.read().then(l=>{if(l.done)return a.dataLength&&s(t,n,a.flush(),e),Promise.resolve(new ArrayBuffer(0));const u=l.value,h=u.length;return t.loaded+=h,h<i||a.dataLength?(a.push(u),a.dataLength>=i&&s(t,n,a.flush(),e)):s(t,n,u,e),o()}).catch(()=>Promise.reject());return o()}}function BD(r,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Xn({},r.headers))};return r.rangeEnd&&t.headers.set("Range","bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)),t}function UD(r){const e=jD.exec(r);if(e)return parseInt(e[2])-parseInt(e[1])+1}function $D(r){const e=r.get("Content-Range");if(e){const n=UD(e);if(Pt(n))return n}const t=r.get("Content-Length");if(t)return parseInt(t)}function VD(r,e){return new self.Request(r.url,e)}class GD extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const HD=/\s/,WD={newCue(r,e,t,n){const i=[];let s,a,c,o,l;const u=self.VTTCue||self.TextTrackCue;for(let f=0;f<n.rows.length;f++)if(s=n.rows[f],c=!0,o=0,l="",!s.isEmpty()){var h;for(let d=0;d<s.chars.length;d++)HD.test(s.chars[d].uchar)&&c?o++:(l+=s.chars[d].uchar,c=!1);s.cueStartTime=e,e===t&&(t+=1e-4),o>=16?o--:o++;const g=XS(l.trim()),p=zg(e,t,g);r!=null&&(h=r.cues)!=null&&h.getCueById(p)||(a=new u(e,t,g),a.id=p,a.line=f+1,a.align="left",a.position=10+Math.min(80,Math.floor(o*8/32)*10),i.push(a))}return r&&i.length&&(i.sort((f,g)=>f.line==="auto"||g.line==="auto"?0:f.line>8&&g.line>8?g.line-f.line:f.line-g.line),i.forEach(f=>SS(r,f))),i}},zD={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},lw=gi(gi({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:cw,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:wP,bufferController:xL,capLevelController:Kg,errorController:uP,fpsController:XL,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:oS,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:zD},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},KD()),{},{subtitleStreamController:wL,subtitleTrackController:RL,timelineController:YL,audioStreamController:bL,audioTrackController:SL,emeController:sl,cmcdController:AD,contentSteeringController:MD});function KD(){return{cueHandler:WD,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function qD(r,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const t=xm(r),n=["manifest","level","frag"],i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return n.forEach(s=>{const a=`${s==="level"?"playlist":s}LoadPolicy`,c=e[a]===void 0,o=[];i.forEach(l=>{const u=`${s}Loading${l}`,h=e[u];if(h!==void 0&&c){o.push(u);const f=t[a].default;switch(e[a]={default:f},l){case"TimeOut":f.maxLoadTimeMs=h,f.maxTimeToFirstByteMs=h;break;case"MaxRetry":f.errorRetry.maxNumRetry=h,f.timeoutRetry.maxNumRetry=h;break;case"RetryDelay":f.errorRetry.retryDelayMs=h,f.timeoutRetry.retryDelayMs=h;break;case"MaxRetryTimeout":f.errorRetry.maxRetryDelayMs=h,f.timeoutRetry.maxRetryDelayMs=h;break}}}),o.length&&Ee.warn(`hls.js config: "${o.join('", "')}" setting(s) are deprecated, use "${a}": ${JSON.stringify(e[a])}`)}),gi(gi({},t),e)}function xm(r){return r&&typeof r=="object"?Array.isArray(r)?r.map(xm):Object.keys(r).reduce((e,t)=>(e[t]=xm(r[t]),e),{}):r}function YD(r){const e=r.loader;e!==Oy&&e!==cw?(Ee.log("[config]: Custom loader detected, cannot enable progressive streaming"),r.progressive=!1):FD()&&(r.loader=Oy,r.progressive=!0,r.enableSoftwareAES=!0,Ee.log("[config]: Progressive streaming enabled, using FetchLoader"))}let lf;class QD extends Ng{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(H.LEVEL_LOADED,this.onLevelLoaded,this),e.on(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(H.FRAG_BUFFERED,this.onFragBuffered,this),e.on(H.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(H.LEVEL_LOADED,this.onLevelLoaded,this),e.off(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(H.FRAG_BUFFERED,this.onFragBuffered,this),e.off(H.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,i=[],s={},a={};let c=!1,o=!1,l=!1;t.levels.forEach(u=>{var h,f;const g=u.attrs;let{audioCodec:p,videoCodec:d}=u;((h=p)==null?void 0:h.indexOf("mp4a.40.34"))!==-1&&(lf||(lf=/chrome|firefox/i.test(navigator.userAgent)),lf&&(u.audioCodec=p=void 0)),p&&(u.audioCodec=p=Ph(p,n)),((f=d)==null?void 0:f.indexOf("avc1"))===0&&(d=u.videoCodec=UC(d));const{width:m,height:E,unknownCodecs:S}=u;if(c||(c=!!(m&&E)),o||(o=!!d),l||(l=!!p),S!=null&&S.length||p&&!Kp(p,"audio",n)||d&&!Kp(d,"video",n))return;const{CODECS:R,"FRAME-RATE":k,"HDCP-LEVEL":C,"PATHWAY-ID":x,RESOLUTION:P,"VIDEO-RANGE":D}=g,w=`${`${x||"."}-`}${u.bitrate}-${P}-${k}-${R}-${D}-${C}`;if(s[w])if(s[w].uri!==u.url&&!u.attrs["PATHWAY-ID"]){const v=a[w]+=1;u.attrs["PATHWAY-ID"]=new Array(v+1).join(".");const _=new gl(u);s[w]=_,i.push(_)}else s[w].addGroupId("audio",g.AUDIO),s[w].addGroupId("text",g.SUBTITLES);else{const v=new gl(u);s[w]=v,a[w]=1,i.push(v)}}),this.filterAndSortMediaOptions(i,t,c,o,l)}filterAndSortMediaOptions(e,t,n,i,s){let a=[],c=[],o=e;if((n||i)&&s&&(o=o.filter(({videoCodec:p,videoRange:d,width:m,height:E})=>(!!p||!!(m&&E))&&ZC(d))),o.length===0){Promise.resolve().then(()=>{if(this.hls){t.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(t.levels[0].attrs)}`);const p=new Error("no level with compatible codecs found in manifest");this.hls.trigger(H.ERROR,{type:rr.MEDIA_ERROR,details:Me.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:p,reason:p.message})}});return}if(t.audioTracks){const{preferManagedMediaSource:p}=this.hls.config;a=t.audioTracks.filter(d=>!d.audioCodec||Kp(d.audioCodec,"audio",p)),My(a)}t.subtitles&&(c=t.subtitles,My(c));const l=o.slice(0);o.sort((p,d)=>{if(p.attrs["HDCP-LEVEL"]!==d.attrs["HDCP-LEVEL"])return(p.attrs["HDCP-LEVEL"]||"")>(d.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&p.height!==d.height)return p.height-d.height;if(p.frameRate!==d.frameRate)return p.frameRate-d.frameRate;if(p.videoRange!==d.videoRange)return Lh.indexOf(p.videoRange)-Lh.indexOf(d.videoRange);if(p.videoCodec!==d.videoCodec){const m=Bv(p.videoCodec),E=Bv(d.videoCodec);if(m!==E)return E-m}if(p.uri===d.uri&&p.codecSet!==d.codecSet){const m=Ch(p.codecSet),E=Ch(d.codecSet);if(m!==E)return E-m}return p.averageBitrate!==d.averageBitrate?p.averageBitrate-d.averageBitrate:0});let u=l[0];if(this.steering&&(o=this.steering.filterParsedLevels(o),o.length!==l.length)){for(let p=0;p<l.length;p++)if(l[p].pathwayId===o[0].pathwayId){u=l[p];break}}this._levels=o;for(let p=0;p<o.length;p++)if(o[p]===u){var h;this._firstLevel=p;const d=u.bitrate,m=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${o.length} level(s) found, first bitrate: ${d}`),((h=this.hls.userConfig)==null?void 0:h.abrEwmaDefaultEstimate)===void 0){const E=Math.min(d,this.hls.config.abrEwmaDefaultEstimateMax);E>m&&m===lw.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=E)}break}const f=s&&!i,g={levels:o,audioTracks:a,subtitleTracks:c,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:i,altAudio:!f&&a.some(p=>!!p.url)};this.hls.trigger(H.MANIFEST_PARSED,g),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const u=new Error("invalid level idx"),h=e<0;if(this.hls.trigger(H.ERROR,{type:rr.OTHER_ERROR,details:Me.LEVEL_SWITCH_ERROR,level:e,fatal:h,error:u,reason:u.message}),h)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,i=this.currentLevel,s=i?i.attrs["PATHWAY-ID"]:void 0,a=t[e],c=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,n===e&&a.details&&i&&s===c)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${c?" with Pathway "+c:""} from level ${n}${s?" with Pathway "+s:""}`);const o={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(H.LEVEL_SWITCHING,o);const l=a.details;if(!l||l.live){const u=this.switchParams(a.uri,i==null?void 0:i.details,l);this.loadPlaylist(u)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){t.fatal||!t.context||t.context.type===Dr.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===Jt.MAIN){const n=t.elementaryStreams;if(!Object.keys(n).some(s=>!!n[s]))return;const i=this._levels[t.level];i!=null&&i.loadError&&(this.log(`Resetting level error count of ${i.loadError} on frag buffered`),i.loadError=0)}}onLevelLoaded(e,t){var n;const{level:i,details:s}=t,a=this._levels[i];if(!a){var c;this.warn(`Invalid level index ${i}`),(c=t.deliveryDirectives)!=null&&c.skip&&(s.deltaUpdateFailed=!0);return}i===this.currentLevelIndex?(a.fragmentError===0&&(a.loadError=0),this.playlistLoaded(i,t,a.details)):(n=t.deliveryDirectives)!=null&&n.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,n=this.currentLevel;if(n&&this.shouldLoadPlaylist(n)){let i=n.uri;if(e)try{i=e.addDirectives(i)}catch(a){this.warn(`Could not construct new URL with HLS Delivery Directives: ${a}`)}const s=n.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${(e==null?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:""} with${s?" Pathway "+s:""} ${i}`),this.clearTimer(),this.hls.trigger(H.LEVEL_LOADING,{url:i,level:t,pathwayId:n.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;const n=this._levels.filter((i,s)=>s!==e?!0:(this.steering&&this.steering.removeLevel(i),i===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,i.details&&i.details.fragments.forEach(a=>a.level=-1)),!1));TS(n),this._levels=n,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(H.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(H.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function My(r){const e={};r.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}class XD{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[n].loader;if(i){var t;if(e&&e!==((t=i.context)==null?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=Me.KEY_LOAD_ERROR,n,i,s){return new Ca({type:rr.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:n,networkDetails:i})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:n,cc:i}=e;for(let s=0;s<t.length;s++){const a=t[s];if(i<=a.cc&&(n==="initSegment"||a.sn==="initSegment"||n<a.sn)){this.emeController.selectKeySystemFormat(a).then(c=>{a.setKeyFormat(c)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,i;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const l=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,Me.KEY_LOAD_ERROR,l))}const a=s.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,Me.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));let c=this.keyUriToKeyInfo[a];if((n=c)!=null&&n.decryptdata.key)return s.key=c.decryptdata.key,Promise.resolve({frag:e,keyInfo:c});if((i=c)!=null&&i.keyLoadPromise){var o;switch((o=c.mediaKeySessionContext)==null?void 0:o.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return c.keyLoadPromise.then(l=>(s.key=l.keyInfo.decryptdata.key,{frag:e,keyInfo:c}))}}switch(c=this.keyUriToKeyInfo[a]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(c,e):this.loadKeyEME(c,e);case"AES-128":return this.loadKeyHTTP(c,e);default:return Promise.reject(this.createKeyLoadError(e,Me.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const i=this.emeController.loadKey(n);if(i)return(e.keyLoadPromise=i.then(s=>(e.mediaKeySessionContext=s,n))).catch(s=>{throw e.keyLoadPromise=null,s})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,i=n.loader,s=new i(n);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((a,c)=>{const o={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},l=n.keyLoadPolicy.default,u={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:(f,g,p,d)=>{const{frag:m,keyInfo:E,url:S}=p;if(!m.decryptdata||E!==this.keyUriToKeyInfo[S])return c(this.createKeyLoadError(m,Me.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),d));E.decryptdata.key=m.decryptdata.key=new Uint8Array(f.data),m.keyLoader=null,E.loader=null,a({frag:m,keyInfo:E})},onError:(f,g,p,d)=>{this.resetLoader(g),c(this.createKeyLoadError(t,Me.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),p,gi({url:o.url,data:void 0},f)))},onTimeout:(f,g,p)=>{this.resetLoader(g),c(this.createKeyLoadError(t,Me.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),p))},onAbort:(f,g,p)=>{this.resetLoader(g),c(this.createKeyLoadError(t,Me.INTERNAL_ABORTED,new Error("key loading aborted"),p))}};s.load(o,u,h)})}resetLoader(e){const{frag:t,keyInfo:n,url:i}=e,s=n.loader;t.keyLoader===s&&(t.keyLoader=null,n.loader=null),delete this.keyUriToKeyInfo[i],s&&s.destroy()}}function uw(){return self.SourceBuffer||self.WebKitSourceBuffer}function dw(){if(!ac())return!1;const e=uw();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function JD(){if(!dw())return!1;const r=ac();return typeof(r==null?void 0:r.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>r.isTypeSupported(Cu(e,"video")))||["mp4a.40.2","fLaC"].some(e=>r.isTypeSupported(Cu(e,"audio"))))}function ZD(){var r;const e=uw();return typeof(e==null||(r=e.prototype)==null?void 0:r.changeType)=="function"}const eI=250,Qd=2,tI=.1,rI=.05;class nI{constructor(e,t,n,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=n,this.hls=i}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:n,media:i,stalled:s}=this;if(i===null)return;const{currentTime:a,seeking:c}=i,o=this.seeking&&!c,l=!this.seeking&&c;if(this.seeking=c,a!==e){if(this.moved=!0,c||(this.nudgeRetry=0),s!==null){if(this.stallReported){const m=self.performance.now()-s;Ee.warn(`playback not stuck anymore @${a}, after ${Math.round(m)}ms`),this.stallReported=!1}this.stalled=null}return}if(l||o){this.stalled=null;return}if(i.paused&&!c||i.ended||i.playbackRate===0||!nn.getBuffered(i).length){this.nudgeRetry=0;return}const u=nn.bufferInfo(i,a,0),h=u.nextStart||0;if(c){const m=u.len>Qd,E=!h||t&&t.start<=a||h-a>Qd&&!this.fragmentTracker.getPartialFragment(a);if(m||E)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var f;if(!(u.len>0)&&!h)return;const E=Math.max(h,u.start||0)-a,S=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,k=(S==null||(f=S.details)==null?void 0:f.live)?S.details.targetduration*2:Qd,C=this.fragmentTracker.getPartialFragment(a);if(E>0&&(E<=k||C)){i.paused||this._trySkipBufferHole(C);return}}const g=self.performance.now();if(s===null){this.stalled=g;return}const p=g-s;if(!c&&p>=eI&&(this._reportStall(u),!this.media))return;const d=nn.bufferInfo(i,a,n.maxBufferHole);this._tryFixBufferStall(d,p)}_tryFixBufferStall(e,t){const{config:n,fragmentTracker:i,media:s}=this;if(s===null)return;const a=s.currentTime,c=i.getPartialFragment(a);c&&(this._trySkipBufferHole(c)||!this.media)||(e.len>n.maxBufferHole||e.nextStart&&e.nextStart-a<n.maxBufferHole)&&t>n.highBufferWatchdogPeriod*1e3&&(Ee.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:n,stallReported:i}=this;if(!i&&n){this.stallReported=!0;const s=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${JSON.stringify(e)})`);Ee.warn(s.message),t.trigger(H.ERROR,{type:rr.MEDIA_ERROR,details:Me.BUFFER_STALLED_ERROR,fatal:!1,error:s,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:n,media:i}=this;if(i===null)return 0;const s=i.currentTime,a=nn.bufferInfo(i,s,0),c=s<a.start?a.start:a.nextStart;if(c){const o=a.len<=t.maxBufferHole,l=a.len>0&&a.len<1&&i.readyState<3,u=c-s;if(u>0&&(o||l)){if(u>t.maxBufferHole){const{fragmentTracker:f}=this;let g=!1;if(s===0){const p=f.getAppendedFrag(0,Jt.MAIN);p&&c<p.end&&(g=!0)}if(!g){const p=e||f.getAppendedFrag(s,Jt.MAIN);if(p){let d=!1,m=p.end;for(;m<c;){const E=f.getPartialFragment(m);if(E)m+=E.duration;else{d=!0;break}}if(d)return 0}}}const h=Math.max(c+rI,s+tI);if(Ee.warn(`skipping hole, adjusting currentTime from ${s} to ${h}`),this.moved=!0,this.stalled=null,i.currentTime=h,e&&!e.gap){const f=new Error(`fragment loaded with buffer holes, seeking from ${s} to ${h}`);n.trigger(H.ERROR,{type:rr.MEDIA_ERROR,details:Me.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:f,reason:f.message,frag:e})}return h}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:n,nudgeRetry:i}=this;if(n===null)return;const s=n.currentTime;if(this.nudgeRetry++,i<e.nudgeMaxRetry){const a=s+(i+1)*e.nudgeOffset,c=new Error(`Nudging 'currentTime' from ${s} to ${a}`);Ee.warn(c.message),n.currentTime=a,t.trigger(H.ERROR,{type:rr.MEDIA_ERROR,details:Me.BUFFER_NUDGE_ON_STALL,error:c,fatal:!1})}else{const a=new Error(`Playhead still not moving while enough data buffered @${s} after ${e.nudgeMaxRetry} nudges`);Ee.error(a.message),t.trigger(H.ERROR,{type:rr.MEDIA_ERROR,details:Me.BUFFER_STALLED_ERROR,error:a,fatal:!0})}}}const iI=100;class sI extends Bg{constructor(e,t,n){super(e,t,n,"[stream-controller]",Jt.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(H.MANIFEST_LOADING,this.onManifestLoading,this),e.on(H.MANIFEST_PARSED,this.onManifestParsed,this),e.on(H.LEVEL_LOADING,this.onLevelLoading,this),e.on(H.LEVEL_LOADED,this.onLevelLoaded,this),e.on(H.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(H.ERROR,this.onError,this),e.on(H.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(H.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(H.BUFFER_CREATED,this.onBufferCreated,this),e.on(H.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(H.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(H.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(H.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(H.MANIFEST_LOADING,this.onManifestLoading,this),e.off(H.MANIFEST_PARSED,this.onManifestParsed,this),e.off(H.LEVEL_LOADED,this.onLevelLoaded,this),e.off(H.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(H.ERROR,this.onError,this),e.off(H.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(H.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(H.BUFFER_CREATED,this.onBufferCreated,this),e.off(H.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(H.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(H.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:n}=this;if(this.stopLoad(),this.setInterval(iI),this.level=-1,!this.startFragRequested){let i=n.startLevel;i===-1&&(n.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=n.firstAutoLevel),n.nextLoadLevel=i,this.level=n.loadLevel,this.loadedmetadata=!1}t>0&&e===-1&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=ze.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=ze.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ze.WAITING_LEVEL:{const{levels:t,level:n}=this,i=t==null?void 0:t[n],s=i==null?void 0:i.details;if(s&&(!s.live||this.levelLastLoaded===i)){if(this.waitForCdnTuneIn(s))break;this.state=ze.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ze.IDLE;break}break}case ze.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),n=this.retryDate;if(!n||t>=n||(e=this.media)!=null&&e.seeking){const{levels:i,level:s}=this,a=i==null?void 0:i[s];this.resetStartWhenNotLoaded(a||null),this.state=ze.IDLE}}break}this.state===ze.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:i}=this;if(t===null||!i&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=e.nextLoadLevel;if(!(n!=null&&n[s]))return;const a=n[s],c=this.getMainFwdBufferInfo();if(c===null)return;const o=this.getLevelDetails();if(o&&this._streamEnded(c,o)){const d={};this.altAudio&&(d.type="video"),this.hls.trigger(H.BUFFER_EOS,d),this.state=ze.ENDED;return}e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const l=a.details;if(!l||this.state===ze.WAITING_LEVEL||l.live&&this.levelLastLoaded!==a){this.level=s,this.state=ze.WAITING_LEVEL;return}const u=c.len,h=this.getMaxBufferLength(a.maxBitrate);if(u>=h)return;this.backtrackFragment&&this.backtrackFragment.start>c.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:c.end;let g=this.getNextFragment(f,l);if(this.couldBacktrack&&!this.fragPrevious&&g&&g.sn!=="initSegment"&&this.fragmentTracker.getState(g)!==fi.OK){var p;const m=((p=this.backtrackFragment)!=null?p:g).sn-l.startSN,E=l.fragments[m-1];E&&g.cc===E.cc&&(g=E,this.fragmentTracker.removeFragment(E))}else this.backtrackFragment&&c.len&&(this.backtrackFragment=null);if(g&&this.isLoopLoading(g,f)){if(!g.gap){const m=this.audioOnly&&!this.altAudio?Gr.AUDIO:Gr.VIDEO,E=(m===Gr.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;E&&this.afterBufferFlushed(E,m,Jt.MAIN)}g=this.getNextFragmentLoopLoading(g,l,c,Jt.MAIN,h)}g&&(g.initSegment&&!g.initSegment.data&&!this.bitrateTest&&(g=g.initSegment),this.loadFragment(g,a,f))}loadFragment(e,t,n){const i=this.fragmentTracker.getState(e);this.fragCurrent=e,i===fi.NOT_LOADED||i===fi.PARTIAL?e.sn==="initSegment"?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,n)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Jt.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let n;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const c=this.getMainFwdBufferInfo();if(!c||c.len<s.targetduration*2)return}if(!t.paused&&e){const c=this.hls.nextLoadLevel,o=e[c],l=this.fragLastKbps;l&&this.fragCurrent?n=this.fragCurrent.duration*o.maxBitrate/(1e3*l)+1:n=0}else n=0;const a=this.getBufferedFrag(t.currentTime+n);if(a){const c=this.followingBufferedFrag(a);if(c){this.abortCurrentFrag();const o=c.maxStartPTS?c.maxStartPTS:c.start,l=c.duration,u=Math.max(a.end,o+Math.min(Math.max(l-this.config.maxFragLookUpTolerance,l*(this.couldBacktrack?.5:.125)),l*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ze.KEY_LOADING:case ze.FRAG_LOADING:case ze.FRAG_LOADING_WAITING_RETRY:case ze.PARSING:case ze.PARSED:this.state=ze.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),n.addEventListener("playing",this.onvplaying),n.addEventListener("seeked",this.onvseeked),this.gapController=new nI(this.config,n,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;Pt(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const n=this.getMainFwdBufferInfo();if(n===null||n.len===0){this.warn(`Main forward buffer length on "seeked" event ${n?n.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(H.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(e,t){let n=!1,i=!1;t.levels.forEach(s=>{const a=s.audioCodec;a&&(n=n||a.indexOf("mp4a.40.2")!==-1,i=i||a.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=n&&i&&!ZD(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==ze.IDLE)return;const i=n[t.level];(!i.details||i.details.live&&this.levelLastLoaded!==i||this.waitForCdnTuneIn(i.details))&&(this.state=ze.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:i}=this,s=t.level,a=t.details,c=a.totalduration;if(!i){this.warn(`Levels were reset while loading level ${s}`);return}this.log(`Level ${s} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""}, cc [${a.startCC}, ${a.endCC}] duration:${c}`);const o=i[s],l=this.fragCurrent;l&&(this.state===ze.FRAG_LOADING||this.state===ze.FRAG_LOADING_WAITING_RETRY)&&l.level!==t.level&&l.loader&&this.abortCurrentFrag();let u=0;if(a.live||(n=o.details)!=null&&n.live){var h;if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;u=this.alignPlaylists(a,o.details,(h=this.levelLastLoaded)==null?void 0:h.details)}if(o.details=a,this.levelLastLoaded=o,this.hls.trigger(H.LEVEL_UPDATED,{details:a,level:s}),this.state===ze.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=ze.IDLE}this.startFragRequested?a.live&&this.synchronizeToLiveEdge(a):this.setStartPosition(a,u),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:n,part:i,payload:s}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const c=a[n.level],o=c.details;if(!o){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const l=c.videoCodec,u=o.PTSKnown||!o.live,h=(t=n.initSegment)==null?void 0:t.data,f=this._getAudioCodec(c),g=this.transmuxer=this.transmuxer||new WS(this.hls,Jt.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),p=i?i.index:-1,d=p!==-1,m=new Fg(n.level,n.sn,n.stats.chunkCount,s.byteLength,p,d),E=this.initPTS[n.cc];g.push(s,h,f,l,n,i,o.totalduration,u,m,E)}onAudioTrackSwitching(e,t){const n=this.altAudio;if(!!!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const s=this.hls;n&&(s.trigger(H.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),s.trigger(H.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=t.id,i=!!this.hls.audioTracks[n].url;if(i){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=i,this.tick()}onBufferCreated(e,t){const n=t.tracks;let i,s,a=!1;for(const c in n){const o=n[c];if(o.id==="main"){if(s=c,i=o,c==="video"){const l=n[c];l&&(this.videoBuffer=l.buffer)}}else a=!0}a&&i?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:i}=t;if(n&&n.type!==Jt.MAIN)return;if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${i?" p: "+i.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ze.PARSED&&(this.state=ze.IDLE);return}const s=i?i.stats:n.stats;this.fragLastKbps=Math.round(8*s.total/(s.buffering.end-s.loading.first)),n.sn!=="initSegment"&&(this.fragPrevious=n),this.fragBufferedComplete(n,i)}onError(e,t){var n;if(t.fatal){this.state=ze.ERROR;return}switch(t.details){case Me.FRAG_GAP:case Me.FRAG_PARSING_ERROR:case Me.FRAG_DECRYPT_ERROR:case Me.FRAG_LOAD_ERROR:case Me.FRAG_LOAD_TIMEOUT:case Me.KEY_LOAD_ERROR:case Me.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Jt.MAIN,t);break;case Me.LEVEL_LOAD_ERROR:case Me.LEVEL_LOAD_TIMEOUT:case Me.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ze.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===Dr.LEVEL&&(this.state=ze.IDLE);break;case Me.BUFFER_APPEND_ERROR:case Me.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="main")return;if(t.details===Me.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case Me.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}checkBuffer(){const{media:e,gapController:t}=this;if(!(!e||!t||!e.readyState)){if(this.loadedmetadata||!nn.getBuffered(e).length){const n=this.state!==ze.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,n)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=ze.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Gr.AUDIO||this.audioOnly&&!this.altAudio){const n=(t===Gr.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(n,t,Jt.MAIN),this.tick()}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}const i=nn.getBuffered(e),a=(i.length?i.start(0):0)-n;a>0&&(a<this.config.maxBufferHole||a<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${a} to match buffer start`),n+=a,this.startPosition=n),this.log(`seek to target start position ${n} from current time ${t}`),e.currentTime=n}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:i}=this;if(!n||this.fragContextChanged(e))return;t.fragmentError=0,this.state=ze.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const s=e.stats;s.parsing.start=s.parsing.end=s.buffering.start=s.buffering.end=self.performance.now(),i.trigger(H.FRAG_LOADED,n),e.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const n="main",{hls:i}=this,{remuxResult:s,chunkMeta:a}=e,c=this.getCurrentContext(a);if(!c){this.resetWhenMissingContext(a);return}const{frag:o,part:l,level:u}=c,{video:h,text:f,id3:g,initSegment:p}=s,{details:d}=u,m=this.altAudio?void 0:s.audio;if(this.fragContextChanged(o)){this.fragmentTracker.removeFragment(o);return}if(this.state=ze.PARSING,p){if(p!=null&&p.tracks){const R=o.initSegment||o;this._bufferInitSegment(u,p.tracks,R,a),i.trigger(H.FRAG_PARSING_INIT_SEGMENT,{frag:R,id:n,tracks:p.tracks})}const E=p.initPTS,S=p.timescale;Pt(E)&&(this.initPTS[o.cc]={baseTime:E,timescale:S},i.trigger(H.INIT_PTS_FOUND,{frag:o,id:n,initPTS:E,timescale:S}))}if(h&&d&&o.sn!=="initSegment"){const E=d.fragments[o.sn-1-d.startSN],S=o.sn===d.startSN,R=!E||o.cc>E.cc;if(s.independent!==!1){const{startPTS:k,endPTS:C,startDTS:x,endDTS:P}=h;if(l)l.elementaryStreams[h.type]={startPTS:k,endPTS:C,startDTS:x,endDTS:P};else if(h.firstKeyFrame&&h.independent&&a.id===1&&!R&&(this.couldBacktrack=!0),h.dropped&&h.independent){const D=this.getMainFwdBufferInfo(),b=(D?D.end:this.getLoadPosition())+this.config.maxBufferHole,w=h.firstKeyFramePTS?h.firstKeyFramePTS:k;if(!S&&b<w-this.config.maxBufferHole&&!R){this.backtrack(o);return}else R&&(o.gap=!0);o.setElementaryStreamInfo(h.type,o.start,C,o.start,P,!0)}else S&&k>Qd&&(o.gap=!0);o.setElementaryStreamInfo(h.type,k,C,x,P),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(h,o,l,a,S||R)}else if(S||R)o.gap=!0;else{this.backtrack(o);return}}if(m){const{startPTS:E,endPTS:S,startDTS:R,endDTS:k}=m;l&&(l.elementaryStreams[Gr.AUDIO]={startPTS:E,endPTS:S,startDTS:R,endDTS:k}),o.setElementaryStreamInfo(Gr.AUDIO,E,S,R,k),this.bufferFragmentData(m,o,l,a)}if(d&&g!=null&&(t=g.samples)!=null&&t.length){const E={id:n,frag:o,details:d,samples:g.samples};i.trigger(H.FRAG_PARSING_METADATA,E)}if(d&&f){const E={id:n,frag:o,details:d,samples:f.samples};i.trigger(H.FRAG_PARSING_USERDATA,E)}}_bufferInitSegment(e,t,n,i){if(this.state!==ze.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:s,video:a,audiovideo:c}=t;if(s){let o=e.audioCodec;const l=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(o&&(o.indexOf("mp4a.40.5")!==-1?o="mp4a.40.2":o="mp4a.40.5"),s.metadata.channelCount!==1&&l.indexOf("firefox")===-1&&(o="mp4a.40.5")),o&&o.indexOf("mp4a.40.5")!==-1&&l.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(o="mp4a.40.2",this.log(`Android: force audio codec to ${o}`)),e.audioCodec&&e.audioCodec!==o&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${o}"`),s.levelCodec=o,s.id="main",this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${o||""}/${e.audioCodec||""}/${s.codec}]`)}a&&(a.levelCodec=e.videoCodec,a.id="main",this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${a.codec}]`)),c&&this.log(`Init audiovideo buffer, container:${c.container}, codecs[level/parsed]=[${e.codecs}/${c.codec}]`),this.hls.trigger(H.BUFFER_CODECS,t),Object.keys(t).forEach(o=>{const u=t[o].initSegment;u!=null&&u.byteLength&&this.hls.trigger(H.BUFFER_APPENDING,{type:o,data:u,frag:n,part:null,chunkMeta:i,parent:n.type})}),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,Jt.MAIN)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ze.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(nn.isBuffered(e,n)?t=this.getAppendedFrag(n):nn.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const i=this.fragPlaying,s=t.level;(!i||t.sn!==i.sn||i.level!==s)&&(this.fragPlaying=t,this.hls.trigger(H.FRAG_CHANGED,{frag:t}),(!i||i.level!==s)&&this.hls.trigger(H.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,n=this.currentFrag;if(n&&Pt(t)&&Pt(n.programDateTime)){const i=n.programDateTime+(t-n.start)*1e3;return new Date(i)}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class ho{static get version(){return"1.5.8"}static isMSESupported(){return dw()}static isSupported(){return JD()}static getMediaSource(){return ac()}static get Events(){return H}static get ErrorTypes(){return rr}static get ErrorDetails(){return Me}static get DefaultConfig(){return ho.defaultConfig?ho.defaultConfig:lw}static set DefaultConfig(e){ho.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new Hg,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,Xk(e.debug||!1,"Hls instance");const t=this.config=qD(ho.DefaultConfig,e);this.userConfig=e,t.progressive&&YD(t);const{abrController:n,bufferController:i,capLevelController:s,errorController:a,fpsController:c}=t,o=new a(this),l=this.abrController=new n(this),u=this.bufferController=new i(this),h=this.capLevelController=new s(this),f=new c(this),g=new WC(this),p=new QC(this),d=t.contentSteeringController,m=d?new d(this):null,E=this.levelController=new QD(this,m),S=new RP(this),R=new XD(this.config),k=this.streamController=new sI(this,S,R);h.setStreamController(k),f.setStreamController(k);const C=[g,E,k];m&&C.splice(1,0,m),this.networkControllers=C;const x=[l,u,h,f,p,S];this.audioTrackController=this.createController(t.audioTrackController,C);const P=t.audioStreamController;P&&C.push(new P(this,S,R)),this.subtitleTrackController=this.createController(t.subtitleTrackController,C);const D=t.subtitleStreamController;D&&C.push(new D(this,S,R)),this.createController(t.timelineController,x),R.emeController=this.emeController=this.createController(t.emeController,x),this.cmcdController=this.createController(t.cmcdController,x),this.latencyController=this.createController(XC,x),this.coreComponents=x,C.push(o);const b=o.onErrorOut;typeof b=="function"&&this.on(H.ERROR,b,o)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,i){this._emitter.off(e,t,n,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(Ee.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const i=e===H.ERROR;this.trigger(H.ERROR,{type:rr.OTHER_ERROR,details:Me.INTERNAL_EXCEPTION,fatal:i,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){Ee.log("destroy"),this.trigger(H.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){Ee.log("attachMedia"),this._media=e,this.trigger(H.MEDIA_ATTACHING,{media:e})}detachMedia(){Ee.log("detachMedia"),this.trigger(H.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();const t=this.media,n=this.url,i=this.url=Dg.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,Ee.log(`loadSource:${i}`),t&&n&&(n!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(H.MANIFEST_LOADING,{url:e})}startLoad(e=-1){Ee.log(`startLoad(${e})`),this.started=!0,this.networkControllers.forEach(t=>{t.startLoad(e)})}stopLoad(){Ee.log("stopLoad"),this.started=!1,this.networkControllers.forEach(e=>{e.stopLoad()})}resumeBuffering(){this.started&&this.networkControllers.forEach(e=>{"fragmentLoader"in e&&e.startLoad(-1)})}pauseBuffering(){this.networkControllers.forEach(e=>{"fragmentLoader"in e&&e.stopLoad()})}swapAudioCodec(){Ee.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){Ee.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e){this.levelController.removeLevel(e)}get levels(){const e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){Ee.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){Ee.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){Ee.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){Ee.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){Ee.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(Ee.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){JC(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let i=0;i<n;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let i;if(t===-1&&e!=null&&e.length?i=e.length-1:i=t,n)for(let s=i;s--;){const a=e[s].attrs["HDCP-LEVEL"];if(a&&a<=n)return s}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(e){var t;return(t=this.audioTrackController)==null?void 0:t.setAudioOption(e)}setSubtitleOption(e){var t;return(t=this.subtitleTrackController)==null||t.setSubtitleOption(e),null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}ho.defaultConfig=void 0;function aI({getMeetingAndToken:r,setMode:e}){const[t,n]=Ie.useState(null),i=async s=>{e(s),await r(t)};return ce.jsx("div",{className:"w-full  max-w-[700px] mx-auto h-[40vh] flex items-center justify-center ",children:ce.jsxs("div",{className:"flex flex-col justify-center gap-4 items-center",children:[ce.jsx("button",{onClick:()=>i("CONFERENCE"),className:"p-3 bg-red-500 text-white rounded-md",children:"Create Meeting"}),ce.jsx("span",{className:"font-bold  text-2xl",children:"OR"}),ce.jsxs("div",{className:"flex max-w-full min-w-[350px] gap-2 flex-col md:flex-row p-1 rounded-md shadow-lg border border-green-500",children:[ce.jsx("input",{type:"text",className:"inline-block p-3 outline-none",placeholder:"Enter Meeting Id",onChange:s=>{n(s.target.value)}}),ce.jsx("button",{onClick:()=>i("CONFERENCE"),className:"block p-3 border-r-2 rounded-md border text-white bg-green-600",children:"Join as Host"}),ce.jsx("button",{onClick:()=>i("VIEWER"),className:"block p-3 border-l-2 rounded-md border border-green-600",children:"Join as Viewer"})]})]})})}function oI(r){const e=Ie.useRef(null),{webcamStream:t,micStream:n,webcamOn:i,micOn:s,isLocal:a,displayName:c}=wx(r.participantId),o=Ie.useMemo(()=>{if(i&&t){const l=new MediaStream;return l.addTrack(t.track),l}},[t,i]);return Ie.useEffect(()=>{if(e.current)if(s&&n){const l=new MediaStream;l.addTrack(n.track),e.current.srcObject=l,e.current.play().catch(u=>console.error("videoElem.current.play() failed",u))}else e.current.srcObject=null},[n,s]),ce.jsxs("div",{className:"relative",children:[ce.jsxs("p",{className:"flex flex-col gap-0 text-sm",children:[ce.jsxs("span",{className:"font-semibold",children:["Participant: ",c]}),ce.jsxs("span",{className:"font-medium text-green-600",children:["Webcam: ",i?"ON":"OFF"]})," ",ce.jsxs("span",{className:"font-medium text-red-600",children:["Mic: ",s?"ON":"OFF"]})]}),ce.jsx("audio",{ref:e,autoPlay:!0,playsInline:!0,muted:a}),i&&ce.jsx(Vk,{playsinline:!0,pip:!1,light:!1,controls:!1,muted:!0,playing:!0,url:o,height:"300px",width:"100%",onError:l=>{console.log(l,"participant video error")}})]})}function cI(){const{leave:r,toggleMic:e,toggleWebcam:t,startHls:n,stopHls:i}=pl();return ce.jsxs("div",{className:"flex gap-2 my-2",children:[ce.jsx("button",{onClick:()=>r(),className:"p-1 bg-red-500 rounded-md text-white",children:"Leave"})," ",ce.jsx("button",{className:"p-1 bg-green-500 rounded-md text-white",onClick:()=>e(),children:"toggleMic"}),ce.jsx("button",{className:"p-1 bg-green-500 rounded-md text-white",onClick:()=>t(),children:"toggleWebcam"})," ",ce.jsx("button",{className:"p-1 bg-green-400 rounded-md text-white",onClick:()=>{n({layout:{type:"SPOTLIGHT",priority:"PIN",gridSize:"20"},theme:"LIGHT",mode:"video-and-audio",quality:"high",orientation:"landscape"})},children:"Start HLS"}),ce.jsx("button",{className:"p-1 bg-red-600 rounded-md text-white",onClick:()=>i(),children:"Stop HLS"})]})}function lI(){const{participants:r,hlsState:e}=pl(),t=Ie.useMemo(()=>[...r.values()].filter(i=>i.mode==am.modes.CONFERENCE),[r]);return ce.jsxs("div",{children:[ce.jsxs("p",{children:["Current HLS State: ",e]}),ce.jsx(cI,{}),t.map(n=>ce.jsx(oI,{participantId:n.id},n.id))]})}function uI(){const r=Ie.useRef(null),{hlsUrls:e,hlsState:t}=pl();return Ie.useEffect(()=>{var n;if(e.playbackHlsUrl&&t=="HLS_PLAYABLE")if(ho.isSupported()){const i=new ho({maxLoadingDelay:1,defaultAudioCodec:"mp4a.40.2",maxBufferLength:0,maxMaxBufferLength:1,startLevel:0,startPosition:-1,maxBufferHole:.001,highBufferWatchdogPeriod:0,nudgeOffset:.05,nudgeMaxRetry:1,maxFragLookUpTolerance:.1,liveSyncDurationCount:1,abrEwmaFastLive:1,abrEwmaSlowLive:3,abrEwmaFastVoD:1,abrEwmaSlowVoD:3,maxStarvationDelay:1});let s=document.querySelector("#hlsPlayer");i.loadSource(e.playbackHlsUrl),i.attachMedia(s)}else typeof((n=r.current)==null?void 0:n.play)=="function"&&(r.current.src=e.playbackHlsUrl,r.current.play())},[e,t,r.current]),ce.jsx("div",{children:t!="HLS_PLAYABLE"?ce.jsx("div",{children:ce.jsx("p",{children:"HLS has not started yet or is stopped"})}):t=="HLS_PLAYABLE"&&ce.jsx("div",{className:"w-full",children:ce.jsx("video",{ref:r,id:"hlsPlayer",autoPlay:!0,controls:!0,style:{width:"100%",height:"100%"},playsinline:!0,playsInline:!0,muted:!0,playing:!0,onError:n=>{console.log(n,"hls video error")}})})})}function dI(r){Ie.useEffect(()=>{(async()=>{const o={patient:1,status:0,message_id:r.meetingId};try{const l=await fetch("/api/consult/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const u=await l.json();console.log("Consultation Response:",u)}catch(l){console.error("Error posting consultation:",l)}})()},[r.meetingId]);const[e,t]=Ie.useState(null),{join:n}=pl(),i=pl({onMeetingJoined:()=>{a.current.localParticipant.mode=="CONFERENCE"&&a.current.localParticipant.pin(),t("JOINED")},onMeetingLeft:()=>{r.onMeetingLeave()},onError:c=>{alert(c.message)}}),s=()=>{t("JOINING"),n()},a=Ie.useRef(i);return Ie.useEffect(()=>{a.current=i},[i]),ce.jsx("div",{className:"max-w-[700px] h-screen mx-auto flex items-center gap-4 justify-center",children:ce.jsxs("div",{className:"flex flex-col gap-3 items-center",children:[ce.jsxs("h3",{className:"mt-2 font-bold",children:["Meeting Id: ",r.meetingId]}),e&&e=="JOINED"?i.localParticipant.mode==am.modes.CONFERENCE?ce.jsx(lI,{}):i.localParticipant.mode==am.modes.VIEWER?ce.jsx(uI,{}):null:e&&e=="JOINING"?ce.jsx("p",{className:"text-green-600",children:"Joining the meeting..."}):ce.jsx("button",{className:"p-1 bg-green-500 rounded-md text-white",onClick:s,children:"Join"})]})})}function hw(){const[r,e]=Ie.useState(null),[t,n]=Ie.useState("CONFERENCE"),i=async a=>{const c=a??await Ex({token:om});e(c)},s=()=>{e(null)};return r?ce.jsx(Sx,{config:{meetingId:r,micEnabled:!0,webcamEnabled:!0,name:"Samuel Raman",mode:t},token:om,children:ce.jsx(_x,{children:()=>ce.jsx(dI,{meetingId:r,onMeetingLeave:s})})}):ce.jsx(aI,{getMeetingAndToken:i,setMode:n})}const hI=()=>ce.jsx("div",{children:ce.jsx(hw,{})}),pI=()=>ce.jsx("div",{children:"Patient"}),La=({label:r,type:e,handleChange:t})=>ce.jsxs("div",{className:"mb-0",children:[ce.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:r,children:r}),ce.jsx("input",{className:"shadow appearance-none border  rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline",id:r,type:e,name:r,placeholder:r,onChange:t})]});function Nh(r){return ko({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"g",attr:{id:"Settings"},child:[{tag:"g",attr:{},child:[{tag:"path",attr:{d:"M12.6,20.936H11.3a.883.883,0,0,1-.852-.654l-.774-2.833-2.5,1.435a.886.886,0,0,1-1.06-.138l-.925-.919a.884.884,0,0,1-.143-1.066l1.469-2.545L6.509,14.2l-2.787-.747a.882.882,0,0,1-.654-.851V11.3a.882.882,0,0,1,.652-.85l2.839-.777L5.12,7.171a.885.885,0,0,1,.141-1.062l.918-.918A.885.885,0,0,1,7.24,5.049L9.792,6.514l.012,0,.745-2.79a.881.881,0,0,1,.851-.655h1.3a.883.883,0,0,1,.852.655l.762,2.838,2.509-1.441a.885.885,0,0,1,1.059.138l.926.919a.882.882,0,0,1,.141,1.067L17.483,9.777l.008.022,2.786.746a.883.883,0,0,1,.653.851v1.3a.883.883,0,0,1-.654.852l-2.837.774,1.439,2.505a.881.881,0,0,1-.141,1.063l-.917.917a.888.888,0,0,1-1.063.141l-2.539-1.462L14.2,17.5l-.745,2.785A.885.885,0,0,1,12.6,20.936Zm-1.21-1h1.119l.738-2.756a.888.888,0,0,1,.528-.592l.134-.052a.873.873,0,0,1,.76.057l2.51,1.445.789-.789-1.423-2.478a.881.881,0,0,1-.048-.78l.052-.125a.875.875,0,0,1,.584-.51l2.8-.749v-1.12l-2.755-.737a.885.885,0,0,1-.592-.529l-.052-.132a.882.882,0,0,1,.057-.763L18.04,6.818l-.8-.79-2.48,1.425a.878.878,0,0,1-.772.052l-.115-.047a.888.888,0,0,1-.518-.588l-.748-2.806H11.492l-.738,2.762a.883.883,0,0,1-.539.6l-.12.045a.874.874,0,0,1-.751-.058L6.822,5.962l-.789.789L7.455,9.227a.886.886,0,0,1,.046.785l-.051.12a.876.876,0,0,1-.579.5l-2.8.758v1.121l2.757.738a.889.889,0,0,1,.591.525l.048.121a.874.874,0,0,1-.055.77L5.958,17.181l.8.791,2.47-1.419a.878.878,0,0,1,.787-.045l.106.044a.874.874,0,0,1,.526.591ZM9.75,17.482l.008,0ZM9.6,17.421l.007,0ZM6.487,14.147h0Zm.044-4.411h0Zm7.724-3.2Z"},child:[]},{tag:"path",attr:{d:"M12,15a3,3,0,1,1,3-3A3,3,0,0,1,12,15Zm0-5a2,2,0,1,0,2,2A2,2,0,0,0,12,10Z"},child:[]}]}]}]})(r)}const fI=()=>{const[r,e]=Ie.useState(!1),[t,n]=Ie.useState("Login"),i=nb(),s=()=>{setTimeout(()=>{e(!r),a()},5e3),n(ce.jsxs("span",{className:"w-full flex justify-center items-center  gap-2",children:["Please Wait ",ce.jsx(Nh,{size:24,className:"animate-spin"})]}))};function a(){setTimeout(()=>{i("/onboard")},4e3)}return ce.jsxs("section",{className:"w-full h-screen bg-gray-50 items-center relative justify-center ",children:[ce.jsx("div",{className:`${r?"left-0 transition-[left] duration-500":"left-[2000px] transition-[left] duration-500"}   w-full h-full bg-white/[0.6] p-3 fixed rounded-md shadow-xl flex justify-center items-center`,children:ce.jsxs("div",{className:"w-[350px] h-[200px] bg-white shadow-2xl rounded-lg p-5 flex flex-col items-center justify-center gap-4",children:[ce.jsx("h1",{children:"Well Done!"}),ce.jsxs("p",{className:"uppercase text-center",children:["You have successfully Logged in as",ce.jsx("span",{className:"text-green-600 font-semibold ",children:" Agent"})]}),ce.jsxs("p",{className:"p-3 border border-green-600 rounded-md flex items-center  gap-2",children:["Redirecting",ce.jsxs("span",{children:[" ",ce.jsx(Nh,{size:24,className:"animate-spin"})]})]})]})}),ce.jsxs("div",{className:"bg-white p-4 w-full sm:w-1/2 md:w-2/5 mx-auto flex flex-col gap-4",children:[ce.jsx("h1",{className:"text-4xl text-center font-bold text-gray-800",children:"Welcome Back"}),ce.jsx("form",{className:"flex justify-center",children:ce.jsxs("div",{className:"w-full max-w-full",children:[ce.jsx("h1",{className:"text-center font-bold",children:"Agent"}),ce.jsxs("form",{className:"bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4",children:[ce.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[ce.jsx(La,{type:"text",label:"Email"}),ce.jsx(La,{type:"password",label:"Password"})]}),ce.jsxs("div",{className:"flex items-center justify-between",children:[ce.jsx("button",{className:"w-1/2 mt-3 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline ",type:"button",onClick:s,children:t}),ce.jsx("a",{className:"inline-block align-baseline font-bold text-sm text-blue-500 hover:text-blue-800",href:"#",children:"Forgot Password?"})]})]}),ce.jsxs("p",{className:"text-center text-gray-500 text-xs",children:["©",new Date().getFullYear()," Tele-Med-Care. All rights reserved."]})]})})]})]})},mI=()=>{const[r,e]=Ie.useState(1),[t,n]=Ie.useState(!1),[i,s]=Ie.useState({name:"",gender:"",lga:"",town:"",phone:"",email:"",password:""}),a=[{id:1,name:"Agent"},{id:2,name:"Patient"},{id:3,name:"Doctor"}];Ie.useEffect(()=>{console.log(i)},[i]);const[c,o]=Ie.useState("Sign Up"),l=()=>{setTimeout(()=>{n(!t)},5e3),o(ce.jsxs("span",{className:"w-full flex justify-center items-center gap-2",children:["Please Wait ",ce.jsx(Nh,{size:24,className:"animate-spin"})]}))},u=h=>{const{name:f,value:g}=h.target;s(p=>({...p,[f]:g}))};return ce.jsxs("section",{className:"w-full h-screen bg-gray-50 items-center relative justify-center",children:[ce.jsx("div",{className:`${t?"left-0 transition-[left] duration-500":"left-[2000px] transition-[left] duration-500"} w-full h-full bg-white/[0.6] p-3 fixed rounded-md shadow-xl flex justify-center items-center`,children:ce.jsxs("div",{className:"w-[350px] h-[200px] bg-white shadow-2xl rounded-lg p-5 flex flex-col items-center justify-center gap-4",children:[ce.jsx("h1",{children:"Well Done!"}),ce.jsxs("p",{className:"uppercase text-center",children:["You have successfully Registered as"," ",ce.jsx("span",{className:"text-green-600 font-semibold",children:a[r-1].name})]}),ce.jsxs(Eh,{to:"/signin",className:"p-3 border border-green-600 rounded-md flex items-center gap-2",children:["Proceed to SignIn"," ",ce.jsx("span",{children:ce.jsx(Nh,{size:24,className:"animate-spin"})})]})]})}),ce.jsxs("div",{className:"bg-white p-4 w-full sm:w-1/2 md:w-2/5 mx-auto flex flex-col gap-4",children:[ce.jsx("h1",{className:"text-4xl text-center font-bold text-gray-800",children:"Signup As"}),ce.jsx("div",{className:"flex w-full bg-green-500 justify-between pt-2 px-1 my-4 rounded-t-md gap-1",children:a.map(({id:h,name:f})=>ce.jsx("button",{className:`flex justify-center w-full font-semibold h-full border-x-[1px] border-t-[1px] border-white py-3 rounded-t-md shadow-md text-white outline-none ${r===h?"bg-white !text-green-600":"text-white"}`,onClick:()=>e(h),children:f},h))}),ce.jsx("form",{className:"flex justify-center",onSubmit:u,children:ce.jsxs("div",{className:"w-full max-w-full",children:[ce.jsx("h1",{className:"text-center font-bold",children:a[r-1].name}),ce.jsxs("form",{className:"bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4 ",o:!0,children:[ce.jsx("div",{className:"grid grid-cols-2 gap-4",children:ce.jsxs("div",{className:"col-span-2",children:[ce.jsx(La,{type:"text",label:"name",name:"name",handleChange:u}),ce.jsx(La,{type:"text",label:"gender",name:"gender",handleChange:u}),ce.jsx(La,{type:"text",label:"lga",name:"lga",handleChange:u}),ce.jsx(La,{type:"text",label:"town",name:"town",handleChange:u}),ce.jsx(La,{type:"number",label:"phone",name:"phone",handleChange:u}),ce.jsx(La,{type:"text",label:"email",name:"email",handleChange:u}),ce.jsx(La,{type:"password",label:"password",name:"password",handleChange:u})," "]})}),ce.jsx("div",{className:"flex items-center justify-between",children:ce.jsx("button",{className:"w-full mt-3 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",type:"button",onClick:l,children:c})})]}),ce.jsxs("p",{className:"text-center text-gray-500 text-xs",children:["©",new Date().getFullYear()," Tele-Med-Care. All rights reserved."]})]})})]})]})},gI=()=>ce.jsx("div",{children:"NotFound"});function Ny(r){return ko({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M18.39 14.56C16.71 13.7 14.53 13 12 13s-4.71.7-6.39 1.56A2.97 2.97 0 0 0 4 17.22V20h16v-2.78c0-1.12-.61-2.15-1.61-2.66zM9.78 12h4.44c1.21 0 2.14-1.06 1.98-2.26l-.32-2.45C15.57 5.39 13.92 4 12 4S8.43 5.39 8.12 7.29L7.8 9.74c-.16 1.2.77 2.26 1.98 2.26z"},child:[]}]})(r)}const vI=()=>{const r=[{title:"Onboard Patient",to:"/onboarding",text:"Start the process of registering a new patient. Gather necessary personal and medical information to ensure a smooth onboarding experience.",icon:ce.jsx(ax,{size:24,className:"text-white"})},{title:"Request Care",to:"/request-care",text:"Submit a request htmlFor medical care. Choose from a variety of services and schedule appointments at your convenience.",icon:ce.jsx(sx,{size:24,className:"text-white"})},{title:"Fund Wallet",to:"/fund",text:"Add funds to your wallet to easily pay htmlFor medical services. Keep track of your balance and transaction history.",icon:ce.jsx(ox,{size:24,className:"text-white"})},{title:"Fund Patient",to:"/fund-patient",text:"Contribute funds to support a patient's medical expenses. Help others receive the care they need by donating directly to their healthcare costs.",icon:ce.jsx(ix,{size:24,className:"text-white"})}],[e,t]=Ie.useState(!1),[n,i]=Ie.useState([]),[s,a]=Ie.useState(!1),[c,o]=Ie.useState({}),[l,u]=Ie.useState(!1);Ie.useEffect(()=>{Object.keys(c).length>0&&i(g=>[...g,c])},[c]);const h=g=>{g.preventDefault();const p=new FormData(g.target),d=Object.fromEntries(p.entries());o(d),g.target.reset()},f=()=>{a(!1),console.log(n)};return ce.jsxs("div",{className:"h-screen w-full bg-gray-50",children:[ce.jsx("div",{className:`${s?"left-0 transition-[left] duration-500":"left-[2000px] transition-[left] duration-500"}   w-full min-h-full bg-white/[0.6] p-3 z-10 fixed rounded-md shadow-xl flex justify-center items-center`,children:ce.jsxs("div",{className:" relative bg-white shadow-2xl rounded-lg p-5 flex flex-col items-center justify-center gap-4",children:[ce.jsx(cx,{size:24,className:"absolute top-2 cursor-pointer right-2 text-red-500",onClick:()=>a(!s)}),ce.jsxs("form",{className:"w-full max-w-lg",onSubmit:h,children:[ce.jsxs("div",{className:"flex flex-wrap -mx-3 mb-6",children:[ce.jsxs("div",{className:"w-full md:w-1/2 px-3 mb-6 md:mb-0",children:[ce.jsx("label",{className:"block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2",htmlFor:"grid-first-name",children:"Name"}),ce.jsx("input",{className:"appearance-none block w-full bg-gray-200 text-gray-700 border b rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white",id:"name",name:"username",type:"text",placeholder:"Name"})]}),ce.jsxs("div",{className:"w-full md:w-1/2 px-3",children:[ce.jsx("label",{className:"block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2",htmlFor:"Email",children:"Email"}),ce.jsx("input",{className:"appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500",id:"email",type:"email",name:"email",placeholder:"Bukola"})]})]}),ce.jsx("div",{className:"flex flex-wrap -mx-3 mb-6",children:ce.jsxs("div",{className:"w-full px-3",children:[ce.jsx("label",{className:"block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2",htmlFor:"grid-password",children:"D-O-B"}),ce.jsx("input",{className:"appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 mb-3 leading-tight focus:outline-none focus:bg-white focus:border-gray-500",id:"date",type:"date",name:"date"})]})}),ce.jsxs("div",{className:"flex flex-wrap -mx-3 mb-2",children:[ce.jsxs("div",{className:"w-full md:w-1/3 px-3 mb-6 md:mb-0",children:[ce.jsx("label",{className:"block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2",htmlFor:"grid-city",children:"Phone Number"}),ce.jsx("input",{className:"appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500",id:"number",type:"number",placeholder:"08068483822",name:"number"})]}),ce.jsxs("div",{className:"w-full md:w-1/3 px-3 mb-6 md:mb-0",children:[ce.jsx("label",{className:"block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2",htmlFor:"grid-state",children:"Gender"}),ce.jsxs("div",{className:"relative",children:[ce.jsxs("select",{className:"block appearance-none w-full bg-gray-200 border border-gray-200 text-gray-700 py-3 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white focus:border-gray-500",id:"gender",name:"gender",children:[ce.jsx("option",{selected:!0,hidden:!0,children:"Gender"}),ce.jsx("option",{defaultValue:"male",children:"Male"}),ce.jsx("option",{defaultValue:"female",children:"Female"})]}),ce.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:ce.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:ce.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]})]}),ce.jsxs("div",{className:"w-full md:w-1/3 px-3 mb-6 md:mb-0",children:[ce.jsx("label",{className:"block uppercase tracking-wide text-gray-700 text-xs font-bold mb-2",htmlFor:"grid-zip",children:"Address"}),ce.jsx("input",{className:"appearance-none block w-full bg-gray-200 text-gray-700 border border-gray-200 rounded py-3 px-4 leading-tight focus:outline-none focus:bg-white focus:border-gray-500",id:"address",type:"text",placeholder:"L/B Iluppeju",name:"address"})]}),ce.jsx("div",{className:"w-full  px-3 mb-6 md:mb-0",children:ce.jsx("button",{type:"submit",className:"w-full rounded-md bg-green-600 hover:bg-green-500 uppercase py-3 font-semibold text-white px-3 mb-6 md:mb-0 block mt-3",onClick:f,children:"Onboard"})})]})]})]})}),ce.jsxs("div",{className:"w-full flex justify-center flex-col gap-4",children:[ce.jsxs("div",{className:"flex justify-between md:px-10 px-4 py-5",children:[ce.jsx("h1",{className:"text-md font-bold text-center items-center",children:"Welcome to to Tele-Med-Care"}),ce.jsxs("div",{children:[ce.jsx("p",{children:"Ekt/16/0011"}),ce.jsxs("p",{children:["Mr. ","Name"]})]}),ce.jsxs("div",{className:"relative ",children:[ce.jsx(Ny,{size:30,className:"cursor-pointer",onClick:()=>t(!e)}),ce.jsxs("div",{className:`${e?"block":" hidden "} p-4 bg-white absolute right-0 min-w-[300px] shadow-lg`,children:[ce.jsxs("p",{className:"text-sm border-b-[1px] pb-1 mb-2 text-right flex justify-between items-center",children:[ce.jsx("span",{children:ce.jsx(Ny,{size:24})}),ce.jsxs("span",{children:["Your Status:",ce.jsx("span",{className:"text-blue-600 font-semibold",children:"Agent"})]})]}),n.length>0&&ce.jsx("div",{className:"flex flex-col gap-2",children:n==null?void 0:n.map((g,p)=>ce.jsxs("div",{className:"border-b-2 last:border-none border-gray-200 p-2",children:[ce.jsxs("p",{className:"text-sm",children:[" Patient ",p+1]}),ce.jsxs("div",{children:[ce.jsxs("p",{className:"text-[10px]",children:["Name: ",g==null?void 0:g.username]}),ce.jsxs("p",{className:"text-[10px]",children:["Email: ",g==null?void 0:g.email]})]})]},p))}),n.length===0&&ce.jsx("p",{children:"You Have no Onboarded Patient"})]})]})]}),ce.jsx("div",{className:"w-full h-full mt-10 py-20 bg-white min-h-20 p-4 shadow-md flex justify-center",children:ce.jsxs("div",{className:"md:w-2/3 lg:w-1/2 w-full",children:[!l&&ce.jsx("h1",{className:"text-center text-4xl font-bold text-green-600 ",children:"I want to"}),l?ce.jsx("div",{className:"flex items-center justify-center",children:ce.jsxs("div",{className:"grid grid-cols-2 min-w-[300px] gap-2",children:[ce.jsx("h1",{className:"col-span-2 text-center my-2 font-bold",children:"Send A request via"}),ce.jsxs("button",{className:"border border-green-600 h-[200px]  rounded-md  hover:bg-green-600 hover:text-white cursor-not-allowed transition-all duration-300 relative overflow-hidden",children:[ce.jsx("div",{className:"absolute rotate-[45deg] -right-16 top-7 text-nowrap text-white bg-red-600 w-[200px]",children:"Coming Soon"}),"Image Upload"]}),ce.jsxs("button",{className:"border border-green-600 h-[200px] rounded-md  cursor-not-allowed hover:bg-green-600 hover:text-white transition-all duration-300 relative overflow-hidden",children:[ce.jsx("div",{className:"absolute rotate-[45deg] -right-16 top-7 text-nowrap text-white bg-red-600 w-[200px]",children:"Coming Soon"}),"Voice Record"]}),ce.jsx(Eh,{to:"/media",className:"border flex justify-center items-center border-green-600 h-[200px] rounded-md  col-span-2 hover:bg-green-600 hover:text-white transition-all duration-300",children:"Live Chat"})]})}):ce.jsx("div",{className:"w-full",children:ce.jsxs("div",{className:"flex w-full flex-col  ",children:[ce.jsxs("div",{className:"w-full  text-center",children:[ce.jsx("h1",{className:"my-2 font-semibold",children:"Request for a Doctor Service"}),ce.jsxs("p",{className:"text-sm",children:["Patient ID: ",ce.jsx("span",{className:"",children:"Ek/533/3737"})]}),ce.jsx("p",{className:"text-sm",children:"Log your complains below using either file attachment, Video recording or file upload"})]}),ce.jsx("div",{className:"w-full mx-auto md:w-full p-3 ",children:ce.jsx("div",{className:"relative",children:ce.jsx("div",{className:"grid grid-cols-2 grid-rows-2 gap-5 mt-5",children:r.map(({title:g,text:p,icon:d})=>ce.jsxs("div",{onClick:()=>{g==="Onboard Patient"?a(!s):g==="Request Care"&&u(!l)},className:`p-4 text-center  flex flex-col justify-center items-center rounded-md text-gray-900  border-2 border-green-500 transition-[background] duration-300 overflow-hidden relative \r
              font-semibold font-md shadow-xl hover:shadow-md cursor-pointer \r
              `,children:[ce.jsx("span",{className:"h-12 w-12 bg-green-600 rounded-full flex justify-center items-center",children:d}),ce.jsxs("p",{className:"text-green-600 text-xl md:text-2xl",children:[" ",g]}),ce.jsx("p",{className:"text-sm text-gray-600 text-left",children:p})]},g))})})})]})})]})})]})]})},yI=Ie.createContext(),_I=({children:r})=>{const[e,t]=Ie.useState(null);return ce.jsx(yI.Provider,{value:{user:e,setUser:t},children:r})};function bI(){return ce.jsx(ce.Fragment,{children:ce.jsx(_I,{children:ce.jsx(HT,{children:ce.jsxs(FT,{children:[ce.jsx(na,{index:!0,element:ce.jsx(lx,{})}),ce.jsx(na,{path:"/agent",element:ce.jsx(ux,{})}),ce.jsx(na,{path:"/doctor",element:ce.jsx(hI,{})}),ce.jsx(na,{path:"/patient",element:ce.jsx(pI,{})}),ce.jsx(na,{path:"/signin",element:ce.jsx(fI,{})}),ce.jsx(na,{path:"/signup",element:ce.jsx(mI,{})}),ce.jsx(na,{path:"/onboard",element:ce.jsx(vI,{})}),ce.jsx(na,{path:"/media",element:ce.jsx(hw,{})}),ce.jsx(na,{path:"*",element:ce.jsx(gI,{})})]})})})})}uf.createRoot(document.getElementById("root")).render(ce.jsx(gs.StrictMode,{children:ce.jsx(bI,{})}));export{Xi as _,Fh as g,b2 as p,Ie as r,ip as u};
